import{r as e}from"./index-I9YdvN_r.js";import{drawGif as i}from"./Utils-CEk6tUlw.js";import{e as a}from"./FlashMessage-ghB6f3ER.js";import"./style-D-IRYiWS.js";import"./flashMessageQueue-C7gl3k6c.js";import"./dynamic-import-helper-CTnsj-vI.js";import"./array-YYQw31d9.js";import"./Logger-cMW5At62.js";import"./string-BBKP9xfj.js";import"./info-DdD9a7JK.js";import"./globalKeyEventManager-C6pBx38h.js";import"./icon-close-DRlspKs3.js";import"./_plugin-vue2_normalizer-DeUNqxFl.js";class s{constructor(e){this.loadImageShape=async e=>{if(!this._engine.loadImage)throw new Error(`${a} image shape not initialized`);await this._engine.loadImage({gif:e.gif,name:e.name,replaceColor:e.replaceColor??!1,src:e.src})},this._engine=e}addImage(e){this._engine.images||(this._engine.images=[]),this._engine.images.push(e)}draw(e){const{context:a,radius:s,particle:t,opacity:o}=e,n=t.image,r=null==n?void 0:n.element;if(n){if(a.globalAlpha=o,n.gif&&n.gifData)i(e);else if(r){const e=n.ratio,i={x:-s,y:-s},t=2*s;a.drawImage(r,i.x,i.y,t,t/e)}a.globalAlpha=1}}getSidesCount(){return 12}async init(e){const i=e.actualOptions;if(i.preload&&this._engine.loadImage)for(const a of i.preload)await this._engine.loadImage(a)}loadShape(e){if("image"!==e.shape&&"images"!==e.shape)return;this._engine.images||(this._engine.images=[]);const i=e.shapeData;if(!i)return;this._engine.images.find((e=>e.name===i.name||e.source===i.src))||this.loadImageShape(i).then((()=>{this.loadShape(e)}))}particleInit(i,a){if("image"!==a.shape&&"images"!==a.shape)return;this._engine.images||(this._engine.images=[]);const s=this._engine.images,t=a.shapeData;if(!t)return;const o=a.getFillColor(),n=s.find((e=>e.name===t.name||e.source===t.src));if(!n)return;const r=t.replaceColor??n.replaceColor;n.loading?setTimeout((()=>{this.particleInit(i,a)})):(async()=>{let i;i=n.svgData&&o?await e(n,t,o,a):{color:o,data:n,element:n.element,gif:n.gif,gifData:n.gifData,gifLoopCount:n.gifLoopCount,loaded:!0,ratio:t.width&&t.height?t.width/t.height:n.ratio??1,replaceColor:r,source:t.src},i.ratio||(i.ratio=1);const s={image:i,fill:t.fill??a.shapeFill,close:t.close??a.shapeClose};a.image=s.image,a.shapeFill=s.fill,a.shapeClose=s.close})()}}export{s as ImageDrawer};