import{p as e}from"./persistStore-BDYPfxbs.js";import{H as t,T as a,a8 as i,D as s,M as o,e as n,V as c,R as d,u as l,ak as r,S as u,a as h,w as p,J as b}from"./dynamic-import-helper-CTnsj-vI.js";import{S as f,a as g}from"./state-S-uBOmbY.js";import{a as v}from"./array-YYQw31d9.js";import{O as y}from"./Logger-cMW5At62.js";import{T as S}from"./TabLeaderElection-Ddi84wmm.js";import{d as w,F as k}from"./focusModeState-BPyBLUbE.js";import{g as I}from"./focusModeHelpers-tDECULZC.js";import{useFocusModeDashViewStateStore as T}from"./focusModeViewState-DaeRKVyi.js";import{u as N}from"./pomodoroCompleted-B2E_m1QL.js";import{computed as A}from"./reactiveCustomization-CEUTOUc3.js";import{a as C}from"./IframeMessenger-Bn2-eCAG.js";import{useSoundsViewStateStore as x}from"./soundsViewState-D7LNJV4L.js";const O=.5,P="sounds:spotify:volumeWarning",V="Spotify may be loud: use device volume",G="Spotify may be loud: autoplay disabled, check device volume",M="Spotify’s player does not allow a volume control. You can still change volume by using your operating system controls.",E="sounds:spotify:logInWarning",B="Momentum can only play 30s song previews unless you're logged into Spotify in your browser. We don’t have access to your Spotify data.",j=[{label:"Recent",value:""},{label:"Soundscapes",value:f.Soundscapes},{label:"Spotify",value:f.Spotify},{label:"Youtube",value:f.Youtube},{label:"Custom",value:"custom"}],D="https://open.spotify.com",F=`${D}/oembed`,U="https://www.youtube.com",R=`${U}/oembed`,$="sounds:embeds:lastUpdated",L=e=>{const t=e.createGain();return t.gain.setValueAtTime(.001,e.currentTime),t},W=async(e,t,a)=>{const i=t.gain.value,s=i>a,o=e.currentTime,n=o+.5*(s?1.5:1);return 0===a&&0===i?Promise.resolve():(a<.001&&(a=.001),t.gain.cancelScheduledValues(o),t.gain.setValueAtTime(i,o),s?t.gain.exponentialRampToValueAtTime(a,n):t.gain.linearRampToValueAtTime(a,n),new Promise((i=>{const s=e.createBufferSource();s.buffer=e.createBuffer(1,1,e.sampleRate),s.connect(e.destination),s.start(n),s.addEventListener("ended",(()=>{const s=t.gain.value-.001<.001;.001===a&&s&&t.gain.setValueAtTime(0,e.currentTime),i()}))})))},K=(e,t)=>{const a=e.createStereoPanner();return a.pan.setValueAtTime(t,e.currentTime),a},q=(e,t)=>{const a=e.createOscillator();return a.type="sine",a.frequency.setValueAtTime(t,e.currentTime),a};class H{constructor(e,t,a,i,s){this.id=e,this.audioContext=i,this.started=!1,this.leftGainNode=L(this.audioContext),this.rightGainNode=L(this.audioContext),this.leftOscNode=q(this.audioContext,t),this.rightOscNode=q(this.audioContext,t+a),this.leftPannerNode=K(this.audioContext,-1),this.rightPannerNode=K(this.audioContext,1),this.leftGainNode.connect(this.leftPannerNode),this.rightGainNode.connect(this.rightPannerNode),this.leftPannerNode.connect(s),this.rightPannerNode.connect(s)}play(e){this.leftOscNode.connect(this.leftGainNode),this.rightOscNode.connect(this.rightGainNode),this.started||(this.leftOscNode.start(),this.rightOscNode.start(),this.started=!0),W(this.audioContext,this.leftGainNode,e),W(this.audioContext,this.rightGainNode,e)}async pause(){await Promise.all([W(this.audioContext,this.leftGainNode,0),W(this.audioContext,this.rightGainNode,0)]),0===this.volume&&(this.leftOscNode.disconnect(),this.rightOscNode.disconnect())}get volume(){return this.leftGainNode.gain.value}set volume(e){this.leftGainNode.gain.setValueAtTime(e,this.audioContext.currentTime),this.rightGainNode.gain.setValueAtTime(e,this.audioContext.currentTime)}}class Y{constructor(e,t,a,i){this.id=e,this.url=t,this.audioContext=a,this.started=!1,this.loading=!1,this.gainNode=L(this.audioContext),this.bufferSourceNode=this.audioContext.createBufferSource(),this.bufferSourceNode.loop=!0,this.gainNode.connect(i)}async loadAudioFile(){return t.get(this.url,{responseType:"arraybuffer"}).then((e=>this.audioContext.decodeAudioData(e.data))).then((e=>{this.bufferSourceNode.buffer=e}))}play(e){this.started||this.loading?this.started&&(this.bufferSourceNode.connect(this.gainNode),W(this.audioContext,this.gainNode,e)):(this.loading=!0,this.loadAudioFile().then((()=>{this.bufferSourceNode.start(),this.started=!0,this.play(e)})).catch((()=>{console.error("Unable to fetch audio file",this.id)})).finally((()=>{this.loading=!1})))}async pause(){await W(this.audioContext,this.gainNode,0),0===this.volume&&this.bufferSourceNode.disconnect()}get volume(){return this.gainNode.gain.value}set volume(e){this.gainNode.gain.setValueAtTime(e,this.audioContext.currentTime)}}const z={fire:{icon:"icon/sounds/flame",title:"Fire",url:"https://content.momentumdash.com/blogimages/276f1472-734e-492c-9138-c1584fb6cd80"},crickets:{icon:"icon/sounds/tent-tree",title:"Crickets",url:"https://content.momentumdash.com/blogimages/bdab645f-d5d8-4e1e-b6e4-cbd4677fbe92"},ocean:{icon:"icon/sounds/waves",title:"Ocean",url:"https://content.momentumdash.com/blogimages/3f851f30-5854-4fdb-805a-3f302ba56a81"},wind:{icon:"icon/sounds/wind",title:"Wind",url:"https://content.momentumdash.com/blogimages/ebcb630e-5cb3-4a64-a2d4-eec16c9abf41"},seagulls:{icon:"icon/sounds/waves-birds",title:"Seagulls",url:"https://content.momentumdash.com/blogimages/c0b4e5c6-ab66-42ce-aea3-5d6a419583cb"},tracks:{icon:"icon/sounds/train-track",title:"Train Tracks",url:"https://content.momentumdash.com/blogimages/38228a91-cfa9-45b1-ada9-c16b619c2568"},rainOnSurface:{icon:"icon/sounds/cloud-rain-wind",title:"Rain on Surface",url:"https://content.momentumdash.com/blogimages/08e95b57-7dbe-4ba8-83a7-8b19fc254ae1"},rain:{icon:"icon/sounds/umbrella",title:"Rain",url:"https://content.momentumdash.com/blogimages/eac6cdc4-1f53-4fc5-92dd-0a4c053de028"},birds:{icon:"icon/sounds/bird",title:"Birds",url:"https://content.momentumdash.com/blogimages/84d9d4e7-1d54-4300-a347-8f2650eafd51"},insects:{icon:"icon/sounds/bug",title:"Insects",url:"https://content.momentumdash.com/blogimages/5875d483-396c-4bfe-a5d4-160384c18832"},chimes:{icon:"icon/sounds/chimes",title:"Chimes",url:"https://content.momentumdash.com/blogimages/c30b03c9-91e0-43ce-9aa9-199e7aa0b76a"},cafe:{icon:"icon/sounds/coffee",title:"Cafe",url:"https://content.momentumdash.com/blogimages/6f8cf03d-c7f2-45b7-898d-576385236122"},coffeeMaker:{icon:"icon/sounds/coffeemaker",title:"Coffee Maker",url:"https://content.momentumdash.com/blogimages/43769f50-e91e-4595-91b4-8248372f39d2"},thunder:{icon:"icon/sounds/zap",title:"Thunder",url:"https://content.momentumdash.com/blogimages/8291e604-c11a-4b45-b844-2e464527a2e1"},loudRain:{icon:"icon/sounds/droplets",title:"Loud Rain",url:"https://content.momentumdash.com/blogimages/31fca0bf-8792-458f-8c13-f605b5618275"},stream:{icon:"icon/sounds/creek",title:"Stream",url:"https://content.momentumdash.com/blogimages/2374f3af-35fd-4ab8-96c3-5e70775ca33a"},coWorkers:{icon:"icon/sounds/speech",title:"Co-Workers",url:"https://content.momentumdash.com/blogimages/7a5fc995-0278-4386-bf30-b5672dfdd95b"},copier:{icon:"icon/sounds/printer",title:"Copier",url:"https://content.momentumdash.com/blogimages/3e1f826c-dca2-4fe7-a10f-bf07c56ecfa8"},airConditioner:{icon:"icon/sounds/air-vent",title:"Air Conditioner",url:"https://content.momentumdash.com/blogimages/e55e01b5-6fe8-43b3-b50b-18ce4f670472"},fluorescentHum:{icon:"icon/sounds/fluorescent",title:"Fluorescent Hum",url:"https://content.momentumdash.com/blogimages/58fdb1ba-8821-4abe-8daf-704ee656e369"},mechanicalKeyboard:{icon:"icon/sounds/keyboard",title:"Mechanical Keyboard",url:"https://content.momentumdash.com/blogimages/f295aec4-9d59-47b2-b31a-ba88f23d4628"},binauralMusic:{icon:"icon/sounds/music",title:"Binaural Music",url:"https://content.momentumdash.com/blogimages/2bac8323-2a2f-4d55-93a8-2f988b81e71c"},oceanWaves:{icon:"icon/sounds/waves",title:"Ocean Waves",url:"https://content.momentumdash.com/blogimages/179cb427-0d11-4b87-aa7f-ee57ee4228e4"},oceanBirds:{icon:"icon/sounds/waves-birds",title:"Ocean Birds",url:"https://content.momentumdash.com/blogimages/f9898015-baa1-49a0-a0b2-706423293d58"},oceanSplash:{icon:"icon/sounds/ocean-splash",title:"Ocean Splash",url:"https://content.momentumdash.com/blogimages/cc6f13b2-b6f9-4847-8374-f6a60ab0a88e"},oceanBubbles:{icon:"icon/sounds/ocean-bubbles",title:"Ocean Bubbles",url:"https://content.momentumdash.com/blogimages/cf998930-0b21-491e-bd81-31ded5bb6374"},oceanBoat:{icon:"icon/sounds/sailboat",title:"Ocean Boat",url:"https://content.momentumdash.com/blogimages/ed7871c2-d338-4e40-b147-4bd14cbc5fce"},brownNoise:{icon:"icon/sounds/noise-brown",title:"Brown Noise",url:"https://content.momentumdash.com/blogimages/6b3a6411-4bb3-405b-b950-bfa39b50f0a0"},greenNoise:{icon:"icon/sounds/noise-green",title:"Green Noise",url:"https://content.momentumdash.com/blogimages/bd4db9c8-751d-4dc3-9d0e-47f0eabf8352"},pinkNoise:{icon:"icon/sounds/noise-pink",title:"Pink Noise",url:"https://content.momentumdash.com/blogimages/fd25b1c1-eb5f-42e1-9987-d1561e6cedeb"},whiteNoise:{icon:"icon/sounds/noise-white",title:"White Noise",url:"https://content.momentumdash.com/blogimages/1eb0e3e7-bdce-458b-a162-2f0d71b1aee9"},airplaneCabin:{icon:"icon/sounds/plane",title:"Airplane Cabin",url:"https://content.momentumdash.com/blogimages/1f20412d-c25d-4d1b-876c-630245553678"},speechBlocker:{icon:"icon/sounds/speech-blocker",title:"Speech Blocker",url:"https://content.momentumdash.com/blogimages/f15fa784-2077-431f-b969-19bf99a87589"},binauralDelta:{icon:"icon/sounds/binaural-delta",title:"Delta (δ) Sleep",frequency:98,difference:2},binauralTheta:{icon:"icon/sounds/binaural-theta",title:"Theta (θ) Relax",frequency:92,difference:8},binauralAlpha:{icon:"icon/sounds/binaural-alpha",title:"Alpha (α) Relax",frequency:170,difference:10},binauralBeta:{icon:"icon/sounds/binaural-beta",title:"Beta (β) Alertness",frequency:125,difference:25},binauralGamma:{icon:"icon/sounds/binaural-gamma",title:"Gamma (γ) Focus",frequency:170,difference:40}};class _{constructor(){this.globalAudioContext=new AudioContext,this.globalGainNode=this.globalAudioContext.createGain(),this.globalGainNode.connect(this.globalAudioContext.destination),this.mediaSessionAudioElement=new Audio("/sounds/silence.mp3"),this.mediaSessionAudioElement.loop=!0,this.activeTracks=new Set([]),this.pausedTracks=new Set([]),this.tracks=Object.entries(z).reduce(((e,[t,a])=>(e[t]="url"in a?new Y(t,a.url,this.globalAudioContext,this.globalGainNode):new H(t,a.frequency,a.difference,this.globalAudioContext,this.globalGainNode),e)),{})}async playTrack(e,t){const a=this.tracks[e];a&&(0===this.activeTracks.size&&(await this.globalAudioContext.resume(),await this.mediaSessionAudioElement.play()),a.play(t),this.activeTracks.add(e))}async pauseTrack(e){const t=this.tracks[e];t&&(this.activeTracks.delete(e),await t.pause(),0===this.activeTracks.size&&"suspended"!==this.globalAudioContext.state&&(this.mediaSessionAudioElement.pause(),await this.globalAudioContext.suspend()))}setTrackVolume(e,t){const a=this.tracks[e];a&&(a.volume=t,0===t&&a.pause())}setGlobalVolume(e){0===this.globalGainNode.gain.value&&0!==e&&(this.pausedTracks.forEach((t=>{this.playTrack(t,e)})),this.pausedTracks.clear()),this.globalGainNode.gain.setValueAtTime(e,this.globalAudioContext.currentTime),0===e&&this.activeTracks.forEach((e=>{this.pausedTracks.add(e),this.pauseTrack(e)}))}}class J{constructor(e){this.dataSyncService=e}get(e){this.dataSyncService.get(e)}create(e){return this.dataSyncService.create(e.id,e)}update(e,t){return this.dataSyncService.update(e,t)}delete(e){return this.dataSyncService.delete(e)}}var Q=(e=>(e.Album="album",e.Track="track",e.Playlist="playlist",e))(Q||{});class X{constructor({id:e=v(),type:t=f.Spotify,title:a="",thumbnailSrc:i="",externalId:s="",externalType:o="playlist",refreshTimestamp:n=0,custom:c=!1}){this.id=e,this.type=t,this.title=a,this.thumbnailSrc=i,this.externalId=s,this.externalType=o,this.refreshTimestamp=n,this.custom=c}get messengerPath(){return`sounds/${this.type}`}}const Z=new y("sounds/embeds");const ee=new a("tab.oembed",.1);const te=new class{async getData(e){try{const{data:a}=await t.get(e),i=document.createElement("div");return i.innerHTML=a.html,{title:a.title,thumbnailUrl:a.thumbnail_url,iframeUrl:i.children[0].getAttribute("src")}}catch(a){throw ee.error(a),i(a,{default:"We couldn't find any music under this link. Please ensure the link is not private or hidden."})}}};class ae{constructor(e){this.dataSyncService=e}get(e){this.dataSyncService.get(e)}create(e){return this.dataSyncService.create(e.id,e)}update(e,t){return this.dataSyncService.update(e,t)}delete(e){return this.dataSyncService.delete(e)}async getConfigData(){const e=await(Z.getConfig()??{});return[...(null==e?void 0:e.spotify.map((e=>({id:e.id,type:f.Spotify,title:e.title,thumbnailSrc:e.thumbnailUrl,externalId:e.id,externalType:Q.Playlist,refreshTimestamp:1/0,custom:!1}))))??[],...(null==e?void 0:e.youtube.map((e=>({id:e.id,type:f.Youtube,title:e.title,thumbnailSrc:e.thumbnailUrl,externalId:e.id,externalType:Q.Track,refreshTimestamp:1/0,custom:!1}))))??[]]}async getExternalInfoForLink(e){let t,a,i,s;return e.includes("open.spotify.com")?(t=f.Spotify,i=await te.getData(`${F}?url=${encodeURIComponent(e)}&format=json`).catch((()=>{})),(null==i?void 0:i.iframeUrl)&&(i.iframeUrl.includes("/playlist/")?a=Q.Playlist:i.iframeUrl.includes("/track/")?a=Q.Track:i.iframeUrl.includes("/album/")&&(a=Q.Album),s=new URL(i.iframeUrl).pathname.split("/").at(-1))):(e.includes("youtu.be")||e.includes("youtube.com"))&&(t=f.Youtube,i=await te.getData(`${R}?url=${encodeURIComponent(e)}&format=json`).catch((()=>{})),(null==i?void 0:i.iframeUrl)&&(i.iframeUrl.includes("/videoseries")?(a=Q.Playlist,s=new URL(i.iframeUrl).searchParams.get("list")):(a=Q.Track,s=new URL(i.iframeUrl).pathname.split("/").at(-1)))),{type:t,externalType:a,thumbnailSrc:null==i?void 0:i.thumbnailUrl,title:null==i?void 0:i.title,externalId:s,link:e}}}const ie=()=>({soundsSoundscapesTracksPlayerService:new _,soundsSoundscapesService:new J(new s("soundsSoundscapes",{mode:o.Cache})),soundsEmbedsService:new ae(new s("soundsEmbeds",{mode:o.TimestampStrict,path:"sounds/embeds/custom",useUpdateMask:!0}))});class se{constructor({id:e=v(),icon:t="icon/apps/sounds",title:a="",thumbnailSrc:i="",defaultKey:s="",defaultDeleted:o=!1,singleTrackOnly:n=!1,tracks:c=[],custom:d=!1}){this.id=e,this.icon=t,this.title=a,this.thumbnailSrc=i,this.defaultKey=s,this.defaultDeleted=o,this.singleTrackOnly=n,this.type=f.Soundscapes,this.tracks=c,this.custom=d}}const oe=(ne=[{id:"8490eba8-6703-4d4e-9511-1ebed3eaffc1",title:"Noise",key:"noise",icon:"icon/sounds/white-noise",singleTrackOnly:!0,tracks:[{id:"brownNoise",volume:1},{id:"greenNoise",volume:1},{id:"pinkNoise",volume:1},{id:"whiteNoise",volume:1},{id:"airplaneCabin",volume:1},{id:"speechBlocker",volume:1}]},{id:"61e3c71c-aac7-4f20-bbcc-c8b3c0c5ddad",title:"Binaural",key:"binaural",icon:"icon/sounds/binaural",singleTrackOnly:!0,tracks:[{id:"binauralDelta",volume:1},{id:"binauralTheta",volume:1},{id:"binauralAlpha",volume:1},{id:"binauralBeta",volume:1},{id:"binauralGamma",volume:1},{id:"binauralMusic",volume:1}]},{id:"53b01a5c-c458-4fc1-8460-72a809355775",title:"Ocean",key:"ocean",icon:"icon/sounds/ship",tracks:[{id:"oceanBoat",volume:.5},{id:"oceanWaves",volume:.3},{id:"oceanBirds",volume:.2},{id:"oceanSplash",volume:.5},{id:"oceanBubbles",volume:.8}]},{id:"289afcfa-6f78-4440-b495-2ce9b04d9e2c",title:"Campfire",key:"campfire",icon:"icon/sounds/flame-kindling",tracks:[{id:"fire",volume:.9},{id:"crickets",volume:.2}]},{id:"c51f90b7-2b8d-4480-8b52-5e74f844754d",title:"Beach",key:"beach",icon:"icon/sounds/palm-tree-island-sun",tracks:[{id:"ocean",volume:.5},{id:"wind",volume:.15},{id:"seagulls",volume:.05}]},{id:"a8689038-2a3c-42b3-b447-01ea2b725ea6",title:"Train",key:"train",icon:"icon/sounds/train-front",tracks:[{id:"tracks",volume:.9},{id:"wind",volume:.1}]},{id:"6b6a0fdb-279a-4a7d-91f0-dee889662be3",title:"Rainfall",key:"rainfall",icon:"icon/sounds/cloud-rain-wind",tracks:[{id:"rainOnSurface",volume:.5},{id:"rain",volume:.5}]},{id:"0983192d-93bc-4df1-8cea-93ee10d74f70",title:"Forest",key:"forest",icon:"icon/sounds/trees",tracks:[{id:"birds",volume:.75},{id:"wind",volume:.1},{id:"insects",volume:.05}]},{id:"8b603dd4-429a-4185-b07b-ff588f36c366",title:"Garden",key:"garden",icon:"icon/sounds/garden",tracks:[{id:"chimes",volume:.5},{id:"insects",volume:.01},{id:"wind",volume:.1}]},{id:"68a096d5-e57e-4c50-9758-7cad011562aa",title:"Café",key:"cafe",icon:"icon/sounds/coffee",tracks:[{id:"cafe",volume:.7},{id:"coffeeMaker",volume:.1}]},{id:"e491a1b5-1f63-44c9-bd97-4c148c5b573f",title:"Thunderstorm",key:"thunderstorm",icon:"icon/sounds/cloud-lightning",tracks:[{id:"thunder",volume:.9},{id:"loudRain",volume:.55},{id:"wind",volume:.45},{id:"rain",volume:.25}]},{id:"a810c333-5c40-4840-b269-8c964efe55d5",title:"Creek",key:"creek",icon:"icon/sounds/creek",tracks:[{id:"stream",volume:.2},{id:"wind",volume:.1}]},{id:"3d98b606-b8c6-4ba3-9b60-f36505fefe6a",title:"Office",key:"office",icon:"icon/sounds/building",tracks:[{id:"coWorkers",volume:.13},{id:"copier",volume:.08},{id:"airConditioner",volume:.07},{id:"fluorescentHum",volume:.03},{id:"mechanicalKeyboard",volume:.01}]},{id:"ff168191-2fed-4262-a380-696b6cb1631a",title:"Custom",key:"custom",icon:"icon/sounds/custom",tracks:Object.keys(z).map((e=>({id:e,volume:.5,active:!1,advanced:!1}))),custom:!0}],Object.fromEntries(ne.map((e=>[e.id,{id:e.id,type:f.Soundscapes,title:e.title,tracks:e.tracks.map(((t,a)=>({...t,active:void 0===t.active&&(!e.singleTrackOnly||0===a),advanced:!1}))),lastPlayedAt:0,defaultKey:e.key,defaultDeleted:!1,singleTrackOnly:!!e.singleTrackOnly,thumbnailSrc:"custom"===e.key?"":`/img/sounds/${e.key}.jpg`,icon:e.icon,custom:!!e.custom}]))));var ne;const ce=(({soundsSoundscapesService:e,soundsSoundscapesTracksPlayerService:t}=ie())=>n("soundsSoundscapes",{state:()=>({data:{},loading:!1,loaded:!1}),getters:{items:e=>(e=>{const t=Object.values(e);return Object.values(oe).reduce(((e,a)=>(t.some((e=>e.defaultKey===a.defaultKey))||e.push(a),e)),t).filter((e=>!e.defaultDeleted))})(e.data).map((e=>new se(e))),getSoundscapeOrDefaultFromId(e){const t=e.data;return e=>{const a=oe[e],i=t[e]??(a&&{...a,tracks:[...a.tracks.map((e=>({...e})))]});if(i)return new se(i)}}},actions:{refresh(t){this.loaded&&!(null==t?void 0:t.force)||(this.loading=!0,e.get({success:e=>{this.data=Object.fromEntries(e.map((e=>[e.id,e]))),this.loaded=!0,this.loading=!1},failure:()=>{this.loading=!1}}))},async create(t){c.set(this.data,t.id,t),await e.create(t)},async update(t,a){const i=this.getSoundscapeOrDefaultFromId(t);if(!this.data[t]&&i)return this.create({...i,...a});const s=this.data[t];if(!s)throw new d({message:`No Soundscape found with id: ${t}`});c.set(this.data,t,{...s,...a}),await e.update(t,a)},async delete(t,a){const i=this.getSoundscapeOrDefaultFromId(t);if(i){if(i.defaultKey&&!(null==a?void 0:a.deleteDefault))return this.update(t,{defaultDeleted:!0});c.delete(this.data,t),await e.delete(t)}},async play(e){const a=this.getSoundscapeOrDefaultFromId(e);if(!a)throw new d({message:`No Soundscape found with id: ${e}`});await Promise.all(a.tracks.map((e=>e.volume&&e.active?t.playTrack(e.id,e.volume):Promise.resolve())))},async pause(e){const a=this.getSoundscapeOrDefaultFromId(e);a&&await Promise.all(a.tracks.map((e=>e.volume&&e.active?t.pauseTrack(e.id):Promise.resolve())))},async updateTrack(e,a,i){const s=this.getSoundscapeOrDefaultFromId(e),o=null==s?void 0:s.tracks,n=null==o?void 0:o.find((e=>e.id===a));s&&n&&o&&(i.volume&&t.setTrackVolume(a,i.volume),!1===i.active?t.pauseTrack(a):!0===i.active&&t.playTrack(a,i.volume??n.volume),i.active&&s.singleTrackOnly&&o.forEach((e=>{e.id!==a&&(e.active=!1,t.pauseTrack(e.id))})),i.volume&&(n.volume=i.volume),void 0!==i.active&&(n.active=i.active),void 0!==i.advanced&&(n.advanced=i.advanced),await this.update(e,{tracks:o}))},setGlobalVolume(e){t.setGlobalVolume(e)}}}))(),de=e=>{const t=(e=>{switch(e){case f.Spotify:return F;case f.Youtube:return R}})(e.type);switch(e.type){case f.Spotify:return`${t}?url=${encodeURIComponent(`${D}/${e.externalType}/${e.externalId}`)}&format=json`;case f.Youtube:return`${t}?url=${encodeURIComponent(`${U}/${e.externalId}`)}&format=json`}},le=((e=ie().soundsEmbedsService)=>{const t=n("soundsEmbeds",{state:()=>({data:{},loaded:!1,loading:!1,loadingPlayer:!1,playerItemId:"",syncingState:!1,messenger:void 0}),getters:{items:e=>Object.values(e.data).map((e=>new X(e))),getEmbedFromId(e){const t=e.data;return e=>{const a=t[e];if(a)return new X(a)}}},actions:{refresh(t){this.loaded&&!(null==t?void 0:t.force)||(this.loading=!0,e.get({success:t=>{(async()=>{const a=await e.getConfigData();t.forEach((e=>e.custom=!0));const i=[...a,...t];this.data=Object.fromEntries(i.map((e=>[e.id,e]))),this.loaded=!0,this.loading=!1})()},failure:e=>{console.error(e),this.loading=!1}}))},async play(e,t){var a,i;if(this.syncingState||this.loadingPlayer)return;const s=this.getEmbedFromId(e);if(!s)throw new d({message:`No embed found with id: ${e}`});this.playerItemId!==e&&(this.playerItemId=e,this.loadingPlayer=!0),this.messenger&&this.messenger.id===s.messengerPath||this.initializeNewMessenger(s.messengerPath);const o=x();o.activeViewItemId=e,o.popupEnabled=!0,await l((()=>o.popupFirstMounted)).toBe(!0),await l((()=>{var e;return null==(e=this.messenger)?void 0:e.connected})).toBe(!0);const n=await(null==(a=this.messenger)?void 0:a.sendMessageAndGetResponse("sounds:loadTrack",{id:s.externalId,type:s.externalType}));t&&n&&(null==(i=this.messenger)||i.sendMessage("sounds:play")),setTimeout((()=>{this.loadingPlayer=!1}),500)},pause(){var e;this.syncingState||null==(e=this.messenger)||e.sendMessage("sounds:pause")},setGlobalVolume(e){var t;this.syncingState||null==(t=this.messenger)||t.sendMessage("sounds:setVolume",{volume:e})},skip(){var e;this.syncingState||null==(e=this.messenger)||e.sendMessage("sounds:skip")},initializeNewMessenger(e){this.disconnectMessenger();const t=new C(e);this.messenger=t,t.addMessageListener("sounds:sync:playing",(async()=>{const e=re(),t=e.activeItem;t&&this.playerItemId!==t.id||(this.syncingState=!0,await e.update({paused:!1}),this.syncingState=!1)})),t.addMessageListener("sounds:sync:paused",(async()=>{const e=re(),t=e.activeItem;t&&this.playerItemId!==t.id||(this.syncingState=!0,await e.update({paused:!0}),this.syncingState=!1)}))},disconnectMessenger(){var e;null==(e=this.messenger)||e.disconnect()},async create(t){c.set(this.data,t.id,t),await e.create(t)},async update(t,a){const i=this.data[t];if(!i)throw new d(`No embed found with id: ${t}`);c.set(this.data,t,{...i,...a}),await e.update(t,a)},async delete(t){if(!this.data[t])throw new d(`No embed found with id: ${t}`);c.delete(this.data,t),await e.delete(t)},getExternalInfoForLink:async t=>e.getExternalInfoForLink(t)}}),a=t();return l((()=>a.loaded)).toBe(!0).then((async()=>{const e=localStorage.getItem($);if(e&&Number(e)<Date.now()-r)return;localStorage.setItem($,Date.now().toString());const t=Object.values(a.data).filter((e=>e.refreshTimestamp+7*u<Date.now())).sort(((e,t)=>e.refreshTimestamp-t.refreshTimestamp)).at(0);if(!t)return;const i=await te.getData(de(t)).catch((e=>{console.error("Unable to update external sound",e)}));if(!i)return await a.update(t.id,{refreshTimestamp:Date.now()});await a.update(t.id,{refreshTimestamp:Date.now(),...i})})),t})(),re=e((({loadedRef:e,updatingRef:t,updateAsync:a})=>{const i=new S("sounds:player:lock:name",{default:null}),s=n("soundsPlayer",{state:()=>({activeItem:g.currentValue,paused:!0,autoplay:!0,muted:!1,globalVolume:.5,activeTabId:"",lastPlayedIds:[]}),getters:{allItems(){const e=[...ce().items,...le().items];return Object.fromEntries(e.map((e=>[e.id,e])))},allItemsOrdered(e){const t={...this.allItems},a=[];return e.lastPlayedIds.forEach((e=>{const i=t[e];i&&(a.push(i),delete t[e])})),[...a,...Object.values(t)]},loaded:()=>e.value,loadedAllItems:()=>ce().loaded&&le().loaded,activeItemStore(e){if(e.activeItem)return e.activeItem.type===f.Soundscapes?ce():le()},isActiveTab:e=>e.activeTabId===h,settingsEnabled:()=>A.soundscapesVisible,focusModeEnabledAndFocusModeSettingActive:()=>w.currentValue&&I().apps.soundscapes.enabled&&T().activeViewId===k.Focusing.toString(),featureEnabled:()=>m.conditionalFeatures.featureEnabled("plus")||w.currentValue,loadingActiveItemPlayer:()=>le().loadingPlayer,activeItemIsEmbed(e){var t,a;return(null==(t=e.activeItem)?void 0:t.type)===f.Spotify||(null==(a=e.activeItem)?void 0:a.type)===f.Youtube},activeItemIsSoundscape(e){var t;return(null==(t=e.activeItem)?void 0:t.type)===f.Soundscapes}},actions:{refresh(){ce().refresh(),le().refresh()},async resetActiveItem(){this.activeItem&&(await this.pauseActiveItem(this.activeItem.id),await this.update({activeItem:null,paused:!0,activeTabId:""}))},async update(e){await a(e)},async play(e){var a,s;await l(t).toBe(!1);const o=this.getItem(e);if(!o)return;this.activeTabId!==h&&(await this.update({activeTabId:h}),i.stealLeadership(),await l(i.isLeader).toBe(!0));const n=[...this.lastPlayedIds],c=n.findIndex((t=>t===e));-1!==c&&n.splice(c,1),n.unshift(e);const d=(null==(a=this.activeItem)?void 0:a.type)===f.Spotify?1:this.globalVolume,r=o.type===f.Spotify&&d<.5,u=o.id===(null==(s=this.activeItem)?void 0:s.id)||!r;await this.update({activeItem:o,lastPlayedIds:n,autoplay:u,paused:!u,globalVolume:d})},async pause(){await this.update({paused:!0})},async toggleActiveItemPaused(){this.activeItem&&(this.paused&&""===this.activeTabId?await this.play(this.activeItem.id):await this.update({paused:!this.paused,autoplay:!0}))},async setGlobalVolume(e,t){await this.update({globalVolume:e,muted:t})},async playActiveItem(e){var t,a;const i=this.getItem(e);i&&(await(null==(t=this.activeItemStore)?void 0:t.play(i.id,this.autoplay)),null==(a=this.activeItemStore)||a.setGlobalVolume(this.muted?0:this.globalVolume),navigator.mediaSession&&(navigator.mediaSession.metadata=new MediaMetadata({title:i.title,artwork:[]}),navigator.mediaSession.playbackState="playing",i.type===f.Soundscapes&&navigator.mediaSession.setPositionState({duration:1/0}),navigator.mediaSession.setActionHandler("play",(()=>{this.play(e)})),navigator.mediaSession.setActionHandler("pause",(()=>{this.pause()}))))},async pauseActiveItem(e){var t;await(null==(t=this.activeItemStore)?void 0:t.pause(e)),navigator.mediaSession&&(navigator.mediaSession.playbackState="paused")},skip(){this.activeItemStore&&"skip"in this.activeItemStore&&this.activeItemStore.skip()},getItem(e){var t;return(null==(t=this.activeItem)?void 0:t.id)===e?this.activeItem:this.allItems[e]}}}),o=s(),c=N(),d=T();return g.switchOverToWatchedStoreItem((()=>o.activeItem)),(async()=>{await l((()=>o.loaded)).toBe(!0),await l(i.isLeader).not.toBeNull(),i.isLeader.value&&o.update({activeTabId:"",paused:!0,activeItem:null}),p(i.isLeader,(e=>{e&&o.activeTabId!==h&&o.update({activeTabId:"",paused:!0})})),await l((()=>o.loadedAllItems)).toBe(!0),b([()=>o.globalVolume,()=>o.activeItem,()=>o.muted],(()=>{o.activeItemStore&&o.activeItemStore.setGlobalVolume(o.muted?0:o.globalVolume)})),p([()=>o.paused,()=>o.autoplay,()=>o.activeItem,()=>o.activeItemStore],(([e,t,a],[,,i,s])=>{i&&s&&i.id!==(null==a?void 0:a.id)&&s.pause(i.id),o.isActiveTab&&a&&(e&&t?o.pauseActiveItem(a.id):o.playActiveItem(a.id))})),await l((()=>c.loaded)).toBe(!0),w.currentValue&&await l((()=>d.activeViewId)).toBe(k.Focusing),b([()=>w.currentValue,()=>o.focusModeEnabledAndFocusModeSettingActive,()=>c.anyFocusTimerActive,()=>c.playing,()=>o.featureEnabled,()=>o.settingsEnabled],(([e,t,a,s,n,c])=>{i.isLeader.value&&(n&&c||o.pause(),e&&(t&&a&&s?o.play(o.lastPlayedIds[0]??"6b6a0fdb-279a-4a7d-91f0-dee889662be3"):o.pause()))}))})(),s}),{mode:o.Cache,syncAutomatically:!0}),ue=Object.freeze(Object.defineProperty({__proto__:null,default:re},Symbol.toStringTag,{value:"Module"}));export{j as L,O as P,Q as S,ce as a,z as b,se as c,le as d,M as e,B as f,E as g,P as h,X as i,G as j,V as k,ue as s,re as u};