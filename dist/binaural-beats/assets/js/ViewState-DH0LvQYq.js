import{e,s as i,n as t,w as o,d as a,r,q as s,t as n}from"./dynamic-import-helper-CTnsj-vI.js";import{a as c}from"./appZStack-Zxx-wHpo.js";const p=e=>Object.keys(e).find((i=>{var t;return null==(t=e[i])?void 0:t.defaultView})),l=(a,{views:n}={})=>{const l=e(a+"ViewState",{state:()=>({activeViewId:(n&&p(n))??"",beforeViewChange:()=>Promise.resolve(!0),confirmationProps:null,popupActive:!1,name:a}),getters:{activeView(e){if(!n)return null;const i=n[e.activeViewId];if(i)return i;throw new Error("No view found with id: "+e.activeViewId)},focused:()=>c.isOnTop(a)},actions:{focus(){c.add(a)},async setActiveView(e){var i,t;if(!n||!(await this.beforeViewChange()))return;let o=e;if("default"===e){const e=p(n);if(!e)throw new Error("No view found with defaultView: true");o=e}await(null==(t=null==(i=this.activeView)?void 0:i.beforeLeave)?void 0:t.call(i,o)),this.activeViewId=o},async togglePopup(e,{resetActiveView:i=!0}={}){await this.beforeViewChange()&&(await s(),this.popupActive=e??!this.popupActive,t.$emit(`${a}:toggled`),this.popupActive&&t.$emit("app:opened"),!this.popupActive&&i&&(this.resetBeforeViewChange(),this.confirmationProps=null,await this.setActiveView("default")))},resetBeforeViewChange(){this.beforeViewChange=()=>Promise.resolve(!0)},async setConfirmation(e){return new Promise((i=>{this.confirmationProps=e,this.confirmationProps.confirm=()=>i(!0),this.confirmationProps.cancel=()=>i(!1)})).finally((()=>{this.confirmationProps=null}))}}}),w=i(l());return t.$on(a+":open",(()=>l().togglePopup(!0))),t.$on(a+":close",(()=>l().togglePopup(!1))),o(w.popupActive,(e=>{e?c.add(a):c.remove(a)})),o(w.confirmationProps,(e=>{(null==e?void 0:e.dashboardOverlay)&&c.add(a,!0),r.dashboardOverlayActive=!!(null==e?void 0:e.dashboardOverlay)})),l},w=(e,{views:i,extend:t})=>{const o=l(`base${a.capitalizeFirstLetter(e)}`,{views:i}),r=t(o(),`extended${a.capitalizeFirstLetter(e)}ViewState`);return d(`${e}ViewState`,o,r)},d=(i,t,o)=>{const a=t(),r=o();return e(i,(()=>({...n(a),...n(r)})))};export{w as e,l as u};