import{S as t,R as e,i as a,U as s,e as i,M as n,V as o,u as r,J as d}from"./dynamic-import-helper-CTnsj-vI.js";import{E as h,p as c}from"./errors-DV9ybRQO.js";import{a as u,g as l}from"./array-YYQw31d9.js";import{B as p}from"./BaseMetric-ClLQP9bU.js";import{c as w}from"./compareObjects-R6Hcs7xe.js";import{computed as g}from"./reactiveCustomization-CEUTOUc3.js";import{P as v}from"./pinia-B4IAWUO-.js";class f{constructor({id:e=u(),utcDate:a=Date.now()+7*t,hasHours:s=!1,name:i="",pinned:n=!1,isTeam:o=!1,archived:r=!1,readOnly:d=!1,icon:m}){this.id=e,this.utcDate=a,this.hasHours=s,this.name=i,this.pinned=n,this.isTeam=o,this.archived=r,this.readOnly=d,this.icon=m??"calendar"}compare(t){return w((null==t?void 0:t.serialize())??new f({id:this.id,utcDate:this.utcDate}).serialize(),this.serialize())}validate(){if(""===this.name)throw new e({message:h.NameEmpty,input:"name"})}serialize(){return{...this}}get type(){return p.Countdown}get displayTooltip(){const t=this.utcDate?new Date(this.utcDate):new Date;return`${a.dayNamesShort[t.getDay()]} ${a.monthNamesShort[t.getMonth()]} ${t.getDate()}, ${t.getFullYear()}`}get displayValue(){const t=this.utcDate,e=s(this.currentTime,t),a=this.hasHours;let i,n="";return a&&e.minsTot<60?(i=0===e.minsTot?"Now":e.minsTot,n="m"):a&&e.hoursTot<24?(i=e.hoursTot,n="h"):(i=a||0!==e.nights?e.nights:"Today",n="d"),e.past&&(n+=" ago"),"Now"!==i&&"Today"!==i||(n=""),i+n}get currentTime(){return m.models.date.get("date").getTime()}get date(){return new Date(this.utcDate)}get dateTime(){return{date:this.date,hasHours:this.hasHours}}set dateTime(t){this.utcDate=t.date.getTime(),this.hasHours=t.hasHours}}const I=((t=c().countdownsService)=>{const a=i("countdowns",{plugins:[v.MockData],state:()=>({data:{},loading:!1,loaded:!1,activeItem:null,randomItems:[]}),getters:{items:t=>Object.values(t.data).filter((t=>!t.archived)).map((t=>new f(t))).sort(((t,e)=>+e.pinned-+t.pinned)),unpinnedItems:t=>Object.values(t.data).filter((t=>!t.archived&&!t.pinned)).map((t=>new f(t))),pinnedItems:t=>Object.values(t.data).filter((t=>!t.archived&&t.pinned)).map((t=>new f(t))).sort(((t,e)=>e.date.getTime()-t.date.getTime())),archivedItems:t=>Object.values(t.data).filter((t=>t.archived)).map((t=>new f(t))),getItemById(t){const e=t.data;return t=>{const a=e[t];if(a)return new f(a)}},showRandom(){return 0===this.pinnedItems.length||!!g["showRandomMetric-countdown"]}},actions:{clearActiveItem(){this.activeItem=null},setRandomItems(){!this.showRandom||this.unpinnedItems.length<=0?this.randomItems=[]:this.randomItems=[l(this.unpinnedItems)]},newItem(){this.activeItem||(this.activeItem=new f({}))},editItem(t){const a=this.data[t];if(!a)throw new e({message:`No countdown found with id: ${t}`});this.activeItem=new f(a)},refresh(e){!(null==e?void 0:e.force)&&(this.loading||this.loaded&&!(null==e?void 0:e.archived))||(this.loading=!0,t.get({success:t=>{this.data=Object.fromEntries(t.map((t=>[t.id,t]))),this.loaded=!0,this.loading=!1},failure:()=>{this.loading=!1},...(null==e?void 0:e.archived)&&{queryParams:{includeArchived:"true"},mode:n.Server}}))},async create(e){o.set(this.data,e.id,e),await t.create(e)},async update(a,s){const i=this.data[a];if(!i)throw new e({message:`No countdown found with id: ${a}`});o.set(this.data,a,{...i,...s}),await t.update(a,s)},async delete(e){o.delete(this.data,e),await t.delete(e)},async openItemOnTeamSite(e){let a=await t.getMetricServerId(e);a.toUpperCase().startsWith("T")&&(a=a.substring(1)),m.commandManager.execute("window.account.open.login",`/team/${p.Countdown}?id=${a}`)}}});return(async()=>{const t=a();await r((()=>t.loaded)).toBe(!0),d((()=>t.showRandom),(()=>{t.setRandomItems()}))})(),a})(),y=Object.freeze(Object.defineProperty({__proto__:null,default:I,useCountdownsStore:I},Symbol.toStringTag,{value:"Module"}));export{f as C,y as c,I as u};