import{F as e}from"./FormMessage-D8y-6rLo.js";import{R as t,a7 as s}from"./dynamic-import-helper-CTnsj-vI.js";import{S as i}from"./SmoothReflow-QsxkeVSi.js";import{n as o}from"./_plugin-vue2_normalizer-DeUNqxFl.js";class r{constructor(e,t,s,i,o,r){this.fields={},this.submit=e,this.getFieldOrder=t,this.getFieldIsFocused=s,this.submitOnBlur=i,this.submitOnInput=o,this.debounce=r}addField(e,t,s){if(this.fields[e])throw new Error(`A field with name: ${e} already exists on this form`);const i={};t&&(i.focus=t),s&&(i.pulse=s),this.fields[e]=i}removeField(e){delete this.fields[e]}getFieldMethod(e,t,s){const i=this.fields[e];if(!i)return console.warn(`"${t}" called on "${e}" but no field with that name was registered.`);const o=i[t];if(!o)return console.warn(`"${t}" called on "${e}" but no "${t}" method was registered for "${e}".`);o(s)}focusInput(e,t){this.getFieldMethod(e,"focus",t)}pulseField(e,t){this.getFieldMethod(e,"pulse",t)}focusNextInputOrSubmitIfLast(e){var t,s;const i=this.getFieldOrder(Object.keys(this.fields)),o=i.indexOf(e);if(-1!==o)if(o===i.length-1)this.submit();else{const e=i[o+1];e&&(null==(s=null==(t=this.fields[e])?void 0:t.focus)||s.call(t))}}submitOnFormBlurAndNoneFocused(){setTimeout((()=>{if(!this.submitOnBlur)return;this.getFieldIsFocused(Object.keys(this.fields))||this.submit()}))}submitOnFormInput(){this.submitOnInput&&(clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout((()=>{this.submit()}),this.debounce))}}const n=o({name:"BaseForm",components:{SmoothReflow:i,FormMessage:e},provide(){return{formFields:new r(this.submitForm,this.getFieldOrder,this.getFieldIsFocused,this.submitOnBlur,this.submitOnInput,this.debounce)}},props:{submit:{type:Function,required:!0},validate:{type:Function,default:()=>{}},submitButton:{type:Boolean,default:!0},submitOnBlur:{type:Boolean,default:!1},submitOnInput:{type:Boolean,default:!1},debounce:{type:Number,default:500},adding:{type:Boolean,default:null}},data:()=>({error:null,processing:!1}),computed:{submitButtonText(){return this.processing?this.adding?"Adding…":"Saving…":!0===this.adding?"Add":!1===this.adding?"Save":"Submit"}},watch:{error(e){if(null==e?void 0:e.input){const[t,s]=e.input.split(".");this.pulseField(t,s)}}},mounted(){window.addEventListener("keydown",this.submitOnMetaEnter)},destroyed(){window.removeEventListener("keydown",this.submitOnMetaEnter)},methods:{async submitForm(){try{this.processing=!0,await this.validate(),this.resetError(),await this.submit()}catch(e){e instanceof t?this.error=e:(console.error(e),this.error=new t({message:s.SERVER_ERROR_BASIC,contact:!0}))}finally{this.processing=!1}},submitOnMetaEnter(e){"Enter"===e.key&&e.metaKey&&this.submitForm()},getNamedFieldElements(e){const t=e.map((e=>`[name=${e}]`)).join(", ");return""===t?[]:Array.from(this.$el.querySelectorAll(t))},getFieldOrder(e){return this.getNamedFieldElements(e).map((e=>e.getAttribute("name")))},getFieldIsFocused(e){return this.getNamedFieldElements(e).some((e=>e===document.activeElement||e.contains(document.activeElement)))},resetError(){this.error=null},pulseField(e,t){this._provided.formFields.pulseField(e,void 0===t?void 0:Number(t))}}},(function(){var e=this,t=e._self._c;return t("div",{staticClass:"base-form"},[e._t("default"),t("smooth-reflow",{staticClass:"form-message-smooth-reflow",attrs:{nested:!0}},[e.error&&e.error.message?t("form-message",e._b({attrs:{error:!0}},"form-message",e.error,!1)):e._e()],1),e.submitButton?t("button",{staticClass:"button",attrs:{"data-test":"submit-form"},on:{click:e.submitForm}},[e._v(" "+e._s(e.submitButtonText)+" ")]):e._e()],2)}),[],!1,null,"df8756c3").exports;export{n as B};