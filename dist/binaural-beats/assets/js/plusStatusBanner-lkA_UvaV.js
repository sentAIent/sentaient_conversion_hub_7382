import{M as e,e as t,d as i}from"./dynamic-import-helper-CTnsj-vI.js";import{S as s,a,u as r}from"./SubscriptionSummary-BTlVYU_L.js";import{p as n}from"./persistStore-BDYPfxbs.js";const l="plusStatusBanner:trial:dismissed",u="plusStatusBanner:expired:dismissed",o="plusStatusBanner:pastDue:dismissed",d=n((({loadedRef:e,loadingRef:a,refresh:r})=>t("teamSubscriptionSummary",{state:()=>({active:!1,error:null,firstSubscriptionStart:null,hasPaymentMethod:!1,intent:null,pastDue:!1,subscriptionEnd:null,trialEnd:null,trialing:!1}),getters:{loaded:()=>e.value,loading:()=>a.value,status:e=>e.trialing&&e.hasPaymentMethod?s.TrialingCard:e.trialing&&!e.hasPaymentMethod?s.TrialingCardless:e.pastDue?s.PastDue:e.active?s.Plus:e.subscriptionEnd?s.ExpiredPlus:e.trialEnd?s.ExpiredTrial:s.Free,trialRemainingDays:e=>i.dateDiffIntegerDays(Date.now(),e.trialEnd??Date.now()),subscriptionDaysElapsed:e=>e.firstSubscriptionStart?i.dateDiffIntegerDays(new Date(e.firstSubscriptionStart),new Date)+1:0,expired(){return[s.ExpiredPlus,s.ExpiredTrial].includes(this.status)}},actions:{refresh(t=!1){if(m.conditionalFeatures.featureEnabled("team")||m.conditionalFeatures.featureEnabled("team-read-only"))return r(t);e.value=!0}}})),{path:"team/subscription_summary",mode:e.TimestampStrict}),D=t("plusStatusBanner",{state:()=>({trialDismissedDate:Number(localStorage.getItem(l)??0),pastDueDismissedDate:Number(localStorage.getItem(o)??0),expiredDismissedDate:Number(localStorage.getItem(u)??0)}),getters:{trialVisible(e){const t=this.activeSubscriptionSummaryStore;return t.status===s.TrialingCardless&&t.trialRemainingDays<=2&&!t.hasPaymentMethod&&i.dateDiffIntegerDays(e.trialDismissedDate,Date.now())>=1},expiredVisible(e){return this.activeSubscriptionSummaryStore.expired&&!e.expiredDismissedDate},requiresActionVisible(){var e;return(null==(e=this.activeSubscriptionSummaryStore.intent)?void 0:e.status)===a.RequiresAction},pastDueVisible(e){return this.activeSubscriptionSummaryStore.status===s.PastDue&&i.dateDiffIntegerDays(e.pastDueDismissedDate,Date.now())>=4},bannerVisible(){const e=this.activeSubscriptionSummaryStore;return e.loaded&&!e.loading&&(this.trialVisible||this.expiredVisible||this.requiresActionVisible||this.pastDueVisible)},bannerDismissDisabled(){return this.requiresActionVisible},trialDaysText(){const e=this.activeSubscriptionSummaryStore;return`${e.trialRemainingDays} day${1!==e.trialRemainingDays?"s":""}`},activeSubscriptionSummaryStore(){var e;const t=null==(e=m.models.teamInfo)?void 0:e.get("team");return(null==t?void 0:t.userIsAdmin)?d():r()}},actions:{dismissTrialBannerForDay(){const e=Date.now();localStorage.setItem(l,String(e)),this.trialDismissedDate=e},dismissExpiredBannerIndefinitely(){const e=Date.now();localStorage.setItem(u,String(e)),this.expiredDismissedDate=e},dismissPastDueBanner(){const e=Date.now();localStorage.setItem(o,String(e)),this.pastDueDismissedDate=e}}});export{D as u};