import t from"./AppHeader-A32plZRR.js";import{B as e}from"./BaseForm-BjqauXKF.js";import{F as i}from"./FormInput-EzoeJ62n.js";import{F as r}from"./FormFieldWrapper-BVlpMs4u.js";import{D as a}from"./BaseItemList-C63B-RAD.js";import s from"./drag-Dj1BzyoD.js";import{n}from"./_plugin-vue2_normalizer-DeUNqxFl.js";import{q as o,d as l}from"./dynamic-import-helper-CTnsj-vI.js";import p from"./icon-close-DRlspKs3.js";import u from"./icon-plus-B-FkYz15.js";import c from"./AppView-BMGOOodE.js";import{c as d,a as f,b as h,v,d as w}from"./links-C4TPnqUd.js";import{F as y}from"./FormToggle-CRXN1Mz8.js";import{B as g}from"./BaseDropdownOption-tB3ldrjh.js";import{a as b}from"./compareObjects-R6Hcs7xe.js";import{L as k}from"./constants-Bt_TxKWw.js";import{A as I}from"./AppConfirmCancel-Dbtq22vw.js";import{g as S}from"./globalKeyEventManager-C6pBx38h.js";import{B as j}from"./BaseDropdown-CB3yfeIu.js";import{A as C}from"./AppHeaderControl-kJjUFX4q.js";import{F as _}from"./FavIcon-DBY8fdra.js";import{a as F}from"./modal-qMFaWR5h.js";import{U as L}from"./enums-1c3kgXdw.js";import x from"./BaseIcon-BW2ar6VN.js";import A from"./icon-trash-BSyM-ydR.js";import"./constants-BfBD_H-d.js";import"./FormMessage-D8y-6rLo.js";import"./icon-alert-BikrS7AG.js";import"./SmoothReflow-QsxkeVSi.js";import"./ResizeSensor-ZXOsDHeC.js";import"./useAllComponentsMounted-VdWDSwjD.js";import"./SoftFocus-BUhesXB-.js";import"./constants-BpVlFj04.js";import"./index-998LMmMn.js";import"./array-YYQw31d9.js";import"./style-D-IRYiWS.js";import"./Logger-cMW5At62.js";import"./string-BBKP9xfj.js";import"./pinia-B4IAWUO-.js";import"./ToggleSwitch-BMo4SbmD.js";import"./constants-CALDQiUE.js";import"./BaseDropdownContent-C68ik0op.js";import"./portal-vue.esm-DdddSpdW.js";import"./icon-ellipsis-D7nTOXaQ.js";import"./links-fallback-J-S_uhC9.js";const E=n({name:"LinksForm",components:{FavIcon:_,AppHeaderControl:C,BaseDropdown:j,BaseDropdownOption:g,FormToggle:y,AppView:c,FormRepeatableInput:n({name:"FormRepeatableInput",components:{DragDrop:a,DragDropHandle:n({name:"DragDropHandle"},(function(){var t=this._self._c;return t("div",{staticClass:"drag-drop-handle",attrs:{"data-test":"drag-drop-handle","data-drag-drop-handle":""}},[t("inline-svg",{staticClass:"icon icon-drag",attrs:{src:s}})],1)}),[],!1,null,"82becf8f").exports,FormFieldWrapper:r},inject:["formFields"],props:{value:{type:Array,required:!0,validator:t=>!t.length||t[0]instanceof Object},name:{type:String,default:"repeatable-input"},property:{type:String,required:!0},getNewEntry:{type:Function,required:!0},addButtonText:{type:String,default:"Add"},disableMultipleEntries:{type:Boolean,default:!1},placeholder:{type:String,default:""},...r.props},data:()=>({pulseInputIndex:null}),watch:{value:{handler(t){t.length||this.addEntry()},immediate:!0}},mounted(){var t;null==(t=this.formFields)||t.addField(this.name,this.focusInput,this.pulseAndFocusInput)},destroyed(){var t;null==(t=this.formFields)||t.removeField(this.name)},methods:{addEntry(){this.value.push(this.getNewEntry())},async addEntryIfLastEntryHasValue(){var t,e;(null==(t=this.value[this.value.length-1][this.property])?void 0:t.trim())?(this.addEntry(),await o(),await o(),null==(e=this.$refs.input[this.value.length-1])||e.focus()):this.pulseAndFocusInput(this.value.length-1)},onAddEntryClick(){this.disableMultipleEntries?this.$emit("addBlocked"):this.addEntryIfLastEntryHasValue()},onEnter(){var t;this.disableMultipleEntries?null==(t=this.formFields)||t.focusNextInputOrSubmitIfLast(this.name):this.addEntryIfLastEntryHasValue()},removeEntry(t){this.value.splice(t,1)},async focusInput(t=0){var e,i;await o(),null==(i=null==(e=this.$refs.input[t])?void 0:e.focus)||i.call(e)},async pulseAndFocusInput(t){await this.focusInput(t),this.pulseInputIndex=t,await m.utils.delay(1e3),this.pulseInputIndex=null}}},(function(){var t=this,e=t._self._c;return e("form-field-wrapper",t._b({staticClass:"form-repeatable-input"},"form-field-wrapper",t.$props,!1),[e("drag-drop",{staticClass:"repeatable-input-rows",attrs:{order:t.value,"use-handles":!0},on:{"update:order":function(e){return t.$emit("input",e)}}},t._l(t.value,(function(i,r){return e("div",{key:i.id,staticClass:"repeatable-input-row",attrs:{"data-test":"repeatable-input-row"}},[t.value.length>1?e("drag-drop-handle"):t._e(),t._t("repeatable-input-row-before-input",null,{value:i[t.property]}),e("div",{staticClass:"repeatable-input-row-content"},[e("input",{directives:[{name:"model",rawName:"v-model",value:i[t.property],expression:"entry[property]"}],ref:"input",refInFor:!0,class:{"empty-input":!i[t.property],pulse:t.pulseInputIndex===r},attrs:{placeholder:r?"":t.placeholder},domProps:{value:i[t.property]},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onEnter.apply(null,arguments)},input:function(e){e.target.composing||t.$set(i,t.property,e.target.value)}}}),e("div",{staticClass:"repeatable-input-row-actions"},[t._t("repeatable-input-row-actions",null,{value:i[t.property]}),t.value.length>1?e("div",{staticClass:"icon-wrapper",attrs:{title:"Delete"},on:{click:function(e){return t.removeEntry(r)}}},[e("inline-svg",{staticClass:"icon icon-delete",attrs:{src:p}})],1):t._e()],2)])],2)})),0),e("div",{staticClass:"add",on:{click:t.onAddEntryClick}},[t._t("add",(function(){return[e("div",{staticClass:"button-clear"},[e("span",{staticClass:"button-label"},[e("inline-svg",{staticClass:"icon icon-plus",attrs:{src:u}}),e("span",[t._v(t._s(t.addButtonText))])],1)])]}))],2)],1)}),[],!1,null,"d62871d2").exports,FormInput:i,BaseForm:e,AppHeader:t,AppConfirmCancel:I,BaseIcon:x},inject:["itemStore","viewStateStore","capture","batchCapture"],computed:{activeItem(){return this.itemStore.activeItem},isTeamAdmin:()=>m.utils.getUserState().isTeamAdmin},mounted(){this.viewStateStore.beforeViewChange=()=>0===this.getFormMutations({cancelling:!0}).length?Promise.resolve(!0):this.viewStateStore.setConfirmation({title:"Are you sure you want to cancel?",dashboardOverlay:!0}),S.registerEventListener("backToList","keyup",27,this.returnToListView)},async destroyed(){this.viewStateStore.resetBeforeViewChange(),this.itemStore.clearActiveItem(),S.removeEventListener("backToList","keyup",27,this.returnToListView)},methods:{getFormMutations({cancelling:t=!1}={}){let e;if(this.itemStore.adding){if(t){const t=new f({id:this.activeItem.id});e=d(h(t))}}else{const t=this.itemStore.buildLinkGroup(this.itemStore.getItemById(this.itemStore.activeItemId));e=d(t)}const i=d(h(this.activeItem));return b(e,i)},async submit(){const t=this.getFormMutations();if(0===t.length)return void(await this.returnToListView());const e=h(this.activeItem);v(e),this.capture(`${e.hasManyLinks?"tab group":"link"} ${this.itemStore.adding?"add":"edit"}`,{is_paid_event:e.hasManyLinks}),await this.itemStore.processMutations(t),this.viewStateStore.resetBeforeViewChange(),await this.returnToListView()},async confirmAndDelete(){var t;null==(t=this.$refs.editingDropdown)||t.closeDropdown();await this.viewStateStore.setConfirmation({title:"Are you sure you want to delete this link?"})&&(this.capture((this.activeItem.hasManyLinks?"tab group":"link")+" delete",{is_paid_event:this.activeItem.hasManyLinks}),await this.itemStore.deleteLinkGroup(this.activeItem.id),this.viewStateStore.resetBeforeViewChange(),await this.returnToListView())},returnToListView(){return this.viewStateStore.setActiveView(k.List)},createNewUrl:()=>new w,showTabGroupsUpsell(){F(L.TAB_GROUPS,"dash")},closePopup(){return this.viewStateStore.togglePopup(!1)},async openLinkInNewTab(t){this.batchCapture("link click",{is_paid_event:!1}),await m.utils.getBrowser().tabs.create({url:l.ensureUrlScheme(t)})}}},(function(){var t=this,e=t._self._c;return e("app-view",{staticClass:"links-app-form",attrs:{"data-test":"links-form-view"},scopedSlots:t._u([{key:"header",fn:function(){return[e("app-header",{on:{close:t.closePopup},scopedSlots:t._u([{key:"left",fn:function(){return[e("app-header-control",{attrs:{"data-test":"return-list-view"},on:{click:t.returnToListView}},[e("base-icon",{staticClass:"icon",attrs:{src:"icon/arrow-left"}})],1)]},proxy:!0},{key:"center",fn:function(){return[t._v(" "+t._s(t.itemStore.adding?"Creating a":"Editing")+" link ")]},proxy:!0},{key:"right",fn:function(){return[t.itemStore.adding?t._e():e("base-dropdown",{ref:"editingDropdown",attrs:{"data-test":"edit-dropdown","container-class":"app"}},[e("base-dropdown-option",{attrs:{"data-test":"delete-link"},on:{click:t.confirmAndDelete}},[e("inline-svg",{staticClass:"icon icon-trash",attrs:{src:A}}),t._v(" Delete ")],1)],1)]},proxy:!0}])})]},proxy:!0},{key:"body",fn:function(){return[e("base-form",{attrs:{submit:t.submit,adding:t.itemStore.adding}},[e("form-input",{attrs:{"data-test":"title-input",autofocus:"",label:"Title",name:"title"},model:{value:t.activeItem.title,callback:function(e){t.$set(t.activeItem,"title",e)},expression:"activeItem.title"}}),e("form-repeatable-input",{attrs:{placeholder:"example.com",label:"Links",name:"links",property:"url","data-test":"links-input","get-new-entry":t.createNewUrl,"disable-multiple-entries":!t.$plus},on:{addBlocked:t.showTabGroupsUpsell},scopedSlots:t._u([{key:"repeatable-input-row-before-input",fn:function({value:t}){return[e("fav-icon",{staticClass:"repeatable-favicon",attrs:{url:t}})]}},{key:"repeatable-input-row-actions",fn:function({value:i}){return[i?e("div",{staticClass:"icon-wrapper",attrs:{"data-test":"repeatable-icon-link",title:"Open Link in New Tab"},on:{click:function(e){return t.openLinkInNewTab(i)}}},[e("base-icon",{attrs:{src:"square-arrow-out-up-right"}})],1):t._e()]}},{key:"add",fn:function(){return[e("div",{staticClass:"button-clear",attrs:{"data-test":"add-link"}},[e("span",{staticClass:"button-label"},[e("inline-svg",{staticClass:"icon icon-plus",attrs:{src:u}}),e("span",[t._v("Add another tab")])],1),t.$plus?t._e():e("div",{staticClass:"badge badge-plus"},[t._v("PLUS")])])]},proxy:!0}]),model:{value:t.activeItem.links,callback:function(e){t.$set(t.activeItem,"links",e)},expression:"activeItem.links"}}),e("form-toggle",{attrs:{"data-test":"pinned-input",label:"Pin to Dashboard"},model:{value:t.activeItem.pinned,callback:function(e){t.$set(t.activeItem,"pinned",e)},expression:"activeItem.pinned"}})],1)]},proxy:!0},{key:"confirm",fn:function(){return[t.viewStateStore.confirmationProps?e("app-confirm-cancel",t._b({attrs:{"data-test":"confirm-cancel"}},"app-confirm-cancel",t.viewStateStore.confirmationProps,!1)):t._e()]},proxy:!0}])})}),[],!1,null,"1b030f2a").exports;export{E as default};