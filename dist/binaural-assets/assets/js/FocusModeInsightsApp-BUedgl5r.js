import{O as t,c as e,a9 as s,aK as o,an as a,f as i,A as r,i as n,R as l,d as c,v as d,e as u,V as p,u as h,ap as g,aq as f,ak as v,aV as b,aj as y}from"./dynamic-import-helper-CTnsj-vI.js";import S from"./AppPopup-D21ZzXTp.js";import{A as w}from"./AppViewSwitchDynamic-ChSgUDaf.js";import{B as C}from"./BaseDropdown-CB3yfeIu.js";import M from"./AppView-BMGOOodE.js";import x from"./AppHeader-A32plZRR.js";import _ from"./BaseIcon-BW2ar6VN.js";import{B as D}from"./BaseDropdownOption-tB3ldrjh.js";import{u as k,F as I}from"./focusModeInsightsViewState-f77ETMNP.js";import j from"./OverflowCarousel-d3_FiDF1.js";import{B as F}from"./constants-BpVlFj04.js";import{n as T}from"./_plugin-vue2_normalizer-DeUNqxFl.js";import{B as A}from"./BaseDropdownContent-C68ik0op.js";import{a as B,D as V}from"./constants-CALDQiUE.js";import{R as L}from"./ResizeSensor-ZXOsDHeC.js";import{persistentObjectSettings as O}from"./reactiveCustomization-CEUTOUc3.js";import{a as H,s as G,m as E}from"./pomodoroCompleted-B2E_m1QL.js";import{v as N}from"./v-style-DxUun1f4.js";import{u as $}from"./internalDataMetrics-CHi96UKS.js";import{d as P}from"./focusModeState-BPyBLUbE.js";import{g as q}from"./focusModeHelpers-tDECULZC.js";import{T as R,a as z}from"./TimeframeService-DOKcTq-5.js";import{u as W}from"./streaks-C-_kXOaw.js";import{A as Y}from"./AppHeaderControl-kJjUFX4q.js";import{B as K}from"./BaseForm-BjqauXKF.js";import{A as J}from"./AppConfirmCancel-Dbtq22vw.js";import{F as U}from"./FormToggle-CRXN1Mz8.js";import{F as X}from"./FormInput-EzoeJ62n.js";import{c as Z}from"./compareObjects-R6Hcs7xe.js";import{F as Q,a as tt}from"./FormFieldWrapper-BVlpMs4u.js";import{h as et}from"./array-YYQw31d9.js";import{A as st}from"./AppLoading-DWsYUtJy.js";import{I as ot}from"./InlineNumberInput-jCUP0XJ2.js";import{C as at}from"./CircleIndicator-D90MQjfF.js";import"./style-D-IRYiWS.js";import"./Logger-cMW5At62.js";import"./string-BBKP9xfj.js";import"./globalKeyEventManager-C6pBx38h.js";import"./SmoothReflow-QsxkeVSi.js";import"./useAllComponentsMounted-VdWDSwjD.js";import"./appViewSwitchMixin-BsLJ76Hr.js";import"./portal-vue.esm-DdddSpdW.js";import"./icon-ellipsis-D7nTOXaQ.js";import"./constants-BfBD_H-d.js";import"./icon-close-DRlspKs3.js";import"./ViewState-DH0LvQYq.js";import"./appZStack-Zxx-wHpo.js";import"./icon-next-CI-_n-sg.js";import"./index-998LMmMn.js";import"./VueBase-C55TLWt3.js";import"./_commonjsHelpers-B3K3fdV-.js";import"./ClickOutside-DCLvi2fj.js";import"./pinia-B4IAWUO-.js";import"./persistStore-BDYPfxbs.js";import"./PomodoroTimers-CyrfcuWH.js";import"./promisifiedChrome-vBWwQWBS.js";import"./LocalStorageStoreSyncedItem-DMdfjgsv.js";import"./login-HJtMK9QU.js";import"./authService-UjcjSrh8.js";import"./auth-BwdMrzFn.js";import"./legacyUserMigration-CaazFMYU.js";import"./enums-1c3kgXdw.js";import"./migrateLegacyUserMessageHandler-CZ8nZZlg.js";import"./onboarding-B35lV45t.js";import"./modal-qMFaWR5h.js";import"./FormMessage-D8y-6rLo.js";import"./icon-alert-BikrS7AG.js";import"./ToggleSwitch-BMo4SbmD.js";import"./SoftFocus-BUhesXB-.js";const it=t({name:"BaseAxes",components:{OverflowCarousel:j},props:{xLabels:{type:Array,required:!0},yLabels:{type:Array,required:!0},yLabelsRanges:{type:Array,default:()=>[]},inlineMarkerSpacing:{type:String,default:"0"},xLabelsHeight:{type:String,default:"1.5rem"}},setup:()=>({carousel:e(),BaseItemListDirection:F}),computed:{gridColumns(){return`auto repeat(${this.xLabels.length}, 1fr)`},gridRows(){return`repeat(${this.yLabels.length}, 1fr) var(--x-labels-height)`}},methods:{isHiddenYLabel(t){return 0!==this.yLabelsRanges.length&&this.yLabelsRanges.every((e=>t<e[0]||t>e[1]))}}}),rt=()=>{s(((t,e)=>({"2b67252a":t.xLabelsHeight,"12afb752":t.gridRows,"743043c4":t.gridColumns,"7b653d9d":t.inlineMarkerSpacing})))},nt=it.setup;it.setup=nt?(t,e)=>(rt(),nt(t,e)):rt;const lt=T(it,(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"base-axes"},[e("div",{staticClass:"base-axes-y"},[e("div",{staticClass:"base-axes-y-values",attrs:{"data-test":"axis-y"}},t._l(t.yLabels,(function(s,o){return e("div",{key:o,staticClass:"base-axes-y-value",class:{hidden:t.isHiddenYLabel(o)},style:{order:t.yLabels.length-o}},[t._v(" "+t._s(s)+" ")])})),0)]),e("div",{staticClass:"carousel-container"},[e("overflow-carousel",{ref:"carousel",attrs:{direction:t.BaseItemListDirection.Row,"start-scroll-from-end":!0}},[e("div",{staticClass:"base-axes-x"},[e("div",{staticClass:"base-axes-inline-marker-spacing"}),e("div",{staticClass:"base-axes-x-values",attrs:{"data-test":"axis-x"}},t._l(t.xLabels,(function(s,o){return e("div",{key:o,staticClass:"base-axes-x-value"},[t._v(" "+t._s(s)+" ")])})),0),e("div",{staticClass:"base-axes-lines"},t._l(t.yLabels,(function(s,o){return e("div",{key:o,staticClass:"base-axes-lines-line",class:{hidden:t.isHiddenYLabel(o)},style:{order:t.yLabels.length-o}})})),0),e("div",{staticClass:"base-axes-graph"},[t._t("default")],2)])]),e("div",{staticClass:"inline-marker-container"},[t._t("marker")],2)],1)])}),[],!1,null,"bc418458").exports,ct={max:{type:Number,required:!0},min:{type:Number,default:0},label:{type:Boolean,default:!1},labelIconSrc:{type:String,default:""},labelBelowMin:{type:Boolean,default:!0}},dt={...ct,barWidth:{type:String,required:!0},tooltip:{type:Boolean,default:!1},tooltipTextTransformer:{type:Function,default:t=>String(t)}},ut=t({name:"BaseBar",directives:{ResizeSensor:L},components:{BaseIcon:_},props:{value:{type:Number,required:!0},width:{type:String,required:!0},groupHeight:{type:Number,required:!0},...ct},data:()=>({labelAbove:!1}),computed:{height(){return this.overflowing?this.groupHeight+"px":this.groupHeight*(this.value/this.max)+"px"},overflowing(){return this.value>this.max},labelVisible(){return this.label&&!this.overflowing&&(this.labelBelowMin||this.value>=this.min)}},methods:{checkIfLabelAboveBar({width:t,height:e}){this.labelAbove=e<t}}}),pt=()=>{s(((t,e)=>({e7c2ac24:t.width,"4430cc02":t.height})))},mt=ut.setup;ut.setup=mt?(t,e)=>(pt(),mt(t,e)):pt;const ht=t({name:"BaseBarGroup",directives:{ResizeSensor:L},components:{BaseBar:T(ut,(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"base-bar",attrs:{"data-value":t.value,"data-test":"bar"}},[e("div",{staticClass:"base-bar-label",class:{floating:!t.labelAbove,hidden:!t.labelVisible},attrs:{"data-test":"bar-label"}},[t.labelIconSrc?e("base-icon",{staticClass:"dark",attrs:{"stroke-width":"4px",src:t.labelIconSrc,size:"min(100%, 0.46875rem)"}}):t._e()],1),e("div",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:t.checkIfLabelAboveBar,expression:"checkIfLabelAboveBar"}],staticClass:"base-bar-container",class:{overflowing:t.overflowing}})])}),[],!1,null,"13eb46ab").exports,BaseDropdownContent:A,BaseDropdown:C},props:{values:{type:Array,required:!0},...dt},setup:()=>({DropdownPosition:B,DropdownAlignment:V}),data:()=>({height:0}),methods:{updateHeight({height:t}){this.height=t}}});const gt=T(t({name:"BaseBarChart",components:{BaseBarGroup:T(ht,(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("base-dropdown",{directives:[{name:"resize-sensor",rawName:"v-resize-sensor",value:t.updateHeight,expression:"updateHeight"}],staticClass:"base-bar-group",class:{hover:t.tooltip},attrs:{hover:!0,disabled:!t.tooltip||!t.values.length,position:t.DropdownPosition.Top,alignment:t.DropdownAlignment.Center,"disable-pointer-events":!0,"disable-click-on-hover":!0,"hover-hide-content-delay":0,"position-offset":6,"container-class":"app inverted-system-theme-override","min-width":"0"},scopedSlots:t._u([{key:"toggle",fn:function(){return[e("div",{staticClass:"base-bar-group-toggle"},t._l(t.values,(function(s,o){return e("base-bar",{key:o,attrs:{max:t.max,min:t.min,value:s,width:t.barWidth,"group-height":t.height,label:t.label,"label-icon-src":t.labelIconSrc,"label-below-min":t.labelBelowMin}})})),1)]},proxy:!0}])},[e("template",{slot:"contentOverride"},[e("base-dropdown-content",{staticClass:"base-bar-group-tooltip-content"},t._l(t.values,(function(s,o){return e("span",{key:o},[t._v(" "+t._s(t.tooltipTextTransformer(s))+" ")])})),0)],1)],2)}),[],!1,null,"64b10096").exports},props:{values:{type:Array,required:!0},...dt}}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"base-bar-chart",attrs:{"data-test":"bar-chart"}},t._l(t.values,(function(s,o){return e("base-bar-group",{key:o,attrs:{max:t.max,min:t.min,values:s,"bar-width":t.barWidth,tooltip:t.tooltip,"tooltip-text-transformer":t.tooltipTextTransformer,label:t.label,"label-icon-src":t.labelIconSrc,"label-below-min":t.labelBelowMin}})})),1)}),[],!1,null,"84ca9770").exports,ft=[[15,30,45,60,75],[30,60,90,120,150],[60,120,180,240,300],[90,180,270,360,450],[120,240,360,480,600]],vt={MinutesMin:"Please enter 1 minute or more",MinutesMax:"Please enter 480 minutes or less"},bt=t({name:"BaseInlineMarker",props:{value:{type:Number,required:!0},max:{type:Number,required:!0},label:{type:String,default:""}},computed:{offset(){return this.value/this.max*100+"%"},isHidden(){return this.value>this.max}}}),yt=()=>{s(((t,e)=>({"2b16e4d4":t.offset})))},St=bt.setup;bt.setup=St?(t,e)=>(yt(),St(t,e)):yt;const wt=T(t({name:"FocusModeInsightsGraph",components:{BaseInlineMarker:T(bt,(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"base-inline-marker",class:{hidden:t.isHidden},attrs:{"data-label":t.label,"data-test":"marker","data-value":t.value}})}),[],!1,null,"76f20772").exports,BaseBarChart:gt,BaseAxes:lt,vStyle:N},props:{timeframeService:{type:Object,required:!0}},setup:()=>({pomodoroCompletedStore:H(),baseAxes:e()}),computed:{pastWeekFocusedTimeString(){return this.pomodoroCompletedStore.pastDays(this.timeframeService.pastDaysCount-1)||"-"},pastWeekFocusedMinutes(){return this.pomodoroCompletedStore.completedStatsDaily(this.timeframeService.pastDaysCount-1).focusedMinutes.reverse()},goalEnabled:()=>O.focusModeSettings.goalEnabled,goalMinutes:()=>O.focusModeSettings.goalMinutes,goalDays:()=>O.focusModeSettings.goalDays,yAxisScale(){const t=Math.max(...this.pastWeekFocusedMinutes),e=ft.findIndex((e=>{const s=e[e.length-1]??0;return t<s}));if(-1===e)return ft.at(-1)??ft[0];const s=ft.findIndex((t=>this.goalMinutes<=t[2]));return ft[Math.max(s,e)]??ft[0]},graphYLabels(){return this.yAxisScale.map((t=>t<60?`${t}m`:Math.round(100*t)/100/60+"h"))},graphValues(){const t=this.pastWeekFocusedMinutes.map((t=>[t]));return Array(this.timeframeService.futureDaysCount).fill(void 0).forEach((()=>t.push([]))),t},graphMax(){return Math.max(...this.yAxisScale)}},methods:{getFriendlyDayTooltipText:t=>o(60*t*1e3,!1)}}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"focus-mode-insights-graph",attrs:{"data-test":"insights-graph"}},[e("div",{staticClass:"weekly-time",attrs:{"data-test":"weekly-time"}},[t._v(" "+t._s(t.pastWeekFocusedTimeString)+" focused ")]),e("base-axes",{ref:"baseAxes",attrs:{"x-labels":t.timeframeService.timeframeLabels,"y-labels":t.graphYLabels,"y-labels-ranges":[[0,3]],"inline-marker-spacing":t.goalEnabled?"1.4rem":"0"},scopedSlots:t._u([{key:"marker",fn:function(){return[t.goalEnabled?e("base-inline-marker",{attrs:{max:t.graphMax,value:t.goalMinutes,label:"Goal"}}):t._e()]},proxy:!0}])},[e("base-bar-chart",{attrs:{min:t.goalMinutes,max:t.graphMax,values:t.graphValues,"bar-width":"0.75rem",tooltip:!0,"tooltip-text-transformer":t.getFriendlyDayTooltipText,label:t.goalEnabled,"label-below-min":!1,"label-icon-src":"check"}})],1),e("v-style",[t._v(" /* highlight last significant value */ .focus-mode-insights-graph .base-axes-x .base-axes-x-value:nth-last-child("+t._s(1+t.timeframeService.futureDaysCount)+") { color: var(--color-stop-6); font-weight: 700; } .focus-mode-insights-graph .base-bar-chart .base-bar-group:nth-last-child("+t._s(1+t.timeframeService.futureDaysCount)+") .base-bar-container { background: linear-gradient(to top, var(--color-stop-2), var(--color-stop-5)); } ")])],1)}),[],!1,null,"efec9be4").exports;const Ct=T(t({name:"RadioIndicator",props:{value:{type:Boolean,default:!1}}}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",t._g({staticClass:"radio-indicator",class:{on:t.value}},t.$listeners))}),[],!1,null,"1377bcec").exports;const Mt=T(t({name:"FocusModeInsightsBentoStats",components:{BaseIcon:_},props:{todosCompletedCount:{type:[Number,String],required:!0},minTimestamp:{type:Number,required:!0},maxTimestamp:{type:Number,default:Number.MAX_SAFE_INTEGER}},setup:()=>({internalDataMetrics:$(),pomodoroCompletedStore:H(),streaksStore:W()}),computed:{todosCompletedMetric(){return this.internalDataMetrics.getMetric("todoStats","todoCompletedSince")},todosCompletedStatVisible(){return!this.todosCompletedMetric.value.unsupported},sitesResistedVisible:()=>a(),pomodorosCompleted(){return this.pomodoroCompletedStore.loading?"-":G(this.pomodoroCompletedStore.dataWithCurrentSessionIfActive.filter((t=>new Date(t.completed).getTime()>=this.minTimestamp&&new Date(t.completed).getTime()<this.maxTimestamp)))},sitesResisted(){return this.streaksStore.loaded?Object.values(this.streaksStore.data).filter((t=>t.timestamp>=this.minTimestamp&&t.timestamp<this.maxTimestamp)).length:"-"}}}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"focus-mode-insights-bento-stats insights-bento"},[t.todosCompletedStatVisible?e("div",{staticClass:"cell cell-metric"},[e("span",{staticClass:"value",attrs:{"data-test":"todos-completed-stat"}},[t._v(" "+t._s(t.todosCompletedCount)+" ")]),e("span",{staticClass:"description"},[e("base-icon",{staticClass:"icon-tasks",attrs:{src:"icon/apps/tasks",size:"15px"}}),t._v(" Tasks ")],1)]):t._e(),e("div",{staticClass:"cell cell-metric"},[e("span",{staticClass:"value",attrs:{"data-test":"pomodoros-completed-stat"}},[t._v(" "+t._s(t.pomodorosCompleted)+" ")]),e("span",{staticClass:"description"},[e("base-icon",{staticClass:"icon-pomodoro",attrs:{src:"icon/apps/pomodoro",size:"15px"}}),t._v(" Timers ")],1)]),t.sitesResistedVisible?e("div",{staticClass:"cell cell-metric"},[e("span",{staticClass:"value"},[t._v(" "+t._s(t.sitesResisted)+" ")]),e("span",{staticClass:"description"},[e("base-icon",{staticClass:"icon-site-blocker",attrs:{src:"icon/apps/site-blocker",size:"15px"}}),t._v(" Resisted ")],1)]):t._e()])}),[],!1,null,"a62f61bb").exports,xt=new r({feature:"focus-mode-insights"});const _t=T(t({name:"FocusModeInsightsOverview",components:{FocusModeInsightsGraph:wt,BaseDropdownOption:D,BaseIcon:_,AppHeader:x,AppView:M,BaseDropdown:C,RadioIndicator:Ct,FocusModeInsightsBentoStats:Mt},emits:["close"],setup:()=>({viewStateStore:k(),internalDataMetrics:$(),Timeframe:R,timeframeService:new z((()=>q().insightsGraphTimeframe)),streakStore:W(),timeframeDropdown:e(),focusInsightsGraph:e()}),computed:{todosCompletedMetric(){return this.internalDataMetrics.getMetric("todoStats","todoCompletedSince")},todosCompleted(){var t,e;return(null==(e=(t=this.todosCompletedMetric.value).getterValue)?void 0:e.call(t,this.timeframeService.startTimestamp))||0},currentDateString:()=>i(m.models.date.get("hour")),todoIntegrationWarningVisible(){return!q().todoIntegrationWarningDismissed&&this.todosCompletedMetric.value.unsupported},focusModeActive:()=>P.currentValue,currentTimeframe:{get(){return this.timeframeService.getTimeframe()},set(t){var e,s,o,a;E("focusModeSettings",(e=>{e.insightsGraphTimeframe=t})),xt.capture("focus insights timeframe change",{new_value:t}),null==(e=this.timeframeDropdown)||e.closeDropdown(),null==(a=null==(o=null==(s=this.focusInsightsGraph)?void 0:s.baseAxes)?void 0:o.carousel)||a.resetScroll()}}},mounted(){this.streakStore.refresh()},methods:{goToGoalSettings(){return xt.capture("edit focus insights settings"),this.viewStateStore.setActiveView(I.Settings)},goToFocusHistory(){return xt.capture("focus insights history click"),this.viewStateStore.setActiveView(I.History)},dismissTodoWarning(){O.focusModeSettings={...q(),todoIntegrationWarningDismissed:!0}},closeAndStartFocusing(){this.$emit("close"),m.trigger("focusMode:start","focus insights")}}}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("app-view",{scopedSlots:t._u([{key:"header",fn:function(){return[e("app-header",{scopedSlots:t._u([{key:"left",fn:function(){return[e("base-icon",{staticClass:"app-header-icon",attrs:{src:"icon/apps/focus-insights",size:"16px"}}),e("span",{staticClass:"app-header-name"},[t._v("Focus Stats")])]},proxy:!0},{key:"right",fn:function(){return[e("base-dropdown",{attrs:{"data-test":"dropdown"}},[e("base-dropdown-option",{attrs:{"data-test":"go-to-settings"},on:{click:t.goToGoalSettings}},[t._v(" Edit daily focus goal ")])],1)]},proxy:!0}])})]},proxy:!0},{key:"body",fn:function(){return[e("div",{staticClass:"overview-content"},[e("base-dropdown",{ref:"timeframeDropdown",scopedSlots:t._u([{key:"toggle",fn:function(){var s;return[e("div",{staticClass:"past-days",class:{open:null==(s=t.timeframeDropdown)?void 0:s.getDropdownOpen()},attrs:{"data-test":"graph-timeframe-toggle"}},[t._v(t._s(t.timeframeService.getLabel())+" "),e("base-icon",{attrs:{src:"chevron-down",size:"11px","stroke-width":"3px"}})],1)]},proxy:!0}])},[t._l(Object.values(t.Timeframe),(function(s){return e("base-dropdown-option",{key:s,attrs:{"data-test":s},on:{click:function(e){t.currentTimeframe=s}}},[e("radio-indicator",{attrs:{value:t.currentTimeframe===s}}),t._v(" "),e("span",[t._v(t._s(t.timeframeService.getLabel(s)))])],1)}))],2),e("div",{staticClass:"insights-bento graph"},[e("div",{staticClass:"cell cell-full cell-insights-graph"},[e("focus-mode-insights-graph",{ref:"focusInsightsGraph",attrs:{"timeframe-service":t.timeframeService}})],1)]),e("focus-mode-insights-bento-stats",{attrs:{"todos-completed-count":t.todosCompleted,"min-timestamp":t.timeframeService.startTimestamp}}),t.todoIntegrationWarningVisible?e("div",{staticClass:"insights-bento todo-warning"},[e("div",{staticClass:"insight-warning cell cell-full cell-metric",attrs:{"data-test":"todo-integration-warning"}},[e("div",{staticClass:"icon-wrapper",attrs:{"data-test":"todo-integration-warning-close"},on:{click:t.dismissTodoWarning}},[e("base-icon",{staticClass:"icon close",attrs:{src:"icon-close",size:"9px"}})],1),e("div",{staticClass:"text"},[t._v(" To see number of completed tasks, switch to Momentum tasks (integrations not yet supported). ")])])]):t._e(),e("div",{staticClass:"buttons"},[t.focusModeActive?t._e():e("button",{staticClass:"button button-neutral start-focus-button",attrs:{"data-test":"start-focus-mode"},on:{click:t.closeAndStartFocusing}},[t._v(" Start focusing ")]),e("button",{staticClass:"button button-tertiary history-button",attrs:{"data-test":"focus-history"},on:{click:t.goToFocusHistory}},[t._v(" Focus History "),e("base-icon",{attrs:{src:"chevron-right"}})],1)])],1)]},proxy:!0}])})}),[],!1,null,"beb3943c").exports;const Dt=T(t({name:"FormDays",components:{FormFieldWrapper:Q},props:{value:{type:Array,required:!0},...tt},emits:["input"],setup:()=>({dayOptions:n.dayNamesExtraShort,dayNamesFull:n.dayNames}),methods:{isDayActive(t){return this.value.includes(t)},toggleDayActive(t){const e=[...this.value],s=e.indexOf(t);-1!==s?e.splice(s,1):e.push(t),this.$emit("input",e.sort())}}}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("form-field-wrapper",t._b({staticClass:"form-days"},"form-field-wrapper",t.$props,!1),[e("div",{staticClass:"form-days-options"},t._l(t.dayOptions,(function(s,o){return e("div",{key:o,staticClass:"form-days-option button",class:{"button-neutral":!t.isDayActive(o)},attrs:{title:t.dayNamesFull[o]??"","data-test":t.dayNamesFull[o]??""},on:{click:function(e){return t.toggleDayActive(o)}}},[t._v(" "+t._s(s)+" ")])})),0)])}),[],!1,null,"6f099a3e").exports,kt=new r({feature:"focus-mode-insights"});const It=T(t({name:"FocusModeInsightsSettings",components:{FormDays:Dt,FormInput:X,FormToggle:U,AppConfirmCancel:J,BaseForm:K,AppHeaderControl:Y,BaseIcon:_,AppHeader:x,AppView:M},setup:()=>({viewStateStore:k()}),data(){const t=O.focusModeSettings;return{focusModeGoalSettings:{goalEnabled:t.goalEnabled,goalMinutes:t.goalMinutes,goalDays:t.goalDays}}},mounted(){this.viewStateStore.beforeViewChange=()=>0===Object.keys(this.getFormMutations()).length?Promise.resolve(!0):this.viewStateStore.setConfirmation({title:"Are you sure you want to cancel?",dashboardOverlay:!0})},destroyed(){this.viewStateStore.resetBeforeViewChange()},methods:{goToOverview(){this.viewStateStore.setActiveView(I.Overview)},updateGoalSettingsAndReturn(){if(this.focusModeGoalSettings.goalMinutes<1)throw new l({message:vt.MinutesMin,input:"minutes"});if(this.focusModeGoalSettings.goalMinutes>480)throw new l({message:vt.MinutesMax,input:"minutes"});O.focusModeSettings={...O.focusModeSettings,...this.focusModeGoalSettings},kt.capture("settings change",{newSettings:JSON.parse(JSON.stringify(this.focusModeGoalSettings))}),this.goToOverview()},getFormMutations(){const t=c.filterObjectKeysByObject(O.focusModeSettings,this.focusModeGoalSettings);return Z(t,this.focusModeGoalSettings)}}}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("app-view",{scopedSlots:t._u([{key:"header",fn:function(){return[e("app-header",{scopedSlots:t._u([{key:"left",fn:function(){return[e("app-header-control",{attrs:{"data-test":"go-to-overview"},on:{click:t.goToOverview}},[e("base-icon",{staticClass:"icon",attrs:{src:"icon/arrow-left"}})],1),e("span",{staticClass:"app-header-name"},[t._v("Edit Daily Focus Goal")])]},proxy:!0}])})]},proxy:!0},{key:"body",fn:function(){return[e("base-form",{attrs:{submit:t.updateGoalSettingsAndReturn,adding:!1}},[e("form-toggle",{attrs:{label:"Daily focus goal",autofocus:!0,"data-test":"goal-toggle"},model:{value:t.focusModeGoalSettings.goalEnabled,callback:function(e){t.$set(t.focusModeGoalSettings,"goalEnabled",e)},expression:"focusModeGoalSettings.goalEnabled"}}),t.focusModeGoalSettings.goalEnabled?e("div",{staticClass:"goal-settings-optional"},[e("form-input",{key:"minutes",attrs:{type:"number",label:"Minutes",name:"minutes"},model:{value:t.focusModeGoalSettings.goalMinutes,callback:function(e){t.$set(t.focusModeGoalSettings,"goalMinutes",e)},expression:"focusModeGoalSettings.goalMinutes"}}),e("form-days",{key:"days",attrs:{label:"Days"},model:{value:t.focusModeGoalSettings.goalDays,callback:function(e){t.$set(t.focusModeGoalSettings,"goalDays",e)},expression:"focusModeGoalSettings.goalDays"}})],1):t._e()],1)]},proxy:!0},{key:"confirm",fn:function(){return[t.viewStateStore.confirmationProps?e("app-confirm-cancel",t._b({},"app-confirm-cancel",t.viewStateStore.confirmationProps,!1)):t._e()]},proxy:!0}])})}),[],!1,null,"e6c42e77").exports;const jt=new class{constructor(){}async get(t,e){const{data:s}=await d.get("todos/completed?start="+t+"&end="+e);return s}},Ft=u("tasksCompleted",{state:()=>({data:{}}),getters:{},actions:{get(t,e,s){jt.get(t,e).then((t=>{"total"in t&&p.set(this.data,s,t)})).catch((t=>console.error(t)))}}});const Tt=T(t({name:"FocusModeInsightsDayListItem",components:{InlineNumberInput:ot,BaseIcon:_,CircleIndicator:at},props:{label:{type:String,required:!0},todosCompleted:{type:Number,required:!0},focusedMinutes:{type:Number,required:!0},focusedTime:{type:String,required:!0},goalEnabledForDay:{type:Boolean,required:!0},goalEnabled:{type:Boolean,required:!0},indicatorProgress:{type:Number,required:!0}},data(){return{inputValue:this.focusedMinutes,editing:!1}},watch:{async focusedMinutes(){this.editing&&(await h((()=>this.editing)).toBe(!1),await this.$nextTick()),this.inputValue=this.focusedMinutes}},methods:{onFocusOut(){this.$emit("editFocusedTime",this.inputValue),this.editing=!1}}}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"focus-mode-insights-day-list-item",attrs:{"data-test":"day-list-item"}},[e("div",{staticClass:"date"},[t._v(t._s(t.label))]),t.todosCompleted?e("div",{staticClass:"todo-completed"},[e("base-icon",{attrs:{src:"icon/apps/tasks"}}),t._v(" "),e("div",[t._v(t._s(t.todosCompleted))])],1):t._e(),e("div",{staticClass:"space"}),t.editing?e("div",{staticClass:"time-input editing"},[e("inline-number-input",{attrs:{min:0,max:1440,"auto-focus":!0,"data-test":"minutes-inline-input"},nativeOn:{focusout:function(e){return t.onFocusOut.apply(null,arguments)}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}),e("div",{staticClass:"time"},[t._v("m")])],1):e("div",{staticClass:"time-input fake",class:{"has-value":!!t.focusedMinutes},attrs:{"data-test":"minutes-fake-input"},on:{click:()=>t.editing=!0}},[t.focusedMinutes?e("span",[t._v(t._s(t.focusedTime))]):e("div",{staticClass:"time dash"},[t._v("â€”")])]),t.goalEnabled?e("div",{staticClass:"goal-indicator"},[t.goalEnabledForDay?e("circle-indicator",{attrs:{progress:t.indicatorProgress}}):t._e()],1):t._e()])}),[],!1,null,"4b4ceccc").exports,At=new r({feature:"focus-mode-insights"}),Bt=t({name:"FocusModeInsightsHistory",components:{AppView:M,AppHeaderControl:Y,BaseIcon:_,AppHeader:x,AppLoading:st,FocusModeInsightsBentoStats:Mt,FocusModeInsightsDayListItem:Tt},setup:()=>({viewStateStore:k(),pomodoroCompletedStore:H(),streaksStore:W(),tasksCompletedStore:Ft()}),data:()=>({month:(new Date).getMonth(),year:(new Date).getFullYear()}),computed:{firstDayInMonth(){return new Date(`${this.year}-${(this.month+1).toString().padStart(2,"0")}-01T00:00:00.000`)},lastDayInMonth(){const t=new Date(`${this.year}-${(this.month+1).toString().padStart(2,"0")}-01T00:00:00.000`);return t.setMonth(this.month+1),t.setDate(0),t},lastDailyDateForData(){return new Date(Math.min(m.models.date.get("hour").getTime(),this.lastDayInMonth.getTime()))},daysInMonth(){return Array(this.lastDailyDateForData.getDate()).fill(void 0).map(((t,e)=>{const s=new Date(this.firstDayInMonth);return s.setDate(s.getDate()+e),s.getTime()}))},focusHistoryDays(){const t=this.pomodoroCompletedStore.dataWithCurrentSessionIfActive;return this.daysInMonth.map((e=>{var s,a,i;const r=new Date(e);r.setDate(r.getDate()+1);const n=t.filter((t=>new Date(t.completed).getTime()>=e&&new Date(t.completed).getTime()<r.getTime())),l=et(n.map((t=>t.focusMinutes))),c=`${this.month}-${this.year}`;return{label:`${g(new Date(e),!0)} ${f(new Date(e),!1)}`,focusedMinutes:l,focusedTime:o(l*v,!1),goalEnabledForDay:this.goalDays.includes(new Date(e).getDay()),todosCompleted:(null==(i=null==(a=null==(s=this.tasksCompletedStore.data[c])?void 0:s.tasks)?void 0:a.filter((t=>new Date(t.completedDate).getTime()>=e&&new Date(t.completedDate).getTime()<r.getTime())))?void 0:i.length)??0,indicatorProgress:Math.min(1,l/this.goalMinutes),pomodoroCompletedForDay:n,forDate:e}})).reverse()},settings:()=>q(),goalDays(){return this.settings.goalDays},goalEnabled(){return this.settings.goalEnabled},goalMinutes(){return this.settings.goalMinutes},totalFocusedInMonth(){return this.pomodoroCompletedStore.loading?"-":o(et(this.focusHistoryDays.map((t=>t.focusedMinutes)))*v)},timeframeLabel(){return`${b(new Date(this.firstDayInMonth),!0)} ${this.year}`},todosCompletedCount(){const t=`${this.month}-${this.year}`;return t in this.tasksCompletedStore.data?this.tasksCompletedStore.data[t].total:"-"},isCurrentMonth(){return this.month===m.models.date.get("hour").getMonth()&&this.year===m.models.date.get("hour").getFullYear()}},mounted(){this.refreshStores()},methods:{goToOverview(){this.viewStateStore.setActiveView(I.Overview)},refreshStores(){this.streaksStore.refresh(),this.pomodoroCompletedStore.refresh({daysNeeded:y(this.firstDayInMonth,new Date,0)+1});const t=`${this.month}-${this.year}`;t in this.tasksCompletedStore.data&&!this.isCurrentMonth||this.tasksCompletedStore.get(new Date(this.firstDayInMonth).getTime(),new Date(this.lastDayInMonth).getTime(),t)},setMonthAdjacent(t){const e=new Date(this.firstDayInMonth);e.setMonth(e.getMonth()+t),this.month=e.getMonth(),this.year=e.getFullYear(),this.refreshStores()},async editTimeFocused(t,e){const s=Number(e)-t.focusedMinutes,o=t.pomodoroCompletedForDay.find((t=>t.manualAdjustment));if(o&&0!==s){const t=o.focusMinutes+s;await this.pomodoroCompletedStore.update(o.id,{focusMinutes:t})}else if(0!==s){const e=new Date(t.forDate);e.setHours(12),await this.pomodoroCompletedStore.create({focusMinutes:s,manualAdjustment:!0,aggregatedEntries:1,completed:e.toISOString()})}At.capture("focus insights time edit",{diff:s,date:new Date(t.forDate).toString()})}}});const Vt=T(t({name:"FocusModeInsightsApp",components:{FocusModeInsightsSettings:It,FocusModeInsightsOverview:_t,AppViewSwitchDynamic:w,AppPopup:S,FocusModeInsightsHistory:T(Bt,(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("app-view",{staticClass:"focus-mode-insights-history",scopedSlots:t._u([{key:"header",fn:function(){return[e("app-header",{scopedSlots:t._u([{key:"left",fn:function(){return[e("app-header-control",{attrs:{"data-test":"go-to-overview"},on:{click:t.goToOverview}},[e("base-icon",{staticClass:"icon",attrs:{src:"icon/arrow-left"}})],1),e("span",{staticClass:"app-header-name"},[t._v("Focus History")])]},proxy:!0}])}),e("div",{staticClass:"insights-bento"},[e("div",{staticClass:"cell cell-full"},[e("div",{staticClass:"month",attrs:{"data-test":"month-label"}},[t._v(t._s(t.timeframeLabel))]),e("div",{staticClass:"time-focused",attrs:{"data-test":"month-time-focused"}},[t._v(t._s(t.totalFocusedInMonth)+" focused")]),t.isCurrentMonth?t._e():e("base-icon",{staticClass:"chevron-right",attrs:{src:"chevron-right",size:"30px","data-test":"next-month"},on:{click:function(e){return t.setMonthAdjacent(1)}}}),e("base-icon",{staticClass:"chevron-left",attrs:{src:"chevron-left",size:"30px","data-test":"prev-month"},on:{click:function(e){return t.setMonthAdjacent(-1)}}})],1)]),e("focus-mode-insights-bento-stats",{attrs:{"todos-completed-count":t.todosCompletedCount,"min-timestamp":t.firstDayInMonth.getTime(),"max-timestamp":t.lastDayInMonth.getTime()}})]},proxy:!0},{key:"body",fn:function(){return[t.pomodoroCompletedStore.loading?e("app-loading"):e("div",{staticClass:"focus-detail-list"},t._l(t.focusHistoryDays,(function(s){return e("focus-mode-insights-day-list-item",t._b({key:s.label,attrs:{"goal-enabled":t.goalEnabled},on:{editFocusedTime:e=>t.editTimeFocused(s,e)}},"focus-mode-insights-day-list-item",s,!1))})),1)]},proxy:!0}])})}),[],!1,null,"d041d1a4").exports},emits:["close"],setup:()=>({viewStateStore:k(),FocusModeInsightsView:I}),computed:{activeView(){return this.viewStateStore.activeView},activeViewId(){return this.viewStateStore.activeViewId}}}),(function(){var t,e=this,s=e._self._c;return e._self._setupProxy,s("app-popup",{attrs:{region:"top-right",position:"bottom-left",focused:e.viewStateStore.focused,width:370},on:{close:function(t){return e.$emit("close")}}},[s("app-view-switch-dynamic",{attrs:{"order-key":null==(t=e.activeView)?void 0:t.order}},[e.activeViewId===e.FocusModeInsightsView.Overview?s("focus-mode-insights-overview",{on:{close:function(t){return e.$emit("close")}}}):e.activeViewId===e.FocusModeInsightsView.Settings?s("focus-mode-insights-settings"):e.activeViewId===e.FocusModeInsightsView.History?s("focus-mode-insights-history"):e._e()],1)],1)}),[],!1,null,"a946083c").exports;export{Vt as default};