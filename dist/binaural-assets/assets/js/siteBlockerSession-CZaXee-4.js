import{e,g as t,u as s,J as i,K as r}from"./dynamic-import-helper-CTnsj-vI.js";import{L as o}from"./LocalStorageStoreSyncedItem-DMdfjgsv.js";import{u as a,a as n}from"./siteBlockerGroups-BbPmPcem.js";import{S as c,a as p,b as l}from"./constants-Dqx3dGLK.js";import{p as d}from"./promisifiedChrome-vBWwQWBS.js";import{d as u,F as g}from"./focusModeState-BPyBLUbE.js";import{useFocusModeDashViewStateStore as j}from"./focusModeViewState-DaeRKVyi.js";import{u as h}from"./pomodoroCompleted-B2E_m1QL.js";import{g as f}from"./focusModeHelpers-tDECULZC.js";import{computed as S}from"./reactiveCustomization-CEUTOUc3.js";import{o as w,a as b}from"./modal-qMFaWR5h.js";import{U as v}from"./enums-1c3kgXdw.js";import"./array-YYQw31d9.js";import"./style-D-IRYiWS.js";import"./Logger-cMW5At62.js";import"./string-BBKP9xfj.js";import"./compareObjects-R6Hcs7xe.js";import"./ViewState-DH0LvQYq.js";import"./appZStack-Zxx-wHpo.js";import"./VueBase-C55TLWt3.js";import"./_commonjsHelpers-B3K3fdV-.js";import"./ClickOutside-DCLvi2fj.js";import"./pinia-B4IAWUO-.js";import"./portal-vue.esm-DdddSpdW.js";import"./PomodoroTimers-CyrfcuWH.js";import"./persistStore-BDYPfxbs.js";import"./constants-BfBD_H-d.js";import"./login-HJtMK9QU.js";import"./authService-UjcjSrh8.js";import"./auth-BwdMrzFn.js";import"./legacyUserMigration-CaazFMYU.js";import"./migrateLegacyUserMessageHandler-CZ8nZZlg.js";import"./onboarding-B35lV45t.js";const k=new o(c,!1),B=new o(p,""),y=e("siteBlockerSession",{state:()=>({active:k.currentValue,hasPermissions:!1}),getters:{urls:()=>[...a().items.reduce(((e,t)=>t.enabled?(n().getWebsitesByGroup(t).filter((e=>e.enabled)).forEach((t=>e.add(t.hostWithWildcard))),e):e),new Set([]))].join(" "),settingsEnabled:()=>S.siteBlockerVisible,focusModeEnabledAndFocusModeSettingActive:()=>u.currentValue&&f().apps.siteBlocker.enabled&&j().activeViewId===g.Focusing.toString(),featureEnabled:()=>m.conditionalFeatures.featureEnabled("site-blocker")||u.currentValue,activeAndBlockingUrls:e=>e.active&&e.hasPermissions&&0!==a().items.length},actions:{toggleActive(e){const t=e??!this.active;t&&this.checkSiteBlockerFeatureDisabledAndOpenUpsell()||(t&&this.registerOrUpdateContentScript(),this.active=t)},async ensurePermissions(e=!1){return this.hasPermissions?await this.registerOrUpdateContentScript():w(l,{source:"Site Blocker",reason:"To block sites while focusing",requestImmediately:e,extraInstructions:r()?' Please select "Always allow on every website..."':"",watchPermissionCheck:!0}).then((async e=>!!e&&(this.hasPermissions=!0,await this.registerOrUpdateContentScript(),!0)))},async registerOrUpdateContentScript(){if(!t().scripting)return;return!!(await t().scripting.getRegisteredContentScripts()).length||await new Promise((e=>{t().scripting.registerContentScripts([{id:"site-blocker",js:["/content-scripts/siteBlocker.js"],matches:["*://*/*"],runAt:"document_start"}],(()=>e(!0)))}))},checkSiteBlockerFeatureDisabledAndOpenUpsell(){return!this.featureEnabled&&(b(v.SITE_BLOCKER,"site-blocker"),!0)}}});(async()=>{const e=y(),r=a(),o=n(),c=h(),m=j();k.switchOverToWatchedStoreItem((()=>e.active)),t().permissions&&d.permissions.contains(l).then((t=>{e.hasPermissions=t,t&&e.active&&e.registerOrUpdateContentScript()})),await s((()=>c.loaded)).toBe(!0),u.currentValue&&await s((()=>m.activeViewId)).toBe(g.Focusing),i([()=>u.currentValue,()=>e.focusModeEnabledAndFocusModeSettingActive,()=>c.anyFocusTimerActive,()=>c.playing,()=>e.featureEnabled,()=>e.settingsEnabled],(([t,s,i,r,o,a])=>{o&&a||e.toggleActive(!1),t&&(s&&i&&r?e.toggleActive(!0):e.toggleActive(!1))})),await s((()=>r.loaded)).toBe(!0),await s((()=>o.loaded)).toBe(!0),B.switchOverToWatchedStoreItem((()=>e.urls))})();export{y as default};