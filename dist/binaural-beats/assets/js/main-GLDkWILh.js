const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/FocusModeHoverDropdown-BP3j5lJG.js","assets/js/BaseDropdownContent-C68ik0op.js","assets/js/constants-CALDQiUE.js","assets/js/dynamic-import-helper-CTnsj-vI.js","assets/js/array-YYQw31d9.js","assets/js/style-D-IRYiWS.js","assets/css/style-6nm_MYpP.css","assets/js/Logger-cMW5At62.js","assets/js/string-BBKP9xfj.js","assets/js/index-998LMmMn.js","assets/js/_plugin-vue2_normalizer-DeUNqxFl.js","assets/css/BaseDropdownContent-DKsGy_8Z.css","assets/js/focus-mode-fill-qvXwryrv.js","assets/js/sounds-DyeiSxA-.js","assets/js/tabs-B0xiyzOS.js","assets/js/links-B3EjXGZU.js","assets/js/pomodoro-circle-CecfhCBZ.js","assets/css/FocusModeHoverDropdown-C9OnliXx.css","assets/js/FocusModeFocusingView-CajEWwui.js","assets/js/BaseIcon-BW2ar6VN.js","assets/css/BaseIcon-CPmL0n7V.css","assets/js/focusModeState-BPyBLUbE.js","assets/js/LocalStorageStoreSyncedItem-DMdfjgsv.js","assets/js/v-style-DxUun1f4.js","assets/js/flashMessageMixin-aWmQ8a-O.js","assets/js/globalKeyEventManager-C6pBx38h.js","assets/js/VueBase-C55TLWt3.js","assets/js/_commonjsHelpers-B3K3fdV-.js","assets/js/ClickOutside-DCLvi2fj.js","assets/js/pinia-B4IAWUO-.js","assets/js/portal-vue.esm-DdddSpdW.js","assets/js/PomodoroTimers-CyrfcuWH.js","assets/js/focusModeHelpers-tDECULZC.js","assets/js/reactiveCustomization-CEUTOUc3.js","assets/js/persistStore-BDYPfxbs.js","assets/js/constants-BfBD_H-d.js","assets/js/focus-mode-TgjJstn5.js","assets/js/AppContainer-BFIQ2qhm.js","assets/js/showAnyway-8ON2gVJd.js","assets/js/useAllComponentsMounted-VdWDSwjD.js","assets/css/AppContainer-Okwrv5EP.css","assets/js/AppDash-Ic_PCFf2.js","assets/css/AppDash-JMHRJAX6.css","assets/js/focusModeViewState-DaeRKVyi.js","assets/js/ViewState-DH0LvQYq.js","assets/js/appZStack-Zxx-wHpo.js","assets/js/login-HJtMK9QU.js","assets/js/authService-UjcjSrh8.js","assets/js/auth-BwdMrzFn.js","assets/js/legacyUserMigration-CaazFMYU.js","assets/js/enums-1c3kgXdw.js","assets/js/migrateLegacyUserMessageHandler-CZ8nZZlg.js","assets/js/onboarding-B35lV45t.js","assets/js/promisifiedChrome-vBWwQWBS.js","assets/js/modal-qMFaWR5h.js","assets/css/FocusModeFocusingView-BpaKZUyt.css"])))=>i.map(i=>d[i]);
import"./VueBase-C55TLWt3.js";import{_ as e}from"./style-D-IRYiWS.js";import t from"./focus-mode-TgjJstn5.js";import o from"./AppContainer-BFIQ2qhm.js";import{u as s,c as i,g as a,b as n,s as r}from"./focusModeHelpers-tDECULZC.js";import{A as c}from"./AppDash-Ic_PCFf2.js";import{useFocusModeViewStateStore as u}from"./focusModeViewState-DaeRKVyi.js";import{F as d,C as l,A as p,I as f,d as h}from"./focusModeState-BPyBLUbE.js";import{c as M,N as w,A as g,G as S,r as F,n as v,d as y,w as b,q as A,V,h as _}from"./dynamic-import-helper-CTnsj-vI.js";import{a as T}from"./appZStack-Zxx-wHpo.js";import{s as C}from"./showAnyway-8ON2gVJd.js";import{w as D}from"./login-HJtMK9QU.js";import{p as I}from"./promisifiedChrome-vBWwQWBS.js";import{a as O}from"./modal-qMFaWR5h.js";import{U as j}from"./enums-1c3kgXdw.js";import{n as E}from"./_plugin-vue2_normalizer-DeUNqxFl.js";const L=new class{constructor(){this.fullscreen=M(!!document.fullscreenElement),this.fullscreenModeAvailable=document.fullscreenEnabled,document.addEventListener("fullscreenchange",(()=>{this.fullscreen.value=!!document.fullscreenElement}))}async enterFullscreen(e){if(this.fullscreenModeAvailable){if(e){const e=await I.tabs.getCurrent();if(!e)return;await I.windows.create({tabId:e.id}),await w(100)}await document.body.requestFullscreen({navigationUI:"hide"})}}async exitFullscreen(){this.fullscreenModeAvailable&&await document.exitFullscreen()}async toggleFullscreen(e,t){this.fullscreen.value?await this.exitFullscreen():await this.enterFullscreen(e),g.capture((this.fullscreen.value?"enter":"leave")+" fullscreen",{feature:t})}},P=new g({feature:"focus mode"});const k=E({name:"FocusMode",components:{AppContainer:o,AppDash:c,FocusModeHoverDropdown:()=>e((()=>import("./FocusModeHoverDropdown-BP3j5lJG.js")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17])),FocusModeFocusingView:()=>e((()=>import("./FocusModeFocusingView-CajEWwui.js")),__vite__mapDeps([18,5,6,3,4,7,8,19,10,20,21,22,23,24,25,26,27,28,29,30,9,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55]))},setup(){const e=u(),t=s();return S("store",t),S("viewStateStore",e),{apps:i,FocusModeView:d,focusModeViewStateStore:e,focusModeSessionStore:t,CAPACITY_LIMIT_MS_ALLOWED_PER_DAY:l,showAnyway:C,capacityLimitInterval:null,APP_TRANSITION_TIME:p}},data:()=>({hoverDropdownOpen:!1,instantFocusingViewTransition:!1,focusModeCancelled:!1}),computed:{tabFocused:()=>F.tabFocused,activatedApps(){return Object.keys(this.apps).filter((e=>"pomodoro"===e||this.settingsWithDefaults.apps[e].enabled&&!this.apps[e].unsupported)).map((e=>({key:e,...this.apps[e]})))},focusing(){return this.focusModeViewStateStore.currentlyFocusing},focusingOrCelebrationViewActive(){return this.focusModeViewStateStore.currentlyFocusing||this.focusModeViewStateStore.currentFocusModeView===d.Celebration},settingsWithDefaults:()=>a()},watch:{"focusModeViewStateStore.currentFocusModeView"(e){e===d.Transition&&this.loadPlusApps()},"focusModeSessionStore.loaded":{handler(e){if(e){const e=async()=>{await this.focusModeViewStateStore.resumeFocusModeAfterTabLoad(),this.setCapacityLimitFocusModeTimeout()};this.focusModeSessionStore.shouldAutoDisable&&this.$plus&&"true"!==localStorage.getItem("pomodoro-running")?(this.stopFocusMode(!0),D().then((async()=>{v.$emit("flashMessage",{icon:t,message:f,button:{text:"Jump back in",action:()=>this.startFocusMode("inactivity flash message")}})}))):this.focusModeSessionStore.focusModeActive&&(this.loadPlusApps(),D().then((async()=>{var e;for(const t of this.activatedApps){(null==(e=t.shouldEnableOnResume)?void 0:e.call(t))&&t.enable(this.focusModeSessionStore.appActivationData[t.key])}await this.triggerFocusModeStartedEventAfterDelay()})),this.instantFocusingViewTransition=!0,F.disableAppTransitions=!0,Promise.race([y.delay(1e3),D()]).then(e)),this.unwatch=b((()=>this.focusModeSessionStore.focusModeActive),(async t=>{t?await e():t||this.focusModeViewStateStore.currentFocusModeView===d.Idle||(this.focusModeViewStateStore.currentFocusModeView!==d.Celebration&&(this.instantFocusingViewTransition=!0,await A()),await this.focusModeViewStateStore.stopFocusMode(),m.tourActive&&m.trigger("modal:close"))})),m.widgetManager.appReady("focus-mode")}},immediate:!0},tabFocused:{handler(){this.setCapacityLimitFocusModeTimeout()},immediate:!0},settingsWithDefaults(){this.onSettingsUpdate()}},mounted(){m.on("globalEvent:click",this.focusModeSessionStore.refreshLastInteraction),m.on("focusMode:start",this.startFocusMode),m.on("focusMode:stop",this.stopFocusMode),m.on("focusMode:cancel",this.cancelFocusMode),h.currentValue||m.widgetManager.appReady("focus-mode"),v.$emit("focusMode:ready")},destroyed(){var e;m.off("globalEvent:click",this.focusModeSessionStore.refreshLastInteraction),m.off("focusMode:start",this.startFocusMode),m.off("focusMode:stop",this.stopFocusMode),m.off("focusMode:cancel",this.cancelFocusMode),null==(e=this.unwatch)||e.call(this)},methods:{async loadPlusApps(){this.$plus||(y.isSafari()||y.isPwa()||await m.widgetManager.loadWidget("tabs"),y.isPwa()||await m.widgetManager.loadWidget("site-blocker"),await m.widgetManager.loadWidget("sounds"))},openHoverDropdown(){1===this.focusModeSessionStore.start&&0===T.stack.length&&(this.hoverDropdownOpen=!0,m.trigger("focusMode:hover:toggle",!0))},closeHoverDropdown(){this.hoverDropdownOpen=!1,m.trigger("focusMode:hover:toggle",!1)},async triggerFocusModeStartedEventAfterDelay(){await y.delay(p),await y.doubleRaf(),m.trigger("focusMode:started")},async startFocusMode(e){if(!this.focusing)if(!this.$plus&&this.focusModeSessionStore.isOverCapacityLimit)this.openUpsell();else{if(this.closeHoverDropdown(),m.trigger("focusMode:starting"),await this.focusModeViewStateStore.startFocusModeWithCancelPeriod(),this.focusModeCancelled)return this.focusModeCancelled=!1;await this.focusModeViewStateStore.finalizeStartFocusModeAfterCancelPeriod();const t={};for(const e of this.activatedApps)t[e.key]=await i[e.key].enable();await this.focusModeSessionStore.startAndSaveFocusMode(t),P.capture("focus mode start",{enabled_apps:this.activatedApps.map((e=>e.key)),source:e}),await this.triggerFocusModeStartedEventAfterDelay()}},async cancelFocusMode(){this.focusModeCancelled=!0,await this.focusModeViewStateStore.cancelFocusModeStart()},async stopFocusMode(e=!1){m.trigger("focusMode:stopping"),await i.pomodoro.disable({});const t=async()=>{await y.delay(p),await this.focusModeSessionStore.disableAppsBeforeStop(e)};e?t():await Promise.allSettled([t(),this.focusModeViewStateStore.celebrateFocusMode()]),L.fullscreen.value&&await L.exitFullscreen(),await this.focusModeSessionStore.stopAndSaveFocusMode();const o=this.activatedApps.map((e=>e.key)),s=Math.round((this.focusModeSessionStore.stop-this.focusModeSessionStore.start)/1e3);P.capture("focus mode stop",{enabled_apps:o,seconds_since_start:s,stopped_by_inactivity:e}),this.setCapacityLimitFocusModeTimeout(),m.trigger("focusMode:stopped")},setCapacityLimitFocusModeTimeout(){clearTimeout(this.capacityLimitInterval),this.$plus||this.focusing&&(this.capacityLimitInterval=setTimeout((async()=>{if(this.focusing){if(!this.focusModeSessionStore.isOverCapacityLimit)return this.setCapacityLimitFocusModeTimeout();await i.pomodoro.disable({}),await i.soundscapes.disable({}),await i.siteBlocker.disable({}),F.tabFocused&&(await this.stopFocusMode(),this.openUpsell())}}),Math.max(this.focusModeSessionStore.msUntilOverCapacityLimit+100,500)))},openUpsell(){O(j.FOCUS_MODE,"dash")},onSettingsUpdate(){this.focusing&&(this.focusModeViewStateStore.resetFocusingStyleVariables(),n(),r(),this.focusModeViewStateStore.setFocusingStyleVariables())},resetInstantTransition(){this.instantFocusingViewTransition=!1}}},(function(){var e,t=this,o=t._self._c;return o("app-container",{class:{focusing:t.focusingOrCelebrationViewActive},attrs:{"app-name":"focus-mode","visible-setting":"focusModeVisible","data-test":"focus-mode"}},[o("transition",{attrs:{name:"focus-mode-fade-deep",duration:t.instantFocusingViewTransition?0:t.APP_TRANSITION_TIME},on:{"after-enter":t.resetInstantTransition,"after-leave":t.resetInstantTransition}},[t.focusingOrCelebrationViewActive&&t.showAnyway.includes("focus-mode")?o("focus-mode-focusing-view",{on:{openUpsell:t.openUpsell,stopFocusMode:t.stopFocusMode}}):t._e()],1),t.focusingOrCelebrationViewActive?t._e():[o("app-dash",{ref:"focusModeAppToggle",attrs:{icon:"icon/apps/focus-mode",label:"Focus","data-test":"focus-mode-top-left-app-toggle"},on:{mouseenter:t.openHoverDropdown,mouseleave:t.closeHoverDropdown,click:function(e){return t.startFocusMode("dash icon")}}}),o("transition",{attrs:{name:"slide-down-fade-blurred",duration:200}},[t.hoverDropdownOpen?o("focus-mode-hover-dropdown",{attrs:{target:null==(e=t.$refs.focusModeAppToggle)?void 0:e.$el}}):t._e()],1)]],2)}),[],!1,null,"4ab97b1f").exports,U=document.querySelector(".region.top-left"),x=document.createElement("div");U&&U.prepend(x),new V({render:()=>_(k)}).$mount(x);const R=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{L as f,R as m};