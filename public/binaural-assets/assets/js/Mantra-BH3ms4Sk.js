import{M as t}from"./Message-DIyUGK15.js";import{V as a,c as n,A as i}from"./dynamic-import-helper-CTnsj-vI.js";import{V as s}from"./VueBase-C55TLWt3.js";import{u as e}from"./useAllComponentsMounted-VdWDSwjD.js";import{persistent as r}from"./reactiveCustomization-CEUTOUc3.js";import{T as o}from"./index-CypNqh9b.js";import{s as p}from"./showAnyway-8ON2gVJd.js";import{a as d}from"./modal-qMFaWR5h.js";import{U as c}from"./enums-1c3kgXdw.js";import{B as l}from"./BaseDropdownOption-tB3ldrjh.js";import g from"./BaseIcon-BW2ar6VN.js";import{B as u}from"./BaseDropdownDivider-Bay0Demn.js";import{B as h}from"./BaseDropdown-CB3yfeIu.js";import{n as f}from"./_plugin-vue2_normalizer-DeUNqxFl.js";import"./MobileBlur-B2s9dLKD.js";import"./array-YYQw31d9.js";import"./style-D-IRYiWS.js";import"./Logger-cMW5At62.js";import"./string-BBKP9xfj.js";import"./_commonjsHelpers-B3K3fdV-.js";import"./ClickOutside-DCLvi2fj.js";import"./pinia-B4IAWUO-.js";import"./portal-vue.esm-DdddSpdW.js";import"./localStorage-B4mFdj8F.js";import"./legacyUserMigration-CaazFMYU.js";import"./migrateLegacyUserMessageHandler-CZ8nZZlg.js";import"./auth-BwdMrzFn.js";import"./persistStore-BDYPfxbs.js";import"./embeddedApp-Bd9r3bdf.js";import"./experiments-6paecGsK.js";import"./flashMessageQueue-C7gl3k6c.js";import"./info-DdD9a7JK.js";import"./constants-Bt_TxKWw.js";import"./index-DHG7crjO.js";import"./appZStack-Zxx-wHpo.js";import"./ResizeSensor-ZXOsDHeC.js";import"./promisifiedChrome-vBWwQWBS.js";import"./modal-BWwnzHDf.js";import"./constants-CALDQiUE.js";import"./BaseDropdownContent-C68ik0op.js";import"./index-998LMmMn.js";import"./icon-ellipsis-D7nTOXaQ.js";a.use(s);const v=new(a.extend({name:"MantraManager",manager:m.models.mantraManager,bb:()=>({mantras:m.collect.mantras,mantraSettings:m.models.mantraSettings}),computed:{pinned(){return this.mantraSettings?this.mantraSettings.pinnedMantra:null},active(){let t;if(this.pinned)return t=this.mantras.findWhere({forDate:"pinned"}),t&&t.get("_id")===this.pinned.id?t:null;if(this.mantras&&this.isEnabled()){if(t=this.mantras.getActiveItem(),!t)return m.trigger("sync:download","mantra"),null;if(t.get("hardSkip"))return null}return t}},watch:{active(t){!t&&this.pinned&&this.mantras.create({forDate:"pinned",_id:this.pinned.id,body:this.pinned.body,is_custom:this.pinned.isCustom,is_favorite:this.pinned.isFavorite})}},methods:{isEnabled:function(){return this.$options.manager.isEnabled()},pinMantra:function(t,a){this.$options.manager.pinMantra(t,a)},toggleFav:function(t){this.$options.manager.toggleFav(t)},skipItem:function(t){return this.$options.manager.skipItem(t)},getMantraForDisplay:function(t,a){return this.$options.manager.getMantraForDisplay(t,a)},markGreetingAsSeenToday:function(){this.$options.manager.markGreetingAsSeenToday()}}})),w=new i({feature:"mantra"});const j=f({name:"Mantra",components:{BaseDropdownDivider:u,BaseIcon:g,BaseDropdownOption:l,BaseDropdown:h,ThreeColLayout:o,Message:t},props:{mantraOverride:{type:String,default:""}},setup:()=>({...e(),showAnyway:p,dropdown:n()}),data:()=>({editingName:!1,skipping:!1,useLastShowName:!1}),computed:{isFavorite(){return this.mantra&&this.mantra.activeMantra&&this.mantra.activeMantra.get("is_favorite")},isPinned(){return this.mantra&&this.mantra.activeMantra&&this.mantra.activeMantra.isPinned()},isCustom(){return this.mantra&&this.mantra.activeMantra&&this.mantra.activeMantra.get("is_custom")},mantra(){if(this.mantraOverride)return{activeMantra:"",content:this.mantraOverride,name:"",punctuation:""};const t=v.active,a=v.getMantraForDisplay(t,this.useLastShowName);return a?{activeMantra:t,content:a.start,name:a.name,punctuation:a.end||"."}:{activeMantra:"",content:" ",name:"",punctuation:""}},skipOrSkipping(){return this.skipping?"Skipping…":"Skip mantra"},pinOrUnpin(){return this.isPinned?"Unpin":"Pin"}},watch:{mantra(){this.useLastShowName=!0}},mounted(){m.trigger("mantra:mounted")},methods:{toggleDropdown(t){var a;this.$emit("stop-cycle",t),m.trigger("mantra:dropdown:visible",t),null==(a=this.dropdown)||a.openDropdown()},openMantraSettings(){var t;this.editingName||(m.commandManager.executeAsync("settings.display",null,{section:"mantra-settings"}),null==(t=this.dropdown)||t.closeDropdown())},toggleFavorite(){v.toggleFav(this.mantra.activeMantra),w.capture("mantra "+(this.isFavorite?"fav":"unfav"),{location:"dash",custom:this.isCustom})},togglePin(){if(!this.$plus)return void d(c.MANTRAS,"dash");w.capture("mantra "+(this.isPinned?"unpin":"pin"),{location:"dash",custom:this.isCustom,is_paid_event:!0});const t=this.mantra.name===r.displayname;v.pinMantra(this.mantra.activeMantra,t)},skip(){if(this.$plus){if(!this.mantra.activeMantra)return m.trigger("sync:download","mantra"),void this.$emit("show-greeting");w.capture("mantra skip",{custom:this.isCustom,is_paid_event:!0}),this.skipping=!0,v.skipItem().finally((()=>{var t;null==(t=this.dropdown)||t.closeDropdown(),this.skipping=!1}))}else d(c.MANTRAS,"dash")},dontShowAgain(){v.skipItem(!0).finally((()=>{var t;null==(t=this.dropdown)||t.closeDropdown(),this.$plus||this.$emit("show-greeting")})),w.capture("mantra don't show again")},editing(t){this.$emit("stop-cycle",t),this.editingName=t},onEditNameClick(){var t;this.editingName=!0,null==(t=this.dropdown)||t.closeDropdown(),i.capture("display name change",{feature:"profile"})}}},(function(){var t=this,a=t._self._c;return a("three-col-layout",{directives:[{name:"mobile-click",rawName:"v-mobile-click",value:t.toggleDropdown.bind(null,!0),expression:"toggleDropdown.bind(null, true)"}],staticClass:"app-container has-dash-icon greeting",class:{"show-anyway":t.showAnyway.includes("greeting")},attrs:{"data-show-anyway":"greeting","data-test":"mantra"},scopedSlots:t._u([{key:"center",fn:function(){return[a("message",{attrs:{message:t.mantra,"editing-name":t.editingName},on:{editing:t.editing,toggle:t.toggleDropdown}})]},proxy:!0},{key:"right",fn:function(){return[a("base-dropdown",{ref:"dropdown",attrs:{"container-class":"dash","data-test":"more-toggle"},scopedSlots:t._u([{key:"toggle",fn:function(){return[a("div",{staticClass:"icon-wrapper dark dark-full"},[a("base-icon",{staticClass:"icon",attrs:{src:"icon-ellipsis",size:"18px"}})],1)]},proxy:!0}])},[a("base-dropdown-option",{attrs:{"data-test":"favorite"},on:{click:t.toggleFavorite}},[a("base-icon",{attrs:{src:t.isFavorite?"heart-off":"heart"}}),a("span",[t._v(t._s(t.isFavorite?"Unfavorite":"Favorite"))])],1),a("base-dropdown-option",{attrs:{"data-test":"pin"},on:{click:t.togglePin}},[a("base-icon",{attrs:{src:t.isPinned?"pin-off":"pin"}}),a("span",[t._v(t._s(t.pinOrUnpin))])],1),a("base-dropdown-option",{attrs:{disabled:t.skipping,"data-test":"skip"},on:{click:t.skip}},[a("base-icon",{attrs:{src:"redo-dot"}}),a("span",[t._v(t._s(t.skipOrSkipping))])],1),t.isCustom?t._e():a("base-dropdown-option",{attrs:{"data-test":"dont-show-again"},on:{click:t.dontShowAgain}},[a("base-icon",{attrs:{src:"thumbs-down"}}),a("span",[t._v("Don't show again")])],1),a("base-dropdown-divider"),a("base-dropdown-option",{attrs:{"data-test":"mantra-settings"},on:{click:function(a){return a.stopPropagation(),t.openMantraSettings.apply(null,arguments)}}},[a("base-icon",{attrs:{src:"settings-2"}}),a("span",[t._v("Mantra settings")])],1),t.mantra.name?a("base-dropdown-option",{attrs:{"data-test":"edit-name"},on:{click:t.onEditNameClick}},[a("base-icon",{attrs:{src:"pencil"}}),a("span",[t._v("Edit your name")])],1):t._e()],1)]},proxy:!0}])})}),[],!1,null,"9c93f840").exports;export{j as default};