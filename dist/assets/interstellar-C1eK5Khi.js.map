{"version":3,"mappings":"0hCAIQ,MAAMA,EAAa,CACf,aAAc,CACV,KAAK,OAAS,SAAS,eAAe,QAAQ,EAC9C,KAAK,IAAM,KAAK,OAAO,WAAW,KAAM,CAAE,MAAO,GAAO,EAGxD,KAAK,OAAS,CACV,eAAgB,IAChB,YAAa,IACb,aAAc,EACd,QAAS,UACT,eAAgB,EACpC,EAGgB,KAAK,UAAY,KAGjB,KAAK,WAAa,IAClB,KAAK,cAAgB,IAAI,IACzB,KAAK,cAAgB,CAAE,EAAG,EAAG,EAAG,GAChC,KAAK,mBAAqB,IAG1B,KAAK,MAAQ,GACb,KAAK,OAAS,CAAE,EAAG,EAAG,EAAG,EAAG,KAAM,EAAG,WAAY,CAAC,EAClD,KAAK,QAAU,GACf,KAAK,KAAO,OAGZ,KAAK,YAAc,UACnB,KAAK,UAAY,QACjB,KAAK,aAAe,IAAI,IACxB,KAAK,sBAAwB,EAC7B,KAAK,uBAAyB,EAC9B,KAAK,YAAc,UACnB,KAAK,kBAAoB,GACzB,KAAK,YAAc,EAGnB,KAAK,WAAa,CAAC,UAAW,UAAW,SAAS,EAClD,KAAK,YAAc,GACnB,KAAK,WAAa,GAClB,KAAK,UAAY,EACjB,KAAK,oBAAsB,EAC3B,KAAK,cAAgB,EACrB,KAAK,oBAAsB,GAC3B,KAAK,qBAAuB,EAG5B,KAAK,WAAa,GAClB,KAAK,YAAc,GACnB,KAAK,QAAU,KAAK,YAAW,EAC/B,MAAMC,EAAgB,KAAK,aAAY,EAEvC,KAAK,WAAa,CACd,KAAM,UACN,EAAG,EAAG,EAAG,EAAG,EAAG,EACf,GAAI,EAAG,GAAI,EAAG,GAAI,EAClB,SAAU,EACV,MAAO,EACP,KAAM,EACN,MAAO,EACP,SAAU,IAAM,GAAKA,EAAc,OAAS,GAAK,IACjD,aAAc,IAAO,GAAKA,EAAc,OAAS,GAAK,IACtD,cAAe,IACf,KAAM,GACN,WAAY,KAAO,GAAKA,EAAc,OAAS,GAAK,IACpD,QAAS,KAAO,GAAKA,EAAc,OAAS,GAAK,IACjD,OAAQ,IAAM,GAAKA,EAAc,QAAU,GAAK,IAChD,UAAW,IAAM,GAAKA,EAAc,QAAU,GAAK,IACnD,WAAY,KAAQ,GAAKA,EAAc,OAAS,GAAK,IACrD,SAAUA,CAC9B,EACgB,KAAK,WAAa,GAClB,KAAK,cAAgB,GAGrB,KAAK,SAAW,GAChB,KAAK,aAAe,CAEhB,KAAM,CAAE,KAAM,OAAQ,MAAO,GAAI,MAAO,UAAW,OAAQ,SAAU,KAAM,GAAI,KAAM,aAAc,IAAK,oBAAoB,EAC5H,OAAQ,CAAE,KAAM,SAAU,MAAO,GAAI,MAAO,UAAW,OAAQ,SAAU,KAAM,GAAI,KAAM,aAAc,IAAK,oBAAoB,EAChI,KAAM,CAAE,KAAM,OAAQ,MAAO,GAAI,MAAO,UAAW,OAAQ,SAAU,KAAM,GAAI,KAAM,aAAc,IAAK,aAAa,EACrH,SAAU,CAAE,KAAM,WAAY,MAAO,GAAI,MAAO,UAAW,OAAQ,SAAU,KAAM,GAAI,KAAM,aAAc,IAAK,eAAe,EAC/H,QAAS,CAAE,KAAM,UAAW,MAAO,GAAI,MAAO,UAAW,OAAQ,SAAU,KAAM,GAAI,KAAM,aAAc,IAAK,uBAAuB,EAGrI,OAAQ,CAAE,KAAM,SAAU,MAAO,IAAK,MAAO,UAAW,OAAQ,WAAY,KAAM,GAAI,KAAM,WAAY,IAAK,sBAAsB,EACnI,KAAM,CAAE,KAAM,OAAQ,MAAO,IAAK,MAAO,UAAW,OAAQ,WAAY,KAAM,GAAI,KAAM,WAAY,IAAK,uBAAuB,EAChI,SAAU,CAAE,KAAM,WAAY,MAAO,IAAK,MAAO,UAAW,OAAQ,WAAY,KAAM,GAAI,KAAM,WAAY,IAAK,oBAAoB,EACrI,UAAW,CAAE,KAAM,YAAa,MAAO,IAAK,MAAO,UAAW,OAAQ,WAAY,KAAM,GAAI,KAAM,WAAY,IAAK,uBAAuB,EAG1I,OAAQ,CAAE,KAAM,SAAU,MAAO,IAAK,MAAO,UAAW,OAAQ,OAAQ,KAAM,GAAI,KAAM,UAAW,IAAK,iBAAiB,EACzH,QAAS,CAAE,KAAM,UAAW,MAAO,KAAM,MAAO,UAAW,OAAQ,OAAQ,KAAM,GAAI,KAAM,UAAW,IAAK,uBAAuB,EAClI,QAAS,CAAE,KAAM,UAAW,MAAO,IAAM,MAAO,UAAW,OAAQ,OAAQ,KAAM,GAAI,KAAM,UAAW,IAAK,iBAAiB,EAC5H,KAAM,CAAE,KAAM,OAAQ,MAAO,KAAM,MAAO,UAAW,OAAQ,OAAQ,KAAM,GAAI,KAAM,UAAW,IAAK,qBAAqB,EAC1H,SAAU,CAAE,KAAM,WAAY,MAAO,KAAM,MAAO,UAAW,OAAQ,OAAQ,KAAM,GAAI,KAAM,UAAW,IAAK,mBAAmB,EAGhI,QAAS,CAAE,KAAM,UAAW,MAAO,IAAM,MAAO,UAAW,OAAQ,OAAQ,KAAM,GAAI,KAAM,UAAW,IAAK,kBAAkB,EAC7H,UAAW,CAAE,KAAM,YAAa,MAAO,KAAO,MAAO,UAAW,OAAQ,OAAQ,KAAM,GAAI,KAAM,UAAW,IAAK,gBAAgB,EAChI,QAAS,CAAE,KAAM,WAAY,MAAO,KAAO,MAAO,UAAW,OAAQ,OAAQ,KAAM,GAAI,KAAM,UAAW,IAAK,iBAAiB,EAG9H,UAAW,CAAE,KAAM,YAAa,MAAO,KAAO,MAAO,UAAW,OAAQ,YAAa,KAAM,GAAI,KAAM,SAAU,IAAK,aAAa,EACjI,UAAW,CAAE,KAAM,YAAa,MAAO,IAAO,MAAO,UAAW,OAAQ,YAAa,KAAM,GAAI,KAAM,SAAU,IAAK,gBAAgB,EACpI,WAAY,CAAE,KAAM,cAAe,MAAO,IAAQ,MAAO,UAAW,OAAQ,SAAU,KAAM,GAAI,KAAM,SAAU,IAAK,aAAa,EAClI,WAAY,CAAE,KAAM,aAAc,MAAO,KAAQ,MAAO,UAAW,OAAQ,SAAU,KAAM,GAAI,KAAM,SAAU,IAAK,oBAAoB,CAC5J,EAGgB,KAAK,YAAc,CACf,WAAY,CACR,KAAM,oBACN,MAAO,UACP,UAAW,2BACX,SAAU,CAAC,OAAQ,SAAU,OAAQ,WAAY,SAAS,EAC1D,mBAAoB,EACpB,aAAc,EACd,cAAe,CAAE,IAAK,IAAK,IAAK,GAAG,CAC3D,EACoB,SAAU,CACN,KAAM,kBACN,MAAO,UACP,UAAW,yBACX,SAAU,CAAC,SAAU,OAAQ,WAAY,WAAW,EACpD,mBAAoB,IACpB,aAAc,EACd,cAAe,CAAE,IAAK,IAAK,IAAK,GAAI,CAC5D,EACoB,QAAS,CACL,KAAM,iBACN,MAAO,UACP,UAAW,0BACX,SAAU,CAAC,SAAU,UAAW,UAAW,OAAQ,UAAU,EAC7D,mBAAoB,EACpB,aAAc,EACd,cAAe,CAAE,IAAK,IAAM,IAAK,GAAI,CAC7D,EACoB,QAAS,CACL,KAAM,iBACN,MAAO,UACP,UAAW,wBACX,SAAU,CAAC,UAAW,YAAa,SAAS,EAC5C,mBAAoB,IACpB,aAAc,EACd,cAAe,CAAE,IAAK,KAAM,IAAK,GAAI,CAC7D,EACoB,OAAQ,CACJ,KAAM,gBACN,MAAO,UACP,UAAW,yBACX,SAAU,CAAC,YAAa,YAAa,aAAc,YAAY,EAC/D,mBAAoB,EACpB,aAAc,EACd,cAAe,CAAE,IAAK,IAAM,IAAK,GAAI,CAC7D,CACA,EAGgB,KAAK,iBAAmB,GAGxB,KAAK,UAAY,GACjB,KAAK,YAAc,GACnB,KAAK,QAAU,GACf,KAAK,UAAY,GACjB,KAAK,YAAc,GACnB,KAAK,gBAAkB,KAAK,cAAa,EACzC,KAAK,wBAA0B,GAG/B,GAAI,CACA,MAAMC,EAAe,aAAa,QAAQ,oBAAoB,EAC9D,KAAK,aAAeA,EAAe,KAAK,MAAMA,CAAY,EAAI,GAC9D,KAAK,iBAAmB,aAAa,QAAQ,kBAAkB,GAAK,EACxE,MAAY,CACR,KAAK,aAAe,GACpB,KAAK,iBAAmB,EAC5B,CAGA,KAAK,YAAc,GACnB,KAAK,SAAW,GAChB,KAAK,WAAa,GAClB,KAAK,cAAgB,GACrB,KAAK,gBAAkB,GACvB,KAAK,QAAU,GACf,KAAK,WAAa,GAClB,KAAK,cAAgB,GACrB,KAAK,QAAU,GAGf,KAAK,UAAY,EACjB,KAAK,UAAY,EACjB,KAAK,UAAY,EAGjB,KAAK,QAAU,CAAE,EAAG,EAAG,EAAG,EAAG,OAAQ,EAAG,OAAQ,EAAG,OAAQ,GAAO,SAAU,GAAO,WAAY,EAAG,WAAY,CAAC,EAC/G,KAAK,YAAc,KACnB,KAAK,YAAc,KACnB,KAAK,iBAAmB,KAGxB,KAAK,mBAAkB,EAEvB,KAAK,mBAAkB,EACvB,KAAK,cAAa,EAClB,KAAK,yBAAwB,EAG7B,KAAK,gBAAkB,GAEvB,KAAK,KAAI,CACb,CAEA,MAAM,eAAgB,CAClB,GAAI,CAGA,KAAM,CAACC,EAAQC,EAASC,CAAS,EAAI,MAAM,QAAQ,IAAI,CACpDC,EAAA,IAAC,OAAO,sBAAyB,MAAE,KAAKC,GAAKA,EAAE,OAAO,EACtDD,EAAA,IAAC,OAAO,uBAAiC,MAAE,KAAKC,GAAKA,EAAE,OAAO,EAC9DD,EAAA,IAAC,OAAO,yBAA4B,MAAE,KAAKC,GAAKA,EAAE,OAAO,CAChF,CAAqB,EAED,KAAK,UAAY,CAAE,OAAAJ,EAAQ,QAAAC,EAAS,UAAAC,CAAS,EAG7C,MAAMG,EAAY,CAACC,EAAUC,EAAKC,IAAgB,CAC9C,MAAMC,EAAM,SAAS,cAAc,QAAQ,EAC3CA,EAAI,UAAY,YAChBA,EAAI,MAAM,OAAS,MACnBA,EAAI,MAAM,cAAgB,aAC1BA,EAAI,UAAYF,EAChBE,EAAI,QAAU,IAAM,KAAK,aAAaH,EAAUC,CAAG,EACnD,SAAS,eAAeC,CAAW,EAAE,YAAYC,CAAG,CACxD,EAGI,KAAK,UAAU,QAAQ,OAAO,KAAK,KAAK,UAAU,MAAM,EAAE,QAAQC,GAAKL,EAAU,SAAUK,EAAG,iBAAiB,CAAC,EAChH,KAAK,UAAU,SAAS,OAAO,KAAK,KAAK,UAAU,OAAO,EAAE,QAAQA,GAAKL,EAAU,UAAWK,EAAG,iBAAiB,CAAC,EACnH,KAAK,UAAU,WAAW,OAAO,KAAK,KAAK,UAAU,SAAS,EAAE,QAAQA,GAAKL,EAAU,YAAaK,EAAG,eAAe,CAAC,CAE/H,OAASC,EAAG,CACR,QAAQ,MAAM,2BAA4BA,CAAC,EAC3C,KAAK,UAAU,0BAA0B,CAC7C,CACJ,CAEA,aAAaL,EAAUC,EAAK,SACxB,MAAMK,EAAS,KAAK,UAAUN,CAAQ,EAAEC,CAAG,EAC3C,GAAI,CAACK,EAAQ,OAEb,KAAK,UAAS,EAGd,IAAIC,EAAS,EAAGC,EAAS,EAAGC,EAAS,EACrCH,EAAO,QAAQI,GAAK,CAChBH,GAAUG,EAAE,CAAC,EACbF,GAAUE,EAAE,CAAC,EACbD,GAAWC,EAAE,CAAC,GAAK,CACvB,CAAC,EACD,MAAMC,EAAQL,EAAO,OACfM,EAAYL,EAASI,EACrBE,EAAYL,EAASG,EACrBG,EAAYL,EAASE,EAG3B,KAAK,OAAS,CAAE,EAAG,EAAG,EAAG,EAAG,KAAM,CAAC,EAGnC,MAAMI,EAAK,EACLC,EAAK,EACLC,EAAQ,EAKRC,GAAYC,EAAA,SAAS,eAAe,qBAAqB,IAA7C,YAAAA,EAAgD,QAC5DC,IAAgBC,EAAA,SAAS,eAAe,qBAAqB,IAA7C,YAAAA,EAAgD,QAAS,UAGzEC,EAAWrB,EAAI,OAAO,CAAC,EAAE,cAAgBA,EAAI,MAAM,CAAC,EAC1D,IAAIsB,EAAeD,EAEnB,GAAI,CAEA,GADK,KAAK,UAAU,KAAK,mBAAkB,EACvC,KAAK,UAAY,KAAK,SAAS,OAAS,EACxC,GAAI,KAAK,OAAM,EAAK,GAEhBC,EAAe,GADA,KAAK,SAAS,KAAK,MAAM,KAAK,SAAW,KAAK,SAAS,MAAM,CAAC,CACrD,IAAID,CAAQ,OACjC,CACH,MAAME,EAAS,KAAK,SAAS,KAAK,MAAM,KAAK,SAAW,KAAK,SAAS,MAAM,CAAC,EAC7ED,EAAe,GAAGD,CAAQ,IAAIE,CAAM,EACxC,CAER,OAASnB,EAAG,CAAE,QAAQ,KAAK,kBAAmBA,CAAC,CAAG,CAGlD,MAAMoB,EAAWnB,EAAO,IAAI,CAACI,EAAGgB,IAAM,CAClC,IAAIC,EAAS,EACTC,EAAOlB,EAAE,CAAC,EAAIE,EACdiB,EAAOnB,EAAE,CAAC,EAAIG,EACdiB,GAAMpB,EAAE,CAAC,GAAK,GAAKI,EAEvB,GAAIJ,EAAE,QAAU,EAEZiB,EAASG,EAAKb,MACX,CAGH,MAAMc,EAAO,KAAK,KAAKH,EAAOA,EAAOC,EAAOA,CAAI,EAEhDF,EAAS,EAAEI,EAAOA,GAAQ,IAAOd,CACrC,CAEA,MAAO,CACH,GAAI,KAAK,IAAG,EAAKS,EACjB,EAAGX,EAAKa,EAAOX,EACf,EAAGD,EAAKa,EAAOZ,EACf,EAAGU,EACH,MAAOT,EAAY,KAAK,cAAa,EAAKE,EAC1C,MAAO,KAAK,OAAM,EAAK,KAAK,GAAK,EACjC,UAAWG,CACnC,CACgB,CAAC,EAED,KAAK,MAAQE,EAGb,SAAS,eAAe,eAAe,EAAE,MAAM,QAAU,OACzD,KAAK,UAAU,UAAUxB,CAAG,WAAW,EACvC,KAAK,KAAI,CACb,CAEA,oBAAqB,CACjB,KAAK,SAAW,CAAC,QAAS,OAAQ,QAAS,QAAS,MAAO,QAAS,QAAS,QAAS,OAAQ,OAAQ,QAAS,QAAS,UAAW,OAAQ,QAAS,QAAS,UAAW,UAAU,EAClL,KAAK,MAAQ,CAAC,QAAS,SAAU,QAAS,OAAQ,OAAQ,QAAS,QAAS,QAAS,OAAQ,SAAU,QAAS,MAAO,SAAU,OAAQ,SAAU,QAAS,QAAS,QAAS,OAAQ,UAAW,SAAS,EAC1M,KAAK,SAAW,CAAC,QAAS,QAAS,QAAS,OAAQ,UAAW,SAAU,UAAW,WAAY,SAAU,OAAQ,MAAO,QAAS,UAAW,OAAQ,WAAY,SAAS,CAC9K,CAEA,MAAO,CACH,OAAO,iBAAiB,SAAU,IAAM,KAAK,OAAM,CAAE,EAGrD,KAAK,OAAO,iBAAiB,cAAeI,GAAK,KAAK,cAAcA,CAAC,CAAC,EACtE,OAAO,iBAAiB,cAAeA,GAAK,KAAK,cAAcA,CAAC,CAAC,EACjE,OAAO,iBAAiB,YAAaA,GAAK,KAAK,YAAYA,CAAC,CAAC,EAC7D,KAAK,OAAO,iBAAiB,QAASA,GAAK,KAAK,QAAQA,CAAC,EAAG,CAAE,QAAS,EAAK,CAAE,EAC9E,KAAK,OAAO,iBAAiB,cAAeA,GAAK,KAAK,aAAaA,CAAC,CAAC,EAGrE,OAAO,iBAAiB,UAAWA,GAAK,CAEpC,IAAKA,EAAE,SAAWA,EAAE,UAAYA,EAAE,MAAQ,IAAK,CAC3CA,EAAE,eAAc,EAChB,KAAK,KAAI,EACT,MACJ,CAGA,GAAI,KAAK,WAAY,CACjB,MAAMJ,EAAMI,EAAE,IAAI,YAAW,EACzBJ,IAAQ,IACR,KAAK,mBAAkB,EAEvB,KAAK,YAAYA,CAAG,EAAI,GAE5BI,EAAE,eAAc,CACpB,CACJ,CAAC,EAED,OAAO,iBAAiB,QAASA,GAAK,CAClC,GAAI,KAAK,WAAY,CACjB,MAAMJ,EAAMI,EAAE,IAAI,YAAW,EAC7B,KAAK,YAAYJ,CAAG,EAAI,EAC5B,CACJ,CAAC,EAED,KAAK,QAAQ,MAAM,EAEnB,KAAK,kBAAiB,EAGtB,KAAK,sBAAwB,GAG7B,KAAK,qBAAoB,EAGzB,KAAK,qBAAoB,EAGzB,KAAK,qBAAoB,EAGzB,MAAM+B,EAAoB,SAAS,eAAe,mBAAmB,EACjEA,GACAA,EAAkB,iBAAiB,QAAU3B,GAAM,CAC/C,KAAK,sBAAwB,WAAWA,EAAE,OAAO,KAAK,EACtD,SAAS,eAAe,kBAAkB,EAAE,YAAc,KAAK,sBAAsB,QAAQ,CAAC,EAAI,GACtG,CAAC,EAIL,MAAM4B,EAAqB,SAAS,eAAe,oBAAoB,EACnEA,GACAA,EAAmB,iBAAiB,QAAU5B,GAAM,CAChD,KAAK,uBAAyB,WAAWA,EAAE,OAAO,KAAK,EACvD,SAAS,eAAe,mBAAmB,EAAE,YAAc,KAAK,uBAAuB,QAAQ,CAAC,EAAI,GACxG,CAAC,EAIL,MAAM6B,EAAoB,SAAS,eAAe,mBAAmB,EACjEA,GACAA,EAAkB,iBAAiB,QAAU7B,GAAM,CAC/C,KAAK,YAAc,SAASA,EAAE,OAAO,KAAK,EAC1C,SAAS,eAAe,kBAAkB,EAAE,YAAc,KAAK,YAAc,GACjF,CAAC,EAIL,MAAM8B,EAAoB,SAAS,eAAe,mBAAmB,EAC/DC,EAAiB,SAAS,eAAe,gBAAgB,EAC3DD,GACAA,EAAkB,iBAAiB,QAAU9B,GAAM,CAC/C,KAAK,YAAcA,EAAE,OAAO,MAC5B,KAAK,sBAAwB,GACzB+B,IAAgBA,EAAe,MAAQ/B,EAAE,OAAO,OAChD,KAAK,eAAe,KAAK,cAAc,QAAQgC,GAAKA,EAAE,MAAQ,KAAK,WAAW,CACtF,CAAC,EAEDD,GACAA,EAAe,iBAAiB,QAAU/B,GAAM,CAC5C,IAAIiC,EAAMjC,EAAE,OAAO,MACfiC,EAAI,MAAM,mBAAmB,IAC7B,KAAK,YAAcA,EACnB,KAAK,sBAAwB,GACzBH,IAAmBA,EAAkB,MAAQG,GAC7C,KAAK,eAAe,KAAK,cAAc,QAAQD,GAAKA,EAAE,MAAQ,KAAK,WAAW,EAE1F,CAAC,EAIL,MAAME,EAAa,SAAS,eAAe,YAAY,EACjDC,EAAa,SAAS,eAAe,YAAY,EACjDC,EAAa,SAAS,eAAe,YAAY,EAEnDF,GACAA,EAAW,iBAAiB,QAAUlC,GAAM,CACxC,KAAK,UAAY,WAAWA,EAAE,OAAO,KAAK,EAC1C,SAAS,eAAe,WAAW,EAAE,YAAc,KAAK,UAAY,GACxE,CAAC,EAEDmC,GACAA,EAAW,iBAAiB,QAAUnC,GAAM,CACxC,KAAK,UAAY,WAAWA,EAAE,OAAO,KAAK,EAC1C,SAAS,eAAe,WAAW,EAAE,YAAc,KAAK,UAAY,GACxE,CAAC,EAEDoC,GACAA,EAAW,iBAAiB,QAAUpC,GAAM,CACxC,KAAK,UAAY,WAAWA,EAAE,OAAO,KAAK,EAC1C,SAAS,eAAe,WAAW,EAAE,YAAc,KAAK,UAAY,GACxE,CAAC,EAIL,KAAK,OAAM,EAGX,OAAO,iBAAiB,SAAU,IAAM,KAAK,OAAM,CAAE,EAErD,KAAK,QAAU,KAAK,QAAQ,KAAK,IAAI,EACrC,sBAAsB,KAAK,OAAO,CACtC,CAEA,QAAS,CACL,KAAK,OAAO,MAAQ,OAAO,WAC3B,KAAK,OAAO,OAAS,OAAO,YAG5B,KAAK,YAAc,GACnB,KAAK,oBAAmB,EAExB,KAAK,KAAI,CACb,CAOA,0BAA2B,CACvB,MAAMqC,EAAU,GAEhB,QAAS,EAAI,EAAG,EAAI,IAAO,IACvBA,EAAQ,KAAK,CACT,EAAG,KAAK,OAAM,EAAK,KAAK,OAAO,MAC/B,EAAG,KAAK,OAAM,EAAK,KAAK,OAAO,OAC/B,KAAM,KAAK,OAAM,EAAK,GAAM,GAC5B,MAAO,KAAK,OAAM,EAAK,GAAM,EACrD,CAAqB,EAEL,OAAOA,CACX,CAEA,sBAAuB,CAEnB,MAAMC,EAAiBC,GAAc,CACjC,MAAMC,EAAU,SAAS,eAAeD,CAAS,EACjD,GAAI,CAACC,EAAS,OAGd,MAAMC,EAASD,EAAQ,cAAc,iCAAiC,EACtE,GAAI,CAACC,EAAQ,OAEb,IAAIC,EAAa,GACbC,EAAQC,EAAQC,EAAUC,EAE9BL,EAAO,MAAM,OAAS,OAEtBA,EAAO,iBAAiB,YAAczC,GAAM,CACxC0C,EAAa,GACbD,EAAO,MAAM,OAAS,WACtBD,EAAQ,MAAM,OAAS,OAEvBG,EAAS3C,EAAE,QACX4C,EAAS5C,EAAE,QAEX,MAAM+C,EAAOP,EAAQ,sBAAqB,EAC1CK,EAAWE,EAAK,KAChBD,EAAWC,EAAK,IAEhB/C,EAAE,eAAc,CACpB,CAAC,EAED,OAAO,iBAAiB,YAAcA,GAAM,CACxC,GAAI,CAAC0C,EAAY,OAEjB,MAAMM,EAAKhD,EAAE,QAAU2C,EACjBM,EAAKjD,EAAE,QAAU4C,EAEvBJ,EAAQ,MAAM,KAAQK,EAAWG,EAAM,KACvCR,EAAQ,MAAM,IAAOM,EAAWG,EAAM,KACtCT,EAAQ,MAAM,OAAS,OACvBA,EAAQ,MAAM,MAAQ,MAC1B,CAAC,EAED,OAAO,iBAAiB,UAAW,IAAM,CACrCE,EAAa,GACbD,EAAO,MAAM,OAAS,MAC1B,CAAC,CACL,EAGAH,EAAc,aAAa,EAC3BA,EAAc,iBAAiB,EAC/BA,EAAc,iBAAiB,EAC/BA,EAAc,cAAc,EAC5BA,EAAc,iBAAiB,EAC/BA,EAAc,aAAa,CAC/B,CAEA,QAAQY,EAAS,CACb,KAAK,KAAOA,EACZ,SAAS,eAAe,aAAa,EAAE,UAAU,OAAO,QAAQ,EAChE,SAAS,eAAe,eAAe,EAAE,UAAU,OAAO,QAAQ,EAE9DA,IAAY,QACZ,SAAS,eAAe,aAAa,EAAE,UAAU,IAAI,QAAQ,EAC7D,KAAK,OAAO,MAAM,OAAS,aACpBA,IAAY,WACnB,SAAS,eAAe,eAAe,EAAE,UAAU,IAAI,QAAQ,EAC/D,KAAK,OAAO,MAAM,OAAS,UAEnC,CAIA,eAAgB,CACZ,MAAO,IAAM,KAAK,MAAM,KAAK,OAAM,EAAK,QAAQ,EAAE,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,CAClF,CAEA,cAAcC,EAAU,CACpB,KAAK,YAAcA,EACnB,KAAK,UAAY,QACjB,KAAK,kBAAiB,EACtB,KAAK,UAAU,uBAAuBA,CAAQ,EAAE,CACpD,CAEA,gBAAiB,CACb,KAAK,UAAY,UACjB,KAAK,kBAAiB,EACtB,KAAK,UAAU,qCAAqC,CACxD,CAKA,aAAaC,EAAM,CACf,MAAMC,EAAI,KAAK,IAAID,CAAI,EAAI,IAC3B,OAAOC,EAAI,KAAK,MAAMA,CAAC,CAC3B,CAEA,gBAAgBC,EAAQC,EAAQ,CAC5B,MAAO,CACH,EAAG,KAAK,MAAMD,EAAS,KAAK,UAAU,EACtC,EAAG,KAAK,MAAMC,EAAS,KAAK,UAAU,CAC1D,CACY,CAEA,cAAcC,EAASC,EAAS,CAC5B,OAAOD,EAAU,SAAWC,EAAU,QAC1C,CAEA,yBAA0B,CACtB,GAAI,CAAC,KAAK,WAAY,OAEtB,MAAMC,EAAS,KAAK,gBAAgB,KAAK,WAAW,EAAG,KAAK,WAAW,CAAC,EACxE,KAAK,cAAgBA,EAGrB,QAASV,EAAK,GAAIA,GAAM,EAAGA,IACvB,QAASC,EAAK,GAAIA,GAAM,EAAGA,IAAM,CAC7B,MAAMU,EAAKD,EAAO,EAAIV,EAChBY,EAAKF,EAAO,EAAIT,EAChBrD,EAAM,GAAG+D,CAAE,IAAIC,CAAE,GAClB,KAAK,cAAc,IAAIhE,CAAG,GAC3B,KAAK,eAAe+D,EAAIC,CAAE,CAElC,CAIJ,SAAW,CAAChE,CAAG,IAAK,KAAK,cAAc,QAAO,EAAI,CAC9C,KAAM,CAAC+D,EAAIC,CAAE,EAAIhE,EAAI,MAAM,GAAG,EAAE,IAAI,MAAM,EAE1C,GADa,KAAK,IAAI,KAAK,IAAI+D,EAAKD,EAAO,CAAC,EAAG,KAAK,IAAIE,EAAKF,EAAO,CAAC,CAAC,EAC3D,EAAG,CACV,MAAMG,EAAa,KAAK,cAAc,IAAIjE,CAAG,EACzCiE,IACA,KAAK,SAAW,KAAK,SAAS,OAAOpE,GAAK,CAACoE,EAAW,SAAS,SAASpE,CAAC,CAAC,EAC1E,KAAK,iBAAmB,KAAK,iBAAiB,OAAOqE,GAAK,CAACD,EAAW,SAAS,SAASC,CAAC,CAAC,GAE9F,KAAK,cAAc,OAAOlE,CAAG,CACjC,CACJ,CACJ,CAEA,eAAe4D,EAASC,EAAS,OAC7B,MAAM7D,EAAM,GAAG4D,CAAO,IAAIC,CAAO,GACjC,GAAI,KAAK,cAAc,IAAI7D,CAAG,EAAG,OAEjC,QAAQ,IAAI,iCAAiC4D,CAAO,KAAKC,CAAO,GAAG,EAEnE,MAAML,EAAO,KAAK,cAAcI,EAASC,CAAO,EAC1CI,EAAa,CAAE,EAAGL,EAAS,EAAGC,EAAS,SAAU,GAAI,SAAU,EAAE,EAEjEM,EAAOP,EAAU,KAAK,YACdA,EAAU,GAAK,KAAK,WAClC,MAAMQ,EAAOP,EAAU,KAAK,YACdA,EAAU,GAAK,KAAK,WAGlC,MAAMQ,EAAe,KAAK,MAAM,IAAM,KAAK,aAAab,EAAO,CAAC,EAAI,GAAG,EACvE,QAAS/B,EAAI,EAAGA,EAAI4C,EAAc5C,IAAK,CACnC,MAAMW,EAAIoB,EAAO/B,EAAI,IACfgC,EAAIU,EAAO,KAAK,aAAa/B,CAAC,EAAI,KAAK,WACvCkC,EAAIF,EAAO,KAAK,aAAahC,EAAI,CAAC,EAAI,KAAK,WAC3CN,EAAO,KAAK,MAAM2B,EAAGa,CAAC,EAE5B,IAAIC,EAAO,OACX,MAAMC,EAAI,KAAK,aAAapC,EAAI,CAAC,EAC7BN,EAAO,IAAMyC,EAAO,CAAC,OAAQ,SAAU,OAAQ,WAAY,SAAS,EAAE,KAAK,MAAMC,EAAI,CAAC,CAAC,EAClF1C,EAAO,IAAMyC,EAAO,CAAC,SAAU,OAAQ,WAAY,WAAW,EAAE,KAAK,MAAMC,EAAI,CAAC,CAAC,EACjF1C,EAAO,IAAMyC,EAAO,CAAC,SAAU,UAAW,UAAW,OAAQ,UAAU,EAAE,KAAK,MAAMC,EAAI,CAAC,CAAC,EAC1F1C,EAAO,IAAOyC,EAAO,CAAC,UAAW,YAAa,SAAS,EAAE,KAAK,MAAMC,EAAI,CAAC,CAAC,EAC9ED,EAAO,CAAC,YAAa,YAAa,aAAc,YAAY,EAAE,KAAK,MAAMC,EAAI,CAAC,CAAC,EAEpF,MAAMC,EAAO,KAAK,aAAaF,CAAI,EACnC,GAAI,CAACE,EAAM,SAEX,MAAMC,EAAU,CAAE,EAAAjB,EAAG,EAAAa,EAAG,KAAAC,EAAM,MAAOE,EAAK,MAAO,KAAMA,EAAK,KAAM,MAAOA,EAAK,KAAK,EACnF,KAAK,SAAS,KAAKC,CAAO,EAC1BT,EAAW,SAAS,KAAKS,CAAO,CACpC,CAGA,MAAMC,EAAe,KAAK,MAAM,EAAI,KAAK,aAAanB,EAAO,GAAM,EAAI,CAAC,EACxE,QAAS/B,EAAI,EAAGA,EAAIkD,EAAclD,IAAK,CACnC,MAAMW,EAAIoB,EAAO,IAAS/B,EAAI,IACxBgC,EAAIU,EAAO,KAAK,aAAa/B,CAAC,EAAI,KAAK,WACvCkC,EAAIF,EAAO,KAAK,aAAahC,EAAI,CAAC,EAAI,KAAK,WAC3CN,EAAO,KAAK,MAAM2B,EAAGa,CAAC,EAE5B,IAAIM,EAAO,aACP9C,GAAQ,IAAM8C,EAAO,SAChB9C,GAAQ,IAAM8C,EAAO,UACrB9C,GAAQ,KAAM8C,EAAO,UACrB9C,GAAQ,MAAM8C,EAAO,YAE9B,MAAMC,EAAW,GAAM,KAAK,aAAazC,EAAI,CAAC,EAAI,GAC5C0C,EAAU,CACZ,EAAArB,EAAG,EAAAa,EAAG,KAAAM,EACN,KAAM,KAAG1D,EAAA,KAAK,YAAY0D,CAAI,IAArB,YAAA1D,EAAwB,OAAQ0D,CAAI,WAC7C,SAAAC,EACA,KAAM,KAAK,MAAMA,EAAW,CAAC,EAAI,CACzD,EAEoB,KAAK,iBAAiB,KAAKC,CAAO,EAClCb,EAAW,SAAS,KAAKa,CAAO,CACpC,CAEA,KAAK,cAAc,IAAI9E,EAAKiE,CAAU,EACtC,QAAQ,IAAI,sBAAsBL,CAAO,KAAKC,CAAO,MAAMQ,CAAY,cAAcM,CAAY,WAAW,CAChH,CAEA,cAAcI,EAAO,CACjB,QAAQ,IAAI,eAAeA,CAAK,sBAAuB,KAAK,aAAa,IAAIA,CAAK,CAAC,EAC/E,KAAK,aAAa,IAAIA,CAAK,GAE3B,KAAK,aAAa,OAAOA,CAAK,EAE9B,KAAK,eAAeA,CAAK,IAGzB,KAAK,aAAa,IAAIA,CAAK,EAC3B,KAAK,oBAAoBA,CAAK,GAGlC,KAAK,WAAU,EACf,KAAK,oBAAmB,CAC5B,CAGA,oBAAoBA,EAAO,CACvB,OAAQA,EAAK,CACT,IAAK,aACD,KAAK,uBAAsB,EAC3B,MACJ,IAAK,SACD,KAAK,oBAAmB,EACxB,MACJ,IAAK,QACD,KAAK,mBAAkB,EACvB,MACJ,IAAK,QACD,KAAK,mBAAkB,EACvB,KACxB,CACY,CAGA,eAAeA,EAAO,CAClB,OAAQA,EAAK,CACT,IAAK,aAED,KAAK,SAAW,GAChB,KAAK,WAAa,GAClB,KAAK,QAAU,GACf,MACJ,IAAK,SAED,KAAK,QAAU,GACf,MACJ,IAAK,QACD,KAAK,WAAa,GAClB,MACJ,IAAK,QACD,KAAK,cAAgB,GACrB,KACxB,CACY,CAEA,YAAa,CAET,SAAS,iBAAiB,YAAY,EAAE,QAAQ7E,GAAO,CACnD,MAAM6E,EAAQ7E,EAAI,aAAa,YAAY,EACvC,KAAK,aAAa,IAAI6E,CAAK,EAC3B7E,EAAI,UAAU,IAAI,QAAQ,EAE1BA,EAAI,UAAU,OAAO,QAAQ,CAErC,CAAC,EAGD,MAAM8E,EAAc,SAAS,eAAe,aAAa,EACrDA,IACI,KAAK,aAAa,IAAI,OAAO,EAC7BA,EAAY,UAAU,OAAO,QAAQ,EAErCA,EAAY,UAAU,IAAI,QAAQ,EAG9C,CAGA,qBAAsB,CAClB,MAAMC,EAAQ,SAAS,eAAe,eAAe,EACjDA,GAAOA,EAAM,UAAU,OAAO,QAAQ,CAC9C,CAEA,qBAAsB,CAClB,MAAMA,EAAQ,SAAS,eAAe,eAAe,EACjDA,EAAM,MAAM,UAAY,QACxBA,EAAM,MAAM,QAAU,OAEtBA,EAAM,MAAM,QAAU,OAE9B,CAEA,kBAAmB,CACf,KAAK,WAAa,CAAC,KAAK,WAGxB,MAAMC,EAAM,SAAS,eAAe,WAAW,EACzCC,EAAc,SAAS,eAAe,aAAa,EACnDC,EAAkB,SAAS,eAAe,iBAAiB,EAE7D,KAAK,YACDF,GAAKA,EAAI,UAAU,OAAO,QAAQ,EAClCC,GAAaA,EAAY,UAAU,OAAO,QAAQ,EAClDC,GAAiBA,EAAgB,UAAU,OAAO,QAAQ,EAC9D,KAAK,0BAAyB,IAE1BF,GAAKA,EAAI,UAAU,IAAI,QAAQ,EAC/BC,GAAaA,EAAY,UAAU,IAAI,QAAQ,EAC/CC,GAAiBA,EAAgB,UAAU,IAAI,QAAQ,GAI3D,KAAK,YAAc,KAAK,aAAa,OAAS,GAC9C,KAAK,cAAc,YAAY,EAGnC,KAAK,UAAU,KAAK,WAAa,sCAAwC,kBAAkB,EAG3F,MAAMC,EAAU,SAAS,eAAe,eAAe,EACnDA,IAASA,EAAQ,MAAM,QAAU,KAAK,WAAa,cAAgB,QACvE,KAAK,KAAI,CACb,CAGA,qBAAqBC,EAAW,CAC5B,MAAMC,EAAU,SAAS,eAAeD,CAAS,EAC7CC,GAASA,EAAQ,UAAU,OAAO,WAAW,CACrD,CAEA,iBAAkB,CACd,KAAK,cAAgB,CAAC,KAAK,cAC3B,KAAK,gBAAe,EACpB,MAAMrF,EAAM,SAAS,eAAe,oBAAoB,EACpDA,IACAA,EAAI,MAAM,WAAa,KAAK,cAAgB,sBAAwB,GAE5E,CAEA,gBAAiB,CACb,MAAMsF,EAAc,SAAS,eAAe,aAAa,EACnDC,EAAeD,GAAA,YAAAA,EAAa,cAAc,kBAChD,GAAI,CAACA,GAAe,CAACC,EAAc,OAEnC,IAAIC,EAAa,GACb3C,EAAQ4C,EAEZF,EAAa,iBAAiB,YAAcrF,GAAM,CAC9CsF,EAAa,GACb3C,EAAS3C,EAAE,QACXuF,EAAaH,EAAY,YACzBpF,EAAE,eAAc,CACpB,CAAC,EAED,OAAO,iBAAiB,YAAcA,GAAM,CACxC,GAAI,CAACsF,EAAY,OACjB,MAAME,EAAQD,GAAcvF,EAAE,QAAU2C,GAClC8C,EAAe,KAAK,IAAI,IAAK,KAAK,IAAI,IAAKD,CAAK,CAAC,EACvDJ,EAAY,MAAM,MAAQK,EAAe,IAC7C,CAAC,EAED,OAAO,iBAAiB,UAAW,IAAM,CACrCH,EAAa,EACjB,CAAC,CACL,CAGA,qBAAqBI,EAAU,CAC3B,MAAMC,EAAM,SAAS,eAAeD,CAAQ,EACxCC,GAAKA,EAAI,UAAU,OAAO,WAAW,CAC7C,CAGA,YAAYxB,EAAM,CA8Bd,MAAO,EACX,CAEA,SAASA,EAAM,CACX,MAAME,EAAO,KAAK,aAAaF,CAAI,EACnC,OAAKE,EAEE,4DAA4DA,EAAK,KAAK;AAAA,8CAC/CA,EAAK,KAAK;AAAA;AAAA;AAAA;AAAA,gDAHtB,EAQtB,CAEA,iBAAkB,CACd,GAAI,CAAC,KAAK,WAAY,OAItB,MAAMuB,EAAa,SAAS,eAAe,aAAa,EAClDC,EAAS,SAAS,eAAe,aAAa,EAChDD,IACAA,EAAW,YAAc,KAAK,MAAM,KAAK,WAAW,KAAK,GAEzDC,IACAA,EAAO,YAAc,KAAK,OAAO,KAAK,QAAQ,CAAC,EAAI,KAIvD,MAAMC,EAAW,SAAS,eAAe,aAAa,EAClDA,IACAA,EAAS,YAAc,MAAM,KAAK,MAAM,KAAK,WAAW,CAAC,CAAC,OAAO,KAAK,MAAM,KAAK,WAAW,CAAC,CAAC,IAIlG,MAAMC,EAAW,SAAS,eAAe,UAAU,EAC7CC,EAAc,SAAS,eAAe,WAAW,EACjDC,EAAY,SAAS,eAAe,gBAAgB,EAK1D,GAFIA,IAAWA,EAAU,YAAc,IAAM,KAAK,QAAQ,eAAc,GAEpEF,EAAU,CACV,IAAIG,EAAa,EACbC,EAAO,GAYX,MAAMC,EAAY,OAAO,QAAQ,KAAK,iBAAmB,EAAE,EAEvDA,EAAU,SAAW,EACrBD,EAAO,0EAEPC,EAAU,QAAQ,CAAC,CAACjC,EAAM7D,CAAK,IAAM,CACjC,GAAIA,GAAS,EAAG,OAChB,MAAM+D,EAAO,KAAK,aAAaF,CAAI,EACnC,GAAI,CAACE,EAAM,OAEX6B,GAAc5F,EAAQ+D,EAAK,MAE3B,MAAMgC,EAAY/F,EAAQ+D,EAAK,MACzBiC,EAAe,KAAK,cAAgB,sBAAsBjC,EAAK,KAAK,0CAA0C,KAAK,MAAMgC,CAAS,EAAE,eAAc,CAAE,UAAY,GAEtKF,GAAQ;AAAA,gFAC4C9B,EAAK,KAAK;AAAA,kDACxC,KAAK,SAASF,CAAI,CAAC;AAAA,yDACZE,EAAK,KAAK,KAAKA,EAAK,IAAI;AAAA,+DAClB/D,CAAK;AAAA,sCAC9BgG,CAAY;AAAA;AAAA,6BAG1B,CAAC,EAGLP,EAAS,UAAYI,EAGjBH,IACAA,EAAY,YAAc,IAAIE,EAAW,eAAc,CAAE,GAEjE,CAGA,KAAK,YAAW,EAGhB,KAAK,UAAS,EAGd,KAAK,eAAc,CACvB,CAEA,aAAc,CACV,MAAMK,EAAS,SAAS,eAAe,aAAa,EACpD,GAAI,CAACA,EAAQ,OACb,MAAMC,EAAMD,EAAO,WAAW,IAAI,EAC5BE,EAAIF,EAAO,MAAOG,EAAIH,EAAO,OAC7B7F,EAAK+F,EAAI,EAAG9F,EAAK+F,EAAI,EAG3BF,EAAI,UAAU,EAAG,EAAGC,EAAGC,CAAC,EAGxBF,EAAI,YAAc,sBAClBA,EAAI,UAAY,EAChBA,EAAI,UAAS,EACbA,EAAI,OAAO9F,EAAI,CAAC,EAAG8F,EAAI,OAAO9F,EAAIgG,CAAC,EACnCF,EAAI,OAAO,EAAG7F,CAAE,EAAG6F,EAAI,OAAOC,EAAG9F,CAAE,EACnC6F,EAAI,IAAI9F,EAAIC,EAAI,GAAI,EAAG,KAAK,GAAK,CAAC,EAClC6F,EAAI,IAAI9F,EAAIC,EAAI,GAAI,EAAG,KAAK,GAAK,CAAC,EAClC6F,EAAI,OAAM,EAGVA,EAAI,UAAY,OAChBA,EAAI,UAAS,EACbA,EAAI,IAAI9F,EAAIC,EAAI,EAAG,EAAG,KAAK,GAAK,CAAC,EACjC6F,EAAI,KAAI,EAGR,MAAMG,EAAa,IACnB,KAAK,SAAS,QAAQlH,GAAK,CACvB,MAAMuD,EAAKvD,EAAE,EAAI,KAAK,WAAW,EAC3BwD,EAAKxD,EAAE,EAAI,KAAK,WAAW,EAEjC,GADa,KAAK,KAAKuD,EAAKA,EAAKC,EAAKA,CAAE,EAC7B0D,EAAY,CACnB,MAAMC,EAAKlG,EAAMsC,EAAK2D,EAAc,GAC9BE,EAAKlG,EAAMsC,EAAK0D,EAAc,GACpCH,EAAI,UAAY/G,EAAE,OAAS,OAC3B+G,EAAI,UAAS,EACbA,EAAI,IAAII,EAAIC,EAAI,EAAG,EAAG,KAAK,GAAK,CAAC,EACjCL,EAAI,KAAI,CACZ,CACJ,CAAC,CACL,CAEA,0BAA2B,CACvB,KAAK,iBAAmB,GAKxB,QAASnF,EAAI,EAAGA,EAAI,GAAIA,IAAK,CACzB,MAAMyF,EAASzF,EAAI,GAAM,KAAK,GAAK,EAAI,KAAK,OAAM,EAAK,GACjDK,EAAO,IAAO,KAAK,OAAM,EAAK,IACpC,KAAK,iBAAiB,KAAK,CACvB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,GAAI,KAAK,OAAM,EAAK,IAAO,IAC3B,KAAM,aACN,OAAQ,IACR,SAAU,IACV,KAAM,EACN,MAAO,MACP,KAAM,gBAAgBL,EAAI,CAAC,EACnD,CAAqB,CACL,CAKA,QAASA,EAAI,EAAGA,EAAI,GAAIA,IAAK,CACzB,MAAMyF,EAASzF,EAAI,GAAM,KAAK,GAAK,EAAI,KAAK,OAAM,EAAK,GACjDK,EAAO,IAAO,KAAK,OAAM,EAAK,IAC9B8C,EAAO,KAAK,OAAM,EAAK,GAAM,WAAa,UAChD,KAAK,iBAAiB,KAAK,CACvB,EAAG,KAAK,IAAIsC,CAAK,EAAIpF,EACrB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,GAAI,KAAK,OAAM,EAAK,IAAO,IAC3B,KAAM8C,EACN,OAAQ,IACR,SAAU,EACV,KAAM,EACN,MAAO,SACP,KAAM,gBAAgBnD,EAAI,CAAC,EACnD,CAAqB,CACL,CAKA,QAASA,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,MAAMyF,EAASzF,EAAI,EAAK,KAAK,GAAK,EAAI,KAAK,OAAM,EAAK,GAChDK,EAAO,IAAQ,KAAK,OAAM,EAAK,IAC/B8C,EAAO,KAAK,OAAM,EAAK,GAAM,UAAY,UAC/C,KAAK,iBAAiB,KAAK,CACvB,EAAG,KAAK,IAAIsC,CAAK,EAAIpF,EACrB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,GAAI,KAAK,OAAM,EAAK,IAAO,IAC3B,KAAM8C,EACN,OAAQ,IACR,SAAU,EACV,KAAM,EACN,MAAO,OACP,KAAM,cAAcnD,EAAI,CAAC,EACjD,CAAqB,CACL,CAKA,QAASA,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,MAAMyF,EAASzF,EAAI,EAAK,KAAK,GAAK,EAAI,KAAK,OAAM,EAAK,GAChDK,EAAO,KAAQ,KAAK,OAAM,EAAK,IACrC,KAAK,iBAAiB,KAAK,CACvB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,GAAI,KAAK,OAAM,EAAK,IAAO,IAC3B,KAAM,UACN,OAAQ,IACR,SAAU,IACV,KAAM,EACN,MAAO,YACP,KAAM,mBAAmBL,EAAI,CAAC,EACtD,CAAqB,CACL,CAKA,QAASA,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,MAAMyF,EAASzF,EAAI,EAAK,KAAK,GAAK,EAAI,KAAK,OAAM,EAAK,GAChDK,EAAO,KAAQ,KAAK,OAAM,EAAK,IACrC,KAAK,iBAAiB,KAAK,CACvB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,GAAI,KAAK,OAAM,EAAK,IAAO,KAC3B,KAAM,SACN,OAAQ,KACR,SAAU,EACV,KAAM,EACN,MAAO,SACP,KAAM,mBAAmBL,EAAI,CAAC,EACtD,CAAqB,CACL,CAKA,QAASA,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,MAAMyF,EAASzF,EAAI,EAAK,KAAK,GAAK,EAAI,KAAK,OAAM,EAAK,GAChDK,EAAO,KAAQ,KAAK,OAAM,EAAK,IACrC,KAAK,iBAAiB,KAAK,CACvB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,GAAI,KAAK,OAAM,EAAK,IAAO,IAC3B,KAAM,SACN,OAAQ,KACR,SAAU,EACV,KAAM,EACN,MAAO,eACP,KAAM,eAAeL,EAAI,CAAC,EAClD,CAAqB,CACL,CAEA,QAAQ,IAAI,wBAAwB,KAAK,iBAAiB,MAAM,mCAAmC,CACvG,CAEA,WAAY,CACR,MAAMkF,EAAS,SAAS,eAAe,WAAW,EAClD,GAAI,CAACA,EAAQ,OACb,MAAMC,EAAMD,EAAO,WAAW,IAAI,EAC5BE,EAAIF,EAAO,MAAOG,EAAIH,EAAO,OAC7B7F,EAAK+F,EAAI,EAAG9F,EAAK+F,EAAI,EAGrB9F,EAAS,KAAK,IAAI6F,EAAGC,CAAC,EAAI,EADd,IAIlBF,EAAI,UAAY,oBAChBA,EAAI,SAAS,EAAG,EAAGC,EAAGC,CAAC,EAGvB,MAAMK,EAAU,CAAC,KAAK,WAAW,EAC3BC,EAAU,CAAC,KAAK,WAAW,EAGjC,OAAO,OAAO,KAAK,WAAW,EAAE,QAAQxC,GAAQ,CAC5C,MAAMJ,EAAII,EAAK,cAAc,IAAM5D,EACnC4F,EAAI,UAAS,EACbA,EAAI,IAAI9F,EAAKqG,EAAUnG,EAAOD,EAAKqG,EAAUpG,EAAOwD,EAAG,EAAG,KAAK,GAAK,CAAC,EACrEoC,EAAI,YAAchC,EAAK,MACvBgC,EAAI,YAAc,GAClBA,EAAI,UAAY,EAChBA,EAAI,OAAM,CACd,CAAC,EAGD,KAAK,iBAAiB,QAAQS,GAAO,CACjC,MAAMjE,GAAMiE,EAAI,EAAIF,GAAWnG,EACzBqC,GAAMgE,EAAI,EAAID,GAAWpG,EAG/B,IAAIsG,EAAOC,EAAWC,EACtB,OAAQH,EAAI,KAAI,CACZ,IAAK,GAAGC,EAAQ,UAAWC,EAAY,UAAWC,EAAQ,IAAK,MAC/D,IAAK,GAAGF,EAAQ,UAAWC,EAAY,UAAWC,EAAQ,IAAK,MAC/D,IAAK,GAAGF,EAAQ,UAAWC,EAAY,UAAWC,EAAQ,IAAK,MAC/D,IAAK,GAAGF,EAAQ,UAAWC,EAAY,UAAWC,EAAQ,IAAK,MAC/D,IAAK,GAAGF,EAAQ,UAAWC,EAAY,UAAWC,EAAQ,IAAK,MAC/D,IAAK,GAAGF,EAAQ,UAAWC,EAAY,UAAWC,EAAQ,IAAK,MAC/D,QAASF,EAAQ,OAAQC,EAAY,OAAQC,EAAQ,IAAK,KAClF,CAGoB,MAAMC,EAAQ,EAAI,KAAK,IAAI,KAAK,IAAG,EAAK,IAAK,EAAI,GAC3CC,GAAY,EAAIL,EAAI,MAAQI,EAGlCb,EAAI,UAAYW,EAChBX,EAAI,YAAc,GAClBA,EAAI,UAAS,EACbA,EAAI,IAAI9F,EAAKsC,EAAIrC,EAAKsC,EAAIqE,EAAU,EAAG,KAAK,GAAK,CAAC,EAClDd,EAAI,KAAI,EACRA,EAAI,YAAc,EAGlBA,EAAI,UAAYU,EAChBV,EAAI,UAAS,EACbA,EAAI,IAAI9F,EAAKsC,EAAIrC,EAAKsC,EAAI,EAAIgE,EAAI,KAAO,GAAK,EAAG,KAAK,GAAK,CAAC,EAC5DT,EAAI,KAAI,EAGRA,EAAI,UAAY,OAChBA,EAAI,KAAO,qBACXA,EAAI,UAAY,SAChBA,EAAI,SAASY,EAAO1G,EAAKsC,EAAIrC,EAAKsC,EAAKqE,EAAW,CAAC,CACvD,CAAC,EAGD,KAAK,SAAS,QAAQhD,GAAW,CAC7B,MAAMtB,GAAMsB,EAAQ,EAAIyC,GAAWnG,EAC7BqC,GAAMqB,EAAQ,EAAI0C,GAAWpG,EAGnC4F,EAAI,UAAYlC,EAAQ,MACxBkC,EAAI,YAAc,GAClBA,EAAI,UAAS,EACbA,EAAI,IAAI9F,EAAKsC,EAAIrC,EAAKsC,EAAI,EAAG,EAAG,KAAK,GAAK,CAAC,EAC3CuD,EAAI,KAAI,EAGRA,EAAI,YAAc,GAClBA,EAAI,UAAS,EACbA,EAAI,IAAI9F,EAAKsC,EAAIrC,EAAKsC,EAAI,IAAK,EAAG,KAAK,GAAK,CAAC,EAC7CuD,EAAI,KAAI,CACZ,CAAC,EACDA,EAAI,YAAc,EAGlB,MAAMe,EAAK7G,EACL8G,EAAK7G,EAGG,KAAK,WAAW,SAAW,KAAK,GAAK,EACnD6F,EAAI,KAAI,EACRA,EAAI,UAAUe,EAAIC,CAAE,EACpBhB,EAAI,OAAO,KAAK,WAAW,SAAW,KAAK,GAAK,CAAC,EACjDA,EAAI,UAAY,OAChBA,EAAI,UAAS,EACbA,EAAI,OAAO,EAAG,EAAE,EAChBA,EAAI,OAAO,EAAG,CAAC,EACfA,EAAI,OAAO,EAAG,CAAC,EACfA,EAAI,OAAO,GAAI,CAAC,EAChBA,EAAI,KAAI,EACRA,EAAI,QAAO,EAGXA,EAAI,YAAc,mBAAmB,GAAM,KAAK,IAAI,KAAK,IAAG,EAAK,IAAK,EAAI,EAAG,IAC7EA,EAAI,UAAS,EACbA,EAAI,IAAIe,EAAIC,EAAI,EAAG,EAAG,KAAK,GAAK,CAAC,EACjChB,EAAI,OAAM,CACd,CAGA,iBAAkB,CACd,QAAQ,IAAI,8BAA8B,EAC1C,MAAMiB,EAAQ,SAAS,eAAe,kBAAkB,EAGxD,GAFA,QAAQ,IAAI,8BAA+BA,CAAK,EAE5CA,IACAA,EAAM,UAAU,OAAO,QAAQ,EAC/B,KAAK,gBAAkB,GACvB,KAAK,gBAAkB,KAAK,iBAAmB,EAC/C,KAAK,kBAAoB,KAAK,mBAAqB,CAAE,EAAG,EAAG,EAAG,CAAC,EAG/D,KAAK,kBAAkB,EAAI,CAAC,KAAK,WAAW,EAC5C,KAAK,kBAAkB,EAAI,CAAC,KAAK,WAAW,EAE5C,QAAQ,IAAI,yCAA0C,KAAK,eAAe,EAC1E,KAAK,mBAAkB,EAGnB,CAAC,KAAK,kBAAkB,CACxB,KAAK,iBAAoBzH,GAAM,CAC3BA,EAAE,eAAc,EAEhB,MAAM0H,EAAU,KAAK,IAAI,GAAK,KAAK,IAAI,GAAM,KAAK,gBAAkB,KAAK,KAAK1H,EAAE,MAAM,EADpE,EACiF,CAAC,EACpG,KAAK,gBAAkB0H,EACvB,SAAS,eAAe,cAAc,EAAE,YAAc,SAAS,KAAK,gBAAgB,QAAQ,CAAC,CAAC,GAClG,EACA,MAAMnB,EAAS,SAAS,eAAe,qBAAqB,EAC5DA,EAAO,iBAAiB,QAAS,KAAK,gBAAgB,EAGtD,KAAK,cAAgB,GACrB,KAAK,aAAe,CAAE,EAAG,EAAG,EAAG,CAAC,EAEhCA,EAAO,iBAAiB,YAAcvG,GAAM,CACxC,KAAK,cAAgB,GACrB,KAAK,aAAe,CAAE,EAAGA,EAAE,QAAS,EAAGA,EAAE,OAAO,EAChDuG,EAAO,MAAM,OAAS,UAC1B,CAAC,EAED,OAAO,iBAAiB,YAAcvG,GAAM,CACxC,GAAI,CAAC,KAAK,cAAe,OACzB,MAAMgD,EAAKhD,EAAE,QAAU,KAAK,aAAa,EACnCiD,EAAKjD,EAAE,QAAU,KAAK,aAAa,EACzC,KAAK,aAAe,CAAE,EAAGA,EAAE,QAAS,EAAGA,EAAE,OAAO,EAGhD,KAAK,kBAAkB,GAAKgD,EAAK,KAAK,gBACtC,KAAK,kBAAkB,GAAKC,EAAK,KAAK,eAC1C,CAAC,EAED,OAAO,iBAAiB,UAAW,IAAM,CACrC,KAAK,cAAgB,GACrBsD,EAAO,MAAM,OAAS,MAC1B,CAAC,CACL,CAER,CAEA,kBAAmB,CACf,MAAMkB,EAAQ,SAAS,eAAe,kBAAkB,EACpDA,IACAA,EAAM,UAAU,IAAI,QAAQ,EAC5B,KAAK,gBAAkB,GAE/B,CAEA,oBAAqB,CACjB,GAAI,CAAC,KAAK,gBAAiB,OAE3B,MAAMlB,EAAS,SAAS,eAAe,qBAAqB,EAC5D,GAAI,CAACA,EAAQ,CACT,QAAQ,MAAM,8BAA8B,EAC5C,MACJ,CAEA,QAAQ,IAAI,4CAA6C,KAAK,eAAe,GAGzEA,EAAO,QAAU,OAAO,YAAcA,EAAO,SAAW,OAAO,eAC/DA,EAAO,MAAQ,OAAO,WACtBA,EAAO,OAAS,OAAO,aAG3B,MAAMC,EAAMD,EAAO,WAAW,IAAI,EAC5BE,EAAIF,EAAO,MACXG,EAAIH,EAAO,OACX7F,EAAK+F,EAAI,EACT9F,EAAK+F,EAAI,EACTiB,EAAO,KAAK,gBACZC,EAAO,KAAK,IAAG,EAAK,KAIpBC,EAAarB,EAAI,qBAAqB9F,EAAIC,EAAI,EAAGD,EAAIC,EAAI,KAAK,IAAI8F,EAAGC,CAAC,CAAC,EAC7EmB,EAAW,aAAa,EAAG,SAAS,EACpCA,EAAW,aAAa,GAAK,SAAS,EACtCA,EAAW,aAAa,EAAG,SAAS,EACpCrB,EAAI,UAAYqB,EAChBrB,EAAI,SAAS,EAAG,EAAGC,EAAGC,CAAC,EAEvBF,EAAI,KAAI,EACRA,EAAI,UAAU9F,EAAIC,CAAE,EACpB6F,EAAI,MAAMmB,EAAMA,CAAI,EACpBnB,EAAI,UAAU,KAAK,kBAAkB,EAAG,KAAK,kBAAkB,CAAC,EAKhE,KAAK,eAAeA,EAAK,GAAK,GAAK,IAAM,KAAO,SAAS,EAEzD,KAAK,eAAeA,EAAK,GAAK,GAAK,IAAM,IAAO,SAAS,EAIzD,OAAO,OAAO,KAAK,WAAW,EAAE,QAAQhC,GAAQ,CAC5C,MAAM9C,EAAO8C,EAAK,cAAc,IAKhCgC,EAAI,UAAS,EACbA,EAAI,IAAI,EAAG,EAAG9E,EAAM,EAAG,KAAK,GAAK,CAAC,EAClC8E,EAAI,UAAYhC,EAAK,WAAaA,EAAK,MACvCgC,EAAI,YAAc,IAClBA,EAAI,UAAY,IAChBA,EAAI,KAAI,EAGRA,EAAI,UAAS,EACbA,EAAI,IAAI,EAAG,EAAG9E,EAAM,EAAG,KAAK,GAAK,CAAC,EAClC8E,EAAI,YAAchC,EAAK,MACvBgC,EAAI,UAAY,EAAImB,EACpBnB,EAAI,YAAc,GAClBA,EAAI,YAAY,CAAC,GAAI,EAAE,CAAC,EACxBA,EAAI,OAAM,EACVA,EAAI,YAAY,EAAE,EAIlBA,EAAI,UAAYhC,EAAK,MACrBgC,EAAI,KAAO,qBACXA,EAAI,UAAY,SAChBA,EAAI,YAAc,GAClBA,EAAI,SAAShC,EAAK,KAAK,YAAW,EAAI,EAAG,CAAC9C,EAAO,GAAG,CACxD,CAAC,EAID8E,EAAI,YAAc,0BAClBA,EAAI,UAAY,EAAImB,EACpB,MAAMG,EAAW,IAIXC,EAAU,CAAC,KAAK,kBAAkB,EAClCC,EAAU,CAAC,KAAK,kBAAkB,EAClCC,EAAWxB,EAAIkB,EACfO,EAAWxB,EAAIiB,EAEfhF,EAAS,KAAK,OAAOoF,EAAUE,GAAYH,CAAQ,EAAIA,EACvDK,EAAO,KAAK,OAAOJ,EAAUE,GAAYH,CAAQ,EAAIA,EACrDlF,EAAS,KAAK,OAAOoF,EAAUE,GAAYJ,CAAQ,EAAIA,EACvDM,EAAO,KAAK,OAAOJ,EAAUE,GAAYJ,CAAQ,EAAIA,EAE3DtB,EAAI,UAAS,EACb,QAASnD,EAAIV,EAAQU,GAAK8E,EAAM9E,GAAKyE,EACjCtB,EAAI,OAAOnD,EAAGT,CAAM,EACpB4D,EAAI,OAAOnD,EAAG+E,CAAI,EAEtB,QAASlE,EAAItB,EAAQsB,GAAKkE,EAAMlE,GAAK4D,EACjCtB,EAAI,OAAO7D,EAAQuB,CAAC,EACpBsC,EAAI,OAAO2B,EAAMjE,CAAC,EAEtBsC,EAAI,OAAM,EASV,KAAK,iBAAiB,QAAQS,GAAO,CAEjC,MAAMI,EAAQ,EAAI,KAAK,IAAIO,EAAO,EAAIX,EAAI,EAAI,GAAI,EAAI,GAGhDoB,EAAY,KAAK,YAAYpB,EAAI,IAAI,EAAI,KAAK,YAAYA,EAAI,IAAI,EAAE,MAAQ,OAC5EE,EAAY,KAAK,YAAYF,EAAI,IAAI,EAAK,KAAK,YAAYA,EAAI,IAAI,EAAE,WAAaoB,EAAa,OAG/FC,EAAO9B,EAAI,qBAAqBS,EAAI,EAAGA,EAAI,EAAG,EAAII,EAAOJ,EAAI,EAAGA,EAAI,EAAG,GAAKI,CAAK,EACvFiB,EAAK,aAAa,EAAGnB,CAAS,EAC9BmB,EAAK,aAAa,EAAG,eAAe,EACpC9B,EAAI,UAAY8B,EAChB9B,EAAI,YAAc,GAClBA,EAAI,UAAS,EACbA,EAAI,IAAIS,EAAI,EAAGA,EAAI,EAAG,GAAKI,EAAO,EAAG,KAAK,GAAK,CAAC,EAChDb,EAAI,KAAI,EAGRA,EAAI,YAAc,EAClBA,EAAI,UAAY6B,EAChB,MAAME,EAAO,GACb/B,EAAI,UAAS,EACbA,EAAI,OAAOS,EAAI,EAAGA,EAAI,EAAIsB,CAAI,EAC9B/B,EAAI,OAAOS,EAAI,EAAIsB,EAAMtB,EAAI,CAAC,EAC9BT,EAAI,OAAOS,EAAI,EAAGA,EAAI,EAAIsB,CAAI,EAC9B/B,EAAI,OAAOS,EAAI,EAAIsB,EAAMtB,EAAI,CAAC,EAC9BT,EAAI,UAAS,EACbA,EAAI,KAAI,EAGJmB,EAAO,KACPnB,EAAI,UAAY,OAChBA,EAAI,KAAO,8BACXA,EAAI,UAAY,SAChBA,EAAI,SAASS,EAAI,KAAMA,EAAI,EAAGA,EAAI,EAAI,EAAE,EAExCT,EAAI,KAAO,8BACXA,EAAI,UAAY,OAChBA,EAAI,SAAS,cAAcS,EAAI,SAAW,KAAK,QAAQ,CAAC,CAAC,IAAKA,EAAI,EAAGA,EAAI,EAAI,EAAE,EAEvF,CAAC,EAID,KAAK,SAAS,QAAQ3C,GAAW,CAC7B,MAAMkE,EAAc,KAAK,aAAalE,EAAQ,IAAI,EAC7CkE,IAGLhC,EAAI,YAAc,GAClBA,EAAI,UAAYgC,EAAY,MAC5BhC,EAAI,UAAS,EACbA,EAAI,IAAIlC,EAAQ,EAAGA,EAAQ,EAAG,EAAIqD,EAAM,EAAG,KAAK,GAAK,CAAC,EACtDnB,EAAI,KAAI,EAGRA,EAAI,YAAc,EAClBA,EAAI,UAAS,EACbA,EAAI,IAAIlC,EAAQ,EAAGA,EAAQ,EAAG,EAAIqD,EAAM,EAAG,KAAK,GAAK,CAAC,EACtDnB,EAAI,KAAI,EAGJmB,EAAO,MACPnB,EAAI,UAAY,OAChBA,EAAI,KAAO,GAAG,GAAKmB,CAAI,WACvBnB,EAAI,UAAY,SAChBA,EAAI,SAASgC,EAAY,KAAMlE,EAAQ,EAAGA,EAAQ,EAAI,GAAKqD,CAAI,GAEvE,CAAC,EACDnB,EAAI,YAAc,EAGlB,MAAMiC,EAAQ,KAAK,WAAW,EACxBC,EAAQ,KAAK,WAAW,EAE9BlC,EAAI,UAAUiC,EAAOC,CAAK,EAG1B,MAAMC,EAAY,IAClBnC,EAAI,OAAO,KAAK,WAAW,SAAW,KAAK,GAAK,CAAC,EAEjDA,EAAI,UAAS,EACbA,EAAI,OAAO,EAAG,CAAC,EACfA,EAAI,IAAI,EAAG,EAAGmC,EAAW,CAAC,KAAK,GAAK,EAAG,KAAK,GAAK,CAAC,EAClDnC,EAAI,UAAY,yBAChBA,EAAI,KAAI,EACRA,EAAI,YAAc,yBAClBA,EAAI,UAAY,EAChBA,EAAI,OAAM,EAGVA,EAAI,UAAS,EACbA,EAAI,OAAO,EAAG,GAAG,EACjBA,EAAI,OAAO,GAAI,EAAE,EACjBA,EAAI,OAAO,EAAG,CAAC,EACfA,EAAI,OAAO,IAAK,EAAE,EAClBA,EAAI,UAAS,EACbA,EAAI,UAAY,OAChBA,EAAI,YAAc,OAClBA,EAAI,WAAa,GACjBA,EAAI,KAAI,EACRA,EAAI,WAAa,EAEjBA,EAAI,QAAO,EAIXA,EAAI,KAAO,2BACXA,EAAI,UAAY,yBAChBA,EAAI,UAAY,OAChBA,EAAI,SAAS,YAAY,KAAK,MAAMiC,EAAQ,GAAI,CAAC,KAAK,KAAK,MAAMC,EAAQ,GAAI,CAAC,IAAK,GAAIhC,EAAI,EAAE,EAC7FF,EAAI,SAAS,aAAa,KAAK,MAAMiC,CAAK,CAAC,OAAO,KAAK,MAAMC,CAAK,CAAC,GAAI,GAAIhC,EAAI,EAAE,EAIjF,MAAMkC,EADa,IACgBjB,EACnCnB,EAAI,UAAS,EACbA,EAAI,OAAOC,EAAI,IAAKC,EAAI,EAAE,EAC1BF,EAAI,OAAOC,EAAI,GAAIC,EAAI,EAAE,EACzBF,EAAI,OAAOC,EAAI,IAAKC,EAAI,EAAE,EAC1BF,EAAI,OAAOC,EAAI,IAAKC,EAAI,EAAE,EAC1BF,EAAI,OAAOC,EAAI,GAAIC,EAAI,EAAE,EACzBF,EAAI,OAAOC,EAAI,GAAIC,EAAI,EAAE,EACzBF,EAAI,YAAc,OAClBA,EAAI,UAAY,EAChBA,EAAI,OAAM,EAEVA,EAAI,UAAY,SAChBA,EAAI,UAAY,OAChBA,EAAI,SAAS,GAAG,KAAK,MAAMoC,CAAa,CAAC,KAAMnC,EAAI,IAAKC,EAAI,EAAE,EAE9D,sBAAsB,IAAM,KAAK,oBAAoB,CACzD,CAGA,eAAeF,EAAKqC,EAASC,EAAUC,EAASC,EAAM9B,EAAO,CACzD,MAAMa,EAAU,CAAC,KAAK,kBAAkB,EAAIe,EACtCd,EAAU,CAAC,KAAK,kBAAkB,EAAIc,EACtCrC,EAAID,EAAI,OAAO,MAAQ,KAAK,gBAC5BE,EAAIF,EAAI,OAAO,OAAS,KAAK,gBAI7B7D,EAAS,KAAK,OAAOoF,EAAUtB,GAAKsC,CAAO,EAC3CZ,EAAO,KAAK,OAAOJ,EAAUtB,GAAKsC,CAAO,EACzCnG,EAAS,KAAK,OAAOoF,EAAUtB,GAAKqC,CAAO,EAC3CX,EAAO,KAAK,OAAOJ,EAAUtB,GAAKqC,CAAO,EAE/CvC,EAAI,UAAYU,EAEhB,QAAS7D,EAAIV,EAAQU,GAAK8E,EAAM9E,IAC5B,QAASa,EAAItB,EAAQsB,GAAKkE,EAAMlE,IAAK,CAEjC,MAAMd,EAAOC,EAAI,MAAQa,EAAI,MACvB0C,EAAK,KAAK,IAAIxD,CAAI,EAAI2F,EACtBlC,EAAK,KAAK,IAAIzD,EAAO,EAAG,EAAI2F,EAC5BR,EAAQ,KAAK,IAAInF,EAAO,GAAG,EAAI,IAErCoD,EAAI,YAAcqC,GAAW,GAAM,KAAK,IAAIzF,EAAO,EAAG,EAAI,IAC1DoD,EAAI,UAAS,EACbA,EAAI,IAAInD,EAAI0F,EAAUnC,EAAI1C,EAAI6E,EAAUlC,EAAI0B,EAAM,EAAG,KAAK,GAAK,CAAC,EAChE/B,EAAI,KAAI,CACZ,CAEJA,EAAI,YAAc,CACtB,CAEA,2BAA4B,CACxB,MAAMyC,EAAS,SAAS,eAAe,qBAAqB,EAC5D,GAAI,CAACA,EAAQ,OAGb,MAAMC,EAAc,CAChB,CAAE,KAAM,cAAe,OAAQ,MAAS,KAAK,MAAM,KAAK,SAAW,GAAK,CAAC,EACzE,CAAE,KAAM,eAAgB,OAAQ,KAAQ,KAAK,MAAM,KAAK,SAAW,GAAI,CAAC,EACxE,CAAE,KAAM,aAAc,OAAQ,KAAQ,KAAK,MAAM,KAAK,SAAW,GAAI,CAAC,EACtE,CAAE,KAAM,MAAO,OAAQ,KAAK,qBAAoB,CAAE,CACtE,EAEgBA,EAAY,KAAK,CAAC,EAAGC,IAAMA,EAAE,OAAS,EAAE,MAAM,EAE9C,IAAIhD,EAAO,GACX+C,EAAY,QAAQ,CAACE,EAAQ/H,IAAM,CAC/B,MAAMgI,EAAQhI,IAAM,EAAI,KAAOA,IAAM,EAAI,KAAOA,IAAM,EAAI,KAAO,GAC3DiI,EAAQF,EAAO,OAAS,MAC9BjD,GAAQ,yBAAyBmD,EAAQ,OAAS,EAAE;AAAA,oDACpBD,GAAUhI,EAAI,CAAE;AAAA,oDAChB+H,EAAO,IAAI;AAAA,uDACRA,EAAO,OAAO,gBAAgB;AAAA,2BAErE,CAAC,EACDH,EAAO,UAAY9C,CACvB,CAEA,mBAAoB,CAEhB,KAAK,0BAAyB,CAClC,CAEA,sBAAuB,CACnB,IAAIoD,EAAQ,EACZ,SAAW,CAACpF,EAAM7D,CAAK,IAAK,OAAO,QAAQ,KAAK,eAAe,EAAG,CAC9D,MAAMkI,EAAc,KAAK,aAAarE,CAAI,EACtCqE,IAAae,GAASf,EAAY,MAAQlI,EAClD,CACA,OAAOiJ,CACX,CAEA,kBAAmB,CACf,MAAMC,EAAO,KAAK,WACZC,EAAO,KAAK,aAGdA,EAAK,GAAQA,EAAK,aAAcD,EAAK,UAAYA,EAAK,gBACtDC,EAAK,GAAQA,EAAK,cAAeD,EAAK,UAAYA,EAAK,eAGvDC,EAAK,IAAMD,EAAK,MAAQ,KAAK,IAAI,KAAK,GAAK,EAAGA,EAAK,MAAQ,GAAI,GAC/DC,EAAK,IAAMD,EAAK,MAAQ,KAAK,IAAI,CAAC,KAAK,GAAK,EAAGA,EAAK,MAAQ,GAAI,GAGhEC,EAAK,IAAMD,EAAK,KAAO,KAAK,IAAI,KAAK,GAAK,EAAGA,EAAK,KAAO,GAAI,GAC7DC,EAAK,IAAMD,EAAK,KAAO,KAAK,IAAI,CAAC,KAAK,GAAK,EAAGA,EAAK,KAAO,GAAI,GAGlE,MAAME,EAAM,KAAK,IAAIF,EAAK,QAAQ,EAC5BG,EAAM,KAAK,IAAIH,EAAK,QAAQ,GAE9BC,EAAK,GAAQA,EAAK,WAClBD,EAAK,IAAME,EAAMF,EAAK,aACtBA,EAAK,IAAMG,EAAMH,EAAK,eAEtBC,EAAK,GAAQA,EAAK,aAClBD,EAAK,IAAME,EAAMF,EAAK,aAAe,GACrCA,EAAK,IAAMG,EAAMH,EAAK,aAAe,IAIrCC,EAAK,IAAMD,EAAK,IAAMA,EAAK,cAC3BC,EAAK,IAAMD,EAAK,IAAMA,EAAK,cAG/B,MAAMI,EAASH,EAAK,OAAYA,EAAK,GAAG,EAAK,EAAM,EAWnD,GARAD,EAAK,GAAKA,EAAK,GAAKI,EACpBJ,EAAK,GAAKA,EAAK,GAAKI,EACpBJ,EAAK,GAAKA,EAAK,GAAKI,EAGpBJ,EAAK,MAAQ,KAAK,KAAKA,EAAK,GAAKA,EAAK,GAAKA,EAAK,GAAKA,EAAK,GAAKA,EAAK,GAAKA,EAAK,EAAE,EAG5EA,EAAK,MAAQA,EAAK,SAAU,CAC5B,MAAMK,EAAQL,EAAK,SAAWA,EAAK,MACnCA,EAAK,IAAMK,EACXL,EAAK,IAAMK,EACXL,EAAK,IAAMK,EACXL,EAAK,MAAQA,EAAK,QACtB,CAGA,MAAMM,EAAW,KAMjB,GALAN,EAAK,IAAMM,EACXN,EAAK,IAAMM,EACXN,EAAK,IAAMM,EAGPN,EAAK,MAAQ,EAAG,CAChB,MAAMO,EAAY,KAAK,MAAMP,EAAK,MAAQ,CAAC,EAC3C,QAASnI,EAAI,EAAGA,EAAI0I,EAAW1I,IAC3B,KAAK,WAAW,KAAK,CACjB,EAAGmI,EAAK,GAAK,KAAK,OAAM,EAAK,IAAO,IACpC,EAAGA,EAAK,GAAK,KAAK,OAAM,EAAK,IAAO,IACpC,EAAGA,EAAK,GAAK,KAAK,OAAM,EAAK,IAAO,IACpC,GAAI,CAACA,EAAK,GAAK,GACf,GAAI,CAACA,EAAK,GAAK,GACf,KAAM,CAClC,CAAyB,CAET,CAGA,KAAK,WAAW,QAAQQ,GAAQ,CAC5BA,EAAK,GAAKA,EAAK,GACfA,EAAK,GAAKA,EAAK,GACfA,EAAK,MAAQ,GACjB,CAAC,EACD,KAAK,WAAa,KAAK,WAAW,OAAOA,GAAQA,EAAK,KAAO,CAAC,EAI9D,KAAK,OAAO,EAAI,CAACR,EAAK,EAAI,KAAK,OAAO,KACtC,KAAK,OAAO,EAAI,CAACA,EAAK,EAAI,KAAK,OAAO,KAGtC,KAAK,wBAAuB,CAChC,CAGA,eAAgB,CACZ,GAAI,CACA,MAAMS,EAAQ,aAAa,QAAQ,iBAAiB,EACpD,OAAOA,EAAQ,KAAK,MAAMA,CAAK,EAAI,EACvC,OAASjK,EAAG,CACR,eAAQ,MAAM,4BAA6BA,CAAC,EACrC,EACX,CACJ,CAEA,eAAgB,CACZ,GAAI,CACA,aAAa,QAAQ,kBAAmB,KAAK,UAAU,KAAK,eAAe,CAAC,CAChF,OAASA,EAAG,CACR,QAAQ,MAAM,4BAA6BA,CAAC,CAChD,CACJ,CAEA,aAAc,CACV,OAAO,SAAS,aAAa,QAAQ,eAAe,CAAC,GAAK,CAC9D,CAEA,aAAc,CACV,aAAa,QAAQ,gBAAiB,KAAK,OAAO,CACtD,CAEA,cAAe,CACX,GAAI,CACA,OAAO,KAAK,MAAM,aAAa,QAAQ,gBAAgB,CAAC,GAAK,CAAE,MAAO,EAAG,MAAO,EAAG,QAAS,EAAG,OAAQ,EAAG,MAAO,EAAG,MAAO,CAAC,CAChI,MAAY,CACR,MAAO,CAAE,MAAO,EAAG,MAAO,EAAG,QAAS,EAAG,OAAQ,EAAG,MAAO,EAAG,MAAO,CAAC,CAC1E,CACJ,CAEA,cAAe,CACX,aAAa,QAAQ,iBAAkB,KAAK,UAAU,KAAK,WAAW,QAAQ,CAAC,CACnF,CAEA,aAAc,CACV,QAAQ,IAAI,4BAA4B,EACxC,IAAIkG,EAAa,EACb5F,EAAQ,EACZ,SAAW,CAAC6D,EAAM+F,CAAG,IAAK,OAAO,QAAQ,KAAK,eAAe,EACzD,GAAIA,EAAM,EAAG,CACT,MAAMjI,EAAM,KAAK,aAAakC,CAAI,EAAE,MACpC+B,GAAcjE,EAAMiI,EACpB5J,GAAS4J,EACT,KAAK,gBAAgB/F,CAAI,EAAI,CACjC,CAGA+B,EAAa,GACb,KAAK,SAAWA,EAChB,KAAK,YAAW,EAChB,KAAK,cAAa,EAClB,KAAK,UAAU,QAAQ5F,CAAK,cAAc4F,EAAW,eAAc,CAAE,EAAE,EACvE,QAAQ,IAAI,sBAAuB5F,EAAO,aAAc4F,CAAU,IAGlE,KAAK,UAAU,iBAAiB,EAChC,QAAQ,IAAI,iCAAiC,EAErD,CAEA,YAAY/B,EAAM,CACd,MAAMgG,EAAe,CAAC,IAAM,KAAM,IAAM,IAAO,IAAK,EAC9CC,EAAe,KAAK,WAAW,SAASjG,CAAI,GAAK,EAEvD,GAAIiG,GAAgB,EAAG,CACnB,KAAK,UAAU,oBAAoB,EACnC,MACJ,CAEA,MAAMC,EAAOF,EAAaC,CAAY,EACtC,GAAI,KAAK,SAAWC,EAAM,CACtB,KAAK,SAAWA,EAChB,KAAK,WAAW,SAASlG,CAAI,IAC7B,KAAK,YAAW,EAChB,KAAK,aAAY,EAGjB,MAAMmG,EAAM,KAAK,WAAW,SAASnG,CAAI,EACrCA,IAAS,SACT,KAAK,WAAW,SAAW,IAAM,EAAImG,EAAM,IAC3C,KAAK,WAAW,aAAe,IAAO,EAAIA,EAAM,KACzCnG,IAAS,SAChB,KAAK,WAAW,QAAU,KAAO,EAAImG,EAAM,IAC3C,KAAK,WAAW,WAAa,KAAK,WAAW,SACtCnG,IAAS,UAChB,KAAK,WAAW,UAAY,IAAM,EAAImG,EAAM,IAC5C,KAAK,WAAW,OAAS,KAAK,WAAW,WAClCnG,IAAS,UAChB,KAAK,WAAW,WAAa,KAAQ,EAAImG,EAAM,KAGnD,KAAK,UAAU,GAAGnG,EAAK,aAAa,sBAAsBmG,EAAM,CAAC,GAAG,EACpE,KAAK,gBAAe,CACxB,MACI,KAAK,UAAU,6BAA6BD,EAAK,eAAc,CAAE,EAAE,CAE3E,CAGA,eAAgB,CACZ,MAAMb,EAAO,KAAK,WACZe,EAAc,KACpB,IAAIC,EAAgB,IAGhBC,EAAe,EACfC,EAAgB,KAChBC,EAAY,GAEhB,UAAW1D,KAAO,KAAK,iBAAkB,CACrC,MAAMjE,EAAKwG,EAAK,EAAIvC,EAAI,EAClBhE,EAAKuG,EAAK,EAAIvC,EAAI,EAExB,GADa,KAAK,KAAKjE,EAAKA,EAAKC,EAAKA,CAAE,EAC7BgE,EAAI,OAAQ,CACnBwD,EAAe,EACfD,EAAgB,IAChBE,EAAgBzD,EAChB0D,EAAY,GACZ,KACJ,CACJ,CAGA,MAAMC,EAAuB,KAAK,KAAKpB,EAAK,EAAIA,EAAK,EAAIA,EAAK,EAAIA,EAAK,CAAC,EAWxE,IARA,KAAK,SAAW,KAAK,SAAS,OAAO/J,GAAK,CACtC,MAAMuD,EAAKvD,EAAE,EAAI+J,EAAK,EAChBvG,EAAKxD,EAAE,EAAI+J,EAAK,EAChBqB,EAAKpL,EAAE,EAAI+J,EAAK,EACtB,OAAO,KAAK,KAAKxG,EAAKA,EAAKC,EAAKA,EAAK4H,EAAKA,CAAE,EAAIN,EAAc,CAClE,CAAC,EAGM,KAAK,SAAS,OAASC,GAAe,CACzC,MAAMM,EAAc,KAAK,kBAAkBF,CAAoB,EACzDG,EAAa,KAAK,qBAAqBD,EAAaF,EAAsBH,CAAY,EACtFtG,EAAO,KAAK,aAAa4G,CAAU,EACzC,GAAI,CAAC5G,EAAM,SAGX,MAAM2C,EAAQ,KAAK,OAAM,EAAK,KAAK,GAAK,EAClCkE,EAAWT,EAAc,KAAK,KAAK,KAAK,OAAM,CAAE,EAChDU,GAAW,KAAK,OAAM,EAAK,IAAO,IAGxC,IAAIC,EAAQC,EACZ,GAAIR,GAAa,KAAK,OAAM,EAAK,GAAK,CAElC,MAAMS,EAAW,KAAK,OAAM,EAAK,KAAK,GAAK,EACrCC,EAAUX,EAAc,OAAS,KAAK,KAAK,KAAK,OAAM,CAAE,EAAI,GAClEQ,EAASR,EAAc,EAAI,KAAK,IAAIU,CAAQ,EAAIC,EAChDF,EAAST,EAAc,EAAI,KAAK,IAAIU,CAAQ,EAAIC,CACpD,MAEIH,EAAS1B,EAAK,EAAI,KAAK,IAAI1C,CAAK,EAAIkE,EACpCG,EAAS3B,EAAK,EAAI,KAAK,IAAI1C,CAAK,EAAIkE,EAGxC,MAAMM,EAAS9B,EAAK,EAAIyB,EAExB,KAAK,SAAS,KAAK,CACf,GAAI,KAAK,MAAQ,KAAK,OAAM,EAC5B,KAAMF,EACN,GAAG5G,EACH,EAAG+G,EACH,EAAGC,EACH,EAAGG,EACH,MAAO,KAAK,OAAM,EAAK,KAAK,GAAK,EACjC,SAAUnH,EAAK,SAAW,QAAUA,EAAK,SAAW,aAAeA,EAAK,SAAW,QAC3G,CAAqB,CACL,CACJ,CAGA,kBAAkB6G,EAAU,CACxB,SAAW,CAACO,EAAS/G,CAAI,IAAK,OAAO,QAAQ,KAAK,WAAW,EACzD,GAAIwG,GAAYxG,EAAK,cAAc,KAAOwG,EAAWxG,EAAK,cAAc,IACpE,OAAO+G,EAIf,OAAIP,GAAY,IAAa,SAEtB,YACX,CAIA,qBAAqBF,EAAaE,EAAUQ,EAAkB,EAAG,CAC7D,MAAMC,EAAQ,KAAK,YACbC,EAAc,OAAO,KAAK,KAAK,YAAY,EAG3CC,EAAU,GAChB,IAAIC,EAAc,EAElB,UAAWC,KAAcH,EAAa,CAClC,MAAMlJ,EAAU,KAAK,aAAaqJ,CAAU,EAC5C,IAAIC,EAAS,EAIb,GAAId,EAAW,KACX,OAAQxI,EAAQ,OAAM,CAClB,IAAK,SAAUsJ,EAAS,GAAI,MAC5B,IAAK,WAAYA,EAAS,GAAI,MAC9B,IAAK,OAAQA,EAAS,EAAG,MACzB,QAASA,EAAS,EAAG,KACjD,SAG6Bd,EAAW,IAChB,OAAQxI,EAAQ,OAAM,CAClB,IAAK,SAAUsJ,EAAS,GAAI,MAC5B,IAAK,WAAYA,EAAS,GAAI,MAC9B,IAAK,OAAQA,EAAS,GAAI,MAC1B,IAAK,OAAQA,EAAS,EAAG,MACzB,QAASA,EAAS,EAAG,KACjD,SAG6Bd,EAAW,IAChB,OAAQxI,EAAQ,OAAM,CAClB,IAAK,SAAUsJ,EAAS,EAAG,MAC3B,IAAK,WAAYA,EAAS,GAAI,MAC9B,IAAK,OAAQA,EAAS,GAAI,MAC1B,IAAK,OAAQA,EAAS,GAAI,MAC1B,IAAK,YAAaA,EAAS,GAAI,MAC/B,QAASA,EAAS,EAAG,KACjD,KAIwB,QAAQtJ,EAAQ,OAAM,CAClB,IAAK,SAAUsJ,EAAS,EAAG,MAC3B,IAAK,WAAYA,EAAS,EAAG,MAC7B,IAAK,OAAQA,EAAS,GAAI,MAC1B,IAAK,OAAQA,EAAS,GAAI,MAC1B,IAAK,YAAaA,EAAS,GAAI,MAC/B,IAAK,SAAUA,EAAS,GAAI,KACxD,CAIwBN,EAAkB,GAEdhJ,EAAQ,SAAW,WACnBsJ,GAAUN,GAKdC,EAAMjJ,EAAQ,IAAI,GAAKiJ,EAAMjJ,EAAQ,IAAI,EAAE,SAAS,SAASqJ,CAAU,GACnErJ,EAAQ,OAASsI,IACjBgB,GAAU,KAIlBH,EAAQ,KAAK,CAAE,IAAKE,EAAY,OAAAC,CAAM,CAAE,EACxCF,GAAeE,CACnB,CAGA,IAAIC,EAAS,KAAK,OAAM,EAAKH,EAC7B,SAAW,CAAE,IAAAhM,EAAK,OAAAkM,CAAM,IAAMH,EAE1B,GADAI,GAAUD,EACNC,GAAU,EACV,OAAOnM,EAKf,MAAO,MACX,CAGA,eAAe0E,EAAS,CACpB,MAAMkF,EAAO,KAAK,WACZxG,EAAKsB,EAAQ,EAAIkF,EAAK,EACtBvG,EAAKqB,EAAQ,EAAIkF,EAAK,EACtBqB,EAAKvG,EAAQ,EAAIkF,EAAK,EACtBwB,EAAW,KAAK,KAAKhI,EAAKA,EAAKC,EAAKA,EAAK4H,EAAKA,CAAE,EAChDmB,EAAmBxC,EAAK,KAAOlF,EAAQ,KAE7C,GAAI0G,EAAWgB,EAAkB,CAExB,KAAK,gBAAgB1H,EAAQ,IAAI,IAClC,KAAK,gBAAgBA,EAAQ,IAAI,EAAI,GAEzC,KAAK,gBAAgBA,EAAQ,IAAI,IACjC,KAAK,cAAa,EAGlB,KAAK,wBAAwB,KAAK,CAC9B,KAAM,IAAIA,EAAQ,IAAI,MAAMA,EAAQ,KAAK,IACzC,MAAOA,EAAQ,MACf,KAAM,KAAK,IAAG,CACtC,CAAqB,EAGD,MAAM2H,EAAQ,KAAK,SAAS,QAAQ3H,CAAO,EACvC2H,EAAQ,IAAI,KAAK,SAAS,OAAOA,EAAO,CAAC,CACjD,CACJ,CAGA,gBAAiB,CACb,GAAI,CAAC,KAAK,WAAY,OAGtB,UAAW3H,IAAW,CAAC,GAAG,KAAK,QAAQ,EACnC,KAAK,eAAeA,CAAO,EAI/B,KAAK,cAAa,EAGlB,MAAM4H,EAAM,KAAK,IAAG,EACpB,KAAK,wBAA0B,KAAK,wBAAwB,OAAOC,GAAKD,EAAMC,EAAE,KAAO,GAAI,CAC/F,CAEA,qBAAsB,CAClB,KAAK,kBAAoB,CAAC,KAAK,kBAC/B,MAAMrM,EAAM,SAAS,eAAe,kBAAkB,EAClDA,GAAKA,EAAI,UAAU,OAAO,SAAU,KAAK,iBAAiB,CAClE,CAGA,kBAAmB,WACf,GAAI,CACA,MAAMsM,IAAKtL,EAAA,SAAS,eAAe,YAAY,IAApC,YAAAA,EAAuC,QAAS,UACrDuL,IAAKrL,EAAA,SAAS,eAAe,YAAY,IAApC,YAAAA,EAAuC,QAAS,UACrDsL,IAAKC,EAAA,SAAS,eAAe,YAAY,IAApC,YAAAA,EAAuC,QAAS,UAC3D,KAAK,WAAa,CAACH,EAAIC,EAAIC,CAAE,EAC7B,KAAK,oBAAmB,EACxB,KAAK,UAAU,qBAAqB,CACxC,OAAStM,EAAG,CACR,QAAQ,MAAM,sCAAuCA,CAAC,CAC1D,CACJ,CAGA,eAAgB,CACZ,GAAI,CAEA,GAAI,KAAK,WAAY,CACjB,KAAK,WAAa,GAClB,MAAMwM,EAAU,SAAS,eAAe,WAAW,EAC/CA,GAASA,EAAQ,UAAU,OAAO,QAAQ,CAClD,CAEA,KAAK,YAAc,CAAC,KAAK,YACzB,MAAM1M,EAAM,SAAS,eAAe,YAAY,EAC5CA,GAAKA,EAAI,UAAU,OAAO,SAAU,KAAK,WAAW,EAGxD,KAAK,oBAAmB,EACxB,KAAK,UAAU,KAAK,YAAc,gBAAkB,gBAAgB,CACxE,OAASE,EAAG,CACR,QAAQ,MAAM,mCAAoCA,CAAC,EACnD,KAAK,YAAc,GACnB,KAAK,UAAU,qCAAqC,CACxD,CACJ,CAEA,oBAAqB,CACjB,MAAM6E,EAAQ,SAAS,eAAe,cAAc,EAChDA,IACAA,EAAM,UAAU,OAAO,QAAQ,EAC1BA,EAAM,UAAU,SAAS,QAAQ,GAClC,KAAK,gBAAe,EAGhC,CAEA,iBAAkB,CACd,MAAM4H,EAAO,SAAS,eAAe,aAAa,EAC5CC,EAAU,SAAS,eAAe,aAAa,EACrD,GAAI,CAACD,GAAQ,CAACC,EAAS,OAEvBA,EAAQ,YAAc,IAAM,KAAK,QAAQ,eAAc,EAEvD,MAAMC,EAAW,CACb,CAAE,GAAI,QAAS,KAAM,mBAAoB,KAAM,oCAAoC,EACnF,CAAE,GAAI,QAAS,KAAM,kBAAmB,KAAM,0BAA0B,EACxE,CAAE,GAAI,UAAW,KAAM,iBAAkB,KAAM,uCAAuC,EACtF,CAAE,GAAI,SAAU,KAAM,gBAAiB,KAAM,2BAA2B,EACxE,CAAE,GAAI,QAAS,KAAM,eAAgB,KAAM,sCAAsC,EACjF,CAAE,GAAI,QAAS,KAAM,kBAAmB,KAAM,2BAA2B,CAC7F,EAEsBC,EAAQ,CAAC,IAAM,KAAM,IAAM,IAAO,IAAK,EAE7C,IAAIzG,EAAO,GACXwG,EAAS,QAAQE,GAAK,CAClB,MAAMC,EAAQ,KAAK,WAAW,SAASD,EAAE,EAAE,GAAK,EAC1CxC,EAAOuC,EAAME,CAAK,EAClBC,EAAQD,GAAS,EACjBE,EAAY,KAAK,SAAW3C,EAElC,IAAI4C,EAAO,GACX,QAAS5L,EAAI,EAAGA,EAAI,EAAGA,IACnB4L,GAAQ,8CAA8C5L,EAAIyL,EAAQ,UAAY,uBAAuB,0BAGzG3G,GAAQ;AAAA,0FAC8D6G,EAAY,sBAAwB,qBAAqB;AAAA;AAAA,iGAElDH,EAAE,IAAI;AAAA,qEAClCE,EAAQ,UAAY,SAAS,KAAKA,EAAQ,MAAQ,IAAM1C,EAAK,gBAAgB;AAAA;AAAA,yFAEzDwC,EAAE,IAAI;AAAA,4EACnBI,CAAI;AAAA,8BACjDF,EAAkN,GAA1M,uDAAuDF,EAAE,EAAE,uDAAuDG,EAAY,iBAAmB,kCAAkC,oBAAyB;AAAA;AAAA,qBAGnO,CAAC,EAEDP,EAAK,UAAYtG,CACrB,CAGA,cAAe,CACX,GAAI,CAEA,GAAI,KAAK,YAAa,CAClB,KAAK,YAAc,GACnB,MAAM+G,EAAW,SAAS,eAAe,YAAY,EACjDA,GAAUA,EAAS,UAAU,OAAO,QAAQ,CACpD,CAEA,MAAMpN,EAAM,SAAS,eAAe,WAAW,EAG/C,GAAI,KAAK,gBAAiB,CACtB,KAAK,UAAU,4BAA4B,EAC3C,MACJ,CAGA,GAAI,KAAK,WAAY,CACjB,KAAK,gBAAkB,GACvB,KAAK,mBAAqB,YAAY,MACtC,KAAK,kBAAoB,KACrBA,GAAKA,EAAI,UAAU,OAAO,QAAQ,EACtC,KAAK,UAAU,mCAAmC,EAG9C,KAAK,sBACL,qBAAqB,KAAK,mBAAmB,EAC7C,KAAK,oBAAsB,MAG/B,MAAMqN,EAAS,SAAS,eAAe,iBAAiB,EACxD,GAAIA,EAAQ,CACR,MAAMC,EAAa,WAAWD,EAAO,KAAK,GAAK,IACzCE,EAAY,YAAY,IAAG,EAK3BC,EAAuB,KACvBC,EAA0B,IAC1BC,EAAgBF,EAAuBC,EAGvCE,EAAyBC,GAAgB,CAC3C,GAAI,CAAC,KAAK,gBAAiB,OAE3B,MAAMC,EAAUD,EAAcL,EAC9B,IAAIO,EAEJ,GAAID,EAAUL,EAAsB,CAEhC,MAAMO,EAAWF,EAAUL,EACrBQ,EAAQ,EAAI,KAAK,IAAI,EAAID,EAAU,CAAC,EAC1CD,EAAQR,EAAcA,EAAa,GAAMU,CAC7C,SAAWH,EAAUH,EAAe,CAGhC,MAAMK,GADiBF,EAAUL,GACCC,EAC5BO,EAAQ,EAAI,KAAK,IAAI,EAAID,EAAU,CAAC,EAC1CD,EAASR,EAAa,GAASA,EAAa,GAAOU,CACvD,KAAO,CAEHF,EAAQ,EACR,KAAK,gBAAkB,GACvB,KAAK,WAAa,GAGlB,MAAMG,EAAqBC,GAAQ,CAC3BA,GAAKA,EAAI,QAAQC,GAAO,CAOxBA,EAAI,SAAW,GACfA,EAAI,YAAc,GAClBA,EAAI,cAAgB,GACpBA,EAAI,UAAY,GAChBA,EAAI,aAAe,OACnBA,EAAI,UAAY,OAChBA,EAAI,UAAY,OAChBA,EAAI,eAAiB,OACrBA,EAAI,aAAe,OACnBA,EAAI,aAAe,OACnBA,EAAI,OAAS,OACbA,EAAI,OAAS,OACbA,EAAI,gBAAkB,OACtBA,EAAI,gBAAkB,OACtBA,EAAI,QAAU,OACdA,EAAI,QAAU,OACdA,EAAI,MAAQ,OACZA,EAAI,MAAQ,OACZA,EAAI,UAAY,MACpB,CAAC,CACL,EACAF,EAAkB,KAAK,OAAO,EAC9BA,EAAkB,KAAK,QAAQ,EAC/BA,EAAkB,KAAK,UAAU,EACjCA,EAAkB,KAAK,OAAO,EAC9BA,EAAkB,KAAK,UAAU,EACjCA,EAAkB,KAAK,KAAK,EAE5BZ,EAAO,MAAQ,EACf,KAAK,uBAAuB,CAAC,EAE7B,KAAK,UAAU,4BAA4B,EAC3C,MACJ,CAEAA,EAAO,MAAQ,KAAK,IAAI,EAAGS,CAAK,EAChC,KAAK,uBAAuB,KAAK,IAAI,EAAGA,CAAK,EAAG,EAAK,EAErD,KAAK,oBAAsB,sBAAsBH,CAAqB,CAC1E,EAEA,KAAK,oBAAsB,sBAAsBA,CAAqB,CAC1E,CACA,MACJ,CAGA,KAAK,WAAa,GAClB,KAAK,gBAAkB,GACnB3N,GAAKA,EAAI,UAAU,IAAI,QAAQ,EAGnC,KAAK,UAAY,EAEjB,KAAK,UAAU,eAAe,EAG9B,MAAMoO,EAAyBD,GAAQ,CAC9BA,IACLA,EAAI,MAAQA,EAAI,EAChBA,EAAI,MAAQA,EAAI,EAChBA,EAAI,SAAW,GACfA,EAAI,UAAY,GACpB,EACI,KAAK,SAAS,KAAK,QAAQ,QAAQC,CAAqB,EACxD,KAAK,UAAU,KAAK,SAAS,QAAQA,CAAqB,EAC1D,KAAK,YAAY,KAAK,WAAW,QAAQA,CAAqB,EAC9D,KAAK,SAAS,KAAK,QAAQ,QAAQA,CAAqB,EACxD,KAAK,YAAY,KAAK,WAAW,QAAQA,CAAqB,EAC9D,KAAK,OAAO,KAAK,MAAM,QAAQA,CAAqB,EAGxD,MAAMf,EAAS,SAAS,eAAe,iBAAiB,EACxD,GAAIA,EAAQ,CACJ,KAAK,qBACL,qBAAqB,KAAK,mBAAmB,EAGjD,KAAK,kBAAoB,GAEzB,MAAMgB,EAAoB,IAAM,CAC5B,KAAK,kBAAoB,GACrB,KAAK,sBACL,qBAAqB,KAAK,mBAAmB,EAC7C,KAAK,oBAAsB,KAEnC,EAEAhB,EAAO,oBAAoB,YAAagB,CAAiB,EACzDhB,EAAO,oBAAoB,aAAcgB,CAAiB,EAC1DhB,EAAO,oBAAoB,cAAegB,CAAiB,EAC3DhB,EAAO,iBAAiB,YAAagB,CAAiB,EACtDhB,EAAO,iBAAiB,aAAcgB,CAAiB,EACvDhB,EAAO,iBAAiB,cAAegB,CAAiB,EAExDhB,EAAO,MAAQ,EACf,KAAK,uBAAuB,CAAC,EAE7B,MAAME,EAAY,YAAY,IAAG,EAC3Be,EAAoB,IACpBC,EAAqB,KACrBb,EAAgBY,EAAoBC,EAEpCC,EAAiBZ,GAAgB,CACnC,GAAI,CAAC,KAAK,YAAc,KAAK,mBAAqB,KAAK,gBAAiB,OAExE,MAAMC,EAAUD,EAAcL,EAC9B,IAAIO,EAEJ,GAAID,EAAUS,EAEVR,EAAQ,EADcD,EAAUS,EACJ,aACrBT,EAAUH,EAAe,CAChC,MAAMe,EAAgBZ,EAAUS,EAEhCR,EAAQ,KADe,KAAK,IAAI,EAAGW,EAAgBF,CAAkB,EACrC,IACpC,KAAO,CACH,MAAMG,GAAgBb,EAAUH,GAAiB,IAC3CiB,EAAQ,KAAK,IAAID,EAAe,EAAG,EAAI,EACvCE,EAAQ,KAAK,IAAIF,EAAe,GAAG,EAAI,EACvCG,EAAQ,KAAK,IAAIH,EAAe,GAAG,EAAI,EACvCI,EAAQ,KAAK,IAAIJ,EAAe,EAAG,EAAI,KAAK,IAAIA,EAAe,GAAG,EAAI,EAE5EZ,EAAQ,IADWa,EAAQC,EAAQC,EAAQC,GAE3ChB,EAAQ,KAAK,IAAI,GAAI,KAAK,IAAI,IAAKA,CAAK,CAAC,CAC7C,CAEAT,EAAO,MAAQS,EACf,KAAK,uBAAuBA,CAAK,EACjC,KAAK,oBAAsB,sBAAsBU,CAAa,CAClE,EACA,KAAK,oBAAsB,sBAAsBA,CAAa,CAClE,CACJ,OAAStO,EAAG,CACR,QAAQ,MAAM,kCAAmCA,CAAC,EAClD,KAAK,WAAa,GAClB,KAAK,gBAAkB,GACvB,KAAK,UAAU,oCAAoC,CACvD,CACJ,CAIA,uBAAuB4N,EAAOiB,EAAc,GAAM,CAC9C,MAAMC,EAAW,WAAWlB,CAAK,GAAK,EAEtC,GAAIiB,EAEA,GAAIC,EAAW,GAAK,CAEX,KAAK,aAAY,KAAK,WAAa,IACxC,KAAK,gBAAkB,GAEvB,MAAMhP,EAAM,SAAS,eAAe,WAAW,EAC3CA,GAAKA,EAAI,UAAU,IAAI,QAAQ,CACvC,SAEQgP,IAAa,EAAG,CAEhB,KAAK,WAAa,GAClB,KAAK,gBAAkB,GACvB,KAAK,UAAY,EACjB,MAAMhP,EAAM,SAAS,eAAe,WAAW,EAC3CA,GAAKA,EAAI,UAAU,OAAO,QAAQ,EACtC,KAAK,UAAU,iBAAiB,CACpC,MAAW,KAAK,YAAc,CAAC,KAAK,kBAEhC,KAAK,gBAAkB,IAMnC,MAAMiP,EAAaD,EAAW,IAIxBE,EAAS,KAAK,IAAID,EAAY,CAAC,EAGrC,KAAK,oBAAsBC,EAAS,IAGpC,KAAK,cAAgBF,CACzB,CAEA,mBAAoB,CAChB,MAAMG,EAAiB,SAAS,eAAe,oBAAoB,EAC7DC,EAAa,SAAS,eAAe,YAAY,EACjDC,EAAY,SAAS,eAAe,sBAAsB,EAC1DC,EAAa,SAAS,eAAe,YAAY,EAGnDA,IAAYA,EAAW,MAAQ,KAAK,aAEpC,KAAK,YAAc,SACfH,IACAA,EAAe,UAAU,IAAI,QAAQ,EACrCA,EAAe,MAAM,WAAa,KAAK,aAEvCC,GAAYA,EAAW,UAAU,OAAO,QAAQ,EAChDC,IAAWA,EAAU,UAAY,sBAAsB,KAAK,WAAW,OAEvEF,GAAgBA,EAAe,UAAU,OAAO,QAAQ,EACxDC,GAAYA,EAAW,UAAU,IAAI,QAAQ,EAC7CC,IAAWA,EAAU,UAAY,yCAE7C,CAIA,YAAYnP,EAAG,CACX,MAAO,CACH,GAAIA,EAAE,QAAU,KAAK,OAAO,MAAQ,EAAI,KAAK,OAAO,GAAK,KAAK,OAAO,KACrE,GAAIA,EAAE,QAAU,KAAK,OAAO,OAAS,EAAI,KAAK,OAAO,GAAK,KAAK,OAAO,IAC1F,CACY,CAEA,cAAcA,EAAG,CAoBb,GAlBA,KAAK,QAAQ,OAASA,EAAE,OAGxB,KAAK,QAAQ,SAAYA,EAAE,SAAW,KAAK,OAC3C,KAAK,QAAQ,OAAS,GACtB,KAAK,QAAQ,OAASA,EAAE,QACxB,KAAK,QAAQ,OAASA,EAAE,QACxB,KAAK,QAAQ,UAAY,KAAK,OAAO,EACrC,KAAK,QAAQ,UAAY,KAAK,OAAO,EACrC,KAAK,QAAQ,UAAY,KAAK,UAC9B,KAAK,QAAQ,UAAY,KAAK,UAI9B,KAAK,QAAQ,UAAaA,EAAE,SAAW,GAAOA,EAAE,SAAW,GAAKA,EAAE,OAClE,KAAK,QAAQ,QAAWA,EAAE,SAAW,GAAKA,EAAE,SAGxC,KAAK,QAAQ,WAAa,KAAK,QAAQ,QACvC,OAGJ,MAAMqP,EAAQ,KAAK,YAAYrP,CAAC,EAC1BsP,EAAW,KAAK,OAAO,YAAc,EAAK,KAAK,OAAO,KACtDC,EAAU,KAAK,MAAM,KAAKvN,GAAK,KAAK,MAAMA,EAAE,EAAIqN,EAAM,EAAGrN,EAAE,EAAIqN,EAAM,CAAC,EAAIC,CAAO,EAGvF,GAAIC,EAAS,CAIT,GAHA,KAAK,0BAAyB,EAG1B,KAAK,OAAS,UAAYA,EAAQ,UAAW,CAE7C,KAAK,iBAAmB,OAAOA,EAAQ,SAAS,EAChD,KAAK,QAAQ,WAAaF,EAAM,EAChC,KAAK,QAAQ,WAAaA,EAAM,EAChC,KAAK,UAAS,EACd,MACJ,CAGI,KAAK,OAAS,SACd,KAAK,YAAcE,EACnB,KAAK,UAAS,EAEtB,CACJ,CAEA,cAAcvP,EAAG,CACb,MAAMqP,EAAQ,KAAK,YAAYrP,CAAC,EAG1BsP,EAAW,KAAK,OAAO,YAAc,EAAK,KAAK,OAAO,KAC5D,KAAK,YAAc,KAAK,MAAM,KAAKtN,GAAK,KAAK,MAAMA,EAAE,EAAIqN,EAAM,EAAGrN,EAAE,EAAIqN,EAAM,CAAC,EAAIC,CAAO,EAG1F,IAAIE,EAAY,UAehB,GAdI,KAAK,QAAQ,WAAa,KAAK,QAAQ,OACvCA,EAAY,OACL,KAAK,QAAQ,SAAW,KAAK,QAAQ,OAC5CA,EAAY,OACL,KAAK,aAAe,KAAK,kBAAoB,KAAK,QAAQ,SACjEA,EAAY,WACL,KAAK,YACZA,EAAY,OACL,KAAK,OAAS,SACrBA,EAAY,aAEhB,KAAK,OAAO,MAAM,OAASA,EAGvB,CAAC,KAAK,QAAQ,OAAQ,OAE1B,MAAMxM,EAAKhD,EAAE,QAAU,KAAK,QAAQ,OAC9BiD,EAAKjD,EAAE,QAAU,KAAK,QAAQ,OAQpC,GAPkB,KAAK,MAAMgD,EAAIC,CAAE,EAEnB,IACZ,KAAK,QAAQ,SAAW,IAIxB,KAAK,QAAQ,UAAW,CACxB,KAAK,UAAY,KAAK,QAAQ,UAAYD,EAAK,GAC/C,KAAK,UAAY,KAAK,QAAQ,UAAYC,EAAK,GAC/C,KAAK,KAAI,EAET,MAAMwM,EAAe,SAAS,eAAe,YAAY,EACnDC,EAAe,SAAS,eAAe,YAAY,EACrDD,IACAA,EAAa,MAAQ,KAAK,UAAY,IACtC,SAAS,eAAe,WAAW,EAAE,YAAc,KAAK,MAAM,KAAK,UAAY,GAAG,EAAI,KAEtFC,IACAA,EAAa,MAAQ,KAAK,UAAY,IACtC,SAAS,eAAe,WAAW,EAAE,YAAc,KAAK,MAAM,KAAK,UAAY,GAAG,EAAI,KAE1F,MACJ,CAGA,GAAI,KAAK,QAAQ,QAAS,CACtB,KAAK,OAAO,EAAI,KAAK,QAAQ,UAAY1M,EACzC,KAAK,OAAO,EAAI,KAAK,QAAQ,UAAYC,EACzC,MACJ,CAGA,GAAI,KAAK,iBAAkB,CAEvB,MAAM0M,EAAcN,EAAM,EAAI,KAAK,QAAQ,WACrCO,EAAcP,EAAM,EAAI,KAAK,QAAQ,WAErCQ,EAAkB,KAAK,iBAE7B,KAAK,MAAM,QAAQ7N,GAAK,CAEhB,OAAOA,EAAE,SAAS,IAAM6N,IACxB7N,EAAE,GAAK2N,EACP3N,EAAE,GAAK4N,EAEf,CAAC,EAGD,KAAK,QAAQ,WAAaP,EAAM,EAChC,KAAK,QAAQ,WAAaA,EAAM,EAChC,MACJ,CAGA,GAAI,KAAK,YAAa,CAClB,KAAK,YAAY,EAAIA,EAAM,EAC3B,KAAK,YAAY,EAAIA,EAAM,EAC3B,MACJ,CAGA,GAAI,KAAK,QAAQ,SAAU,CACvB,KAAK,UAAY,KAAK,QAAQ,UAAYrM,EAAK,GAC/C,KAAK,UAAY,KAAK,QAAQ,UAAYC,EAAK,GAC/C,KAAK,KAAI,EAET,MAAMwM,EAAe,SAAS,eAAe,YAAY,EACnDC,EAAe,SAAS,eAAe,YAAY,EACrDD,IACAA,EAAa,MAAQ,KAAK,UAAY,IACtC,SAAS,eAAe,WAAW,EAAE,YAAc,KAAK,MAAM,KAAK,UAAY,GAAG,EAAI,KAEtFC,IACAA,EAAa,MAAQ,KAAK,UAAY,IACtC,SAAS,eAAe,WAAW,EAAE,YAAc,KAAK,MAAM,KAAK,UAAY,GAAG,EAAI,IAE9F,CACJ,CAEA,YAAY1P,EAAG,CAEX,MAAM8P,EAAgB,KAAK,QAAQ,WAAa,KAAK,QAAQ,QAG7D,GAAI,KAAK,QAAQ,UAAY,CAACA,EAAe,CACzC,MAAMT,EAAQ,KAAK,YAAYrP,CAAC,EAC1BsP,EAAW,KAAK,OAAO,YAAc,EAAK,KAAK,OAAO,KACtDS,EAAc,KAAK,MAAM,KAAK,GAAK,KAAK,MAAM,EAAE,EAAIV,EAAM,EAAG,EAAE,EAAIA,EAAM,CAAC,EAAIC,CAAO,EAE3F,GAAI,CAAC,KAAK,QAAQ,UAAY,CAACS,GAEvB,KAAK,OAAS,OAAQ,CACtB,KAAK,UAAS,EAId,MAAMC,EAAS,KAAK,uBAAsB,EAI1C,KAAK,sBAAwB,CAAE,EAAGA,EAAO,EAAG,EAAGA,EAAO,EAAG,EAAGA,EAAO,CAAC,EAGpE,MAAMC,EAAQ,KAAK,gBAAgBZ,EAAM,EAAGA,EAAM,EAAGW,EAAO,EAAGA,EAAO,CAAC,EAEvE,KAAK,WAAWC,EAAM,EAAGA,EAAM,EAAGA,EAAM,CAAC,EAGzC,WAAW,IAAM,CAAE,KAAK,sBAAwB,IAAM,EAAG,GAAG,CAChE,CAER,CAGA,KAAK,QAAQ,OAAS,GACtB,KAAK,QAAQ,SAAW,GACxB,KAAK,QAAQ,SAAW,GACxB,KAAK,QAAQ,UAAY,GACzB,KAAK,QAAQ,QAAU,GACvB,KAAK,QAAQ,OAAS,EACtB,KAAK,YAAc,KACnB,KAAK,iBAAmB,IAC5B,CAEA,aAAajQ,EAAG,CACZA,EAAE,eAAc,EAChB,MAAMqP,EAAQ,KAAK,YAAYrP,CAAC,EAC1BsP,EAAW,KAAK,OAAO,YAAc,EAAK,KAAK,OAAO,KAGtDY,EAAmB,KAAK,MAAM,UAAU,GAAK,KAAK,MAAM,EAAE,EAAIb,EAAM,EAAG,EAAE,EAAIA,EAAM,CAAC,EAAIC,CAAO,EAErG,GAAIY,IAAqB,GAAI,CAEzB,KAAK,UAAS,EACd,KAAK,MAAM,OAAOA,EAAkB,CAAC,EACrC,KAAK,UAAU,cAAc,EAC7B,KAAK,KAAI,EACT,MACJ,CAGA,MAAMC,EAAc,EAAI,KAAK,OAAO,KACpC,QAAS9O,EAAI,EAAGA,EAAI,KAAK,MAAM,OAAQA,IAAK,CACxC,MAAM+O,EAAK,KAAK,MAAM/O,CAAC,EACvB,QAASgP,EAAIhP,EAAI,EAAGgP,EAAI,KAAK,MAAM,OAAQA,IAAK,CAC5C,MAAMC,EAAK,KAAK,MAAMD,CAAC,EAGvB,GAAI,KAAK,MAAMD,EAAG,EAAIE,EAAG,EAAGF,EAAG,EAAIE,EAAG,CAAC,EAAI,KAAK,OAAO,eAAgB,SAGvE,MAAMC,EAAU,KAAK,MAAMD,EAAG,EAAIF,EAAG,EAAGE,EAAG,EAAIF,EAAG,CAAC,EACnD,GAAIG,IAAY,EAAG,SAEnB,MAAMC,EAAI,KAAK,IAAI,EAAG,KAAK,IAAI,IAAKnB,EAAM,EAAIe,EAAG,IAAME,EAAG,EAAIF,EAAG,IAAMf,EAAM,EAAIe,EAAG,IAAME,EAAG,EAAIF,EAAG,KAAOG,EAAUA,EAAQ,CAAC,EACxHE,EAAQL,EAAG,EAAII,GAAKF,EAAG,EAAIF,EAAG,GAC9BM,EAAQN,EAAG,EAAII,GAAKF,EAAG,EAAIF,EAAG,GAGpC,GAFa,KAAK,MAAMf,EAAM,EAAIoB,EAAOpB,EAAM,EAAIqB,CAAK,EAE7CP,EAAa,CAEpB,KAAK,UAAS,EACd,MAAMQ,EAAU,CAACtP,EAAGgP,CAAC,EAAE,KAAK,CAACO,EAAGzH,IAAMA,EAAIyH,CAAC,EAC3C,KAAK,MAAM,OAAOD,EAAQ,CAAC,EAAG,CAAC,EAC/B,KAAK,MAAM,OAAOA,EAAQ,CAAC,EAAG,CAAC,EAC/B,KAAK,UAAU,oBAAoB,EACnC,KAAK,KAAI,EACT,MACJ,CACJ,CACJ,CACJ,CAEA,QAAQ3Q,EAAG,CACPA,EAAE,eAAc,EAEhB,MAAM0H,EAAU,KAAK,IAAI,GAAK,KAAK,IAAI,EAAG,KAAK,OAAO,KAAO1H,EAAE,OAD7C,KAC+D,CAAC,EAE5E6Q,EAAW,KAAK,YAAY7Q,CAAC,EACnC,KAAK,OAAO,KAAO0H,EAEnB,KAAK,OAAO,EAAI1H,EAAE,QAAU,KAAK,OAAO,MAAQ,EAAI6Q,EAAS,EAAI,KAAK,OAAO,KAC7E,KAAK,OAAO,EAAI7Q,EAAE,QAAU,KAAK,OAAO,OAAS,EAAI6Q,EAAS,EAAI,KAAK,OAAO,IAClF,CAIA,WAAWxN,EAAGa,EAAG4M,EAAI,EAAG,CACpB,IAAIC,EAAY,KAAK,YACjB,KAAK,YAAc,YACnBA,EAAY,KAAK,cAAa,GAGlC,KAAK,MAAM,KAAK,CACZ,EAAA1N,EAAG,EAAAa,EACH,EAAG4M,EACH,GAAI,KAAK,MAAM,KAAK,IAAG,EAAK,KAAK,OAAM,EAAK,GAAI,EAAE,SAAQ,EAC1D,MAAO,KAAK,OAAM,EAAK,KAAK,GAAK,EACjC,MAAOC,EACP,UAAW,IAC/B,CAAiB,EACD,KAAK,KAAI,CACb,CAMA,2BAA4B,CACxB,KAAM,CAAE,MAAAC,EAAO,SAAAC,GAAa,KAAK,kBAAiB,EAG5CC,EAAgB,IAAI,IAG1B,OAAAD,EAAS,QAAQE,GAAK,CAClB,GAAIA,EAAE,QAAU,KAAK,OAAO,aAAc,CACtC,MAAMC,EAAO,KAAK,qBAAqBD,CAAC,EACxCA,EAAE,QAAQE,GAAQ,CACdH,EAAc,IAAIG,EAAK,GAAID,CAAI,CACnC,CAAC,CACL,CACJ,CAAC,EAGD,KAAK,MAAM,QAAQpP,GAAK,CAGpB,MAAMsP,EAAWJ,EAAc,IAAIlP,EAAE,EAAE,EACnCsP,EACAtP,EAAE,UAAYsP,EACPtP,EAAE,WAAa,MAAM,WAAWA,EAAE,SAAS,CAAC,IAInDA,EAAE,UAAYA,EAAE,GAExB,CAAC,EAEM,CAAE,MAAAgP,EAAO,SAAAC,CAAQ,CAC5B,CAIA,aAAajP,EAAG,CACZ,OAAOA,EAAE,OAAS,SACtB,CAEA,SAASuP,EAAK,CACV,MAAMC,EAAiB,mCACvBD,EAAMA,EAAI,QAAQC,EAAgB,CAAC/R,EAAG2E,EAAGqN,EAAGtI,IAAM/E,EAAIA,EAAIqN,EAAIA,EAAItI,EAAIA,CAAC,EACvE,MAAMuI,EAAS,4CAA4C,KAAKH,CAAG,EACnE,OAAOG,EAAS,CACZ,SAASA,EAAO,CAAC,EAAG,EAAE,EACtB,SAASA,EAAO,CAAC,EAAG,EAAE,EACtB,SAASA,EAAO,CAAC,EAAG,EAAE,CAC1C,EAAoB,CAAC,IAAK,IAAK,GAAG,CACtB,CAKA,WAAY,CAER,MAAMC,EAAW,KAAK,UAAU,KAAK,MAAM,IAAI3P,IAAM,CACjD,EAAGA,EAAE,EACL,EAAGA,EAAE,EACL,GAAI,OAAOA,EAAE,EAAE,EACf,MAAOA,EAAE,MACT,MAAOA,EAAE,KAC7B,EAAkB,CAAC,EACC,KAAK,QAAQ,OAAS,IAAI,KAAK,QAAQ,MAAK,EAChD,KAAK,QAAQ,KAAK2P,CAAQ,EAC1B,QAAQ,IAAI,2CAA4C,KAAK,QAAQ,MAAM,CAC/E,CAEA,MAAO,CAEH,GADA,QAAQ,IAAI,wCAAyC,KAAK,QAAQ,MAAM,EACpE,KAAK,QAAQ,SAAW,EAAG,CAC3B,KAAK,UAAU,iBAAiB,EAChC,MACJ,CAEA,MAAMC,EAAY,KAAK,QAAQ,IAAG,EAC9BA,GACA,KAAK,MAAQ,KAAK,MAAMA,CAAS,EACjC,QAAQ,IAAI,6BAA8B,KAAK,MAAM,OAAQ,OAAO,GAEpE,KAAK,MAAQ,GAGjB,KAAK,KAAI,EACT,KAAK,UAAU,WAAW,KAAK,QAAQ,MAAM,aAAa,CAC9D,CAEA,cAAe,CACX,SAAS,eAAe,YAAY,EAAE,UAAU,IAAI,QAAQ,CAChE,CAEA,YAAa,CACT,SAAS,eAAe,YAAY,EAAE,UAAU,OAAO,QAAQ,CACnE,CAEA,cAAe,CACX,KAAK,UAAS,EACd,KAAK,MAAQ,GACb,KAAK,OAAS,CAAE,EAAG,EAAG,EAAG,EAAG,KAAM,CAAC,EACnC,KAAK,WAAU,EACf,KAAK,KAAI,EACT,KAAK,UAAU,mBAAmB,CACtC,CAEA,WAAY,CACR,KAAK,OAAS,CAAE,EAAG,EAAG,EAAG,EAAG,KAAM,CAAC,CACvC,CAEA,WAAWC,EAAO,CACd,KAAK,OAAO,KAAO,KAAK,IAAI,GAAK,KAAK,IAAI,EAAG,KAAK,OAAO,KAAOA,CAAK,CAAC,EAGlE,KAAK,YAAc,KAAK,aACxB,KAAK,OAAO,EAAI,CAAC,KAAK,WAAW,EAAI,KAAK,OAAO,KACjD,KAAK,OAAO,EAAI,CAAC,KAAK,WAAW,EAAI,KAAK,OAAO,KAEzD,CAEA,qBAAqBC,EAAO,CAGxB,MAAMC,EAAWD,EAAM,KAAK9P,GAAKA,EAAE,WAAa,MAAM,WAAWA,EAAE,SAAS,CAAC,CAAC,EAC9E,GAAI+P,EAAU,OAAOA,EAAS,UAE9B,MAAMC,EAAYF,EAAM,IAAI9P,GAAK,OAAOA,EAAE,EAAE,CAAC,EAAE,KAAK,CAAC4O,EAAGzH,IAAMyH,EAAE,cAAczH,CAAC,CAAC,EAChF,IAAI/F,EAAO,EACX4O,EAAU,QAAQ,CAACC,EAAI5Q,IAAM,CACzB,QAASgP,EAAI,EAAGA,EAAI4B,EAAG,OAAQ5B,IAC3BjN,GAAQ6O,EAAG,WAAW5B,CAAC,GAAKA,EAAI,IAAMhP,EAAI,EAElD,CAAC,EACD+B,EAAO,KAAK,MAAMA,CAAI,EAEtB,MAAM8O,EAAM,KAAK,SAAS9O,EAAO,KAAK,SAAS,MAAM,EAC/C+O,EAAO,KAAK,MAAO/O,EAAO,GAAM,KAAK,MAAM,MAAM,EACjDgP,EAAM,KAAK,SAAUhP,EAAO,EAAK,KAAK,SAAS,MAAM,EAErDe,EAAOf,EAAO,EACpB,OAAIe,IAAS,EAAU,GAAG+N,CAAG,IAAIC,CAAI,GACjChO,IAAS,EAAU,GAAGgO,CAAI,IAAIC,CAAG,GAC9B,OAAOF,CAAG,IAAIC,CAAI,IAAIC,CAAG,EACpC,CAMA,oBAAqB,CACjB,GAAI,CAEA,KAAK,OAAO,eAAiB,GAC7B,KAAK,YAAc,GACnB,KAAK,SAAW,GAChB,KAAK,WAAa,GAClB,KAAK,cAAgB,GACrB,KAAK,gBAAkB,GACvB,KAAK,QAAU,GACf,KAAK,WAAa,GAClB,KAAK,cAAgB,GAGrB,GAAI,CACA,MAAMhT,EAAe,aAAa,QAAQ,oBAAoB,EAC9D,KAAK,aAAeA,EAAe,KAAK,MAAMA,CAAY,EAAI,GAC9D,KAAK,iBAAmB,aAAa,QAAQ,kBAAkB,GAAK,EACxE,OAASY,EAAG,CACR,QAAQ,KAAK,kCAAmCA,CAAC,EACjD,KAAK,aAAe,GACpB,KAAK,iBAAmB,EAC5B,CAGA,GAAI,CACA,KAAK,oBAAmB,CAC5B,OAASA,EAAG,CACR,QAAQ,MAAM,yCAA0CA,CAAC,EACzD,KAAK,YAAc,EACvB,CAIA,GAAI,KAAK,aAAa,IAAI,YAAY,EAClC,GAAI,CACA,KAAK,uBAAsB,CAC/B,OAASA,EAAG,CACR,QAAQ,MAAM,4CAA6CA,CAAC,CAChE,CAEJ,GAAI,KAAK,aAAa,IAAI,QAAQ,EAC9B,GAAI,CACA,KAAK,oBAAmB,CAC5B,OAASA,EAAG,CACR,QAAQ,MAAM,yCAA0CA,CAAC,CAC7D,CAEJ,GAAI,KAAK,aAAa,IAAI,OAAO,EAC7B,GAAI,CACA,KAAK,mBAAkB,CAC3B,OAASA,EAAG,CACR,QAAQ,MAAM,wCAAyCA,CAAC,CAC5D,CAEJ,GAAI,KAAK,aAAa,IAAI,OAAO,EAC7B,GAAI,CACA,KAAK,mBAAkB,CAC3B,OAASA,EAAG,CACR,QAAQ,MAAM,wCAAyCA,CAAC,CAC5D,CAER,OAASA,EAAG,CACR,QAAQ,MAAM,mDAAoDA,CAAC,EACnE,KAAK,UAAU,mDAAmD,EAElE,KAAK,YAAc,KAAK,aAAe,GACvC,KAAK,SAAW,KAAK,UAAY,GACjC,KAAK,WAAa,KAAK,YAAc,GACrC,KAAK,cAAgB,KAAK,eAAiB,GAC3C,KAAK,gBAAkB,KAAK,iBAAmB,GAC/C,KAAK,QAAU,KAAK,SAAW,GAC/B,KAAK,WAAa,KAAK,YAAc,GACrC,KAAK,cAAgB,KAAK,eAAiB,EAC/C,CACJ,CAEA,qBAAsB,WAElB,KAAK,YAAc,GAGnB,MAAMM,EAAQ,KAAK,WAAa,IAAM,IAGhC8L,IAAKtL,EAAA,SAAS,eAAe,YAAY,IAApC,YAAAA,EAAuC,QAAS,UACrDuL,IAAKrL,EAAA,SAAS,eAAe,YAAY,IAApC,YAAAA,EAAuC,QAAS,UACrDsL,IAAKC,EAAA,SAAS,eAAe,YAAY,IAApC,YAAAA,EAAuC,QAAS,UACrD8F,EAAe,CAACjG,EAAIC,EAAIC,CAAE,EAEhC,KAAK,WAAa+F,EAGlB,MAAM5L,EAAI,KAAK,OAAO,MAChBC,EAAI,KAAK,OAAO,OAChB4L,EAAU7L,EAAI,EACd8L,EAAU7L,EAAI,EACd8L,EAAU/L,EAAI,GACdgM,EAAU/L,EAAI,GAEpB,QAASrF,EAAI,EAAGA,EAAIf,EAAOe,IAAK,CAC5B,IAAIgC,EAAG,EAAGqP,EAAK,EAAGC,EAAK,EAEvB,GAAI,KAAK,WAAY,CAEjB,MAAM7L,EAAQ,KAAK,OAAM,EAAK,KAAK,GAAK,EAClCpF,EAAO,KAAK,OAAM,EAAK,KAAK,IAAI+E,EAAGC,CAAC,EAAI,GAC9CrD,EAAIiP,EAAU,KAAK,IAAIxL,CAAK,EAAIpF,EAChC,EAAI6Q,EAAU,KAAK,IAAIzL,CAAK,EAAIpF,EAEhC,MAAMkR,EAAQ,EAAI,KAAK,OAAM,EAAK,GAClCF,EAAK,KAAK,IAAI5L,CAAK,EAAI8L,EACvBD,EAAK,KAAK,IAAI7L,CAAK,EAAI8L,CAC3B,SAEIvP,EAAI,KAAK,OAAM,EAAKmP,EAAUA,EAAU,EAAIF,EAC5C,EAAI,KAAK,OAAM,EAAKG,EAAUA,EAAU,EAAIF,EAExC,KAAK,YAAa,CAElB,MAAMzL,EAAQ,KAAK,OAAM,EAAK,KAAK,GAAK,EAClC8L,EAAQ,GAAM,KAAK,OAAM,EAAK,GACpCF,EAAK,KAAK,IAAI5L,CAAK,EAAI8L,EACvBD,EAAK,KAAK,IAAI7L,CAAK,EAAI8L,CAC3B,CAIJ,MAAMC,EAAa,GAAM,KAAK,OAAM,EAAK,GACzC,KAAK,YAAY,KAAK,CAClB,EAAGxP,EACH,EACA,GAAIqP,EACJ,GAAIC,EACJ,MAAO,KAAK,OAAM,EAAK,IAAM,IAAOE,EACpC,MAAO,KAAK,OAAM,EAAK,GAAM,GAC7B,UAAW,KAAK,OAAM,EAAK,GAAM,GACjC,MAAOR,EAAa,KAAK,MAAM,KAAK,OAAM,EAAKA,EAAa,MAAM,CAAC,EACnE,MAAOQ,CAC/B,CAAqB,CACL,CACJ,CAGA,cAActB,EAAK,CACf,MAAMuB,EAAM,KAAK,SAASvB,CAAG,EACvBnN,EAAI0O,EAAI,CAAC,EAAI,IAAKrB,EAAIqB,EAAI,CAAC,EAAI,IAAK3J,EAAI2J,EAAI,CAAC,EAAI,IACjDC,EAAM,KAAK,IAAI3O,EAAGqN,EAAGtI,CAAC,EAAG6J,EAAM,KAAK,IAAI5O,EAAGqN,EAAGtI,CAAC,EACrD,IAAIzC,EAAI,EACR,GAAIqM,IAAQC,EAAK,CACb,MAAMlP,EAAIiP,EAAMC,EACZD,IAAQ3O,EAAGsC,IAAM+K,EAAItI,GAAKrF,GAAK2N,EAAItI,EAAI,EAAI,IAAM,EAC5C4J,IAAQtB,EAAG/K,IAAMyC,EAAI/E,GAAKN,EAAI,GAAK,EACvC4C,IAAMtC,EAAIqN,GAAK3N,EAAI,GAAK,CACjC,CACA,OAAO,KAAK,MAAM4C,EAAI,GAAG,CAC7B,CAGA,SAASA,EAAG1E,EAAGiR,EAAG,CACdjR,GAAK,IAAKiR,GAAK,IACf,MAAMlT,EAAIoM,IAAMA,EAAIzF,EAAI,IAAM,GACxBkK,EAAI5O,EAAI,KAAK,IAAIiR,EAAG,EAAIA,CAAC,EACzBC,EAAI/G,GAAK8G,EAAIrC,EAAI,KAAK,IAAI,GAAI,KAAK,IAAI7Q,EAAEoM,CAAC,EAAI,EAAG,KAAK,IAAI,EAAIpM,EAAEoM,CAAC,EAAG,CAAC,CAAC,CAAC,EACvEgH,EAAQ9P,GAAK,KAAK,MAAMA,EAAI,GAAG,EAAE,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,EACnE,MAAO,IAAI8P,EAAMD,EAAE,CAAC,CAAC,CAAC,GAAGC,EAAMD,EAAE,CAAC,CAAC,CAAC,GAAGC,EAAMD,EAAE,CAAC,CAAC,CAAC,EACtD,CAEA,wBAAyB,CACP,KAAK,UAEnB,MAAME,EAAS,IAQTC,EAAY,IAClB,QAAShS,EAAI,EAAGA,EAAIgS,EAAWhS,IAAK,CAChC,MAAMiS,EAAO,KAAK,OAAM,EACxB,IAAI5R,EAAM6G,EACN+K,EAAO,IACP5R,EAAO,KAAK,OAAM,EAAK,IACvB6G,EAAO,GAAM,KAAK,OAAM,EAAK,GACtB+K,EAAO,IACd5R,EAAO,IAAM,KAAK,OAAM,EAAK,KAC7B6G,EAAO,EAAM,KAAK,OAAM,EAAK,MAE7B7G,EAAO,IAAO,KAAK,OAAM,EAAK,IAC9B6G,EAAO,IAAM,KAAK,OAAM,EAAK,GAEjC,MAAMzB,EAAQ,KAAK,OAAM,EAAK,KAAK,GAAK,EACxC,KAAK,gBAAgB,KAAK,CACtB,EAAG,KAAK,IAAIA,CAAK,EAAIpF,EACrB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,EAAI,KAAK,OAAM,EAAK0R,EAAUA,EAAS,EACvC,EAAG7K,EACH,MAAO,IAAO,KAAK,SAAW,EACtD,CAAqB,CACL,CAGsB,CAClB,CAAE,MAAO,EAAG,QAAS,IAAK,QAAS,IAAK,QAAS,GAAI,QAAS,GAAG,EACjE,CAAE,MAAO,EAAG,QAAS,IAAK,QAAS,IAAM,QAAS,IAAK,QAAS,GAAG,EACnE,CAAE,MAAO,EAAG,QAAS,IAAM,QAAS,IAAM,QAAS,IAAK,QAAS,GAAG,CACxF,EAC8B,QAAQgL,GAAO,CACzB,QAASlS,EAAI,EAAGA,EAAIkS,EAAI,MAAOlS,IAAK,CAChC,MAAMK,EAAO6R,EAAI,QAAU,KAAK,OAAM,GAAMA,EAAI,QAAUA,EAAI,SACxDzM,EAAQ,KAAK,OAAM,EAAK,KAAK,GAAK,EACxC,KAAK,SAAS,KAAK,CACf,EAAG,KAAK,IAAIA,CAAK,EAAIpF,EACrB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,EAAI,KAAK,OAAM,EAAK0R,EAAUA,EAAS,EAEvC,MAAO,CAAC,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,SAAS,EAAE,KAAK,MAAM,KAAK,OAAM,EAAK,CAAC,CAAC,EAC7H,MAAO,KAAK,OAAM,EAAK,KAAK,GAAK,EACjC,KAAMG,EAAI,QAAU,KAAK,OAAM,GAAMA,EAAI,QAAUA,EAAI,QACnF,CAAyB,CACL,CACJ,CAAC,EAGwB,CACrB,CAAE,QAAS,IAAK,QAAS,IAAK,QAAS,GAAI,QAAS,EAAE,EACtD,CAAE,QAAS,IAAK,QAAS,IAAM,QAAS,GAAI,QAAS,EAAE,EACvD,CAAE,QAAS,KAAM,QAAS,IAAM,QAAS,GAAI,QAAS,GAAG,CAC7E,EACiC,QAAQA,GAAO,CAC5B,MAAM7R,EAAO6R,EAAI,QAAU,KAAK,OAAM,GAAMA,EAAI,QAAUA,EAAI,SACxDzM,EAAQ,KAAK,OAAM,EAAK,KAAK,GAAK,EACxC,KAAK,WAAW,KAAK,CACjB,EAAG,KAAK,IAAIA,CAAK,EAAIpF,EACrB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,EAAI,KAAK,OAAM,EAAK0R,EAAUA,EAAS,EACvC,KAAMG,EAAI,QAAU,KAAK,OAAM,GAAMA,EAAI,QAAUA,EAAI,QAC/E,CAAqB,CACL,CAAC,EAGqB,CAClB,CAAE,MAAO,EAAG,QAAS,GAAI,QAAS,IAAK,QAAS,IAAK,QAAS,GAAG,EACjE,CAAE,MAAO,EAAG,QAAS,IAAK,QAAS,KAAM,QAAS,IAAK,QAAS,GAAG,EACnE,CAAE,MAAO,EAAG,QAAS,KAAM,QAAS,IAAM,QAAS,IAAK,QAAS,IAAI,CACzF,EAC8B,QAAQA,GAAO,CACzB,QAASlS,EAAI,EAAGA,EAAIkS,EAAI,MAAOlS,IAAK,CAChC,MAAMK,EAAO6R,EAAI,QAAU,KAAK,OAAM,GAAMA,EAAI,QAAUA,EAAI,SACxDzM,EAAQ,KAAK,OAAM,EAAK,KAAK,GAAK,EACxC,KAAK,QAAQ,KAAK,CACd,EAAG,KAAK,IAAIA,CAAK,EAAIpF,EACrB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,EAAI,KAAK,OAAM,EAAK0R,EAAUA,EAAS,EACvC,KAAMG,EAAI,QAAU,KAAK,OAAM,GAAMA,EAAI,QAAUA,EAAI,SACvD,MAAO,CAAC,UAAW,UAAW,UAAW,UAAW,UAAW,SAAS,EAAE,KAAK,MAAM,KAAK,OAAM,EAAK,CAAC,CAAC,EACvG,MAAO,IAAO,KAAK,SAAW,EAC1D,CAAyB,CACL,CACJ,CAAC,EAGD,KAAK,QAAU,GACf,MAAMC,EAAc,CAChB,CAAE,KAAM,YAAa,OAAQ,CAAC,UAAW,UAAW,SAAS,EAAG,cAAe,EAAI,EACnF,CAAE,KAAM,YAAa,OAAQ,CAAC,UAAW,UAAW,SAAS,EAAG,cAAe,EAAI,EACnF,CAAE,KAAM,cAAe,OAAQ,CAAC,UAAW,UAAW,SAAS,EAAG,cAAe,EAAI,EACrF,CAAE,KAAM,SAAU,OAAQ,CAAC,UAAW,UAAW,SAAS,EAAG,cAAe,EAAK,EACjF,CAAE,KAAM,WAAY,OAAQ,CAAC,UAAW,UAAW,SAAS,EAAG,cAAe,EAAI,EAClF,CAAE,KAAM,QAAS,OAAQ,CAAC,UAAW,UAAW,SAAS,EAAG,cAAe,EAAI,CACnG,EACsBC,EAAgB,CAClB,CAAE,MAAO,EAAG,QAAS,IAAK,QAAS,IAAK,UAAW,GAAI,UAAW,EAAE,EACpE,CAAE,MAAO,EAAG,QAAS,IAAK,QAAS,KAAM,UAAW,GAAI,UAAW,GAAG,EACtE,CAAE,MAAO,EAAG,QAAS,KAAM,QAAS,IAAM,UAAW,GAAI,UAAW,GAAG,CAC3F,EAGsBC,EAAe,CAACnC,EAAKoC,EAAS,KAAO,CACvC,GAAI,CAACpC,GAAO,CAACA,EAAI,WAAW,GAAG,EAAG,OAAOA,EACzC,IAAInN,EAAI,SAASmN,EAAI,MAAM,EAAG,CAAC,EAAG,EAAE,EAChCE,EAAI,SAASF,EAAI,MAAM,EAAG,CAAC,EAAG,EAAE,EAChCpI,EAAI,SAASoI,EAAI,MAAM,EAAG,CAAC,EAAG,EAAE,EAEpC,OAAAnN,EAAI,KAAK,IAAI,IAAK,KAAK,IAAI,EAAGA,GAAK,KAAK,OAAM,EAAK,IAAOuP,EAAS,CAAC,CAAC,EACrElC,EAAI,KAAK,IAAI,IAAK,KAAK,IAAI,EAAGA,GAAK,KAAK,OAAM,EAAK,IAAOkC,EAAS,CAAC,CAAC,EACrExK,EAAI,KAAK,IAAI,IAAK,KAAK,IAAI,EAAGA,GAAK,KAAK,OAAM,EAAK,IAAOwK,EAAS,CAAC,CAAC,EAE9D,KAAKvP,EAAI,GAAG,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,CAAC,IAAIqN,EAAI,GAAG,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,CAAC,IAAItI,EAAI,GAAG,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,CAAC,EACpI,EAGMyK,EAAqB,CAACvQ,EAAGa,EAAG4M,EAAG+C,IAAW,CAI5C,UAAW9B,KAAY,KAAK,QAAS,CACjC,MAAM/O,EAAKK,EAAI0O,EAAS,EAClB9O,EAAKiB,EAAI6N,EAAS,EAClBlH,EAAKiG,EAAIiB,EAAS,EAGlB+B,EAAS,KAAK,KAAK9Q,EAAKA,EAAKC,EAAKA,CAAE,EACpC8Q,EAAaF,EAAS9B,EAAS,OAAS,IAM9C,GAAI+B,EAASC,GACL,KAAK,IAAIlJ,CAAE,EAAI,IAAa,MAAO,EAE/C,CACA,MAAO,EACX,EAGMmJ,EAAc,CAChB,CAAE,KAAM,KAAO,KAAM,IAAI,EACzB,CAAE,KAAM,KAAM,KAAM,GAAG,EACvB,CAAE,KAAM,IAAK,KAAM,IAAI,CAC3C,EAEgBP,EAAc,QAAQ,CAACF,EAAKU,IAAc,CACtC,MAAMC,EAAQF,EAAYC,CAAS,EAEnC,QAAS5S,EAAI,EAAGA,EAAIkS,EAAI,MAAOlS,IAAK,CAChC,MAAM8C,EAAOqP,EAAY,KAAK,MAAM,KAAK,OAAM,EAAKA,EAAY,MAAM,CAAC,EACjEW,EAAW,KAAK,OAAM,EAAK,GAC3BN,EAASN,EAAI,UAAY,KAAK,OAAM,GAAMA,EAAI,UAAYA,EAAI,WAGpE,IAAIlQ,EAAGa,EAAG4M,EAAGsD,EAAW,EACxB,EAAG,CACC,MAAM1S,EAAO6R,EAAI,QAAU,KAAK,OAAM,GAAMA,EAAI,QAAUA,EAAI,SACxDzM,EAAQ,KAAK,OAAM,EAAK,KAAK,GAAK,EACxCzD,EAAI,KAAK,IAAIyD,CAAK,EAAIpF,EACtBwC,EAAI,KAAK,IAAI4C,CAAK,EAAIpF,EAEtBoP,EAAIoD,EAAM,KAAO,KAAK,OAAM,GAAMA,EAAM,KAAOA,EAAM,MACrDE,GACJ,OAAS,CAACR,EAAmBvQ,EAAGa,EAAG4M,EAAG+C,CAAM,GAAKO,EAAW,IAE5D,KAAK,QAAQ,KAAK,CACd,EAAG/Q,EACH,EAAGa,EACH,EAAG4M,EACH,OAAQ+C,EACR,KAAM1P,EAAK,KAEX,UAAWuP,EAAavP,EAAK,OAAO,CAAC,EAAG,EAAE,EAC1C,eAAgBuP,EAAavP,EAAK,OAAO,CAAC,EAAG,EAAE,EAC/C,cAAeuP,EAAavP,EAAK,OAAO,CAAC,EAAG,EAAE,EAC9C,cAAeA,EAAK,cACpB,gBAAiBA,EAAK,OAAS,YAAc,UAAaA,EAAK,OAAS,WAAa,UAAY,UACjG,SAAUgQ,EACV,UAAWA,EAAW,OAAO,KAAK,SAAW,GAAG,KAAK,GAAK,KAAK,SAAW,EAAE,MAAM,GAAK,KAAK,SAAW,EAAE,KAAO,KAChH,gBAAiBN,EAAS,IAC1B,gBAAiBA,EAAS,IAC1B,YAAa,KAAK,OAAM,EAAK,IAC7B,SAAU,KAAK,OAAM,EAAK,KAAK,GAAK,EACpC,WAAY,KAAK,OAAM,EAAK,IAAO,EAC/D,CAAyB,CACL,CACJ,CAAC,EAGD,KAAK,cAAgB,GACrB,MAAMQ,EAAoB,GAC1B,QAAShT,EAAI,EAAGA,EAAIgT,EAAmBhT,IAAK,CACxC,MAAMyF,EAAQ,KAAK,OAAM,EAAK,KAAK,GAAK,EAClCpF,EAAO,IAAM,KAAK,OAAM,EAAK,IACnC,KAAK,cAAc,KAAK,CACpB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,EAAI,KAAK,OAAM,EAAK0R,EAAUA,EAAS,EACvC,IAAK,KAAK,OAAM,EAAK,IAAO,EAC5B,IAAK,KAAK,OAAM,EAAK,IAAO,EAC5B,KAAM,EAAI,KAAK,OAAM,EAAK,EAC1B,WAAY,GAAK,KAAK,OAAM,EAAK,GACjC,MAAO,CAAC,UAAW,UAAW,UAAW,SAAS,EAAE,KAAK,MAAM,KAAK,OAAM,EAAK,CAAC,CAAC,EACjF,MAAO,GAAM,KAAK,SAAW,EACrD,CAAqB,CACL,CACJ,CAEA,qBAAsB,CAIlB,MAAMkB,EAAgB,CAClB,CAAE,MAAO,EAAG,QAAS,GAAI,QAAS,IAAK,QAAS,IAAK,QAAS,GAAG,EACjE,CAAE,MAAO,GAAI,QAAS,IAAK,QAAS,KAAM,QAAS,IAAK,QAAS,GAAG,EACpE,CAAE,MAAO,GAAI,QAAS,KAAM,QAAS,IAAM,QAAS,IAAK,QAAS,IAAI,CAC1F,EACsBC,EAAS,CAAC,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,SAAS,EAEtGD,EAAc,QAAQf,GAAO,CACzB,QAASlS,EAAI,EAAGA,EAAIkS,EAAI,MAAOlS,IAAK,CAChC,MAAMK,EAAO6R,EAAI,QAAU,KAAK,OAAM,GAAMA,EAAI,QAAUA,EAAI,SACxDzM,EAAQ,KAAK,OAAM,EAAK,KAAK,GAAK,EACxC,KAAK,QAAQ,KAAK,CACd,EAAG,KAAK,IAAIA,CAAK,EAAIpF,EACrB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,EAAI,KAAK,OAAM,EAAK,IAAU,IAAS,EACvC,KAAM6R,EAAI,QAAU,KAAK,OAAM,GAAMA,EAAI,QAAUA,EAAI,SACvD,MAAOgB,EAAO,KAAK,MAAM,KAAK,OAAM,EAAKA,EAAO,MAAM,CAAC,EACvD,MAAO,IAAO,KAAK,SAAW,GAC1D,CAAyB,CACL,CACJ,CAAC,EAGD,MAAMlB,EAAY,IAClB,QAAShS,EAAI,EAAGA,EAAIgS,EAAWhS,IAAK,CAChC,MAAMiS,EAAO,KAAK,OAAM,EACxB,IAAI5R,EAAM6G,EACN+K,EAAO,IACP5R,EAAO,KAAK,OAAM,EAAK,IACvB6G,EAAO,GAAM,KAAK,OAAM,EAAK,GACtB+K,EAAO,IACd5R,EAAO,IAAM,KAAK,OAAM,EAAK,IAC7B6G,EAAO,EAAM,KAAK,OAAM,EAAK,MAE7B7G,EAAO,KAAO,KAAK,OAAM,EAAK,KAC9B6G,EAAO,IAAM,KAAK,OAAM,EAAK,KAEjC,MAAMzB,EAAQ,KAAK,OAAM,EAAK,KAAK,GAAK,EACxC,KAAK,gBAAgB,KAAK,CACtB,EAAG,KAAK,IAAIA,CAAK,EAAIpF,EACrB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,EAAI,KAAK,OAAM,EAAK,IAAU,IAAS,EACvC6G,EACA,MAAO,GAAM,KAAK,SAAW,EACrD,CAAqB,CACL,CACJ,CAEA,oBAAqB,CAIjB,MAAMiM,EAAQ,KAAK,OAAM,EACzB,IAAIC,EAAQC,EACRF,EAAQ,KAAQC,EAAS,UAAWC,EAAS,WACxCF,EAAQ,KAAQC,EAAS,UAAWC,EAAS,YAC/CD,EAAS,UAAWC,EAAS,WAGpC,MAAMrB,EAAY,KAClB,QAAShS,EAAI,EAAGA,EAAIgS,EAAWhS,IAAK,CAChC,MAAMiS,EAAO,KAAK,OAAM,EACxB,IAAI5R,EAAM6G,EACN+K,EAAO,IACP5R,EAAO,KAAK,OAAM,EAAK,IACvB6G,EAAO,GAAM,KAAK,OAAM,EAAK,IACtB+K,EAAO,IACd5R,EAAO,IAAM,KAAK,OAAM,EAAK,IAC7B6G,EAAO,GAAM,KAAK,OAAM,EAAK,KAE7B7G,EAAO,KAAO,KAAK,OAAM,EAAK,KAC9B6G,EAAO,GAAM,KAAK,OAAM,EAAK,KAEjC,MAAMzB,EAAQ,KAAK,OAAM,EAAK,KAAK,GAAK,EACxC,KAAK,gBAAgB,KAAK,CACtB,EAAG,KAAK,IAAIA,CAAK,EAAIpF,EACrB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,EAAI,KAAK,OAAM,EAAK,IAAU,IAAS,EACvC,EAAG6G,EACH,MAAO,GAAM,KAAK,OAAM,EAAK,GAC7B,MAAO,KAAK,SAAW,GAAMkM,EAASC,CAC9D,CAAqB,CACL,CAGA,MAAMC,EAAc,CAChB,CAAE,KAAM,SAAU,SAAU,GAAI,WAAY,OAAQ,OAAQ,CAAC,EAC7D,CAAE,KAAM,mBAAoB,SAAU,IAAK,WAAY,OAAQ,OAAQ,CAAC,EACxE,CAAE,KAAM,gBAAiB,SAAU,GAAI,WAAY,OAAQ,OAAQ,CAAC,EACpE,CAAE,KAAM,eAAgB,SAAU,GAAI,WAAY,SAAU,OAAQ,CAAC,EACrE,CAAE,KAAM,iBAAkB,SAAU,GAAI,WAAY,OAAQ,OAAQ,CAAC,EACrE,CAAE,KAAM,eAAgB,SAAU,GAAI,WAAY,OAAQ,OAAQ,CAAC,EACnE,CAAE,KAAM,eAAgB,SAAU,IAAK,WAAY,SAAU,OAAQ,CAAC,EACtE,CAAE,KAAM,kBAAmB,SAAU,GAAI,WAAY,MAAO,OAAQ,CAAC,EACrE,CAAE,KAAM,gBAAiB,SAAU,IAAK,WAAY,SAAU,OAAQ,CAAC,EACvE,CAAE,KAAM,eAAgB,SAAU,GAAI,WAAY,OAAQ,OAAQ,CAAC,EACnE,CAAE,KAAM,cAAe,SAAU,GAAI,WAAY,OAAQ,OAAQ,CAAC,EAClE,CAAE,KAAM,eAAgB,SAAU,IAAK,WAAY,OAAQ,OAAQ,CAAC,EACpE,CAAE,KAAM,cAAe,SAAU,GAAI,WAAY,OAAQ,OAAQ,CAAC,CACtF,EAGsBC,EAAO,GACbD,EAAY,QAAQE,GAAM,CACtB,QAASpO,EAAI,EAAGA,EAAIoO,EAAG,OAAQpO,IAAKmO,EAAK,KAAKC,CAAE,CACpD,CAAC,EAGoB,CACjB,CAAE,MAAO,EAAG,QAAS,GAAI,QAAS,IAAK,UAAW,EAAG,EACrD,CAAE,MAAO,GAAI,QAAS,IAAK,QAAS,KAAM,UAAW,EAAG,EACxD,CAAE,MAAO,GAAI,QAAS,KAAM,QAAS,IAAM,UAAW,GAAG,CAC7E,EAE6B,QAAQtB,GAAO,CACxB,QAASlS,EAAI,EAAGA,EAAIkS,EAAI,MAAOlS,IAAK,CAChC,MAAMyT,EAAYF,EAAK,KAAK,MAAM,KAAK,OAAM,EAAKA,EAAK,MAAM,CAAC,EACxDG,EAAM,KAAK,OAAM,EAAK,IACtBxM,EAAOuM,EAAU,SAAWvB,EAAI,WAAa,GAAM,KAAK,OAAM,EAAK,IACnEyB,EAAWF,EAAU,OAAS,SAC9BpT,EAAO6R,EAAI,QAAU,KAAK,OAAM,GAAMA,EAAI,QAAUA,EAAI,SACxDzM,EAAQ,KAAK,OAAM,EAAK,KAAK,GAAK,EAExC,KAAK,WAAW,KAAK,CACjB,EAAG,KAAK,IAAIA,CAAK,EAAIpF,EACrB,EAAG,KAAK,IAAIoF,CAAK,EAAIpF,EACrB,EAAI,KAAK,OAAM,EAAK,IAAU,IAAS,EACvC,IAAK,KAAK,OAAM,EAAK,KAAQsT,EAAW,EAAI,GAC5C,IAAK,KAAK,OAAM,EAAK,KAAQA,EAAW,EAAI,GAC5C,KAAMzM,EACN,UAAWuM,EAAU,KACrB,WAAYA,EAAU,WACtB,UAAWE,EAAW,OAAOD,CAAG,cAAgB,OAAOA,CAAG,cAC1D,cAAeC,EAAW,OAAOD,CAAG,aAAe,OAAOA,CAAG,cAC7D,WAAYC,EAAW,OAAOD,CAAG,cAAgB,OAAOA,CAAG,cAC3D,YAAa,QAAQA,EAAM,KAAO,GAAG,eACrC,WAAY,QAAQA,EAAM,KAAO,GAAG,eACpC,WAAY,OAAO,KAAK,OAAM,EAAK,GAAK,GAAG,eAC3C,YAAa,OAAO,KAAK,OAAM,EAAK,EAAE,eACtC,WAAY,KAAK,OAAM,EAAK,KAAK,GAAK,EACtC,WAAY,KAAK,OAAM,EAAK,IAC5B,UAAW,GAAM,KAAK,OAAM,EAAK,GACjC,YAAaD,EAAU,OAAS,aAAe,EAAKA,EAAU,OAAS,YAAc,EAAKA,EAAU,OAAS,UAAY,EAAI,EAC7H,UAAW,OAAO,KAAK,OAAM,EAAK,IAAM,GAAG,cAC3C,WAAY,KAAK,OAAM,EAAK,GAC5B,UAAW,OAAO,KAAK,OAAM,EAAK,GAAK,EAAE,eACzC,UAAWE,EAAW,KAAK,MAAM,KAAK,SAAW,CAAC,EAAI,EAAI,EAC1D,eAAgB,KAAK,OAAM,EAAK,IAAO,IACvC,SAAU,KAAK,OAAM,EAAK,KAAK,GAAK,EACpC,UAAW,KAAK,OAAM,EAAK,GAC3B,YAAa,OAAO,KAAK,OAAM,EAAK,GAAK,GAAG,cAC5C,YAAa,KAAK,SAAW,KAAK,GAAK,CACnE,CAAyB,CACL,CACJ,CAAC,CACL,CAEA,oBAAqB,CAEjB,KAAK,sBAAwB,GAG7B,KAAK,cAAgB,GACrB,MAAMC,EAAW,GACXC,EAAU,KAAK,KAAK,KAAK,OAAO,MAAQD,CAAQ,EAIhDE,EAAS,CACX,CAAE,KAAM,gBAAiB,MAAO,UAAW,OAAQ,QAAQ,EAC3D,CAAE,KAAM,YAAa,MAAO,UAAW,OAAQ,MAAM,EACrD,CAAE,KAAM,gBAAiB,MAAO,UAAW,OAAQ,MAAM,EACzD,CAAE,KAAM,aAAc,MAAO,UAAW,OAAQ,MAAM,EACtD,CAAE,KAAM,YAAa,MAAO,UAAW,OAAQ,MAAM,EACrD,CAAE,KAAM,cAAe,MAAO,UAAW,OAAQ,MAAM,EACvD,CAAE,KAAM,aAAc,MAAO,UAAW,OAAQ,QAAQ,EACxD,CAAE,KAAM,kBAAmB,MAAO,UAAW,OAAQ,MAAM,EAC3D,CAAE,KAAM,cAAe,MAAO,UAAW,OAAQ,MAAM,EACvD,CAAE,KAAM,cAAe,MAAO,UAAW,OAAQ,OAAO,EACxD,CAAE,KAAM,cAAe,MAAO,UAAW,OAAQ,QAAQ,EACzD,CAAE,KAAM,gBAAiB,MAAO,UAAW,OAAQ,MAAM,EACzD,CAAE,KAAM,cAAe,MAAO,UAAW,OAAQ,OAAO,EACxD,CAAE,KAAM,eAAgB,MAAO,UAAW,OAAQ,MAAM,EACxD,CAAE,KAAM,mBAAoB,MAAO,UAAW,OAAQ,QAAQ,EAC9D,CAAE,KAAM,eAAgB,MAAO,UAAW,OAAQ,OAAO,EACzD,CAAE,KAAM,kBAAmB,MAAO,UAAW,OAAQ,MAAM,EAC3D,CAAE,KAAM,gBAAiB,MAAO,UAAW,OAAQ,MAAM,EACzD,CAAE,KAAM,cAAe,MAAO,UAAW,OAAQ,QAAQ,EACzD,CAAE,KAAM,WAAY,MAAO,UAAW,OAAQ,MAAM,EACpD,CAAE,KAAM,iBAAkB,MAAO,UAAW,OAAQ,MAAM,EAC1D,CAAE,KAAM,gBAAiB,MAAO,UAAW,OAAQ,SAAS,CAChF,EAIsBC,EAAa,KAAK,kBAAoB,GAE5C,IAAIC,EAAkBF,EAAO,OAAO3E,GAAK,CAAC,KAAK,aAAa,SAASA,EAAE,IAAI,CAAC,EAG5E,MAAM8E,EAAiBD,EAAgB,OAAO7E,GAAKA,EAAE,SAAW4E,CAAU,EACtEE,EAAe,OAAS,IACxBD,EAAkBC,GAItB,IAAIV,EAAOS,EACX,GAAIT,EAAK,SAAW,EAAG,CACnB,MAAMW,EAAY,KAAK,aAAa,KAAK,aAAa,OAAS,CAAC,EAChEX,EAAOO,EAAO,OAAO3E,GAAKA,EAAE,OAAS+E,CAAS,CAClD,CAEA,MAAMC,EAAa,KAAK,MAAM,KAAK,OAAM,EAAKZ,EAAK,MAAM,EACnDJ,EAAQI,EAAKY,CAAU,EAG7B,KAAK,aAAa,KAAKhB,EAAM,IAAI,EAC7B,KAAK,aAAa,OAAS,GAC3B,KAAK,aAAa,QAEtB,KAAK,iBAAmBA,EAAM,OAG9B,GAAI,CACA,aAAa,QAAQ,qBAAsB,KAAK,UAAU,KAAK,YAAY,CAAC,EAC5E,aAAa,QAAQ,mBAAoB,KAAK,gBAAgB,CAClE,OAASxU,EAAG,CACR,QAAQ,KAAK,sBAAuBA,CAAC,CACzC,CAEA,QAAQ,IAAI,sBAAsBwU,EAAM,IAAI,KAAKA,EAAM,MAAM,eAAe,KAAK,UAAU,KAAK,YAAY,CAAC,gBAAgBI,EAAK,MAAM,EAAE,EAE1I,KAAK,YAAcJ,EAGnB,MAAMiB,EAAc,CAChB,CAAE,KAAM,QAAS,MAAO,EAAG,EAC3B,CAAE,KAAM,OAAQ,MAAO,EAAG,EAC1B,CAAE,KAAM,SAAU,MAAO,CAAG,EAC5B,CAAE,KAAM,OAAQ,MAAO,CAAG,EAC1B,CAAE,KAAM,QAAS,MAAO,CAAG,EAC3B,CAAE,KAAM,YAAa,MAAO,CAAG,CACnD,EACsBC,EAAgBD,EAAY,KAAK,MAAM,KAAK,OAAM,EAAKA,EAAY,MAAM,CAAC,EAChF,KAAK,sBAAwBC,EAAc,MAE3C,KAAK,UAAU,gBAAgBlB,EAAM,IAAI,YAAYkB,EAAc,IAAI,SAAS,EAGhF,MAAMC,EAAY,SAAS,eAAe,oBAAoB,EAC1DA,IACAA,EAAU,UAAY,UAAUnB,EAAM,IAAI,cAAcA,EAAM,OAAO,OAAO,CAAC,EAAE,cAAgBA,EAAM,OAAO,MAAM,CAAC,CAAC,IAIxH,MAAMrH,EAAS,SAAS,eAAe,mBAAmB,EACpDyI,EAAc,SAAS,eAAe,kBAAkB,EAC1DzI,IAAQA,EAAO,MAAQ,KAAK,uBAC5ByI,IAAaA,EAAY,YAAc,KAAK,sBAAsB,QAAQ,CAAC,EAAI,KAEnF,QAASvU,EAAI,EAAGA,EAAI6T,EAAS7T,IAAK,CAC9B,MAAMwU,EAAQ,KAAK,SACbtN,EAAO,KAAK,MAAM,GAAKsN,EAAQ,EAAE,GAExB,EAAIA,EAAQ,EAAI,KAAK,OAAM,EAAK,GAAK,KAAK,sBAGzD,MAAMC,EAAM,IAAM,KAAK,MAAM,KAAK,OAAM,EAAK,GAAI,EAC3CC,EAAQ,GACd,QAAS1F,EAAI,EAAGA,EAAIyF,EAAKzF,IACrB0F,EAAM,KAAK,OAAO,aAAa,MAAS,KAAK,SAAW,EAAE,CAAC,EAI/D,IAAIC,EAAcxB,EAAM,MACpB,KAAK,sBACLwB,EAAc,KAAK,YACZxB,EAAM,OAAS,kBAGtBwB,EAAc,OADD3U,EAAI,IAAM6T,EAAW,GACV,gBAG5B,KAAK,cAAc,KAAK,CACpB,EAAG7T,EAAI4T,EACP,EAAG,CAAC,KAAK,OAAM,EAAK,KAAK,OAAO,OAAS1M,EAAOuN,EAChD,UAAY,EAAID,EAAQ,EAAI,KAAK,OAAM,EAAK,EAC5C,MAAOE,EACP,MAAOC,EACP,KAAMzN,EACN,QAAS,GAAMsN,EAAQ,EAC/C,CAAqB,CACL,CAEA,QAAQ,IAAI,sBAAsB,KAAK,cAAc,MAAM,sBAAsBX,CAAO,YAAYV,EAAM,IAAI,EAAE,CACpH,CAIA,QAAQ5M,EAAM,CASV,GAPI,KAAK,aACL,KAAK,iBAAgB,EACrB,KAAK,eAAc,EACnB,KAAK,gBAAe,GAIpB,KAAK,YAAc,KAAK,WAAW,OAAS,EAAG,CAE/C,MAAMqO,EADQ,KAAK,UACE,EACrB,KAAK,WAAW,QAAQjU,GAAK,CACzBA,EAAE,GAAKA,EAAE,GACTA,EAAE,GAAKA,EAAE,GAELA,EAAE,EAAIiU,IAAMjU,EAAE,EAAI,CAACiU,GACnBjU,EAAE,EAAI,CAACiU,IAAMjU,EAAE,EAAIiU,GACnBjU,EAAE,EAAIiU,IAAMjU,EAAE,EAAI,CAACiU,GACnBjU,EAAE,EAAI,CAACiU,IAAMjU,EAAE,EAAIiU,EAC3B,CAAC,CACL,CAGA,GAAI,KAAK,eAAiB,KAAK,cAAc,OAAS,EAAG,CAErD,MAAMA,EADQ,KAAK,UACE,EACrB,KAAK,cAAc,QAAQjU,GAAK,CAC5BA,EAAE,GAAKA,EAAE,GACTA,EAAE,GAAKA,EAAE,GAELA,EAAE,EAAIiU,IAAMjU,EAAE,EAAI,CAACiU,GACnBjU,EAAE,EAAI,CAACiU,IAAMjU,EAAE,EAAIiU,GACnBjU,EAAE,EAAIiU,IAAMjU,EAAE,EAAI,CAACiU,GACnBjU,EAAE,EAAI,CAACiU,IAAMjU,EAAE,EAAIiU,EAC3B,CAAC,CACL,CAGA,GAAI,CACA,IAAK,KAAK,aAAe,KAAK,aAAe,KAAK,aAAe,KAAK,YAAY,OAAS,EAAG,CAC1F,MAAMxP,EAAI,KAAK,OAAO,MAChBC,EAAI,KAAK,OAAO,OAChB4L,EAAU7L,EAAI,EACd8L,EAAU7L,EAAI,EAGpB,GAAI,KAAK,YAAc,KAAK,gBAAiB,CAEzC,MAAMwP,EAAe,KAAK,qBAAuB,EAE3CC,EAAa,KAAK,IAAI,KAAMD,EAAe,EAAE,EAE7CE,EAAY,IAClB,KAAK,UAAY,KAAK,WAAa,EACnC,KAAK,YAAcD,EAAa,KAAK,WAAaC,EAElD,KAAK,UAAY,KAAK,IAAI,KAAK,UAAW,IAAI,EAE1C,KAAK,UAAY,MAAM,KAAK,UAAY,EAChD,CAEA,KAAK,YAAY,QAAQ,GAAK,CAW1B,GATI,OAAO,EAAE,IAAO,WAAU,EAAE,GAAK,GACjC,OAAO,EAAE,IAAO,WAAU,EAAE,GAAK,GACjC,OAAO,EAAE,WAAc,WAAU,EAAE,UAAY,EAAE,OAAS,IAG1D,OAAO,EAAE,OAAU,WAAU,EAAE,MAAQ,EAAE,GACzC,OAAO,EAAE,OAAU,WAAU,EAAE,MAAQ,EAAE,IAGxC,KAAK,YAAc,KAAK,kBAAoB,CAAC,KAAK,YAAa,CAEhE,MAAMpT,EAAK,EAAE,EAAIsP,EACXrP,EAAK,EAAE,EAAIsP,EACX7Q,EAAO,KAAK,KAAKsB,EAAKA,EAAKC,EAAKA,CAAE,EAGlCoT,EAAiB,KAAK,WAAa,EAEnCC,EAAe,KAAK,IAAI,IAAMD,EAAgB,IAAK,EACnDE,GAAe,KAAK,OAAM,EAAK,IAAOD,EACtCE,EAAW9U,EAAO,EAAIsB,EAAKtB,EAAO,EAClC+U,EAAW/U,EAAO,EAAIuB,EAAKvB,EAAO,EAElCgV,EAAO,KAAK,IAAIH,CAAW,EAC3BI,EAAO,KAAK,IAAIJ,CAAW,EAC3BK,EAAOJ,EAAWE,EAAOD,EAAWE,EACpCE,EAAOL,EAAWG,EAAOF,EAAWC,EAGpCI,EAAc,EAAE,OAAS,GACzBC,EAAmB,EAAKrV,EAAO,KAAK,IAAI+E,EAAGC,CAAC,EAAK,IAEjDkM,EAAQyD,EAAgBU,EAAmB,KAAOD,EAGxD,EAAE,GAAKF,EAAOhE,EACd,EAAE,GAAKiE,EAAOjE,EAGd,MAAMoE,EAAU,KAAK,IAAIvQ,EAAGC,CAAC,EAAI,GACjC,GAAIhF,EAAOsV,GAAW,EAAE,EAAI,KAAO,EAAE,EAAIvQ,EAAI,IAAM,EAAE,EAAI,KAAO,EAAE,EAAIC,EAAI,GAAI,CAE1E,MAAMI,EAAQ,KAAK,OAAM,EAAK,KAAK,GAAK,EAElCmQ,EAAY,EAAI,KAAK,OAAM,EAAK,KAAK,OAAM,EAAK,GACtD,EAAE,EAAI3E,EAAU,KAAK,IAAIxL,CAAK,EAAImQ,EAClC,EAAE,EAAI1E,EAAU,KAAK,IAAIzL,CAAK,EAAImQ,EAClC,EAAE,MAAQ,IAEV,EAAE,MAAQ,GAAM,KAAK,OAAM,EAAK,GAChC,EAAE,MAAQ,KAAK,OAAM,EAAK,IAAM,IAAO,EAAE,KAC7C,KAAO,CAEH,MAAMC,EAAW,GAAMJ,EAAc,GACrC,EAAE,MAAQ,KAAK,IAAI,EAAG,IAAQpV,EAAOsV,EAAW,IAAOE,CAAQ,CACnE,CACJ,MAAW,KAAK,aAAe,CAAC,KAAK,aAEjC,EAAE,GAAK,EAAE,GAAK,IACd,EAAE,GAAK,EAAE,GAAK,IAGV,EAAE,EAAI,CAACzQ,EAAI,IAAG,EAAE,GAAKA,EAAI,IACzB,EAAE,EAAIA,EAAI,IAAG,EAAE,GAAKA,EAAI,IACxB,EAAE,EAAI,CAACC,EAAI,IAAG,EAAE,GAAKA,EAAI,IACzB,EAAE,EAAIA,EAAI,IAAG,EAAE,GAAKA,EAAI,IAEpC,CAAC,CACL,CACJ,OAAS,EAAG,CACR,QAAQ,MAAM,2CAA4C,CAAC,CAE/D,CAKA,GAAI,KAAK,YAAc,KAAK,gBACxB,GAAI,CACA,MAAMD,EAAI,KAAK,OAAO,MAChBC,EAAI,KAAK,OAAO,OAGhByQ,EAAS,KAAK,QAAU,CAAE,EAAG,EAAG,EAAG,EAAG,KAAM,CAAC,EAC7CxP,EAAOwP,EAAO,MAAQ,EACtBC,EAAqB,EAAED,EAAO,GAAK,GAAKxP,EACxC0P,EAAqB,EAAEF,EAAO,GAAK,GAAKxP,EAExC2P,EAAe,KAAK,UAAY,EAEhCjB,EAAgB,KAAK,WAAa,EAClCkB,EAAgB,KAAK,gBAGrBC,EAAY,CAACvJ,EAAKwJ,EAAkB,EAAGC,EAAY,MAAS,CAC9D,GAAKzJ,EAEL,GAAIsJ,EAAe,CAQf,GAHAtJ,EAAI,SAAW,GAGX,CAACA,EAAI,cAAe,CAGpB,MAAMnH,EAAQ,KAAK,OAAM,EAAK,KAAK,GAAK,EAClCkE,EAAW,IAAM,KAAK,OAAM,EAAK0M,EACjC7B,EAAQ,GAAM,KAAK,OAAM,EAAK,IAEpC5H,EAAI,OAASmJ,EAAqB,KAAK,IAAItQ,CAAK,EAAIkE,EACpDiD,EAAI,OAASoJ,EAAqB,KAAK,IAAIvQ,CAAK,EAAIkE,EACpDiD,EAAI,MAAQ4H,EAIZ5H,EAAI,OAASmJ,EACbnJ,EAAI,OAASoJ,EAGbpJ,EAAI,UAAY,IAChBA,EAAI,UAAY,EAEhBA,EAAI,cAAgB,EACxB,CAOA,MAAMJ,EAAW,EAAI,KAAK,IAAI,GAFVwI,GAAiB,GADrB,EAGsC,EAItDpI,EAAI,EAAIA,EAAI,QAAUA,EAAI,OAASA,EAAI,QAAUJ,EACjDI,EAAI,EAAIA,EAAI,QAAUA,EAAI,OAASA,EAAI,QAAUJ,EAKjD,MAAM8J,EAAO9J,EAAWA,EAAWA,EACnCI,EAAI,UAAY,IAAO0J,EAAO,IAC9B1J,EAAI,UAAY,KAAK,IAAI,EAAG,KAAK,IAAI,IAAMA,EAAI,SAAS,CAAC,EAIzD,MAAM2J,EAAa,IACbC,EAAgB,KAAK,IAAI,GAAIhK,EAAW+J,IAAe,EAAIA,EAAW,EAC5E3J,EAAI,UAAY4J,EAEhB,MAEJ,KAAO,CAGH,GAAI5J,EAAI,SAAU,OAGlB,MAAMjL,EAAKiL,EAAI,EAAImJ,EACbnU,EAAKgL,EAAI,EAAIoJ,EACb3V,EAAO,KAAK,KAAKsB,EAAKA,EAAKC,EAAKA,CAAE,EAGxC,GAAIvB,EAAO,EAAG,CACV,MAAMoF,EAAQ,KAAK,OAAM,EAAK,KAAK,GAAK,EACxCmH,EAAI,GAAK,KAAK,IAAInH,CAAK,EAAI,GAC3BmH,EAAI,GAAK,KAAK,IAAInH,CAAK,EAAI,GAC3B,MACJ,CAGA,MAAM8P,EAAO5T,EAAKtB,EACZmV,EAAO5T,EAAKvB,EAIZoW,EAAa,GAAK,KAAK,OAAO,MAAQ,GAEtCf,EAAmB,EAAKrV,EAAO,KAAK,UAAa,IACjDmU,EAAQ5H,EAAI,OAAS,GAErB2E,EAAQyD,EAAgBU,EAAmB,KAAOlB,EAAQ4B,EADtC,EAC4EK,EAGtG7J,EAAI,GAAK2I,EAAOhE,EAChB3E,EAAI,GAAK4I,EAAOjE,EAGZlR,EAAO4V,IACPrJ,EAAI,SAAW,GACfA,EAAI,YAAc,GAE1B,CACJ,EAIA,IAAI8J,EAAc,EACd,KAAK,SAAS,KAAK,QAAQ,QAAQ,CAAC1X,EAAGgB,IAAM,CAC7ChB,EAAE,MAAQA,EAAE,OAAS,GACrBA,EAAE,UAAY0X,IACdP,EAAUnX,EAAG,GAAK,GAAI,CAC1B,CAAC,EACG,KAAK,UAAU,KAAK,SAAS,QAAQ,CAACoR,EAAGpQ,IAAM,CAC/CoQ,EAAE,MAAQA,EAAE,OAAS,GACrBA,EAAE,UAAYsG,IACdP,EAAU/F,EAAG,GAAK,GAAI,CAC1B,CAAC,EACG,KAAK,YAAY,KAAK,WAAW,QAAQ,CAACuG,EAAI3W,IAAM,CACpD2W,EAAG,MAAQA,EAAG,OAAS,GACvBA,EAAG,UAAYD,IACfP,EAAUQ,EAAI,GAAK,GAAI,CAC3B,CAAC,EACG,KAAK,SAAS,KAAK,QAAQ,QAAQ,CAAC7L,EAAG9K,IAAM,CAC7C8K,EAAE,MAAQA,EAAE,OAAS,GACrBA,EAAE,UAAY4L,IACdP,EAAUrL,EAAG,GAAK,GAAI,CAC1B,CAAC,EACG,KAAK,YAAY,KAAK,WAAW,QAAQ,CAACnK,EAAGX,IAAM,CACnDW,EAAE,MAAQA,EAAE,OAAS,GACrBA,EAAE,UAAY+V,IACdP,EAAUxV,EAAG,IAAK,GAAI,CAC1B,CAAC,EAEG,KAAK,OAAS,KAAK,MAAM,OAAS,GAClC,KAAK,MAAM,QAAQ,CAACqP,EAAMhQ,IAAM,CAC5BgQ,EAAK,MAAQA,EAAK,OAAS,GAC3BA,EAAK,UAAY0G,IACjBP,EAAUnG,EAAM,GAAK,IAAI,CAC7B,CAAC,CAET,OAAS,EAAG,CACR,QAAQ,MAAM,0BAA2B,CAAC,CAC9C,CAGJ,KAAK,KAAKzJ,CAAI,EACd,sBAAsB,KAAK,OAAO,CACtC,CAEA,KAAKA,EAAM,CACP,KAAM,CAAE,IAAApB,EAAK,OAAAD,CAAM,EAAK,KAOxB,GALAC,EAAI,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EACjCA,EAAI,UAAY,KAAK,OAAO,QAC5BA,EAAI,SAAS,EAAG,EAAGD,EAAO,MAAOA,EAAO,MAAM,EAG1C,KAAK,OAAO,eAAgB,CAC5B,MAAM0R,EAAQ,KAAK,OAAO,EAAI,IACxBC,EAAQ,KAAK,OAAO,EAAI,IAE9B,GAAI,CACA,MAAM5F,EAAU/L,EAAO,MAAQ,EACzBgM,EAAUhM,EAAO,OAAS,EAC1ByQ,EAAU,KAAK,KAAK1E,EAAUA,EAAUC,EAAUA,CAAO,EACzD3K,EAAO,YAAY,IAAG,EAAK,IAEjC,KAAK,YAAY,QAAQ5F,GAAK,CAE1B,GAAI,OAAOA,EAAE,GAAM,UAAY,OAAOA,EAAE,GAAM,SAAU,OAExD,IAAI2B,GAAM3B,EAAE,EAAIiW,GAAS1R,EAAO,MAC5B3C,GAAM5B,EAAE,EAAIkW,GAAS3R,EAAO,OAC5B5C,EAAK,IAAGA,GAAM4C,EAAO,OACrB3C,EAAK,IAAGA,GAAM2C,EAAO,QAGzB,MAAMmM,EAAK,OAAO1Q,EAAE,IAAO,SAAWA,EAAE,GAAK,EACvC2Q,EAAK,OAAO3Q,EAAE,IAAO,SAAWA,EAAE,GAAK,EACvCuG,EAAOvG,EAAE,GAAKA,EAAE,MAAQ,EACxB+O,EAAY/O,EAAE,OAAS,UAG7B,IAAIoC,EAAI,IAAKqN,EAAI,IAAKtI,EAAI,IAC1B,GAAI,CACA,GAAI4H,EAAU,WAAW,GAAG,EAAG,CAC3B,MAAMQ,EAAMR,EAAU,MAAM,CAAC,EAEvBoH,EAAU,SAAS5G,EAAI,OAAO,EAAG,CAAC,EAAG,EAAE,EACvC6G,EAAU,SAAS7G,EAAI,OAAO,EAAG,CAAC,EAAG,EAAE,EACvC8G,EAAU,SAAS9G,EAAI,OAAO,EAAG,CAAC,EAAG,EAAE,EAC7CnN,EAAI,MAAM+T,CAAO,EAAI,IAAMA,EAC3B1G,EAAI,MAAM2G,CAAO,EAAI,IAAMA,EAC3BjP,EAAI,MAAMkP,CAAO,EAAI,IAAMA,CAC/B,CACJ,MAAY,CAAqB,CAEjC,GAAI,KAAK,YAAc,CAAC,KAAK,YAAa,CAEtC,MAAMrV,EAAKW,EAAK2O,EACVrP,EAAKW,EAAK2O,EACV+F,EAAiB,KAAK,KAAKtV,EAAKA,EAAKC,EAAKA,CAAE,EAElD,GAAIqV,EAAiB,EAAG,OAGxB,MAAMjC,EAAgB,KAAK,WAAa,EAClCT,EAAc,KAAK,qBAAuB,EAI1C2C,EAAcD,EAAiBtB,EAC/BF,EAAc9U,EAAE,OAAS,GAGzBwW,EAAe,EADA,KAAK,KAAK5C,CAAW,EAAI,GAAKkB,GACV,EAAIyB,EAAc,IAErDE,EAAe,KAAK,IAAID,EAAc,KAAO1B,CAAW,EAGxD4B,EAAU1V,EAAKsV,EACfK,EAAU1V,EAAKqV,EAIfM,EAAQjV,EACRkV,EAAQjV,EACRkV,EAAQnV,EAAK+U,EAAUD,EACvBM,EAAQnV,EAAK+U,EAAUF,EAIvBO,EAAYhX,EAAE,OAAS,GACvBiX,EAAiB,KAAK,IAAI,GAAK5C,EAAgB,GAAI,EACnD6C,EAAQ,KAAK,IAAI,IAAMF,EAAYC,CAAc,EAGvD,GAFAzS,EAAI,YAAc0S,EAEdT,EAAe,EACf,GAAI,CAEA,MAAMnQ,EAAO9B,EAAI,qBAAqBsS,EAAOC,EAAOH,EAAOC,CAAK,EAChEvQ,EAAK,aAAa,EAAG,aAAa,EAClCA,EAAK,aAAa,GAAK,QAAQlE,CAAC,KAAKqN,CAAC,KAAKtI,CAAC,QAAQ,EACpDb,EAAK,aAAa,GAAK,QAAQlE,CAAC,KAAKqN,CAAC,KAAKtI,CAAC,QAAQ,EAEpD,MAAMgQ,GAAU,KAAK,IAAI,IAAK/U,EAAI,EAAE,EAC9BgV,GAAU,KAAK,IAAI,IAAK3H,EAAI,EAAE,EAC9B4H,GAAU,KAAK,IAAI,IAAKlQ,EAAI,EAAE,EACpCb,EAAK,aAAa,EAAG,QAAQ6Q,EAAO,KAAKC,EAAO,KAAKC,EAAO,MAAM,EAGlE7S,EAAI,YAAc8B,EAElB,MAAMgR,GAAQ,KAAK,IAAI,GAAK,KAAK,IAAI,EAAG/Q,EAAO,EAAM8N,EAAgB,GAAI,CAAC,EAS1E,GARA7P,EAAI,UAAY8S,GAChB9S,EAAI,QAAU,QACdA,EAAI,UAAS,EACbA,EAAI,OAAOsS,EAAOC,CAAK,EACvBvS,EAAI,OAAOoS,EAAOC,CAAK,EACvBrS,EAAI,OAAM,EAGNiS,EAAe,GAAI,CAEnB,MAAMc,GAAQ,KAAK,IAAI,IAAKnV,EAAI,EAAE,EAC5BoV,GAAQ,KAAK,IAAI,IAAK/H,EAAI,EAAE,EAC5BgI,GAAQ,KAAK,IAAI,IAAKtQ,EAAI,EAAE,EAClC3C,EAAI,YAAc,QAAQ+S,EAAK,KAAKC,EAAK,KAAKC,EAAK,UACnDjT,EAAI,UAAY,KAAK,IAAI,GAAK+B,EAAO,EAAG,EACxC/B,EAAI,YAAc0S,EAAQ,GAC1B1S,EAAI,UAAS,EACb,MAAMkT,EAAU,KAAK,IAAIjB,EAAe,IAAM,EAAE,EAC1CkB,GAAQf,EAAQF,EAAUgB,EAC1BE,GAAQf,EAAQF,EAAUe,EAChClT,EAAI,OAAOmT,GAAOC,EAAK,EACvBpT,EAAI,OAAOoS,EAAOC,CAAK,EACvBrS,EAAI,OAAM,CACd,CACJ,MAAY,CACRA,EAAI,YAAcuK,EAClBvK,EAAI,UAAY+B,EAChB/B,EAAI,UAAS,EACbA,EAAI,OAAOsS,EAAOC,CAAK,EACvBvS,EAAI,OAAOoS,EAAOC,CAAK,EACvBrS,EAAI,OAAM,CACd,CAIJA,EAAI,YAAc,KAAK,IAAI,GAAK0S,EAAQ,EAAG,EAE3C,MAAMW,EAAQ,KAAK,IAAI,IAAKzV,EAAI,GAAG,EAC7B0V,EAAQ,KAAK,IAAI,IAAKrI,EAAI,GAAG,EAC7BsI,EAAQ,KAAK,IAAI,IAAK5Q,EAAI,GAAG,EACnC3C,EAAI,UAAY,OAAOqT,CAAK,KAAKC,CAAK,KAAKC,CAAK,IAChDvT,EAAI,UAAS,EACb,MAAMwT,EAAW,KAAK,IAAI,GAAK,KAAK,IAAI,IAAKzR,EAAO,EAAG,CAAC,EACxD/B,EAAI,IAAIoS,EAAOC,EAAOmB,EAAU,EAAG,KAAK,GAAK,CAAC,EAC9CxT,EAAI,KAAI,CAGZ,MAAW,KAAK,aAAgB,KAAK,WAEjCA,EAAI,YAAcxE,EAAE,OAAS,GAC7BwE,EAAI,UAAYuK,EAChBvK,EAAI,UAAS,EACbA,EAAI,IAAI7C,EAAIC,EAAI2E,EAAM,EAAG,KAAK,GAAK,CAAC,EACpC/B,EAAI,KAAI,CAUhB,CAAC,CACL,OAASyT,EAAa,CAClB,QAAQ,MAAM,oCAAqCA,CAAW,CAClE,CAGA,GAAI,CAAC,KAAK,YAAc,CAAC,KAAK,YAAa,CACvC,MAAM/N,EAAM,YAAY,IAAG,EAG3B,GAAIA,EAAM,KAAK,qBAAuB,IAAO,KAAK,OAAM,EAAK,IAAM,CAC/D,KAAK,qBAAuBA,EAC5B,MAAMqI,EAAS,KAAK,YAAc,CAAC,UAAW,UAAW,SAAS,EAG5D2F,EAAO,KAAK,MAAM,KAAK,OAAM,EAAK,CAAC,EACzC,IAAIvX,EAAQC,EAAQkE,EAEhBoT,IAAS,GACTvX,EAAS,KAAK,OAAM,EAAK4D,EAAO,MAChC3D,EAAS,IACTkE,EAAQ,KAAK,GAAK,IAAO,KAAK,OAAM,EAAK,KAAK,GAAK,IAC5CoT,IAAS,GAChBvX,EAAS4D,EAAO,MAAQ,GACxB3D,EAAS,KAAK,OAAM,EAAK2D,EAAO,OAChCO,EAAQ,KAAK,GAAK,IAAO,KAAK,OAAM,EAAK,KAAK,GAAK,IAC5CoT,IAAS,GAChBvX,EAAS,KAAK,OAAM,EAAK4D,EAAO,MAChC3D,EAAS2D,EAAO,OAAS,GACzBO,EAAQ,CAAC,KAAK,GAAK,IAAO,KAAK,OAAM,EAAK,KAAK,GAAK,KAEpDnE,EAAS,IACTC,EAAS,KAAK,OAAM,EAAK2D,EAAO,OAChCO,EAAQ,CAAC,KAAK,GAAK,IAAO,KAAK,OAAM,EAAK,KAAK,GAAK,IAGxD,KAAK,oBAAoB,KAAK,CAC1B,EAAGnE,EACH,EAAGC,EACH,GAAI,KAAK,IAAIkE,CAAK,GAAK,EAAI,KAAK,OAAM,EAAK,IAC3C,GAAI,KAAK,IAAIA,CAAK,GAAK,EAAI,KAAK,OAAM,EAAK,IAC3C,KAAM,IAAM,KAAK,OAAM,EAAK,IAC5B,WAAY,GAAK,KAAK,OAAM,EAAK,GACjC,MAAOyN,EAAO,KAAK,MAAM,KAAK,OAAM,EAAKA,EAAO,MAAM,CAAC,EACvD,KAAM,CACtC,CAA6B,CACL,CAGA,KAAK,oBAAsB,KAAK,oBAAoB,OAAOlD,GAAQ,CAK/D,GAJAA,EAAK,GAAKA,EAAK,GACfA,EAAK,GAAKA,EAAK,GACfA,EAAK,MAAQ,IAETA,EAAK,MAAQ,GAAKA,EAAK,EAAI,MAAQA,EAAK,EAAI9K,EAAO,MAAQ,KAC3D8K,EAAK,EAAI,MAAQA,EAAK,EAAI9K,EAAO,OAAS,IAC1C,MAAO,GAIX,MAAMqM,EAAQ,KAAK,KAAKvB,EAAK,GAAKA,EAAK,GAAKA,EAAK,GAAKA,EAAK,EAAE,EACvDuF,EAAO,CAACvF,EAAK,GAAKuB,EAClBiE,EAAO,CAACxF,EAAK,GAAKuB,EAClBkG,EAAQzH,EAAK,EAAIuF,EAAOvF,EAAK,WAC7B0H,EAAQ1H,EAAK,EAAIwF,EAAOxF,EAAK,WAEnC,OAAA7K,EAAI,YAAc6K,EAAK,KAAO,GAC9B7K,EAAI,YAAc6K,EAAK,MACvB7K,EAAI,UAAY6K,EAAK,KACrB7K,EAAI,QAAU,QACdA,EAAI,UAAS,EACbA,EAAI,OAAOsS,EAAOC,CAAK,EACvBvS,EAAI,OAAO6K,EAAK,EAAGA,EAAK,CAAC,EACzB7K,EAAI,OAAM,EAGVA,EAAI,UAAY,UAChBA,EAAI,UAAS,EACbA,EAAI,IAAI6K,EAAK,EAAGA,EAAK,EAAGA,EAAK,KAAO,IAAK,EAAG,KAAK,GAAK,CAAC,EACvD7K,EAAI,KAAI,EAED,EACX,CAAC,CACL,CAMA,GAJAA,EAAI,YAAc,EAId,KAAK,aAAa,IAAI,OAAO,GAAK,KAAK,cAAe,CACtD,QAAQ,IAAI,0BAA2B,KAAK,cAAc,OAAQ,SAAS,EAC3EA,EAAI,UAAY,SAChB,MAAM2T,EAAY,KAAK,uBAAyB,EAC1CC,EAAa,KAAK,wBAA0B,EAG9C,KAAK,cAAgB,IACrB5T,EAAI,KAAI,EACRA,EAAI,UAAUD,EAAO,MAAQ,EAAGA,EAAO,OAAS,CAAC,EACjDC,EAAI,OAAQ,KAAK,YAAc,KAAK,GAAM,GAAG,EAC7CA,EAAI,UAAU,CAACD,EAAO,MAAQ,EAAG,CAACA,EAAO,OAAS,CAAC,GAIvD,MAAM8T,EAAoB,GACpBC,EAAmB,KAAK,IAAG,EAAK,GAEtC,KAAK,cAAc,QAAQ,CAACC,EAAQC,IAAgB,CAEhDD,EAAO,GAAKA,EAAO,UAAYJ,EAG/B,MAAMM,EAAgB,KAAK,IAAI,EAAG,KAAK,MAAMJ,EAAoBD,CAAU,CAAC,EAExEG,EAAO,EAAKE,EAAgBF,EAAO,KAAQhU,EAAO,OAAS,MAC3DgU,EAAO,EAAI,CAACA,EAAO,KAAOE,GAI9BjU,EAAI,KAAO,GAAG+T,EAAO,IAAI,yCACzB/T,EAAI,aAAe,SAGnB,QAASnF,EAAI,EAAGA,EAAIoZ,GAAiBpZ,EAAIkZ,EAAO,MAAM,OAAQlZ,IAAK,CAC/D,MAAMqZ,EAAOH,EAAO,MAAMlZ,CAAC,EACrBsZ,EAAQJ,EAAO,EAAKlZ,EAAIkZ,EAAO,KACrC,GAAII,EAAQ,CAACJ,EAAO,KAAO,GAAKI,EAAQpU,EAAO,OAAS,IAAK,SAG7D,MAAMqU,EAAc,EAAKvZ,EAAIoZ,EACvBvB,EAAQ,KAAK,IAAI0B,EAAa,EAAG,EAAIL,EAAO,QAKlD,GAHA/T,EAAI,YAAc0S,EAGd,KAAK,kBAAmB,CACxB,MAAMnE,GAAOuF,EAAmBE,EAAc,GAAKnZ,EAAI,GAAK,IAC5DmF,EAAI,UAAY,OAAOuO,CAAG,cAC9B,MACIvO,EAAI,UAAY+T,EAAO,MAE3B/T,EAAI,WAAa,EACjBA,EAAI,YAAc+T,EAAO,MAEzB/T,EAAI,SAASkU,EAAMH,EAAO,EAAGI,CAAK,CACtC,CACJ,CAAC,EAGG,KAAK,cAAgB,GACrBnU,EAAI,QAAO,EAGfA,EAAI,WAAa,EACjBA,EAAI,YAAc,CACtB,CACJ,CAGAA,EAAI,UAAUD,EAAO,MAAQ,EAAI,KAAK,OAAO,EAAGA,EAAO,OAAS,EAAI,KAAK,OAAO,CAAC,EACjFC,EAAI,MAAM,KAAK,OAAO,KAAM,KAAK,OAAO,IAAI,EAG5C,KAAM,CAAE,MAAAwK,EAAO,SAAAC,GAAa,KAAK,0BAAyB,EAU1D,GANA,KAAK,uBAAsB,EAGvB,KAAK,aAAa,IAAI,YAAY,GAAG,KAAK,sBAAqB,EAG/DD,EAAM,OAAS,EAAG,CAClBxK,EAAI,QAAU,QACdA,EAAI,WAAa,GAGjB,MAAMwJ,EAAS,KAAK,uBAAyB,KAAK,uBAAsB,EAClE6K,EAAa7K,EAAO,EACpB8K,EAAa9K,EAAO,EACPA,EAAO,EAE1BgB,EAAM,QAAQiC,GAAK,CACf,MAAMiG,EAAQ,KAAK,IAAI,EAAG,EAAKjG,EAAE,KAAO,KAAK,OAAO,cAAe,EAC7DlC,EAAY,KAAK,aAAakC,EAAE,EAAE,EAClC,CAAC7O,EAAGqN,EAAGtI,CAAC,EAAI,KAAK,SAAS4H,CAAS,EAGnCgK,EAAM9H,EAAE,GAAG,GAAK,EAChB+H,EAAM/H,EAAE,GAAG,GAAK,EAChBgI,EAAK,KAAK,SAAShI,EAAE,GAAG,EAAGA,EAAE,GAAG,EAAG8H,EAAKF,EAAYC,CAAU,EAC9DI,EAAK,KAAK,SAASjI,EAAE,GAAG,EAAGA,EAAE,GAAG,EAAG+H,EAAKH,EAAYC,CAAU,EAEpEtU,EAAI,YAAc,QAAQpC,CAAC,KAAKqN,CAAC,KAAKtI,CAAC,SACvC3C,EAAI,YAAc,QAAQpC,CAAC,KAAKqN,CAAC,KAAKtI,CAAC,KAAK+P,EAAQ,EAAG,IACvD1S,EAAI,UAAY,EAAI,KAAK,OAAO,KAChCA,EAAI,UAAS,EACbA,EAAI,OAAOyU,EAAG,EAAGA,EAAG,CAAC,EACrBzU,EAAI,OAAO0U,EAAG,EAAGA,EAAG,CAAC,EACrB1U,EAAI,OAAM,CACd,CAAC,EACDA,EAAI,WAAa,EAEjBwK,EAAM,QAAQiC,GAAK,CACf,MAAMiG,EAAQ,KAAK,IAAI,EAAG,EAAKjG,EAAE,KAAO,KAAK,OAAO,cAAe,EAC7DlC,EAAY,KAAK,aAAakC,EAAE,EAAE,EAGlC8H,EAAM9H,EAAE,GAAG,GAAK,EAChB+H,EAAM/H,EAAE,GAAG,GAAK,EAChBgI,EAAK,KAAK,SAAShI,EAAE,GAAG,EAAGA,EAAE,GAAG,EAAG8H,EAAKF,EAAYC,CAAU,EAC9DI,EAAK,KAAK,SAASjI,EAAE,GAAG,EAAGA,EAAE,GAAG,EAAG+H,EAAKH,EAAYC,CAAU,EAEpEtU,EAAI,YAAcuK,EAClBvK,EAAI,YAAc0S,EAAQ,GAC1B1S,EAAI,UAAY,EAAI,KAAK,OAAO,KAChCA,EAAI,UAAS,EACbA,EAAI,OAAOyU,EAAG,EAAGA,EAAG,CAAC,EACrBzU,EAAI,OAAO0U,EAAG,EAAGA,EAAG,CAAC,EACrB1U,EAAI,OAAM,CACd,CAAC,EACDA,EAAI,YAAc,CACtB,CAGAA,EAAI,UAAY,SAChBA,EAAI,aAAe,SACnBA,EAAI,KAAO,OAAO,GAAK,KAAK,OAAO,IAAI,aAEvCyK,EAAS,QAAQE,GAAK,CAElB,MAAMC,EAAO,OAAOD,EAAE,CAAC,EAAE,SAAS,EAClC,GAAIA,EAAE,OAAS,KAAK,OAAO,cAAgBC,IAAS,OAAOD,EAAE,CAAC,EAAE,EAAE,EAAG,OAGrE,IAAIzQ,EAAK,EAAGC,EAAK,EACjBwQ,EAAE,QAAQnP,GAAK,CAAEtB,GAAMsB,EAAE,EAAGrB,GAAMqB,EAAE,CAAG,CAAC,EACxCtB,GAAMyQ,EAAE,OAAQxQ,GAAMwQ,EAAE,OAExB,MAAMgK,EAAW,KAAK,aAAahK,EAAE,CAAC,CAAC,EAGvC3K,EAAI,UAAY2U,EAChB3U,EAAI,YAAc,QAClBA,EAAI,WAAa,EACjBA,EAAI,SAAS4K,EAAM1Q,EAAIC,EAAM,GAAK,KAAK,OAAO,IAAK,EACnD6F,EAAI,WAAa,CACrB,CAAC,EAGD,MAAM4U,EAAU,YAAY,IAAG,EAEzBpL,EAAS,KAAK,uBAAyB,KAAK,uBAAsB,EAClE6K,EAAa7K,EAAO,EACpB8K,EAAa9K,EAAO,EAU1B,KAAK,MAAM,QAAQhO,GAAK,CACpB,GAAIA,EAAE,SAAU,OAEhBwE,EAAI,KAAI,EAGR,IAAI6U,EAAS,EACTC,EAAS,EACT,KAAK,iBAAmBtZ,EAAE,YAAc,SACxCqZ,EAASrZ,EAAE,UACXsZ,EAAStZ,EAAE,YAAc,OAAYA,EAAE,UAAY,GAGvD,MAAMuZ,EAAWvZ,IAAM,KAAK,YAGtBwZ,EAAKxZ,EAAE,GAAK,EACZyZ,EAAU,KAAK,SAASzZ,EAAE,EAAGA,EAAE,EAAGwZ,EAAIX,EAAYC,CAAU,EAC5DlU,EAAK6U,EAAQ,EACb5U,EAAK4U,EAAQ,EACbC,EAASD,EAAQ,MAEjBE,EAAU,KAAK,IAAIP,EAAU,KAAQpZ,EAAE,KAAK,EAAI,GAAM,GACtDpB,EAAQ2a,EAAU,IAAM,EACxB1H,EAAS,KAAK,OAAO,YAAc8H,EAAU/a,EAAQ8a,EAASL,EAAS,KAAK,OAAO,KACnFtK,EAAY,KAAK,aAAa/O,CAAC,EAC/B,CAACoC,EAAGqN,EAAGtI,CAAC,EAAI,KAAK,SAAS4H,CAAS,EAGzCvK,EAAI,YAAc8U,EAGlB,MAAMM,EAAU,KAAK,IAAI,GAAK/H,EAAS,CAAC,EAClCvL,EAAO9B,EAAI,qBAAqBI,EAAIC,EAAI,EAAGD,EAAIC,EAAI+U,CAAO,EAChEtT,EAAK,aAAa,EAAG,uBAAuBiT,EAAU,GAAM,EAAG,GAAG,EAClEjT,EAAK,aAAa,GAAK,QAAQlE,CAAC,KAAKqN,CAAC,KAAKtI,CAAC,QAAQ,EACpDb,EAAK,aAAa,EAAG,eAAe,EAEpC9B,EAAI,UAAY8B,EAChB9B,EAAI,UAAS,EACbA,EAAI,IAAII,EAAIC,EAAI+U,EAAS,EAAG,KAAK,GAAK,CAAC,EACvCpV,EAAI,KAAI,EAGRA,EAAI,UAAYuK,EAChB,KAAK,cAAcvK,EAAKI,EAAIC,EAAIgN,CAAM,EAEtCrN,EAAI,QAAO,CACf,CAAC,EAGD,MAAMqV,EAAS,SAAS,eAAe,OAAO,EACxCC,EAAqB7K,EAAS,OAAOE,GAAKA,EAAE,QAAU,KAAK,OAAO,YAAY,EAAE,OAClF0K,IAAQA,EAAO,UAAY,SAAS,KAAK,KAAK,OAAO,CAAC,EAAE,YAAW,EAAK,KAAK,KAAK,MAAM,CAAC,CAAC,aAAa,KAAK,MAAM,MAAM,sBAAsBC,CAAkB,YAAY,KAAK,OAAO,KAAK,QAAQ,CAAC,CAAC,KAGvM,KAAK,YAAc,KAAK,YACxB,QAAQ,IAAI,8CAA+C,KAAK,WAAW,EAAG,KAAK,WAAW,CAAC,EAC/F,KAAK,iBAAiBtV,CAAG,EACzB,KAAK,eAAeA,EAAKoB,CAAI,EAC7B,KAAK,iBAAiBpB,EAAKoB,CAAI,EAC/B,KAAK,8BAA8BpB,CAAG,GAEtC,QAAQ,IAAI,iDAAkD,KAAK,WAAY,cAAe,CAAC,CAAC,KAAK,UAAU,CAEvH,CAEA,iBAAiBA,EAAK,CAClB,KAAK,WAAW,QAAQwD,GAAQ,CAC5BxD,EAAI,KAAI,EACRA,EAAI,UAAUwD,EAAK,EAAGA,EAAK,CAAC,EAE5BxD,EAAI,YAAcwD,EAAK,KAAO,GAC9BxD,EAAI,YAAc,UAClBA,EAAI,UAAY,EAAI,KAAK,OAAO,KAEhCA,EAAI,UAAS,EACbA,EAAI,OAAO,EAAG,CAAC,EACfA,EAAI,OAAO,CAACwD,EAAK,GAAK,EAAG,CAACA,EAAK,GAAK,CAAC,EACrCxD,EAAI,OAAM,EAEVA,EAAI,YAAc,EAClBA,EAAI,QAAO,CACf,CAAC,CACL,CAEA,iBAAiBA,EAAKoB,EAAM,CACxB,MAAM4B,EAAO,KAAK,WAClB,GAAI,CAACA,EAAM,OAEXhD,EAAI,KAAI,EACRA,EAAI,UAAUgD,EAAK,EAAGA,EAAK,CAAC,EAG5BhD,EAAI,OAAOgD,EAAK,QAAQ,EAGxB,MAAMuS,EAAOvS,EAAK,MAAQ,EAC1BhD,EAAI,OAAOuV,CAAI,EAGf,MAAMC,EAAQxS,EAAK,OAAS,EACtByS,EAAa,KAAK,IAAID,CAAK,EAE3BzT,EAAO,GAAK,KAAK,OAAO,KAI9B,OAHiBiB,EAAK,MAAQ,cAGd,CACZ,IAAK,SAEDhD,EAAI,UAAY,UAChBA,EAAI,YAAc,UAClBA,EAAI,UAAY,EAAI,KAAK,OAAO,KAChCA,EAAI,UAAS,EACbA,EAAI,QAAQ,EAAG,EAAG+B,EAAMA,EAAO,GAAK,EAAG,EAAG,KAAK,GAAK,CAAC,EACrD/B,EAAI,KAAI,EACRA,EAAI,OAAM,EAEVA,EAAI,UAAY,UAChBA,EAAI,UAAS,EACbA,EAAI,QAAQ,EAAG,CAAC+B,EAAO,IAAMA,EAAO,GAAKA,EAAO,IAAM,EAAG,KAAK,GAAI,CAAC,EACnE/B,EAAI,KAAI,EAER,QAASnF,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,MAAMyF,EAASzF,EAAI,EAAK,KAAK,GAAK,EAAIuG,EAAO,KAC7CpB,EAAI,UAAYnF,EAAI,IAAM,EAAI,UAAY,UAC1CmF,EAAI,UAAS,EACbA,EAAI,IAAI,KAAK,IAAIM,CAAK,EAAIyB,EAAO,GAAK,KAAK,IAAIzB,CAAK,EAAIyB,EAAO,GAAKA,EAAO,IAAM,EAAG,KAAK,GAAK,CAAC,EAC/F/B,EAAI,KAAI,CACZ,CACA,MAEJ,IAAK,SAEDA,EAAI,UAAY,UAChBA,EAAI,YAAc,UAClBA,EAAI,UAAY,EAAI,KAAK,OAAO,KAChCA,EAAI,SAAS,CAAC+B,EAAO,GAAK,CAACA,EAAO,GAAKA,EAAO,IAAKA,CAAI,EACvD/B,EAAI,WAAW,CAAC+B,EAAO,GAAK,CAACA,EAAO,GAAKA,EAAO,IAAKA,CAAI,EAEzD/B,EAAI,UAAY,UAChBA,EAAI,SAAS,CAAC+B,EAAO,GAAK,CAACA,EAAO,IAAMA,EAAO,GAAKA,EAAO,EAAG,EAC9D/B,EAAI,SAAS,EAAG,CAAC+B,EAAO,IAAMA,EAAO,GAAKA,EAAO,EAAG,EAEpD/B,EAAI,UAAY,UAChBA,EAAI,UAAS,EACbA,EAAI,OAAO+B,EAAO,GAAK,CAAC,EACxB/B,EAAI,OAAO+B,EAAO,GAAK,CAACA,EAAO,EAAG,EAClC/B,EAAI,OAAO+B,EAAO,GAAKA,EAAO,EAAG,EACjC/B,EAAI,UAAS,EACbA,EAAI,KAAI,EAERA,EAAI,UAAY,UAChBA,EAAI,SAAS,CAAC+B,EAAO,GAAK,CAACA,EAAO,GAAKA,EAAO,IAAMA,EAAO,GAAI,EAC/D/B,EAAI,SAAS,CAAC+B,EAAO,GAAKA,EAAO,IAAMA,EAAO,IAAMA,EAAO,GAAI,EAC/D,MAEJ,IAAK,QAED/B,EAAI,UAAY,UAChBA,EAAI,YAAc,UAClBA,EAAI,UAAY,EAAI,KAAK,OAAO,KAEhCA,EAAI,UAAS,EACb,QAASnF,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,MAAM6a,EAAc7a,EAAI,KAAK,GAAK,EAAI,EAAK,KAAK,GAAK,EAC/C8a,EAAaD,EAAa,KAAK,GAAK,EACpCE,EAAS,KAAK,IAAIF,CAAU,EAAI3T,EAChC8T,EAAS,KAAK,IAAIH,CAAU,EAAI3T,EAChC+T,EAAS,KAAK,IAAIH,CAAU,EAAI5T,EAAO,GACvCgU,EAAS,KAAK,IAAIJ,CAAU,EAAI5T,EAAO,GACzClH,IAAM,EAAGmF,EAAI,OAAO4V,EAAQC,CAAM,EACjC7V,EAAI,OAAO4V,EAAQC,CAAM,EAC9B7V,EAAI,OAAO8V,EAAQC,CAAM,CAC7B,CACA/V,EAAI,UAAS,EACbA,EAAI,KAAI,EACRA,EAAI,OAAM,EAEVA,EAAI,UAAY,UAChBA,EAAI,UAAS,EACbA,EAAI,IAAI,EAAG,EAAG+B,EAAO,IAAM,EAAG,KAAK,GAAK,CAAC,EACzC/B,EAAI,KAAI,EACR,MAEJ,IAAK,QAEDA,EAAI,UAAY,UAChBA,EAAI,YAAc,UAClBA,EAAI,UAAY,EAAI,KAAK,OAAO,KAEhCA,EAAI,UAAS,EACbA,EAAI,OAAO+B,EAAM,CAAC,EAClB/B,EAAI,OAAO+B,EAAO,GAAK,CAACA,EAAO,EAAG,EAClC/B,EAAI,OAAO+B,EAAO,GAAK,CAACA,EAAO,EAAG,EAClC/B,EAAI,OAAO,EAAG,CAAC+B,EAAO,EAAG,EACzB/B,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAACA,EAAO,EAAG,EACnC/B,EAAI,OAAO,CAAC+B,EAAM,CAAC,EACnB/B,EAAI,OAAO,CAAC+B,EAAO,GAAKA,EAAO,EAAG,EAClC/B,EAAI,OAAO,EAAG+B,EAAO,EAAG,EACxB/B,EAAI,OAAO+B,EAAO,GAAKA,EAAO,EAAG,EACjC/B,EAAI,OAAO+B,EAAO,GAAKA,EAAO,EAAG,EACjC/B,EAAI,UAAS,EACbA,EAAI,KAAI,EACRA,EAAI,OAAM,EAEVA,EAAI,UAAY,UAChBA,EAAI,UAAS,EACbA,EAAI,IAAI+B,EAAO,GAAK,CAACA,EAAO,GAAKA,EAAO,GAAK,EAAG,KAAK,GAAK,CAAC,EAC3D/B,EAAI,KAAI,EAERA,EAAI,UAAY,aAAa,IAAM,KAAK,IAAIoB,EAAO,GAAI,EAAI,EAAE,YAC7DpB,EAAI,UAAS,EACbA,EAAI,OAAO+B,EAAM,CAAC,EAClB/B,EAAI,OAAO+B,EAAO,IAAK,CAACA,EAAO,EAAG,EAClC/B,EAAI,OAAO+B,EAAO,IAAK,CAAC,EACxB/B,EAAI,OAAO+B,EAAO,IAAKA,EAAO,EAAG,EACjC/B,EAAI,UAAS,EACbA,EAAI,KAAI,EACR,MAEJ,IAAK,UAEDA,EAAI,UAAY,UAChBA,EAAI,YAAc,UAClBA,EAAI,UAAY,EAAI,KAAK,OAAO,KAEhCA,EAAI,UAAS,EACbA,EAAI,OAAO+B,EAAM,CAAC,EAClB/B,EAAI,cAAc+B,EAAO,GAAK,CAACA,EAAO,GAAK,CAACA,EAAO,GAAK,CAACA,EAAO,GAAK,CAACA,EAAO,GAAK,CAAC,EACnF/B,EAAI,cAAc,CAAC+B,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAKA,EAAM,CAAC,EAC1E/B,EAAI,KAAI,EACRA,EAAI,OAAM,EAEVA,EAAI,UAAY,UAChBA,EAAI,UAAS,EACbA,EAAI,OAAO,EAAG,CAAC+B,EAAO,EAAG,EACzB/B,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAACA,EAAO,EAAG,EACnC/B,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAACA,EAAO,EAAG,EACnC/B,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAACA,EAAO,EAAG,EACnC/B,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAACA,EAAO,EAAG,EACnC/B,EAAI,UAAS,EACbA,EAAI,KAAI,EACRA,EAAI,UAAS,EACbA,EAAI,OAAO,EAAG+B,EAAO,EAAG,EACxB/B,EAAI,OAAO,CAAC+B,EAAO,GAAKA,EAAO,EAAG,EAClC/B,EAAI,OAAO,CAAC+B,EAAO,GAAKA,EAAO,EAAG,EAClC/B,EAAI,OAAO,CAAC+B,EAAO,GAAKA,EAAO,EAAG,EAClC/B,EAAI,OAAO,CAAC+B,EAAO,GAAKA,EAAO,EAAG,EAClC/B,EAAI,UAAS,EACbA,EAAI,KAAI,EAER,MAAMgW,EAAU,KAAK,IAAI5U,EAAO,GAAI,EAAI,GACxCpB,EAAI,UAAY,aAAa,IAAMgW,EAAU,GAAG,YAChDhW,EAAI,UAAS,EACbA,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAAC,EACzB/B,EAAI,OAAO,CAAC+B,GAAQ,IAAMiU,GAAU,CAACjU,EAAO,GAAI,EAChD/B,EAAI,OAAO,CAAC+B,GAAQ,EAAIiU,GAAU,CAAC,EACnChW,EAAI,OAAO,CAAC+B,GAAQ,IAAMiU,GAAUjU,EAAO,GAAI,EAC/C/B,EAAI,UAAS,EACbA,EAAI,KAAI,EACR,MAEJ,IAAK,YAGDA,EAAI,OAAO,KAAK,GAAK,CAAC,EACtBA,EAAI,MAAM,EAAGyV,GAAc,CAAC,EAE5BzV,EAAI,UAAY,UAChBA,EAAI,YAAc,UAClBA,EAAI,UAAY,EAAI,KAAK,OAAO,KAChCA,EAAI,UAAS,EACb,QAASnF,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,MAAMyF,EAAS,KAAK,GAAK,EAAKzF,EACxBgC,EAAI,CAACkF,EAAO,IAAM,KAAK,IAAIzB,CAAK,EAAIyB,EAAO,GAC3CrE,EAAI,KAAK,IAAI4C,CAAK,EAAIyB,EAAO,GAC/BlH,IAAM,EAAGmF,EAAI,OAAOnD,EAAGa,CAAC,EACvBsC,EAAI,OAAOnD,EAAGa,CAAC,CACxB,CACAsC,EAAI,UAAS,EACbA,EAAI,KAAI,EACRA,EAAI,OAAM,EAGVA,EAAI,UAAS,EACb,QAASnF,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,MAAMyF,EAAS,KAAK,GAAK,EAAKzF,EACxBgC,EAAIkF,EAAO,IAAM,KAAK,IAAIzB,CAAK,EAAIyB,EAAO,GAC1CrE,EAAI,KAAK,IAAI4C,CAAK,EAAIyB,EAAO,GAC/BlH,IAAM,EAAGmF,EAAI,OAAOnD,EAAGa,CAAC,EACvBsC,EAAI,OAAOnD,EAAGa,CAAC,CACxB,CACAsC,EAAI,UAAS,EACbA,EAAI,KAAI,EACRA,EAAI,OAAM,EAGVA,EAAI,UAAY,UAChBA,EAAI,YAAc,UAClBA,EAAI,UAAY,EAAI,KAAK,OAAO,KAChCA,EAAI,UAAS,EACbA,EAAI,QAAQ,EAAG,EAAG+B,EAAO,GAAKA,EAAO,IAAM,EAAG,EAAG,KAAK,GAAK,CAAC,EAC5D/B,EAAI,KAAI,EACRA,EAAI,OAAM,EAGVA,EAAI,UAAY,UAChBA,EAAI,UAAS,EACbA,EAAI,IAAI,EAAG,EAAG+B,EAAO,IAAM,EAAG,KAAK,GAAK,CAAC,EACzC/B,EAAI,KAAI,EAGRA,EAAI,YAAc,UAClBA,EAAI,UAAY,EAAI,KAAK,OAAO,KAChCA,EAAI,UAAS,EACbA,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAAC,EACzB/B,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAAC,EACzB/B,EAAI,OAAO+B,EAAO,GAAK,CAAC,EACxB/B,EAAI,OAAO+B,EAAO,GAAK,CAAC,EACxB/B,EAAI,OAAM,EAGV,MAAMiW,EAAY,GAAM,KAAK,IAAI7U,EAAO,IAAK,EAAI,GACjDpB,EAAI,UAAY,qBAAqBiW,CAAS,IAC9CjW,EAAI,UAAS,EACbA,EAAI,IAAI,CAAC+B,EAAO,IAAK,EAAGA,EAAO,IAAM,EAAG,KAAK,GAAK,CAAC,EACnD/B,EAAI,KAAI,EACRA,EAAI,UAAS,EACbA,EAAI,IAAI+B,EAAO,IAAK,EAAGA,EAAO,IAAM,EAAG,KAAK,GAAK,CAAC,EAClD/B,EAAI,KAAI,EACR,MAEJ,IAAK,cACL,QAEIA,EAAI,UAAY,UAChBA,EAAI,YAAc,UAClBA,EAAI,UAAY,EAAI,KAAK,OAAO,KAChCA,EAAI,UAAS,EACbA,EAAI,OAAO+B,EAAM,CAAC,EAClB/B,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAACA,EAAO,EAAG,EACnC/B,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAAC,EACzB/B,EAAI,OAAO,CAAC+B,EAAO,GAAKA,EAAO,EAAG,EAClC/B,EAAI,UAAS,EACbA,EAAI,KAAI,EACRA,EAAI,OAAM,EAEVA,EAAI,UAAY,UAChBA,EAAI,UAAS,EACbA,EAAI,IAAI,CAAC+B,EAAO,GAAK,EAAGA,EAAO,GAAK,EAAG,KAAK,GAAK,CAAC,EAClD/B,EAAI,KAAI,EACR,KACxB,CAEgBA,EAAI,QAAO,CACf,CAEA,eAAeA,EAAKoB,EAAM,CACtB,KAAK,SAAS,QAAQtD,GAAW,CAC7BkC,EAAI,KAAI,EAERA,EAAI,UAAUlC,EAAQ,EAAGA,EAAQ,CAAC,EAGlC,MAAMoY,EAAW,KAAK,IAAI,IAAM,KAAK,OAAO,MAAQ,CAAC,EAG/CrV,EAAQ,KAAK,IAAIO,EAAO,KAAQtD,EAAQ,KAAK,EAAI,GAAM,GACvDiE,EAAOjE,EAAQ,KAAO+C,EAAQqV,EAGpC,GAAI,CAAC,SAASnU,CAAI,GAAKA,GAAQ,EAAG,CAC9B/B,EAAI,QAAO,EACX,MACJ,CAGA,MAAMmW,EAAWnW,EAAI,qBAAqB,EAAG,EAAG,EAAG,EAAG,EAAG+B,EAAO,CAAC,EACjEoU,EAAS,aAAa,EAAGrY,EAAQ,KAAK,EACtCqY,EAAS,aAAa,GAAKrY,EAAQ,MAAQ,IAAI,EAC/CqY,EAAS,aAAa,EAAGrY,EAAQ,MAAQ,IAAI,EAE7CkC,EAAI,UAAYmW,EAChBnW,EAAI,UAAS,EACbA,EAAI,IAAI,EAAG,EAAG+B,EAAO,EAAG,EAAG,KAAK,GAAK,CAAC,EACtC/B,EAAI,KAAI,EAGRA,EAAI,UAAYlC,EAAQ,MACxBkC,EAAI,UAAS,EACbA,EAAI,IAAI,EAAG,EAAG+B,EAAM,EAAG,KAAK,GAAK,CAAC,EAClC/B,EAAI,KAAI,EAGRA,EAAI,UAAY,UAChBA,EAAI,YAAc,GAClBA,EAAI,UAAS,EACbA,EAAI,IAAI,EAAG,EAAG+B,EAAO,GAAK,EAAG,KAAK,GAAK,CAAC,EACxC/B,EAAI,KAAI,EACRA,EAAI,YAAc,EAElBA,EAAI,QAAO,CACf,CAAC,CACL,CAEA,8BAA8BA,EAAK,CAC/B,MAAMD,EAAS,KAAK,OACd2F,EAAM,KAAK,IAAG,EAEpB,KAAK,wBAAwB,QAAQ0Q,GAAgB,CACjD,MAAMC,EAAM3Q,EAAM0Q,EAAa,KACzB/T,EAAU,KAAK,IAAI,EAAG,EAAIgU,EAAM,GAAI,EACpCC,EAAUD,EAAM,IAEtBrW,EAAI,KAAI,EACRA,EAAI,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EAEjCA,EAAI,YAAcqC,EAClBrC,EAAI,KAAO,kBACXA,EAAI,UAAYoW,EAAa,MAC7BpW,EAAI,YAAc,OAClBA,EAAI,UAAY,EAChBA,EAAI,UAAY,SAEhB,MAAMnD,EAAIkD,EAAO,MAAQ,EACnBrC,EAAIqC,EAAO,OAAS,EAAI,IAAMuW,EAEpCtW,EAAI,WAAWoW,EAAa,KAAMvZ,EAAGa,CAAC,EACtCsC,EAAI,SAASoW,EAAa,KAAMvZ,EAAGa,CAAC,EACpCsC,EAAI,YAAc,EAElBA,EAAI,QAAO,CACf,CAAC,CACL,CAEA,wBAAyB,CACrB,GAAI,CAAC,KAAK,OAAO,eAAgB,OAEjC,MAAMA,EAAM,KAAK,IAkFjB,GA/EI,KAAK,iBAAmB,KAAK,gBAAgB,OAAS,IACtD,KAAK,gBAAgB,QAAQxE,GAAK,CAC9BwE,EAAI,UAAYxE,EAAE,OAAS,QAC3BwE,EAAI,YAAcxE,EAAE,MACpBwE,EAAI,UAAS,EACbA,EAAI,IAAIxE,EAAE,EAAGA,EAAE,EAAGA,EAAE,EAAG,EAAG,KAAK,GAAK,CAAC,EACrCwE,EAAI,KAAI,CACZ,CAAC,EACDA,EAAI,YAAc,GAIlB,KAAK,SAAW,KAAK,QAAQ,OAAS,IACtCA,EAAI,yBAA2B,SAC/B,KAAK,QAAQ,QAAQ2F,GAAK,CACtB,GAAIA,EAAE,SAAU,OAGhB,IAAIvL,EAAQ,EACRsY,EAAQ,EACR,KAAK,iBAAmB/M,EAAE,YAAc,SACxCvL,EAAQuL,EAAE,WAAa,IACvB+M,EAAQ/M,EAAE,WAAa,GAG3B,MAAM4Q,EAAa,KAAK,IAAI,GAAK5Q,EAAE,KAAOvL,CAAK,EACzCoc,EAAc7Q,EAAE,MAAQ+M,EAExB5Q,EAAO9B,EAAI,qBAAqB2F,EAAE,EAAGA,EAAE,EAAG,EAAGA,EAAE,EAAGA,EAAE,EAAG4Q,CAAU,EACvEzU,EAAK,aAAa,EAAG6D,EAAE,KAAK,EAC5B7D,EAAK,aAAa,EAAG,aAAa,EAElC9B,EAAI,YAAcwW,EAClBxW,EAAI,UAAY8B,EAChB9B,EAAI,UAAS,EACbA,EAAI,IAAI2F,EAAE,EAAGA,EAAE,EAAG4Q,EAAY,EAAG,KAAK,GAAK,CAAC,EAC5CvW,EAAI,KAAI,CACZ,CAAC,EACDA,EAAI,yBAA2B,cAC/BA,EAAI,YAAc,GAIlB,KAAK,aAAa,IAAI,YAAY,GAAK,KAAK,eAAiB,KAAK,cAAc,OAAS,IACzF,KAAK,cAAc,QAAQxE,GAAK,CAC5BwE,EAAI,KAAI,EAGR,MAAMsS,EAAQ9W,EAAE,EAAIA,EAAE,GAAKA,EAAE,WACvB+W,EAAQ/W,EAAE,EAAIA,EAAE,GAAKA,EAAE,WAEvBib,EAAWzW,EAAI,qBAAqBsS,EAAOC,EAAO/W,EAAE,EAAGA,EAAE,CAAC,EAChEib,EAAS,aAAa,EAAG,aAAa,EACtCA,EAAS,aAAa,GAAKjb,EAAE,MAAQ,IAAI,EACzCib,EAAS,aAAa,EAAGjb,EAAE,KAAK,EAEhCwE,EAAI,YAAcyW,EAClBzW,EAAI,UAAYxE,EAAE,KAAO,GACzBwE,EAAI,QAAU,QACdA,EAAI,YAAcxE,EAAE,MAEpBwE,EAAI,UAAS,EACbA,EAAI,OAAOsS,EAAOC,CAAK,EACvBvS,EAAI,OAAOxE,EAAE,EAAGA,EAAE,CAAC,EACnBwE,EAAI,OAAM,EAGVA,EAAI,UAAYxE,EAAE,MAClBwE,EAAI,YAAcxE,EAAE,MAAQ,GAC5BwE,EAAI,UAAS,EACbA,EAAI,IAAIxE,EAAE,EAAGA,EAAE,EAAGA,EAAE,KAAM,EAAG,KAAK,GAAK,CAAC,EACxCwE,EAAI,KAAI,EAERA,EAAI,QAAO,CACf,CAAC,EACDA,EAAI,YAAc,GAIlB,KAAK,aAAa,IAAI,OAAO,GAAK,KAAK,YAAc,KAAK,WAAW,OAAS,EAAG,CACjF,MAAMoB,EAAO,YAAY,IAAG,EAAK,KACjC,KAAK,WAAW,QAAQ5F,GAAK,CACzB,GAAIA,EAAE,SAAU,OAChBwE,EAAI,KAAI,EAGRA,EAAI,UAAUxE,EAAE,EAAGA,EAAE,CAAC,EAGlB,KAAK,iBAAmBA,EAAE,YAAc,SACxCwE,EAAI,MAAMxE,EAAE,UAAWA,EAAE,SAAS,EAClCwE,EAAI,YAAcxE,EAAE,WAAa,GAIjCA,EAAE,gBAAeA,EAAE,UAAYA,EAAE,eAErC,MAAMuG,EAAOvG,EAAE,KACT2F,EAAO,KAAK,OAAO,KACnBb,EAAQ,KAAK,MAAM9E,EAAE,GAAIA,EAAE,EAAE,EAGnC,GAAIA,EAAE,UAAW,CACb,MAAMkb,EAAc,KAAK,IAAItV,EAAO,EAAI5F,EAAE,WAAW,EAAI,GAAM,GAC/DwE,EAAI,YAAc0W,EAAc,GAChC,MAAMC,EAAa3W,EAAI,qBAAqB,EAAG,EAAG+B,EAAO,GAAK,EAAG,EAAGA,EAAO,GAAG,EAC9E4U,EAAW,aAAa,EAAG,aAAa,EACxCA,EAAW,aAAa,GAAKnb,EAAE,aAAe,uBAAuB,EACrEmb,EAAW,aAAa,EAAG,aAAa,EACxC3W,EAAI,UAAY2W,EAChB3W,EAAI,UAAS,EACbA,EAAI,IAAI,EAAG,EAAG+B,EAAO,IAAK,EAAG,KAAK,GAAK,CAAC,EACxC/B,EAAI,KAAI,EACRA,EAAI,YAAc,CACtB,CAGA,GAAIxE,EAAE,YAAcA,EAAE,YAAc,SAAU,CAC1C,MAAMob,EAAY,KAAK,IAAIxV,EAAO,CAAC,EAAI,GAAM,GAC7CpB,EAAI,YAAc4W,EAAY,GAC9B,MAAMC,EAAW7W,EAAI,qBAAqB,EAAG+B,EAAO,GAAK,EAAGA,EAAO,CAAC,EACpE8U,EAAS,aAAa,EAAGrb,EAAE,WAAa,SAAS,EACjDqb,EAAS,aAAa,EAAG,aAAa,EACtC7W,EAAI,UAAY6W,EAChB7W,EAAI,UAAS,EACbA,EAAI,OAAO,CAAC+B,EAAO,GAAKA,EAAO,EAAG,EAClC/B,EAAI,OAAO,CAAC+B,EAAO,GAAKA,EAAO,CAAC,EAChC/B,EAAI,OAAO+B,EAAO,GAAKA,EAAO,CAAC,EAC/B/B,EAAI,OAAO+B,EAAO,GAAKA,EAAO,EAAG,EACjC/B,EAAI,UAAS,EACbA,EAAI,KAAI,EACRA,EAAI,YAAc,CACtB,CAQA,GALIxE,EAAE,YAAc,UAChBwE,EAAI,OAAOM,CAAK,EAIhB9E,EAAE,YAAc,UAAYA,EAAE,YAAc,QAAS,CACrDwE,EAAI,YAAc,GAClB,MAAM8W,EAAc/U,EAAO,EACrBgV,EAAgBhV,EAAO,IACvBiV,EAAcxb,EAAE,aAAe,EAErC,QAASX,EAAI,EAAGA,EAAImc,EAAanc,IAAK,CAClC,MAAM2F,GAAW3F,GAAKmc,EAAc,GAAK,GAAKD,EACxCf,EAAU,GAAM,KAAK,IAAI5U,EAAO,GAAK5F,EAAE,WAAaX,CAAC,EAAI,GACzDoc,EAAYjX,EAAI,qBAAqB,CAAC+B,EAAO,GAAKvB,EAAS,CAACuB,EAAO,GAAM+U,EAAcd,EAASxV,CAAO,EAC7GyW,EAAU,aAAa,EAAGzb,EAAE,YAAc,SAAS,EACnDyb,EAAU,aAAa,IAAMzb,EAAE,aAAe,SAAS,EACvDyb,EAAU,aAAa,EAAG,aAAa,EAEvCjX,EAAI,UAAYiX,EAChBjX,EAAI,UAAS,EACbA,EAAI,OAAO,CAAC+B,EAAO,IAAMvB,EAAU,CAAC,EACpCR,EAAI,iBAAiB,CAAC+B,EAAO,GAAM+U,EAAc,GAAMd,EAASxV,EAAS,CAACuB,EAAO,GAAM+U,EAAcd,EAASxV,CAAO,EACrHR,EAAI,iBAAiB,CAAC+B,EAAO,GAAM+U,EAAc,GAAMd,EAASxV,EAAS,CAACuB,EAAO,IAAMvB,EAAU,CAAC,EAClGR,EAAI,UAAS,EACbA,EAAI,KAAI,CACZ,CACAA,EAAI,YAAc,CACtB,CAGA,MAAMkX,EAAWlX,EAAI,qBAAqB,EAAG,CAAC+B,EAAO,GAAK,EAAGA,EAAO,EAAG,EASvE,GARAmV,EAAS,aAAa,EAAG1b,EAAE,eAAiB,MAAM,EAClD0b,EAAS,aAAa,GAAK1b,EAAE,WAAa,MAAM,EAChD0b,EAAS,aAAa,EAAG1b,EAAE,YAAc,MAAM,EAC/CwE,EAAI,UAAYkX,EAChBlX,EAAI,YAAcxE,EAAE,eAAiB,OACrCwE,EAAI,UAAY,IAAMmB,EAGlB3F,EAAE,YAAc,SAAU,CAC1BwE,EAAI,UAAS,EACbA,EAAI,QAAQ,EAAG,EAAG+B,EAAMA,EAAO,IAAM,EAAG,EAAG,KAAK,GAAK,CAAC,EACtD/B,EAAI,KAAI,EACRA,EAAI,OAAM,EACV,MAAMmX,EAAWnX,EAAI,qBAAqB,CAAC+B,EAAO,GAAK,CAACA,EAAO,IAAM,EAAG,EAAG,CAACA,EAAO,IAAMA,EAAO,EAAG,EACnGoV,EAAS,aAAa,EAAG,SAAS,EAClCA,EAAS,aAAa,GAAK3b,EAAE,WAAa,SAAS,EACnD2b,EAAS,aAAa,EAAG,mBAAmB,EAC5CnX,EAAI,UAAYmX,EAChBnX,EAAI,UAAS,EACbA,EAAI,QAAQ,EAAG,CAAC+B,EAAO,IAAMA,EAAO,IAAMA,EAAO,IAAM,EAAG,KAAK,GAAI,CAAC,EACpE/B,EAAI,KAAI,CACZ,SAAWxE,EAAE,YAAc,mBAAoB,CAC3CwE,EAAI,UAAS,EACbA,EAAI,OAAO+B,EAAO,IAAK,CAAC,EACxB,QAASlH,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,MAAMyF,EAASzF,EAAI,EAAK,KAAK,GAAK,EAClCmF,EAAI,OAAO,KAAK,IAAIM,CAAK,EAAIyB,EAAO,GAAK,KAAK,IAAIzB,CAAK,EAAIyB,EAAO,EAAG,CACzE,CACA/B,EAAI,UAAS,EACbA,EAAI,KAAI,EACRA,EAAI,OAAM,CACd,SAAWxE,EAAE,YAAc,gBACvB,QAASX,EAAI,EAAGA,EAAI,EAAGA,IACnBmF,EAAI,KAAI,EACRA,EAAI,OAAOoB,GAAQ,EAAIvG,GAAKA,CAAC,EAC7BmF,EAAI,YAAc,UAClBA,EAAI,UAAY,EAChBA,EAAI,UAAS,EACbA,EAAI,QAAQ,EAAG,EAAG+B,GAAQ,GAAMlH,EAAI,IAAMkH,EAAO,GAAK,EAAG,EAAG,KAAK,GAAK,CAAC,EACvE/B,EAAI,OAAM,EACVA,EAAI,QAAO,UAERxE,EAAE,YAAc,eACvBwE,EAAI,UAAS,EACbA,EAAI,OAAO+B,EAAO,GAAK,CAAC,EACxB/B,EAAI,OAAO+B,EAAO,GAAK,CAACA,EAAO,EAAG,EAClC/B,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAACA,EAAO,EAAG,EACnC/B,EAAI,OAAO,CAAC+B,EAAO,GAAKA,EAAO,EAAG,EAClC/B,EAAI,OAAO+B,EAAO,GAAKA,EAAO,EAAG,EACjC/B,EAAI,UAAS,EACbA,EAAI,KAAI,EACRA,EAAI,OAAM,UACHxE,EAAE,YAAc,iBAAkB,CAEzC,MAAM0b,EAAWlX,EAAI,qBAAqB,CAAC+B,EAAM,EAAGA,EAAM,CAAC,EAC3DmV,EAAS,aAAa,EAAG,SAAS,EAClCA,EAAS,aAAa,GAAK,SAAS,EACpCA,EAAS,aAAa,EAAG,SAAS,EAClClX,EAAI,UAAYkX,EAEhBlX,EAAI,UAAS,EACbA,EAAI,OAAO+B,EAAO,IAAK,CAAC,EACxB/B,EAAI,OAAO+B,EAAO,GAAK,CAACA,EAAO,GAAI,EACnC/B,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAACA,EAAO,GAAI,EACpC/B,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAAC,EACzB/B,EAAI,OAAO,CAAC+B,EAAO,GAAKA,EAAO,GAAI,EACnC/B,EAAI,OAAO+B,EAAO,GAAKA,EAAO,GAAI,EAClC/B,EAAI,UAAS,EACbA,EAAI,KAAI,EACRA,EAAI,OAAM,EAEVA,EAAI,UAAY,UAChBA,EAAI,UAAS,EACbA,EAAI,OAAO+B,EAAO,GAAK,CAAC,EACxB/B,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAACA,EAAO,EAAG,EACnC/B,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAACA,EAAO,EAAG,EACnC/B,EAAI,UAAS,EACbA,EAAI,KAAI,EACRA,EAAI,UAAS,EACbA,EAAI,OAAO+B,EAAO,GAAK,CAAC,EACxB/B,EAAI,OAAO,CAAC+B,EAAO,GAAKA,EAAO,EAAG,EAClC/B,EAAI,OAAO,CAAC+B,EAAO,GAAKA,EAAO,EAAG,EAClC/B,EAAI,UAAS,EACbA,EAAI,KAAI,CACZ,SAAWxE,EAAE,YAAc,eAAgB,CACvC,MAAM4b,EAAUpX,EAAI,qBAAqB,CAAC+B,EAAM,EAAGA,EAAM,CAAC,EAC1DqV,EAAQ,aAAa,EAAG,SAAS,EACjCA,EAAQ,aAAa,GAAK,SAAS,EACnCA,EAAQ,aAAa,EAAG,SAAS,EACjCpX,EAAI,UAAYoX,EAChBpX,EAAI,UAAS,EACbA,EAAI,OAAO+B,EAAO,GAAK,CAAC,EACxB/B,EAAI,cAAc+B,EAAO,GAAK,CAACA,EAAO,GAAKA,EAAO,GAAK,CAACA,EAAO,GAAK,CAACA,EAAO,GAAK,CAACA,EAAO,EAAG,EAC5F/B,EAAI,cAAc,CAAC+B,EAAO,GAAK,EAAG,CAACA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAKA,EAAO,EAAG,EACjF/B,EAAI,cAAc+B,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAK,EAAGA,EAAO,GAAK,CAAC,EACtE/B,EAAI,KAAI,CACZ,SAAWxE,EAAE,YAAc,eAAgB,CACvC,MAAM0b,EAAWlX,EAAI,qBAAqB,CAAC+B,EAAM,EAAGA,EAAM,CAAC,EAC3DmV,EAAS,aAAa,EAAG,SAAS,EAClCA,EAAS,aAAa,GAAK,SAAS,EACpCA,EAAS,aAAa,EAAG,SAAS,EAClClX,EAAI,UAAYkX,EAChBlX,EAAI,UAAS,EACbA,EAAI,OAAO+B,EAAO,GAAK,CAAC,EACxB/B,EAAI,OAAO+B,EAAO,GAAK,CAACA,EAAO,GAAI,EACnC/B,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAACA,EAAO,GAAI,EACpC/B,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAAC,EACzB/B,EAAI,OAAO,CAAC+B,EAAO,GAAKA,EAAO,GAAI,EACnC/B,EAAI,OAAO+B,EAAO,GAAKA,EAAO,GAAI,EAClC/B,EAAI,UAAS,EACbA,EAAI,KAAI,EACRA,EAAI,UAAY,UAChBA,EAAI,SAAS,CAAC+B,EAAO,GAAK,CAACA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAI,EAC9D/B,EAAI,SAAS,CAAC+B,EAAO,GAAKA,EAAO,IAAMA,EAAO,GAAKA,EAAO,GAAI,CAClE,SAAWvG,EAAE,YAAc,kBAAmB,CAC1C,MAAM0b,EAAWlX,EAAI,qBAAqB,CAAC+B,EAAM,CAACA,EAAMA,EAAMA,CAAI,EAClEmV,EAAS,aAAa,EAAG,SAAS,EAClCA,EAAS,aAAa,GAAK,SAAS,EACpCA,EAAS,aAAa,EAAG,SAAS,EAClClX,EAAI,UAAYkX,EAChBlX,EAAI,UAAS,EACbA,EAAI,OAAO+B,EAAM,CAAC,EAClB/B,EAAI,OAAO+B,EAAO,GAAK,CAACA,EAAO,EAAG,EAClC/B,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAACA,EAAO,EAAG,EACnC/B,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAAC,EACzB/B,EAAI,OAAO,CAAC+B,EAAO,GAAKA,EAAO,EAAG,EAClC/B,EAAI,OAAO+B,EAAO,GAAKA,EAAO,EAAG,EACjC/B,EAAI,UAAS,EACbA,EAAI,KAAI,EACRA,EAAI,OAAM,CACd,SAAWxE,EAAE,YAAc,gBAAiB,CACxC,MAAM0b,EAAWlX,EAAI,qBAAqB,CAAC+B,EAAM,EAAGA,EAAM,CAAC,EAC3DmV,EAAS,aAAa,EAAG,SAAS,EAClCA,EAAS,aAAa,GAAK,SAAS,EACpCA,EAAS,aAAa,EAAG,SAAS,EAClClX,EAAI,UAAYkX,EAChBlX,EAAI,SAAS,CAAC+B,EAAO,GAAK,CAACA,EAAO,IAAMA,EAAO,IAAKA,EAAO,EAAG,EAC9D/B,EAAI,UAAY,UAChBA,EAAI,UAAS,EACbA,EAAI,OAAO+B,EAAO,GAAK,CAACA,EAAO,GAAI,EACnC/B,EAAI,OAAO+B,EAAM,CAAC,EAClB/B,EAAI,OAAO+B,EAAO,GAAKA,EAAO,GAAI,EAClC/B,EAAI,UAAS,EACbA,EAAI,KAAI,CACZ,SAAWxE,EAAE,YAAc,eAAgB,CACvC,MAAM6b,EAAUrX,EAAI,qBAAqB,EAAG,EAAG,EAAG,EAAG,EAAG+B,EAAO,EAAG,EAClEsV,EAAQ,aAAa,EAAG,SAAS,EACjCA,EAAQ,aAAa,GAAK,SAAS,EACnCA,EAAQ,aAAa,EAAG,SAAS,EACjCrX,EAAI,UAAYqX,EAChBrX,EAAI,UAAS,EACbA,EAAI,IAAI,EAAG,EAAG+B,EAAO,IAAM,EAAG,KAAK,GAAK,CAAC,EACzC/B,EAAI,KAAI,EACR,QAASnF,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,MAAMyF,EAASzF,EAAI,EAAK,KAAK,GAAK,EAAIuG,EACtCpB,EAAI,YAAc,UAClBA,EAAI,UAAY,EAChBA,EAAI,UAAS,EACbA,EAAI,OAAO,KAAK,IAAIM,CAAK,EAAIyB,EAAO,GAAK,KAAK,IAAIzB,CAAK,EAAIyB,EAAO,EAAG,EACrE/B,EAAI,OAAO,KAAK,IAAIM,CAAK,EAAIyB,EAAO,GAAK,KAAK,IAAIzB,CAAK,EAAIyB,EAAO,EAAG,EACrE/B,EAAI,OAAM,CACd,CACJ,SAAWxE,EAAE,YAAc,cAAe,CACtC,MAAMsG,EAAO9B,EAAI,qBAAqB,CAAC+B,EAAM,EAAGA,EAAM,CAAC,EACvDD,EAAK,aAAa,EAAG,mBAAmB,EACxCA,EAAK,aAAa,GAAK,uBAAuB,EAC9CA,EAAK,aAAa,EAAG,mBAAmB,EACxC9B,EAAI,UAAY8B,EAChB9B,EAAI,UAAS,EACbA,EAAI,OAAO,CAAC+B,EAAO,GAAK,CAACA,EAAO,EAAG,EACnC/B,EAAI,OAAO+B,EAAO,GAAK,CAAC,EACxB/B,EAAI,OAAO,CAAC+B,EAAO,GAAKA,EAAO,EAAG,EAClC/B,EAAI,UAAS,EACbA,EAAI,KAAI,CACZ,SAAWxE,EAAE,YAAc,eAAgB,CACvC,MAAM8b,EAAatX,EAAI,qBAAqB,CAAC+B,EAAO,GAAK,CAACA,EAAO,GAAK,EAAG,EAAG,EAAGA,CAAI,EACnFuV,EAAW,aAAa,EAAG,SAAS,EACpCA,EAAW,aAAa,GAAK,SAAS,EACtCA,EAAW,aAAa,EAAG,SAAS,EACpCtX,EAAI,UAAYsX,EAChBtX,EAAI,UAAS,EACbA,EAAI,IAAI,EAAG,EAAG+B,EAAM,EAAG,KAAK,GAAK,CAAC,EAClC/B,EAAI,KAAI,EACRA,EAAI,OAAM,EACV,MAAMuX,EAAYvX,EAAI,qBAAqB+B,EAAO,GAAK,CAACA,EAAO,GAAK,EAAGA,EAAO,GAAK,CAACA,EAAO,GAAKA,EAAO,GAAI,EAC3GwV,EAAU,aAAa,EAAG,SAAS,EACnCA,EAAU,aAAa,GAAK,SAAS,EACrCA,EAAU,aAAa,EAAG,iBAAiB,EAC3CvX,EAAI,UAAYuX,EAChBvX,EAAI,UAAS,EACbA,EAAI,IAAI+B,EAAO,GAAK,CAACA,EAAO,GAAKA,EAAO,GAAK,EAAG,KAAK,GAAK,CAAC,EAC3D/B,EAAI,KAAI,CACZ,SAAWxE,EAAE,YAAc,cAAe,CACtC,MAAMgc,EAAcxX,EAAI,qBAAqB,EAAG,EAAG,EAAG,EAAG,EAAG+B,EAAO,EAAG,EACtEyV,EAAY,aAAa,EAAG,SAAS,EACrCA,EAAY,aAAa,GAAK,SAAS,EACvCA,EAAY,aAAa,EAAG,SAAS,EACrCxX,EAAI,UAAYwX,EAChBxX,EAAI,UAAS,EACb,QAASnF,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,MAAMyF,EAASzF,EAAI,EAAK,KAAK,GAAK,EAAI,KAAK,GAAK,EAC1CgC,EAAI,KAAK,IAAIyD,CAAK,EAAIyB,EAAO,IAC7BrE,EAAI,KAAK,IAAI4C,CAAK,EAAIyB,EAAO,IAC/BlH,IAAM,EAAGmF,EAAI,OAAOnD,EAAGa,CAAC,EACvBsC,EAAI,OAAOnD,EAAGa,CAAC,CACxB,CACAsC,EAAI,UAAS,EACbA,EAAI,KAAI,EACRA,EAAI,OAAM,EACV,MAAMyX,EAAYzX,EAAI,qBAAqB,CAAC+B,EAAM,CAACA,EAAMA,EAAMA,CAAI,EACnE0V,EAAU,aAAa,EAAG,SAAS,EACnCA,EAAU,aAAa,GAAK,SAAS,EACrCA,EAAU,aAAa,EAAG,SAAS,EACnCzX,EAAI,UAAYyX,EAChBzX,EAAI,SAAS,CAAC+B,EAAO,IAAK,CAACA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAG,EAC7D/B,EAAI,WAAW,CAAC+B,EAAO,IAAK,CAACA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAG,EAC/D/B,EAAI,SAAS+B,EAAO,GAAK,CAACA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAG,EAC5D/B,EAAI,WAAW+B,EAAO,GAAK,CAACA,EAAO,GAAKA,EAAO,GAAKA,EAAO,GAAG,CAClE,MAEI/B,EAAI,UAAS,EACbA,EAAI,IAAI,EAAG,EAAG+B,EAAO,GAAK,EAAG,KAAK,GAAK,CAAC,EACxC/B,EAAI,KAAI,EACRA,EAAI,OAAM,EAId,GAAIxE,EAAE,YAAc,SAAWA,EAAE,YAAc,SAAU,CACrD,MAAMkc,EAAa,KAAK,IAAItW,EAAO,GAAK5F,EAAE,YAAc,EAAE,EAAI,GAAM,GACpEwE,EAAI,UAAYxE,EAAE,YAAc,UAChCwE,EAAI,YAAc0X,EAClB1X,EAAI,UAAS,EACbA,EAAI,IAAI+B,EAAO,IAAM,EAAG,EAAIZ,EAAM,EAAG,KAAK,GAAK,CAAC,EAChDnB,EAAI,KAAI,EAGRA,EAAI,UAAY,UAChBA,EAAI,UAAS,EACbA,EAAI,IAAI,CAAC+B,EAAO,GAAK,CAACA,EAAO,GAAK,EAAIZ,EAAM,EAAG,KAAK,GAAK,CAAC,EAC1DnB,EAAI,KAAI,EACRA,EAAI,UAAY,UAChBA,EAAI,UAAS,EACbA,EAAI,IAAI,CAAC+B,EAAO,GAAKA,EAAO,GAAK,EAAIZ,EAAM,EAAG,KAAK,GAAK,CAAC,EACzDnB,EAAI,KAAI,EACRA,EAAI,YAAc,CACtB,CAEAA,EAAI,QAAO,CACf,CAAC,CACL,CACJ,CAEA,uBAAwB,CACpB,GAAI,CAAC,KAAK,OAAO,eAAgB,OAEjC,MAAMA,EAAM,KAAK,IACXoB,EAAO,YAAY,IAAG,EAAK,KAyEjC,GAtEI,KAAK,UAAY,KAAK,SAAS,OAAS,GACxC,KAAK,SAAS,QAAQ6J,GAAK,CACvB,GAAIA,EAAE,SAAU,OAChBjL,EAAI,KAAI,EAERA,EAAI,UAAUiL,EAAE,EAAGA,EAAE,CAAC,EAGlB,KAAK,iBAAmBA,EAAE,YAAc,SACxCjL,EAAI,MAAMiL,EAAE,UAAWA,EAAE,SAAS,EAClCjL,EAAI,YAAciL,EAAE,WAAa,GAGrCjL,EAAI,OAAOiL,EAAE,MAAQ7J,EAAO,EAAG,EAE/B,MAAMuW,EAAiB3X,EAAI,qBAAqB,EAAG,EAAG,EAAG,EAAG,EAAGiL,EAAE,IAAI,EACrE0M,EAAe,aAAa,EAAG,uBAAuB,EACtDA,EAAe,aAAa,GAAK1M,EAAE,KAAK,EACxC0M,EAAe,aAAa,EAAG,aAAa,EAE5C3X,EAAI,UAAY2X,EAChB3X,EAAI,UAAS,EACb,QAASnF,EAAI,EAAGA,EAAI,EAAGA,IACnBmF,EAAI,OAAO,KAAK,GAAK,EAAI,CAAC,EAC1BA,EAAI,QAAQ,EAAG,EAAGiL,EAAE,KAAMA,EAAE,KAAO,EAAG,EAAG,EAAG,KAAK,GAAK,CAAC,EAE3DjL,EAAI,KAAI,EACRA,EAAI,QAAO,CACf,CAAC,EAID,KAAK,YAAc,KAAK,WAAW,OAAS,GAC5C,KAAK,WAAW,QAAQwR,GAAM,CACtBA,EAAG,WACPxR,EAAI,KAAI,EAGRA,EAAI,UAAUwR,EAAG,EAAGA,EAAG,CAAC,EAGpB,KAAK,iBAAmBA,EAAG,YAAc,SACzCxR,EAAI,MAAMwR,EAAG,UAAWA,EAAG,SAAS,EACpCxR,EAAI,YAAcwR,EAAG,WAAa,GAItCxR,EAAI,UAAS,EACbA,EAAI,YAAc,SAClBA,EAAI,UAAY,EAChBA,EAAI,IAAI,EAAG,EAAGwR,EAAG,KAAO,IAAK,EAAG,KAAK,GAAK,CAAC,EAC3CxR,EAAI,OAAM,EAGVA,EAAI,UAAS,EACbA,EAAI,UAAY,QAChBA,EAAI,IAAI,EAAG,EAAGwR,EAAG,KAAM,EAAG,KAAK,GAAK,CAAC,EACrCxR,EAAI,KAAI,EAGRA,EAAI,YAAc,SAClBA,EAAI,WAAa,GACjBA,EAAI,OAAM,EACVA,EAAI,WAAa,EAEjBA,EAAI,QAAO,EACf,CAAC,EAID,KAAK,SAAW,KAAK,QAAQ,OAAS,EAAG,CACzC,MAAMmB,EAAO,KAAK,OAAO,KACzB,KAAK,QAAQ,QAAQtH,GAAK,CACtB,GAAIA,EAAE,SAAU,OAChBmG,EAAI,KAAI,EAGRA,EAAI,UAAUnG,EAAE,EAAGA,EAAE,CAAC,EAGlB,KAAK,iBAAmBA,EAAE,YAAc,SACxCmG,EAAI,MAAMnG,EAAE,UAAWA,EAAE,SAAS,EAClCmG,EAAI,YAAcnG,EAAE,WAAa,GAGrCmG,EAAI,OAAOnG,EAAE,SAAS,EAEtB,MAAM+d,EAAe/d,EAAE,OAASsH,EAC1B0W,EAAc,KAAK,IAAI,EAAG,KAAK,MAAMD,EAAe,EAAE,CAAC,EAQ7D,GALI/d,EAAE,UACF,KAAK,oBAAoBmG,EAAKnG,EAAG,MAAM,EAIvCA,EAAE,cAAe,CACjB,MAAMie,EAAY9X,EAAI,qBAAqB,EAAG,EAAGnG,EAAE,OAAS,IAAM,EAAG,EAAGA,EAAE,OAAS,IAAI,EACvFie,EAAU,aAAa,EAAG,aAAa,EACvCA,EAAU,aAAa,GAAKje,EAAE,gBAAkB,IAAI,EACpDie,EAAU,aAAa,EAAG,aAAa,EACvC9X,EAAI,UAAY8X,EAChB9X,EAAI,UAAS,EACbA,EAAI,IAAI,EAAG,EAAGnG,EAAE,OAAS,KAAM,EAAG,KAAK,GAAK,CAAC,EAC7CmG,EAAI,KAAI,CACZ,CAGA,MAAM+X,EAAW/X,EAAI,qBACjB,CAACnG,EAAE,OAAS,GAAK,CAACA,EAAE,OAAS,GAAK,EAClC,EAAG,EAAGA,EAAE,MACpC,EAYwB,GAXAke,EAAS,aAAa,EAAGle,EAAE,cAAc,EACzCke,EAAS,aAAa,GAAKle,EAAE,SAAS,EACtCke,EAAS,aAAa,GAAKle,EAAE,aAAa,EAC1Cke,EAAS,aAAa,EAAG,SAAS,EAElC/X,EAAI,UAAY+X,EAChB/X,EAAI,UAAS,EACbA,EAAI,IAAI,EAAG,EAAGnG,EAAE,OAAQ,EAAG,KAAK,GAAK,CAAC,EACtCmG,EAAI,KAAI,EAGJ6X,GAAe,EAAG,CAMlB,GALA7X,EAAI,YAAc,GAClBA,EAAI,YAAcnG,EAAE,cACpBmG,EAAI,UAAY,EAAImB,EAGhBtH,EAAE,OAAS,aAAeA,EAAE,OAAS,YACrC,QAASgB,EAAI,GAAIA,GAAK,EAAGA,IAAK,CAC1B,MAAMmd,EAAQne,EAAE,QAAUgB,EAAI,KACxBod,EAAY,KAAK,KAAKpe,EAAE,OAASA,EAAE,OAASme,EAAQA,CAAK,EAC3DC,EAAY,IACZjY,EAAI,UAAS,EACbA,EAAI,QAAQ,EAAGgY,EAAOC,EAAW,EAAG,EAAG,EAAG,KAAK,GAAK,CAAC,EACrDjY,EAAI,OAAM,EAElB,CAIJ,IAAKnG,EAAE,OAAS,eAAiBA,EAAE,OAAS,UAAYge,GAAe,EAAG,CACtE7X,EAAI,UAAYnG,EAAE,OAAS,QAAUA,EAAE,UAAYA,EAAE,eACrD,MAAM+C,EAAO/C,EAAE,YACf,QAASgQ,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,MAAM3P,EAAK,KAAK,IAAI0C,EAAOiN,EAAI,GAAG,EAAIhQ,EAAE,OAAS,GAC3CM,EAAK,KAAK,IAAIyC,EAAO,GAAMiN,CAAC,EAAIhQ,EAAE,OAAS,GAC3Cqe,EAAKre,EAAE,QAAU,IAAO,KAAK,IAAI+C,EAAOiN,CAAC,EAAI,IACnD7J,EAAI,UAAS,EACbA,EAAI,IAAI9F,EAAIC,EAAI+d,EAAI,EAAG,KAAK,GAAK,CAAC,EAClClY,EAAI,KAAI,CACZ,CACJ,CACAA,EAAI,YAAc,CACtB,CAGA,MAAMmY,EAAanY,EAAI,qBAAqB,CAACnG,EAAE,OAAQ,EAAGA,EAAE,OAAQ,CAAC,EACrEse,EAAW,aAAa,EAAG,aAAa,EACxCA,EAAW,aAAa,GAAK,aAAa,EAC1CA,EAAW,aAAa,EAAG,iBAAiB,EAC5CnY,EAAI,UAAYmY,EAChBnY,EAAI,UAAS,EACbA,EAAI,IAAI,EAAG,EAAGnG,EAAE,OAAQ,EAAG,KAAK,GAAK,CAAC,EACtCmG,EAAI,KAAI,EAGJnG,EAAE,UACF,KAAK,oBAAoBmG,EAAKnG,EAAG,OAAO,EAG5CmG,EAAI,QAAO,CACf,CAAC,CACL,CACJ,CAGA,oBAAoBA,EAAKoY,EAAQ3I,EAAM,CACnC,MAAM5V,EAAIue,EACVpY,EAAI,KAAI,EAGRA,EAAI,UAAS,EACTyP,IAAS,OAETzP,EAAI,KAAK,CAACnG,EAAE,gBAAkB,IAAK,CAACA,EAAE,gBAAiBA,EAAE,gBAAkB,EAAGA,EAAE,eAAe,EAG/FmG,EAAI,KAAK,CAACnG,EAAE,gBAAkB,IAAK,EAAGA,EAAE,gBAAkB,EAAGA,EAAE,eAAe,EAElFmG,EAAI,KAAI,EAGRA,EAAI,YAAcyP,IAAS,OAAS,GAAM,GAG1C,QAAS5U,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,MAAMwd,EAAQxe,EAAE,iBAAmBA,EAAE,gBAAkBA,EAAE,kBAAoBgB,EAAI,EAAI,IAC/Eyd,GAAiBze,EAAE,gBAAkBA,EAAE,iBAAmB,IAIhEmG,EAAI,YAAcnG,EAAE,UACpBmG,EAAI,UAAYsY,EAEhBtY,EAAI,UAAS,EACbA,EAAI,QAAQ,EAAG,EAAGqY,EAAOA,EAAQ,IAAM,EAAG,EAAG,KAAK,GAAK,CAAC,EACxDrY,EAAI,OAAM,CACd,CAEAA,EAAI,QAAO,CACf,CAEA,cAAcA,EAAKnD,EAAGa,EAAGE,EAAG,CACxBoC,EAAI,UAAS,EACb,MAAMuY,EAAK3a,EAAI,GACfoC,EAAI,OAAOnD,EAAGa,EAAIE,CAAC,EACnBoC,EAAI,OAAOnD,EAAI0b,EAAI7a,EAAI6a,CAAE,EACzBvY,EAAI,OAAOnD,EAAIe,EAAGF,CAAC,EACnBsC,EAAI,OAAOnD,EAAI0b,EAAI7a,EAAI6a,CAAE,EACzBvY,EAAI,OAAOnD,EAAGa,EAAIE,CAAC,EACnBoC,EAAI,OAAOnD,EAAI0b,EAAI7a,EAAI6a,CAAE,EACzBvY,EAAI,OAAOnD,EAAIe,EAAGF,CAAC,EACnBsC,EAAI,OAAOnD,EAAI0b,EAAI7a,EAAI6a,CAAE,EACzBvY,EAAI,UAAS,EACbA,EAAI,KAAI,CACZ,CAGA,wBAAyB,CACrB,GAAI,KAAK,MAAM,SAAW,EACtB,MAAO,CAAE,EAAG,KAAK,OAAO,MAAQ,EAAG,EAAG,KAAK,OAAO,OAAS,EAAG,EAAG,CAAC,EAEtE,IAAIwY,EAAO,EAAGC,EAAO,EAAGC,EAAO,EAC/B,YAAK,MAAM,QAAQld,GAAK,CACpBgd,GAAQhd,EAAE,EACVid,GAAQjd,EAAE,EACVkd,GAASld,EAAE,GAAK,CACpB,CAAC,EACM,CACH,EAAGgd,EAAO,KAAK,MAAM,OACrB,EAAGC,EAAO,KAAK,MAAM,OACrB,EAAGC,EAAO,KAAK,MAAM,MACzC,CACY,CAGA,SAAS7b,EAAGa,EAAG4M,EAAGwB,EAASC,EAAS,CAEhC,MAAM4M,EAAO,KAAK,UAAY,KAAK,GAAK,IAClCC,EAAO,KAAK,UAAY,KAAK,GAAK,IAClCC,EAAO,KAAK,UAAY,KAAK,GAAK,IAGxC,IAAI9X,EAAKlE,EAAIiP,EACT9K,EAAKtD,EAAIqO,EACT+M,EAAKxO,EAGLyO,EAAK/X,EAAK,KAAK,IAAI2X,CAAI,EAAIG,EAAK,KAAK,IAAIH,CAAI,EAC7CK,EAAKhY,EAAK,KAAK,IAAI2X,CAAI,EAAIG,EAAK,KAAK,IAAIH,CAAI,EACjD3X,EAAK+X,EACLD,EAAKE,EAGL,IAAIC,EAAKlY,EAAK,KAAK,IAAI6X,CAAI,EAAIE,EAAK,KAAK,IAAIF,CAAI,EACjDI,EAAK,CAACjY,EAAK,KAAK,IAAI6X,CAAI,EAAIE,EAAK,KAAK,IAAIF,CAAI,EAC9C7X,EAAKkY,EACLH,EAAKE,EAGLC,EAAKlY,EAAK,KAAK,IAAI8X,CAAI,EAAI7X,EAAK,KAAK,IAAI6X,CAAI,EAC7CE,EAAKhY,EAAK,KAAK,IAAI8X,CAAI,EAAI7X,EAAK,KAAK,IAAI6X,CAAI,EAC7C9X,EAAKkY,EACLjY,EAAK+X,EAGL,MAAMG,EAAM,IACN9e,EAAQ8e,GAAOA,EAAMJ,GAG3B,MAAO,CACH,EAAG/X,EAAK3G,EAAQ0R,EAChB,EAAG9K,EAAK5G,EAAQ2R,EAChB,MAAO3R,CAC3B,CACY,CAGA,gBAAgByC,EAAGa,EAAGoO,EAASC,EAAS,CAEpC,MAAM4M,EAAO,CAAC,KAAK,UAAY,KAAK,GAAK,IACnCC,EAAO,CAAC,KAAK,UAAY,KAAK,GAAK,IACnCC,EAAO,CAAC,KAAK,UAAY,KAAK,GAAK,IAGzC,IAAI9X,EAAKlE,EAAIiP,EACT9K,EAAKtD,EAAIqO,EACT+M,EAAK,EAMLG,EAAKlY,EAAK,KAAK,IAAI8X,CAAI,EAAI7X,EAAK,KAAK,IAAI6X,CAAI,EAC7CE,EAAKhY,EAAK,KAAK,IAAI8X,CAAI,EAAI7X,EAAK,KAAK,IAAI6X,CAAI,EACjD9X,EAAKkY,EACLjY,EAAK+X,EAGLE,EAAKlY,EAAK,KAAK,IAAI6X,CAAI,EAAIE,EAAK,KAAK,IAAIF,CAAI,EAC7C,IAAII,EAAK,CAACjY,EAAK,KAAK,IAAI6X,CAAI,EAAIE,EAAK,KAAK,IAAIF,CAAI,EAClD,OAAA7X,EAAKkY,EACLH,EAAKE,EAGLD,EAAK/X,EAAK,KAAK,IAAI2X,CAAI,EAAIG,EAAK,KAAK,IAAIH,CAAI,EAC7CK,EAAKhY,EAAK,KAAK,IAAI2X,CAAI,EAAIG,EAAK,KAAK,IAAIH,CAAI,EAC7C3X,EAAK+X,EACLD,EAAKE,EAGE,CACH,EAAGjY,EAAK+K,EACR,EAAG9K,EAAK+K,EACR,EAAG+M,CACvB,CACY,CAGA,eAAgB,CACZ,KAAK,UAAY,EACjB,KAAK,UAAY,EACjB,KAAK,UAAY,EAEjB,MAAMK,EAAU,SAAS,eAAe,YAAY,EAC9CC,EAAU,SAAS,eAAe,YAAY,EAC9CC,EAAU,SAAS,eAAe,YAAY,EAEhDF,IAAWA,EAAQ,MAAQ,EAAG,SAAS,eAAe,WAAW,EAAE,YAAc,MACjFC,IAAWA,EAAQ,MAAQ,EAAG,SAAS,eAAe,WAAW,EAAE,YAAc,MACjFC,IAAWA,EAAQ,MAAQ,EAAG,SAAS,eAAe,WAAW,EAAE,YAAc,KACzF,CAEA,mBAAoB,CAChB,MAAM7O,EAAQ,GACR8O,EAAM,GAENC,EAAU,IAAI,IACpB,KAAK,MAAM,QAAQ,GAAK,CACpBD,EAAI,EAAE,EAAE,EAAI,GACZC,EAAQ,IAAI,EAAE,GAAI,CAAC,CACvB,CAAC,EAED,QAAS1e,EAAI,EAAGA,EAAI,KAAK,MAAM,OAAQA,IACnC,QAASgP,EAAIhP,EAAI,EAAGgP,EAAI,KAAK,MAAM,OAAQA,IAAK,CAC5C,MAAMD,EAAK,KAAK,MAAM/O,CAAC,EACjBiP,EAAK,KAAK,MAAMD,CAAC,EACjB3O,EAAO,KAAK,MAAM0O,EAAG,EAAIE,EAAG,EAAGF,EAAG,EAAIE,EAAG,CAAC,EAE5C5O,EAAO,KAAK,OAAO,iBACnBsP,EAAM,KAAK,CAAE,GAAAZ,EAAI,GAAAE,EAAI,KAAA5O,CAAI,CAAE,EAC3Boe,EAAI1P,EAAG,EAAE,EAAE,KAAKE,EAAG,EAAE,EACrBwP,EAAIxP,EAAG,EAAE,EAAE,KAAKF,EAAG,EAAE,EAE7B,CAIJ,MAAMa,EAAW,GACX+O,EAAU,IAAI,IACpB,YAAK,MAAM,QAAQ3O,GAAQ,CACvB,GAAI,CAAC2O,EAAQ,IAAI3O,EAAK,EAAE,EAAG,CACvB,MAAM4O,EAAU,GACVC,EAAQ,CAAC7O,EAAK,EAAE,EAEtB,IADA2O,EAAQ,IAAI3O,EAAK,EAAE,EACZ6O,EAAM,QAAQ,CACjB,MAAMjO,EAAKiO,EAAM,MAAK,EAChBle,EAAI+d,EAAQ,IAAI9N,CAAE,EACpBjQ,GAAGie,EAAQ,KAAKje,CAAC,EACrB8d,EAAI7N,CAAE,EAAE,QAAQkO,GAAO,CACdH,EAAQ,IAAIG,CAAG,IAChBH,EAAQ,IAAIG,CAAG,EACfD,EAAM,KAAKC,CAAG,EAEtB,CAAC,CACL,CACIF,EAAQ,OAAS,GAAGhP,EAAS,KAAKgP,CAAO,CACjD,CACJ,CAAC,EAEM,CAAE,MAAAjP,EAAO,SAAAC,CAAQ,CAC5B,CAEA,UAAUmP,EAAK,CACX,QAAQ,IAAI,UAAWA,CAAG,EAE1B,IAAIC,EAAQ,SAAS,eAAe,OAAO,EACtCA,IACDA,EAAQ,SAAS,cAAc,KAAK,EACpCA,EAAM,GAAK,QACXA,EAAM,MAAM,QAAU,iLACtB,SAAS,KAAK,YAAYA,CAAK,GAEnCA,EAAM,YAAcD,EACpBC,EAAM,MAAM,QAAU,IACtB,aAAa,KAAK,aAAa,EAC/B,KAAK,cAAgB,WAAW,IAAM,CAAEA,EAAM,MAAM,QAAU,GAAK,EAAG,GAAI,CAC9E,CAGA,eAAgB,CACZ,MAAM5Y,EAAQ,SAAS,eAAe,WAAW,EAC7CA,GAAOA,EAAM,UAAU,IAAI,QAAQ,CAC3C,CAEA,eAAgB,CACZ,MAAMA,EAAQ,SAAS,eAAe,WAAW,EAC7CA,GAAOA,EAAM,UAAU,OAAO,QAAQ,CAC9C,CAEA,WAAW6Y,EAAU,CAUjB,MAAM9W,EATQ,CACV,YAAa,CAAE,KAAM,cAAe,SAAU,GAAI,aAAc,EAAG,EACnE,OAAQ,CAAE,KAAM,SAAU,SAAU,GAAI,aAAc,EAAG,EACzD,OAAQ,CAAE,KAAM,SAAU,SAAU,GAAI,aAAc,EAAG,EACzD,MAAO,CAAE,KAAM,QAAS,SAAU,GAAI,aAAc,EAAG,EACvD,MAAO,CAAE,KAAM,QAAS,SAAU,GAAI,aAAc,EAAG,EACvD,QAAS,CAAE,KAAM,UAAW,SAAU,GAAI,aAAc,EAAG,EAC3D,UAAW,CAAE,KAAM,cAAe,SAAU,GAAI,aAAc,EAAG,CACrF,EACmC8W,CAAQ,EACvB9W,GAAQ,KAAK,aACb,KAAK,WAAW,KAAO8W,EACvB,KAAK,WAAW,SAAW9W,EAAK,SAChC,KAAK,WAAW,aAAeA,EAAK,aACpC,KAAK,UAAU,YAAYA,EAAK,IAAI,EAAE,GAE1C,KAAK,cAAa,CACtB,CAEA,aAAc,CACV,GAAI,KAAK,MAAM,SAAW,EAAG,CACzB,KAAK,UAAU,oBAAoB,EACnC,MACJ,CAGA,KAAK,0BAAyB,EAE9B,IAAIzF,EAAO,IAAUC,EAAO,IAAUuc,EAAO,KAAWC,EAAO,KAC/D,KAAK,MAAM,QAAQxe,GAAK,CACpB+B,EAAO,KAAK,IAAIA,EAAM/B,EAAE,CAAC,EAAGgC,EAAO,KAAK,IAAIA,EAAMhC,EAAE,CAAC,EACrDue,EAAO,KAAK,IAAIA,EAAMve,EAAE,CAAC,EAAGwe,EAAO,KAAK,IAAIA,EAAMxe,EAAE,CAAC,CACzD,CAAC,EAED,MAAMye,EAAM,IACNha,EAAK8Z,EAAOxc,EAAQ0c,EAAM,EAC1B/Z,EAAK8Z,EAAOxc,EAAQyc,EAAM,EAC1BC,EAAM3c,EAAO0c,EACbE,EAAM3c,EAAOyc,EAEb,CAAE,MAAAzP,EAAO,SAAAC,GAAa,KAAK,kBAAiB,EAElD,IAAI2P,EAAM,oDAAoDF,CAAG,IAAIC,CAAG,IAAIla,CAAC,IAAIC,CAAC;AAAA,uBAC3Ega,CAAG,QAAQC,CAAG,YAAYla,CAAC,aAAaC,CAAC,qBAGhDsK,EAAM,QAAQiC,GAAK,CACf,MAAM4N,GAAM,EAAK5N,EAAE,KAAO,KAAK,OAAO,gBAAiB,QAAQ,CAAC,EAC1D,CAAC7O,EAAGqN,EAAGtI,CAAC,EAAI,KAAK,SAAS,KAAK,aAAa8J,EAAE,EAAE,CAAC,EACvD2N,GAAO,aAAa3N,EAAE,GAAG,CAAC,SAASA,EAAE,GAAG,CAAC,SAASA,EAAE,GAAG,CAAC,SAASA,EAAE,GAAG,CAAC,iBAAiB7O,CAAC,KAAKqN,CAAC,KAAKtI,CAAC,yDAAyD0X,EAAK,EAAG,KAC1K,CAAC,EAGD5P,EAAS,QAAQE,GAAK,CAClB,MAAMC,EAAO,OAAOD,EAAE,CAAC,EAAE,SAAS,EAClC,GAAIA,EAAE,OAAS,KAAK,OAAO,cAAgBC,IAAS,OAAOD,EAAE,CAAC,EAAE,EAAE,EAAG,OAErE,IAAIzQ,EAAK,EAAGC,EAAK,EAAGwQ,EAAE,QAAQnP,GAAK,CAAEtB,GAAMsB,EAAE,EAAGrB,GAAMqB,EAAE,CAAE,CAAC,EAAGtB,GAAMyQ,EAAE,OAAQxQ,GAAMwQ,EAAE,OACtF,MAAMjK,EAAQ,KAAK,aAAaiK,EAAE,CAAC,CAAC,EACpCyP,GAAO,YAAYlgB,CAAE,QAAQC,EAAK,EAAE,mDAAmDuG,CAAK,4CAA4CkK,CAAI,SAChJ,CAAC,EAGD,KAAK,MAAM,QAAQpP,GAAK,CACpB,MAAMkF,EAAQ,KAAK,aAAalF,CAAC,EAC3BoC,EAAI,KAAK,OAAO,YAAc,IAG9B2a,EAAK3a,EAAI,GACT0c,EAAW,IAAI9e,EAAE,CAAC,IAAIA,EAAE,EAAIoC,CAAC,KAAKpC,EAAE,EAAI+c,CAAE,IAAI/c,EAAE,EAAI+c,CAAE,KAAK/c,EAAE,EAAIoC,CAAC,IAAIpC,EAAE,CAAC,KAAKA,EAAE,EAAI+c,CAAE,IAAI/c,EAAE,EAAI+c,CAAE,KAAK/c,EAAE,CAAC,IAAIA,EAAE,EAAIoC,CAAC,KAAKpC,EAAE,EAAI+c,CAAE,IAAI/c,EAAE,EAAI+c,CAAE,KAAK/c,EAAE,EAAIoC,CAAC,IAAIpC,EAAE,CAAC,KAAKA,EAAE,EAAI+c,CAAE,IAAI/c,EAAE,EAAI+c,CAAE,KAChM6B,GAAO,YAAYE,CAAQ,WAAW5Z,CAAK,oBAG3C0Z,GAAO,eAAe5e,EAAE,CAAC,SAASA,EAAE,CAAC,2BACzC,CAAC,EAED4e,GAAO,SAGP,MAAMG,EAAO,IAAI,KAAK,CAACH,CAAG,EAAG,CAAE,KAAM,8BAA+B,EAC9DI,EAAW,aAAa,KAAK,IAAG,CAAE,OAGxC,GAAI,OAAO,OAAO,UAAU,WAAe,IAAa,CACpD,OAAO,UAAU,WAAWD,EAAMC,CAAQ,EAC1C,KAAK,UAAU,cAAc,EAC7B,MACJ,CAEA,MAAMC,EAAM,OAAO,IAAI,gBAAgBF,CAAI,EACrCG,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,KAAOD,EACZC,EAAK,SAAWF,EAGhB,MAAMG,EAAQ,IAAI,WAAW,QAAS,CAClC,KAAM,OACN,QAAS,GACT,WAAY,EAChC,CAAiB,EACDD,EAAK,cAAcC,CAAK,EAGxB,WAAW,IAAM,CACb,OAAO,IAAI,gBAAgBF,CAAG,CAClC,EAAG,GAAI,EAEP,KAAK,UAAU,cAAc,CACjC,CAGA,aAAc,CACV,MAAMD,EAAW,gBAAgB,KAAK,IAAG,CAAE,OACrCE,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,SAAWF,EAChBE,EAAK,KAAO,KAAK,OAAO,UAAU,WAAW,EAG7C,MAAMC,EAAQ,IAAI,WAAW,QAAS,CAClC,KAAM,OACN,QAAS,GACT,WAAY,EAChC,CAAiB,EACDD,EAAK,cAAcC,CAAK,EAExB,KAAK,UAAU,kBAAoBH,CAAQ,CAC/C,CAGA,gBAAiB,CACb,SAAS,eAAe,cAAc,EAAE,MAAK,CACjD,CAGA,QAAQG,EAAO,CACX,MAAMC,EAAOD,EAAM,OAAO,MAAM,CAAC,EACjC,GAAI,CAACC,EAAM,OAEX,MAAMC,EAAS,IAAI,WACnBA,EAAO,OAAUrhB,GAAM,CACnB,GAAI,CACA,MAAMshB,EAAathB,EAAE,OAAO,OAKtBuhB,EAJS,IAAI,UAAS,EACT,gBAAgBD,EAAY,eAAe,EAGrC,iBAAiB,qBAAqB,EAE/D,GAAIC,EAAa,SAAW,EAAG,CAC3B,KAAK,UAAU,uBAAuB,EACtC,MACJ,CAGA,KAAK,MAAQ,GACb,KAAK,QAAU,GAGfA,EAAa,QAAQ,CAACC,EAAMvV,IAAU,CAClC,MAAM,EAAIuV,EAAK,aAAa,GAAG,EACzBC,EAAOD,EAAK,aAAa,MAAM,EAG/BE,EAAQ,EAAE,MAAM,wBAAwB,EAC9C,GAAIA,EAAO,CACP,MAAMC,EAAO,WAAWD,EAAM,CAAC,CAAC,EAC1BE,EAAO,WAAWF,EAAM,CAAC,CAAC,EAC1Btd,EAAI,KAAK,OAAO,YAAc,IAC9B,EAAIwd,EAAOxd,EAEjB,KAAK,MAAM,KAAK,CACZ,GAAI,KAAK,IAAG,EAAK6H,EACjB,EAAG0V,EACH,EACA,MAAOF,EACP,MAAO,KAAK,OAAM,EAAK,KAAK,GAAK,EACjC,UAAW,IAC/C,CAAiC,CACL,CACJ,CAAC,EAEDN,EAAM,OAAO,MAAQ,GACrB,KAAK,UAAU,UAAU,KAAK,MAAM,MAAM,QAAQ,EAClD,KAAK,KAAI,CACb,OAASU,EAAK,CACV,QAAQ,MAAM,qBAAsBA,CAAG,EACvC,KAAK,UAAU,wBAAwB,CAC3C,CACJ,EACAR,EAAO,WAAWD,CAAI,CAC1B,CAGA,aAAc,CACV,GAAI,KAAK,aAAc,CACnB,KAAK,UAAU,sBAAsB,EACrC,MACJ,CAGA,MAAMU,EAAiB,SAAS,eAAe,eAAe,EACxDC,EAAWD,EAAiB,SAASA,EAAe,KAAK,EAAI,IAC7DE,EAAcD,EAAW,IAE/B,KAAK,aAAe,GACpB,MAAMjiB,EAAM,SAAS,eAAe,gBAAgB,EAChDA,GAAKA,EAAI,UAAU,IAAI,QAAQ,EAEnC,KAAK,UAAU,aAAakiB,CAAW,aAAa,EAEpD,MAAMzH,EAAS,KAAK,OAAO,cAAc,EAAE,EACrC0H,EAAS,GAETC,EAAW,cAAc,gBAAgB,uBAAuB,EAChE,wBACA,aAEAC,EAAW,IAAI,cAAc5H,EAAQ,CAAE,SAAA2H,CAAQ,CAAE,EAEvDC,EAAS,gBAAmBniB,GAAM,CAC1BA,EAAE,KAAK,KAAO,GAAGiiB,EAAO,KAAKjiB,EAAE,IAAI,CAC3C,EAEAmiB,EAAS,OAAS,IAAM,CACpB,KAAK,aAAe,GAChBriB,GAAKA,EAAI,UAAU,OAAO,QAAQ,EAEtC,MAAMihB,EAAO,IAAI,KAAKkB,EAAQ,CAAE,KAAMC,EAAU,EAC1ClB,EAAW,gBAAgB,KAAK,IAAG,CAAE,QACrCC,EAAM,OAAO,IAAI,gBAAgBF,CAAI,EACrCG,EAAO,SAAS,cAAc,GAAG,EACvCA,EAAK,KAAOD,EACZC,EAAK,SAAWF,EAGhB,MAAMG,EAAQ,IAAI,WAAW,QAAS,CAClC,KAAM,OACN,QAAS,GACT,WAAY,EACpC,CAAqB,EACDD,EAAK,cAAcC,CAAK,EAGxB,WAAW,IAAM,CACb,OAAO,IAAI,gBAAgBF,CAAG,CAClC,EAAG,GAAI,EAEP,KAAK,UAAU,iBAAiB,CACpC,EAEAkB,EAAS,QAAWniB,GAAM,CACtB,KAAK,aAAe,GAChBF,GAAKA,EAAI,UAAU,OAAO,QAAQ,EACtC,QAAQ,MAAM,mBAAoBE,CAAC,EACnC,KAAK,UAAU,kBAAkB,CACrC,EAEAmiB,EAAS,MAAK,EAEd,WAAW,IAAM,CACTA,EAAS,QAAU,aACnBA,EAAS,KAAI,CAErB,EAAGJ,CAAQ,CACf,CACZ,CAEQ,OAAO,IAAM,IAAI7iB","names":["AetherEngine","savedUpgrades","savedHistory","zodiac","animals","mythology","__vitePreload","m","createBtn","category","key","containerId","btn","k","e","points","totalX","totalY","totalZ","p","count","centroidX","centroidY","centroidZ","cx","cy","scale","isRainbow","_a","templateColor","_b","baseName","creativeName","suffix","newStars","i","zDepth","xPos","yPos","pZ","dist","matrixSpeedSlider","matrixLengthSlider","matrixAngleSlider","matrixColorPicker","matrixColorHex","s","val","rotXSlider","rotYSlider","rotZSlider","bgStars","makeDraggable","elementId","element","header","isDragging","startX","startY","initialX","initialY","rect","dx","dy","newMode","hexColor","seed","x","worldX","worldY","sectorX","sectorY","sector","sx","sy","sectorData","d","minX","minY","mineralCount","y","type","r","info","mineral","depositCount","zone","richness","deposit","style","matrixPanel","panel","hud","floatingMap","floatingLeaders","shipBtn","sectionId","section","gemsSection","resizeHandle","isResizing","startWidth","width","clampedWidth","windowId","win","speedNumEl","zoomEl","coordsEl","gemsGrid","gemsTotalEl","creditsEl","totalValue","html","inventory","itemValue","valueDisplay","canvas","ctx","w","h","radarRange","rx","ry","angle","offsetX","offsetY","dep","color","glowColor","label","pulse","glowSize","px","py","modal","newZoom","zoom","time","bgGradient","gridSize","worldCx","worldCy","visibleW","visibleH","endX","endY","zoneColor","grad","size","mineralInfo","shipX","shipY","fovRadius","scaleDistance","opacity","parallax","spacing","modX","listEl","mockPlayers","b","player","medal","isYou","total","ship","keys","cos","sin","boost","ratio","friction","lineCount","line","saved","qty","upgradeCosts","currentLevel","cost","lvl","spawnRadius","targetDensity","hotspotBonus","activeHotspot","inHotspot","playerDistFromOrigin","dz","currentZone","mineralKey","distance","zOffset","spawnX","spawnY","hotAngle","hotDist","spawnZ","zoneKey","bonusMultiplier","zones","allElements","weights","totalWeight","elementKey","weight","random","collectionRadius","index","now","n","c1","c2","c3","_c","warpBtn","list","credits","upgrades","costs","u","level","isMax","canAfford","bars","driftBtn","slider","startValue","startTime","fastSlowdownDuration","gradualSlowdownDuration","totalDuration","animateSliderBackward","currentTime","elapsed","value","progress","eased","finalizePositions","arr","obj","storeOriginalPosition","stopAutoAnimation","firstHalfDuration","secondHalfDuration","animateSlider","secondElapsed","maintainTime","wave1","wave2","wave3","surge","updateState","rawValue","normalized","curved","fixedIndicator","rainbowBtn","colorText","colorInput","world","hitDist","starHit","newCursor","rotXSliderEl","rotYSliderEl","deltaWorldX","deltaWorldY","draggedIdString","wasNavigating","clickedStar","center","pos3D","clickedStarIndex","lineHitDist","s1","j","s2","lineLen","t","projX","projY","indices","a","worldPos","z","starColor","lines","clusters","assignmentMap","c","name","star","assigned","hex","shorthandRegex","g","result","newState","prevState","delta","group","existing","sortedIds","id","pre","root","suf","activeColors","centerX","centerY","spreadX","spreadY","vx","vy","speed","depthLayer","rgb","max","min","l","f","toHex","zRange","starCount","tier","cfg","planetTypes","planetConfigs","perturbColor","amount","checkPlanetSpacing","radius","dist2D","required2D","zDepthTiers","tierIndex","zTier","hasRings","attempts","shootingStarCount","nebulaConfigs","colors","theme","color1","color2","shipClasses","pool","sc","shipClass","hue","isSaucer","fontSize","columns","themes","lastFamily","availableThemes","familyFiltered","lastTheme","themeIndex","speedLevels","selectedSpeed","displayEl","sliderValue","depth","len","chars","streamColor","half","linearSlider","targetWarp","rampSpeed","warpIntensity","jitterAmount","jitterAngle","baseDirX","baseDirY","cosJ","sinJ","dirX","dirY","depthFactor","perspectiveAccel","maxDist","startDist","fadeRate","camera","screenCenterWorldX","screenCenterWorldY","maxWorldDist","isDisengaging","flyObject","speedMultiplier","maxSpread","ease","alphaDelay","alphaProgress","zoomFactor","globalIndex","bh","paraX","paraY","parsedR","parsedG","parsedB","distFromCenter","perspFactor","streakLength","cappedStreak","dirOutX","dirOutY","headX","headY","tailX","tailY","baseAlpha","intensityBoost","alpha","brightR","brightG","brightB","lineW","coreR","coreG","coreB","coreLen","coreX","coreY","headR","headG","headB","headSize","renderError","edge","speedMult","lengthMult","baseVisibleLength","rainbowHueOffset","stream","streamIndex","visibleLength","char","charY","relativePos","rotCenterX","rotCenterY","s1z","s2z","p1","p2","avgColor","timeNow","wScale","wAlpha","isHover","sz","rotated","rScale","twinkle","glowRad","statEl","constellationCount","roll","pitch","pitchScale","outerAngle","innerAngle","outerX","outerY","innerX","innerY","flicker","pulseGlow","safeZoom","gradient","notification","age","yOffset","scaledSize","scaledAlpha","tailGrad","shieldPulse","shieldGrad","beamPulse","beamGrad","trailLength","engineSpacing","engineCount","trailGrad","hullGrad","domeGrad","bioGrad","eyeGrad","sphereGrad","laserGrad","cockpitGrad","panelGrad","lightPulse","spiralGradient","screenRadius","detailLevel","atmosGrad","bodyGrad","bandY","bandWidth","cr","shadowGrad","planet","ringR","ringThickness","pr","sumX","sumY","sumZ","radX","radY","radZ","pz","y1","z1","x1","fov","xSlider","ySlider","zSlider","adj","starMap","visited","cluster","queue","nid","msg","toast","shipType","maxX","maxY","pad","vbX","vbY","svg","op","pathData","blob","filename","url","link","event","file","reader","svgContent","pathElements","path","fill","match","topX","topY","err","durationSelect","duration","durationSec","chunks","mimeType","recorder"],"ignoreList":[],"sources":["../../src/pages/interstellar/index.html?html-proxy&index=1.js"],"sourcesContent":["\n        /**\n         * Aether Map Engine v5.0 - Pre-Placement Color Model\n         */\n        class AetherEngine {\n            constructor() {\n                this.canvas = document.getElementById('canvas');\n                this.ctx = this.canvas.getContext('2d', { alpha: false });\n\n                // Configuration\n                this.config = {\n                    maxConnectDist: 180,\n                    starBaseRad: 3.5,\n                    minGroupSize: 3,\n                    bgColor: '#020205',\n                    showBackground: true,\n                };\n\n                // World size for background generation (covers full canvas at min zoom 0.1x)\n                this.worldSize = 12000;\n\n                // Procedural Universe Generation System\n                this.sectorSize = 10000; // Each sector is 10k x 10k units\n                this.loadedSectors = new Map(); // Map of \"x,y\" -> sector data\n                this.currentSector = { x: 0, y: 0 }; // Player's current sector\n                this.generationBoundary = 3000; // Generate new sectors when within this distance of edge\n\n                // State\n                this.stars = [];\n                this.camera = { x: 0, y: 0, zoom: 1, targetZoom: 1 };\n                this.history = [];\n                this.mode = 'draw'; // 'draw' or 'select'\n\n                // NEW COLOR STATE\n                this.activeColor = '#00f3ff';\n                this.colorMode = 'fixed'; // 'fixed' or 'rainbow'\n                this.activeStyles = new Set(); // Start with no backgrounds active\n                this.matrixSpeedMultiplier = 1.0; // User-adjustable cyber speed\n                this.matrixLengthMultiplier = 1.0; // User-adjustable cyber stream length\n                this.matrixColor = '#00ff00'; // User-adjustable matrix stream color\n                this.matrixRainbowMode = false; // Rainbow color cycling for matrix\n                this.matrixAngle = 0; // Angle in degrees for stream direction\n\n                // Generic Background Mode Options\n                this.starColors = ['#ffffff', '#aaddff', '#ffddaa']; // 3 customizable star colors\n                this.bgDriftMode = false; // Star drift movement enabled  \n                this.bgWarpMode = false; // Warp speed effect enabled\n                this.warpSpeed = 0; // Current warp animation speed (for ramping)\n                this.warpSpeedMultiplier = 1; // User-controlled warp intensity (0.5 to 5)\n                this.warpStartTime = 0; // When warp mode started\n                this.shootingStarsActive = []; // Active shooting stars in normal mode\n                this.lastShootingStarTime = 0; // Last time a shooting star was spawned\n\n                // Flight game state\n                this.flightMode = false;\n                this.keysPressed = {};\n                this.credits = this.loadCredits();\n                const savedUpgrades = this.loadUpgrades();\n\n                this.playerShip = {\n                    type: 'default',\n                    x: 0, y: 0, z: 0,\n                    vx: 0, vy: 0, vz: 0,\n                    rotation: 0,\n                    pitch: 0, // 3D pitch rotation (up/down)\n                    roll: 0,  // 3D roll rotation (barrel roll)\n                    speed: 0,\n                    maxSpeed: 50 * (1 + (savedUpgrades.speed || 0) * 0.2),\n                    acceleration: 0.5 * (1 + (savedUpgrades.speed || 0) * 0.1),\n                    rotationSpeed: 0.08,\n                    size: 45,\n                    hullHealth: 100 * (1 + (savedUpgrades.armor || 0) * 0.2),\n                    maxHull: 100 * (1 + (savedUpgrades.armor || 0) * 0.2),\n                    shield: 50 * (1 + (savedUpgrades.shield || 0) * 0.2),\n                    maxShield: 50 * (1 + (savedUpgrades.shield || 0) * 0.2),\n                    radarRange: 2000 * (1 + (savedUpgrades.radar || 0) * 0.3),\n                    upgrades: savedUpgrades\n                };\n                this.speedLines = [];  // Visual speed indicators\n                this.showGemValues = false; // Toggle for showing gem values\n\n                // Mineral system\n                this.minerals = [];\n                this.mineralTypes = {\n                    // ============ INDUSTRIAL ZONE (50% spawn rate in industrial galaxies) ============\n                    iron: { name: 'Iron', value: 10, color: '#8B8680', rarity: 'common', size: 15, zone: 'industrial', use: 'Basic construction' },\n                    copper: { name: 'Copper', value: 25, color: '#B87333', rarity: 'common', size: 15, zone: 'industrial', use: 'Wiring, conductors' },\n                    coal: { name: 'Coal', value: 15, color: '#36454F', rarity: 'common', size: 12, zone: 'industrial', use: 'Fuel source' },\n                    titanium: { name: 'Titanium', value: 80, color: '#878681', rarity: 'common', size: 16, zone: 'industrial', use: 'Armor plating' },\n                    silicon: { name: 'Silicon', value: 45, color: '#A0A0A0', rarity: 'common', size: 14, zone: 'industrial', use: 'Electronics, circuits' },\n\n                    // ============ PRECIOUS ZONE (25% spawn rate in precious galaxies) ============\n                    silver: { name: 'Silver', value: 150, color: '#C0C0C0', rarity: 'uncommon', size: 18, zone: 'precious', use: 'Currency, conductors' },\n                    gold: { name: 'Gold', value: 400, color: '#FFD700', rarity: 'uncommon', size: 20, zone: 'precious', use: 'Electronics, currency' },\n                    platinum: { name: 'Platinum', value: 500, color: '#E5E4E2', rarity: 'uncommon', size: 20, zone: 'precious', use: 'Catalysts, jewelry' },\n                    palladium: { name: 'Palladium', value: 600, color: '#CED0DD', rarity: 'uncommon', size: 19, zone: 'precious', use: 'Fuel cells, catalysts' },\n\n                    // ============ CRYSTAL ZONE (15% spawn rate in crystal galaxies) ============\n                    quartz: { name: 'Quartz', value: 800, color: '#F5F5F5', rarity: 'rare', size: 22, zone: 'crystal', use: 'Optics, sensors' },\n                    diamond: { name: 'Diamond', value: 2500, color: '#B9F2FF', rarity: 'rare', size: 25, zone: 'crystal', use: 'Cutting tools, lasers' },\n                    emerald: { name: 'Emerald', value: 3000, color: '#50C878', rarity: 'rare', size: 25, zone: 'crystal', use: 'Energy focusing' },\n                    ruby: { name: 'Ruby', value: 2800, color: '#E0115F', rarity: 'rare', size: 25, zone: 'crystal', use: 'Laser amplification' },\n                    sapphire: { name: 'Sapphire', value: 3200, color: '#0F52BA', rarity: 'rare', size: 25, zone: 'crystal', use: 'Shield technology' },\n\n                    // ============ NUCLEAR ZONE (7% spawn rate near black holes) ============\n                    uranium: { name: 'Uranium', value: 8000, color: '#4AFF00', rarity: 'epic', size: 28, zone: 'nuclear', use: 'Nuclear reactors' },\n                    plutonium: { name: 'Plutonium', value: 12000, color: '#00FF7F', rarity: 'epic', size: 28, zone: 'nuclear', use: 'Advanced power' },\n                    helium3: { name: 'Helium-3', value: 15000, color: '#87CEEB', rarity: 'epic', size: 26, zone: 'nuclear', use: 'Fusion reactors' },\n\n                    // ============ EXOTIC ZONE (3% spawn rate - edge of space) ============\n                    neodymium: { name: 'Neodymium', value: 25000, color: '#FF6EC7', rarity: 'legendary', size: 30, zone: 'exotic', use: 'Magnet tech' },\n                    lanthanum: { name: 'Lanthanum', value: 30000, color: '#9D00FF', rarity: 'legendary', size: 32, zone: 'exotic', use: 'Hybrid engines' },\n                    darkmatter: { name: 'Dark Matter', value: 100000, color: '#1a0033', rarity: 'mythic', size: 35, zone: 'exotic', use: 'Warp drives' },\n                    antimatter: { name: 'Antimatter', value: 150000, color: '#FF00FF', rarity: 'mythic', size: 35, zone: 'exotic', use: 'Annihilation power' }\n                };\n\n                // Galaxy zone configuration - determines element distribution\n                this.galaxyZones = {\n                    industrial: {\n                        name: 'Industrial Sector',\n                        color: '#8B8680',\n                        glowColor: 'rgba(139, 134, 128, 0.3)',\n                        elements: ['iron', 'copper', 'coal', 'titanium', 'silicon'],\n                        concentrationBonus: 3.0,\n                        defenseLevel: 1,\n                        distanceRange: { min: 100, max: 800 }\n                    },\n                    precious: {\n                        name: 'Precious Nebula',\n                        color: '#FFD700',\n                        glowColor: 'rgba(255, 215, 0, 0.3)',\n                        elements: ['silver', 'gold', 'platinum', 'palladium'],\n                        concentrationBonus: 2.5,\n                        defenseLevel: 2,\n                        distanceRange: { min: 800, max: 2000 }\n                    },\n                    crystal: {\n                        name: 'Crystal Fields',\n                        color: '#50C878',\n                        glowColor: 'rgba(80, 200, 120, 0.3)',\n                        elements: ['quartz', 'diamond', 'emerald', 'ruby', 'sapphire'],\n                        concentrationBonus: 2.0,\n                        defenseLevel: 3,\n                        distanceRange: { min: 2000, max: 4000 }\n                    },\n                    nuclear: {\n                        name: 'Radiation Belt',\n                        color: '#4AFF00',\n                        glowColor: 'rgba(74, 255, 0, 0.4)',\n                        elements: ['uranium', 'plutonium', 'helium3'],\n                        concentrationBonus: 1.5,\n                        defenseLevel: 4,\n                        distanceRange: { min: 3500, max: 5000 }\n                    },\n                    exotic: {\n                        name: 'Dark Frontier',\n                        color: '#9D00FF',\n                        glowColor: 'rgba(157, 0, 255, 0.4)',\n                        elements: ['neodymium', 'lanthanum', 'darkmatter', 'antimatter'],\n                        concentrationBonus: 1.0,\n                        defenseLevel: 5,\n                        distanceRange: { min: 5000, max: 8000 }\n                    }\n                };\n\n                // Resource deposits - persistent locations with finite resources\n                this.resourceDeposits = [];\n\n                // Defense entities\n                this.sentinels = [];     // AI patrol drones\n                this.forcefields = [];   // Energy barriers\n                this.turrets = [];       // Stationary guns\n                this.guardians = [];     // Boss-level protectors\n                this.projectiles = [];   // Active projectiles\n                this.playerInventory = this.loadInventory();\n                this.collectionNotifications = [];\n\n                // Initialize Matrix theme history (must exist before toggleBgStyle/generateCyberStyle is called)\n                try {\n                    const savedHistory = localStorage.getItem('matrixThemeHistory');\n                    this.themeHistory = savedHistory ? JSON.parse(savedHistory) : [];\n                    this.lastMatrixFamily = localStorage.getItem('matrixLastFamily') || '';\n                } catch (e) {\n                    this.themeHistory = [];\n                    this.lastMatrixFamily = '';\n                }\n\n                // Initialize background arrays (must exist before toggleBgStyle is called)\n                this.staticStars = [];\n                this.galaxies = [];\n                this.blackHoles = [];\n                this.shootingStars = [];\n                this.backgroundStars = [];\n                this.nebulae = [];\n                this.spacecraft = [];\n                this.matrixStreams = [];\n                this.planets = [];\n\n                // 3D Rotation State (degrees)\n                this.rotationX = 0;\n                this.rotationY = 0;\n                this.rotationZ = 0;\n\n                // Interaction State\n                this.pointer = { x: 0, y: 0, startX: 0, startY: 0, isDown: false, dragging: false, lastWorldX: 0, lastWorldY: 0 };\n                this.hoveredStar = null;\n                this.draggedStar = null;\n                this.draggedClusterId = null; // Used only for dragging entire clusters\n\n                // Generators\n                this.initNameGenerators();\n                // Generators\n                this.initNameGenerators();\n                this.initTemplates();\n                this.generateResourceDeposits();\n\n                // Performance\n                this.backgroundStars = [];\n\n                this.init();\n            }\n\n            async initTemplates() {\n                try {\n                    // Modern Module Loading: Dynamic Import of JSON assets\n                    // Vite handles this natively\n                    const [zodiac, animals, mythology] = await Promise.all([\n                        import('./templates/zodiac.json').then(m => m.default),\n                        import('./templates/animals.json?bust=1').then(m => m.default),\n                        import('./templates/mythology.json').then(m => m.default)\n                    ]);\n\n                    this.templates = { zodiac, animals, mythology };\n\n                    // Render Buttons\n                    const createBtn = (category, key, containerId) => {\n                        const btn = document.createElement('button');\n                        btn.className = 'btn-small';\n                        btn.style.margin = '2px';\n                        btn.style.textTransform = 'capitalize';\n                        btn.innerText = key;\n                        btn.onclick = () => this.loadTemplate(category, key);\n                        document.getElementById(containerId).appendChild(btn);\n                    };\n\n                    // Only render if data loaded\n                    if (this.templates.zodiac) Object.keys(this.templates.zodiac).forEach(k => createBtn('zodiac', k, 'zodiacTemplates'));\n                    if (this.templates.animals) Object.keys(this.templates.animals).forEach(k => createBtn('animals', k, 'animalTemplates'));\n                    if (this.templates.mythology) Object.keys(this.templates.mythology).forEach(k => createBtn('mythology', k, 'mythTemplates'));\n\n                } catch (e) {\n                    console.error(\"Template loading failed:\", e);\n                    this.showToast(\"Failed to load templates\");\n                }\n            }\n\n            loadTemplate(category, key) {\n                const points = this.templates[category][key];\n                if (!points) return;\n\n                this.saveState(); // Save before clearing\n\n                // Center Calculation: Find centroid of the template points\n                let totalX = 0, totalY = 0, totalZ = 0;\n                points.forEach(p => {\n                    totalX += p[0];\n                    totalY += p[1];\n                    totalZ += (p[2] || 0);\n                });\n                const count = points.length;\n                const centroidX = totalX / count;\n                const centroidY = totalY / count;\n                const centroidZ = totalZ / count;\n\n                // Reset Camera to ensure visibility (User request: \"put in middle of screen\")\n                this.camera = { x: 0, y: 0, zoom: 1 };\n\n                // Center Position\n                const cx = 0;\n                const cy = 0;\n                const scale = 3;\n\n                // Offset calculation happens inside mapping (p[0] - centroidX)\n\n                // Check Rainbow Mode\n                const isRainbow = document.getElementById('templateRainbowMode')?.checked;\n                const templateColor = document.getElementById('templateColorPicker')?.value || '#00ffff';\n\n                // Generate Creative Name\n                const baseName = key.charAt(0).toUpperCase() + key.slice(1);\n                let creativeName = baseName;\n\n                try {\n                    if (!this.prefixes) this.initNameGenerators();\n                    if (this.prefixes && this.prefixes.length > 0) {\n                        if (Math.random() > 0.5) {\n                            const prefix = this.prefixes[Math.floor(Math.random() * this.prefixes.length)];\n                            creativeName = `${prefix} ${baseName}`;\n                        } else {\n                            const suffix = this.suffixes[Math.floor(Math.random() * this.suffixes.length)];\n                            creativeName = `${baseName} ${suffix}`;\n                        }\n                    }\n                } catch (e) { console.warn(\"Name gen failed\", e); }\n\n                // Create stars with 3D Depth\n                const newStars = points.map((p, i) => {\n                    let zDepth = 0;\n                    let xPos = p[0] - centroidX;\n                    let yPos = p[1] - centroidY;\n                    let pZ = (p[2] || 0) - centroidZ;\n\n                    if (p.length >= 3) {\n                        // Explicit Z from template data\n                        zDepth = pZ * scale;\n                    } else {\n                        // Implicit 3D: Map 2D constellations onto a gentle celestial curve\n                        // Calculate distance from center (which is now 0,0 locally)\n                        const dist = Math.sqrt(xPos * xPos + yPos * yPos);\n                        // Curve edges away\n                        zDepth = -(dist * dist) * 0.05 * scale;\n                    }\n\n                    return {\n                        id: Date.now() + i,\n                        x: cx + xPos * scale,\n                        y: cy + yPos * scale,\n                        z: zDepth,\n                        color: isRainbow ? this.getRainbowHex() : templateColor,\n                        phase: Math.random() * Math.PI * 2,\n                        clusterId: creativeName\n                    };\n                });\n\n                this.stars = newStars;\n\n                // Close panel\n                document.getElementById('templatePanel').style.display = 'none';\n                this.showToast(`Loaded ${key} template`);\n                this.draw();\n            }\n\n            initNameGenerators() {\n                this.prefixes = [\"Alpha\", \"Beta\", \"Gamma\", \"Delta\", \"Neo\", \"Proto\", \"Hyper\", \"Cyber\", \"Dark\", \"Lost\", \"Royal\", \"Azure\", \"Crimson\", \"Void\", \"Solar\", \"Lunar\", \"Emerald\", \"Obsidian\"];\n                this.roots = [\"Orion\", \"Cygnus\", \"Draco\", \"Lyra\", \"Vela\", \"Hydra\", \"Cetus\", \"Lupus\", \"Pavo\", \"Volans\", \"Aries\", \"Leo\", \"Gemini\", \"Ursa\", \"Vortex\", \"Helix\", \"Prism\", \"Shard\", \"Echo\", \"Serpens\", \"Phoenix\"];\n                this.suffixes = [\"Major\", \"Minor\", \"Prime\", \"Zero\", \"Cluster\", \"Nebula\", \"Expanse\", \"Quadrant\", \"Sector\", \"Knot\", \"Web\", \"Crown\", \"Trident\", \"Gate\", \"Symphony\", \"Paradox\"];\n            }\n\n            init() {\n                window.addEventListener('resize', () => this.resize());\n\n                // Pointer Events\n                this.canvas.addEventListener('pointerdown', e => this.onPointerDown(e));\n                window.addEventListener('pointermove', e => this.onPointerMove(e));\n                window.addEventListener('pointerup', e => this.onPointerUp(e));\n                this.canvas.addEventListener('wheel', e => this.onWheel(e), { passive: false });\n                this.canvas.addEventListener('contextmenu', e => this.onRightClick(e)); // Right-click deletion\n\n                // Keyboard\n                window.addEventListener('keydown', e => {\n                    // Undo shortcut\n                    if ((e.ctrlKey || e.metaKey) && e.key === 'z') {\n                        e.preventDefault();\n                        this.undo();\n                        return;\n                    }\n\n                    // Flight mode controls\n                    if (this.flightMode) {\n                        const key = e.key.toLowerCase();\n                        if (key === 'u') {\n                            this.toggleUpgradePanel();\n                        } else {\n                            this.keysPressed[key] = true;\n                        }\n                        e.preventDefault();\n                    }\n                });\n\n                window.addEventListener('keyup', e => {\n                    if (this.flightMode) {\n                        const key = e.key.toLowerCase();\n                        this.keysPressed[key] = false;\n                    }\n                });\n                // Initial mode setup\n                this.setMode('draw');\n                // Initial color state setup\n                this.updateColorModeUI();\n\n                // Cyber speed slider\n                this.matrixColorCustomized = false;\n\n                // UI Events\n                this.initDraggableWindows();\n\n                // UI Events\n                this.initDraggableWindows();\n\n                // UI Events\n                this.initDraggableWindows();\n\n                // Matrix (previously Cyber) speed slider\n                const matrixSpeedSlider = document.getElementById('matrixSpeedSlider');\n                if (matrixSpeedSlider) {\n                    matrixSpeedSlider.addEventListener('input', (e) => {\n                        this.matrixSpeedMultiplier = parseFloat(e.target.value);\n                        document.getElementById('matrixSpeedValue').textContent = this.matrixSpeedMultiplier.toFixed(1) + 'x';\n                    });\n                }\n\n                // Matrix length slider\n                const matrixLengthSlider = document.getElementById('matrixLengthSlider');\n                if (matrixLengthSlider) {\n                    matrixLengthSlider.addEventListener('input', (e) => {\n                        this.matrixLengthMultiplier = parseFloat(e.target.value);\n                        document.getElementById('matrixLengthValue').textContent = this.matrixLengthMultiplier.toFixed(1) + 'x';\n                    });\n                }\n\n                // Matrix angle slider\n                const matrixAngleSlider = document.getElementById('matrixAngleSlider');\n                if (matrixAngleSlider) {\n                    matrixAngleSlider.addEventListener('input', (e) => {\n                        this.matrixAngle = parseInt(e.target.value);\n                        document.getElementById('matrixAngleValue').textContent = this.matrixAngle + '';\n                    });\n                }\n\n                // Matrix color picker\n                const matrixColorPicker = document.getElementById('matrixColorPicker');\n                const matrixColorHex = document.getElementById('matrixColorHex');\n                if (matrixColorPicker) {\n                    matrixColorPicker.addEventListener('input', (e) => {\n                        this.matrixColor = e.target.value;\n                        this.matrixColorCustomized = true;\n                        if (matrixColorHex) matrixColorHex.value = e.target.value;\n                        if (this.matrixStreams) this.matrixStreams.forEach(s => s.color = this.matrixColor);\n                    });\n                }\n                if (matrixColorHex) {\n                    matrixColorHex.addEventListener('input', (e) => {\n                        let val = e.target.value;\n                        if (val.match(/^#[0-9A-Fa-f]{6}$/)) {\n                            this.matrixColor = val;\n                            this.matrixColorCustomized = true;\n                            if (matrixColorPicker) matrixColorPicker.value = val;\n                            if (this.matrixStreams) this.matrixStreams.forEach(s => s.color = this.matrixColor);\n                        }\n                    });\n                }\n\n                // 3D Rotation sliders\n                const rotXSlider = document.getElementById('rotXSlider');\n                const rotYSlider = document.getElementById('rotYSlider');\n                const rotZSlider = document.getElementById('rotZSlider');\n\n                if (rotXSlider) {\n                    rotXSlider.addEventListener('input', (e) => {\n                        this.rotationX = parseFloat(e.target.value);\n                        document.getElementById('rotXValue').textContent = this.rotationX + '';\n                    });\n                }\n                if (rotYSlider) {\n                    rotYSlider.addEventListener('input', (e) => {\n                        this.rotationY = parseFloat(e.target.value);\n                        document.getElementById('rotYValue').textContent = this.rotationY + '';\n                    });\n                }\n                if (rotZSlider) {\n                    rotZSlider.addEventListener('input', (e) => {\n                        this.rotationZ = parseFloat(e.target.value);\n                        document.getElementById('rotZValue').textContent = this.rotationZ + '';\n                    });\n                }\n\n                // Trigger initial background generation\n                this.resize();\n\n                // Add Resize Listener\n                window.addEventListener('resize', () => this.resize());\n\n                this.animate = this.animate.bind(this);\n                requestAnimationFrame(this.animate);\n            }\n\n            resize() {\n                this.canvas.width = window.innerWidth;\n                this.canvas.height = window.innerHeight;\n\n                // Regenerate screen-space background (static stars) to ensure coverage\n                this.staticStars = [];\n                this.generateStaticStars();\n\n                this.draw();\n            }\n\n            /**\n             * FIX: Added the missing function to generate static background stars.\n             * This method is now positioned explicitly before other methods that rely on it\n             * (like resize) to ensure availability in sensitive execution environments.\n             */\n            generateStaticBackground() {\n                const bgStars = [];\n                const count = 300; // number of background stars\n                for (let i = 0; i < count; i++) {\n                    bgStars.push({\n                        x: Math.random() * this.canvas.width,\n                        y: Math.random() * this.canvas.height,\n                        size: Math.random() * 0.5 + 0.1,\n                        alpha: Math.random() * 0.5 + 0.2\n                    });\n                }\n                return bgStars;\n            }\n\n            initDraggableWindows() {\n                // Reusable drag function\n                const makeDraggable = (elementId) => {\n                    const element = document.getElementById(elementId);\n                    if (!element) return;\n\n                    // Find the header - it could be .window-header or .cockpit-header\n                    const header = element.querySelector('.window-header, .cockpit-header');\n                    if (!header) return;\n\n                    let isDragging = false;\n                    let startX, startY, initialX, initialY;\n\n                    header.style.cursor = 'grab';\n\n                    header.addEventListener('mousedown', (e) => {\n                        isDragging = true;\n                        header.style.cursor = 'grabbing';\n                        element.style.zIndex = '1000'; // Bring to front\n\n                        startX = e.clientX;\n                        startY = e.clientY;\n\n                        const rect = element.getBoundingClientRect();\n                        initialX = rect.left;\n                        initialY = rect.top;\n\n                        e.preventDefault();\n                    });\n\n                    window.addEventListener('mousemove', (e) => {\n                        if (!isDragging) return;\n\n                        const dx = e.clientX - startX;\n                        const dy = e.clientY - startY;\n\n                        element.style.left = (initialX + dx) + 'px';\n                        element.style.top = (initialY + dy) + 'px';\n                        element.style.bottom = 'auto'; // Remove bottom positioning\n                        element.style.right = 'auto'; // Remove right positioning\n                    });\n\n                    window.addEventListener('mouseup', () => {\n                        isDragging = false;\n                        header.style.cursor = 'grab';\n                    });\n                };\n\n                // Make all windows draggable\n                makeDraggable('floatingMap');\n                makeDraggable('floatingLeaders');\n                makeDraggable('sectionControls');\n                makeDraggable('sectionRadar');\n                makeDraggable('sectionVelocity');\n                makeDraggable('sectionGems');\n            }\n\n            setMode(newMode) {\n                this.mode = newMode;\n                document.getElementById('drawModeBtn').classList.remove('active');\n                document.getElementById('selectModeBtn').classList.remove('active');\n\n                if (newMode === 'draw') {\n                    document.getElementById('drawModeBtn').classList.add('active');\n                    this.canvas.style.cursor = 'crosshair';\n                } else if (newMode === 'select') {\n                    document.getElementById('selectModeBtn').classList.add('active');\n                    this.canvas.style.cursor = 'pointer';\n                }\n            }\n\n            /* --- NEW COLOR CONTROLS --- */\n\n            getRainbowHex() {\n                return '#' + Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0');\n            }\n\n            setFixedColor(hexColor) {\n                this.activeColor = hexColor;\n                this.colorMode = 'fixed';\n                this.updateColorModeUI();\n                this.showToast(`Active color set to ${hexColor}`);\n            }\n\n            setRainbowMode() {\n                this.colorMode = 'rainbow';\n                this.updateColorModeUI();\n                this.showToast(\"Active color set to Rainbow Mode \");\n            }\n\n            // ===== PROCEDURAL UNIVERSE GENERATION =====\n\n            // Seeded Random Number Generator\n            seededRandom(seed) {\n                const x = Math.sin(seed) * 10000;\n                return x - Math.floor(x);\n            }\n\n            getSectorCoords(worldX, worldY) {\n                return {\n                    x: Math.floor(worldX / this.sectorSize),\n                    y: Math.floor(worldY / this.sectorSize)\n                };\n            }\n\n            getSectorSeed(sectorX, sectorY) {\n                return sectorX * 73856093 ^ sectorY * 19349663;\n            }\n\n            checkAndGenerateSectors() {\n                if (!this.flightMode) return;\n\n                const sector = this.getSectorCoords(this.playerShip.x, this.playerShip.y);\n                this.currentSector = sector;\n\n                // Generate adjacent sectors (3x3 grid)\n                for (let dx = -1; dx <= 1; dx++) {\n                    for (let dy = -1; dy <= 1; dy++) {\n                        const sx = sector.x + dx;\n                        const sy = sector.y + dy;\n                        const key = `${sx},${sy}`;\n                        if (!this.loadedSectors.has(key)) {\n                            this.generateSector(sx, sy);\n                        }\n                    }\n                }\n\n                // Cull far sectors\n                for (const [key] of this.loadedSectors.entries()) {\n                    const [sx, sy] = key.split(',').map(Number);\n                    const dist = Math.max(Math.abs(sx - sector.x), Math.abs(sy - sector.y));\n                    if (dist > 2) {\n                        const sectorData = this.loadedSectors.get(key);\n                        if (sectorData) {\n                            this.minerals = this.minerals.filter(m => !sectorData.minerals.includes(m));\n                            this.resourceDeposits = this.resourceDeposits.filter(d => !sectorData.deposits.includes(d));\n                        }\n                        this.loadedSectors.delete(key);\n                    }\n                }\n            }\n\n            generateSector(sectorX, sectorY) {\n                const key = `${sectorX},${sectorY}`;\n                if (this.loadedSectors.has(key)) return;\n\n                console.log(`[Universe] Generating sector (${sectorX}, ${sectorY})`);\n\n                const seed = this.getSectorSeed(sectorX, sectorY);\n                const sectorData = { x: sectorX, y: sectorY, minerals: [], deposits: [] };\n\n                const minX = sectorX * this.sectorSize;\n                const maxX = (sectorX + 1) * this.sectorSize;\n                const minY = sectorY * this.sectorSize;\n                const maxY = (sectorY + 1) * this.sectorSize;\n\n                // Generate 100-300 minerals\n                const mineralCount = Math.floor(100 + this.seededRandom(seed + 1) * 200);\n                for (let i = 0; i < mineralCount; i++) {\n                    const s = seed + i * 1000;\n                    const x = minX + this.seededRandom(s) * this.sectorSize;\n                    const y = minY + this.seededRandom(s + 1) * this.sectorSize;\n                    const dist = Math.hypot(x, y);\n\n                    let type = 'iron';\n                    const r = this.seededRandom(s + 2);\n                    if (dist < 1000) type = ['iron', 'copper', 'coal', 'titanium', 'silicon'][Math.floor(r * 5)];\n                    else if (dist < 3000) type = ['silver', 'gold', 'platinum', 'palladium'][Math.floor(r * 4)];\n                    else if (dist < 6000) type = ['quartz', 'diamond', 'emerald', 'ruby', 'sapphire'][Math.floor(r * 5)];\n                    else if (dist < 10000) type = ['uranium', 'plutonium', 'helium3'][Math.floor(r * 3)];\n                    else type = ['neodymium', 'lanthanum', 'darkmatter', 'antimatter'][Math.floor(r * 4)];\n\n                    const info = this.mineralTypes[type];\n                    if (!info) continue;\n\n                    const mineral = { x, y, type, color: info.color, size: info.size, value: info.value };\n                    this.minerals.push(mineral);\n                    sectorData.minerals.push(mineral);\n                }\n\n                // Generate 3-8 deposits\n                const depositCount = Math.floor(3 + this.seededRandom(seed + 500000) * 5);\n                for (let i = 0; i < depositCount; i++) {\n                    const s = seed + 500000 + i * 2000;\n                    const x = minX + this.seededRandom(s) * this.sectorSize;\n                    const y = minY + this.seededRandom(s + 1) * this.sectorSize;\n                    const dist = Math.hypot(x, y);\n\n                    let zone = 'industrial';\n                    if (dist >= 8000) zone = 'exotic';\n                    else if (dist >= 5000) zone = 'nuclear';\n                    else if (dist >= 2500) zone = 'crystal';\n                    else if (dist >= 1000) zone = 'precious';\n\n                    const richness = 0.3 + this.seededRandom(s + 2) * 0.7;\n                    const deposit = {\n                        x, y, zone,\n                        name: `${this.galaxyZones[zone]?.name || zone} Deposit`,\n                        richness,\n                        tier: Math.floor(richness * 3) + 1\n                    };\n\n                    this.resourceDeposits.push(deposit);\n                    sectorData.deposits.push(deposit);\n                }\n\n                this.loadedSectors.set(key, sectorData);\n                console.log(`[Universe] Sector (${sectorX}, ${sectorY}): ${mineralCount} minerals, ${depositCount} deposits`);\n            }\n\n            toggleBgStyle(style) {\n                console.log(`[BG Toggle] ${style}, currently active:`, this.activeStyles.has(style));\n                if (this.activeStyles.has(style)) {\n                    // Deselecting - just remove from active, don't regenerate others\n                    this.activeStyles.delete(style);\n                    // Clear only this style's data\n                    this.clearStyleData(style);\n                } else {\n                    // Enabling - only generate this specific style\n                    this.activeStyles.add(style);\n                    this.generateSingleStyle(style);\n                }\n\n                this.updateBgUI();\n                this.generateStaticStars(); // Refresh static stars for color mix\n            }\n\n            // Generate only a single style's data\n            generateSingleStyle(style) {\n                switch (style) {\n                    case 'deep-space':\n                        this.generateDeepSpaceStyle();\n                        break;\n                    case 'nebula':\n                        this.generateNebulaStyle();\n                        break;\n                    case 'alien':\n                        this.generateAlienStyle();\n                        break;\n                    case 'cyber':\n                        this.generateCyberStyle();\n                        break;\n                }\n            }\n\n            // Clear only a specific style's data\n            clearStyleData(style) {\n                switch (style) {\n                    case 'deep-space':\n                        // Deep space uses: galaxies, blackHoles, planets, and contributes to nebulae/backgroundStars\n                        this.galaxies = [];\n                        this.blackHoles = [];\n                        this.planets = [];\n                        break;\n                    case 'nebula':\n                        // Clear nebula clouds\n                        this.nebulae = [];\n                        break;\n                    case 'alien':\n                        this.spacecraft = [];\n                        break;\n                    case 'cyber':\n                        this.matrixStreams = [];\n                        break;\n                }\n            }\n\n            updateBgUI() {\n                // Update Buttons\n                document.querySelectorAll('.bg-toggle').forEach(btn => {\n                    const style = btn.getAttribute('data-style');\n                    if (this.activeStyles.has(style)) {\n                        btn.classList.add('active');\n                    } else {\n                        btn.classList.remove('active');\n                    }\n                });\n\n                // Show/hide matrix panel when cyber style is active\n                const matrixPanel = document.getElementById('matrixPanel');\n                if (matrixPanel) {\n                    if (this.activeStyles.has('cyber')) {\n                        matrixPanel.classList.remove('hidden');\n                    } else {\n                        matrixPanel.classList.add('hidden');\n                    }\n                }\n            }\n\n            // Toggle functions for popup panels\n            toggleRotationPanel() {\n                const panel = document.getElementById('rotationPanel');\n                if (panel) panel.classList.toggle('hidden');\n            }\n\n            toggleTemplatePanel() {\n                const panel = document.getElementById('templatePanel');\n                if (panel.style.display === 'block') {\n                    panel.style.display = 'none';\n                } else {\n                    panel.style.display = 'block';\n                }\n            }\n\n            toggleFlightMode() {\n                this.flightMode = !this.flightMode;\n\n                // Toggle HUD overlay\n                const hud = document.getElementById('flightHUD');\n                const floatingMap = document.getElementById('floatingMap');\n                const floatingLeaders = document.getElementById('floatingLeaders');\n\n                if (this.flightMode) {\n                    if (hud) hud.classList.remove('hidden');\n                    if (floatingMap) floatingMap.classList.remove('hidden');\n                    if (floatingLeaders) floatingLeaders.classList.remove('hidden');\n                    this.updateFloatingLeaderboard();\n                } else {\n                    if (hud) hud.classList.add('hidden');\n                    if (floatingMap) floatingMap.classList.add('hidden');\n                    if (floatingLeaders) floatingLeaders.classList.add('hidden');\n                }\n\n                // Ensure a background is active\n                if (this.flightMode && this.activeStyles.size === 0) {\n                    this.toggleBgStyle('deep-space');\n                }\n\n                this.showToast(this.flightMode ? 'Flight Mode: ON - Use WASD/QE/Shift' : 'Flight Mode: OFF');\n\n                // Toggle ship button visibility\n                const shipBtn = document.getElementById('selectShipBtn');\n                if (shipBtn) shipBtn.style.display = this.flightMode ? 'inline-flex' : 'none';\n                this.draw();\n            }\n\n            // Toggle cockpit section collapse\n            toggleCockpitSection(sectionId) {\n                const section = document.getElementById(sectionId);\n                if (section) section.classList.toggle('collapsed');\n            }\n\n            toggleGemValues() {\n                this.showGemValues = !this.showGemValues;\n                this.updateFlightHUD(); // Refresh display\n                const btn = document.getElementById('btnToggleGemValues');\n                if (btn) {\n                    btn.style.background = this.showGemValues ? 'rgba(255,215,0,0.3)' : '';\n                }\n            }\n\n            initGemsResize() {\n                const gemsSection = document.getElementById('sectionGems');\n                const resizeHandle = gemsSection?.querySelector('.resize-handle');\n                if (!gemsSection || !resizeHandle) return;\n\n                let isResizing = false;\n                let startX, startWidth;\n\n                resizeHandle.addEventListener('mousedown', (e) => {\n                    isResizing = true;\n                    startX = e.clientX;\n                    startWidth = gemsSection.offsetWidth;\n                    e.preventDefault();\n                });\n\n                window.addEventListener('mousemove', (e) => {\n                    if (!isResizing) return;\n                    const width = startWidth + (e.clientX - startX);\n                    const clampedWidth = Math.max(200, Math.min(800, width));\n                    gemsSection.style.width = clampedWidth + 'px';\n                });\n\n                window.addEventListener('mouseup', () => {\n                    isResizing = false;\n                });\n            }\n\n            // Toggle floating window collapse\n            toggleFloatingWindow(windowId) {\n                const win = document.getElementById(windowId);\n                if (win) win.classList.toggle('collapsed');\n            }\n\n            // Gem emoji mapping\n            getGemEmoji(type) {\n                const emojis = {\n                    // Industrial\n                    iron: '',\n                    copper: '',\n                    coal: '',\n                    titanium: '',\n                    silicon: '',\n                    // Precious\n                    silver: '',\n                    gold: '',\n                    platinum: '',\n                    palladium: '',\n                    // Crystal\n                    quartz: '',\n                    diamond: '',\n                    emerald: '',\n                    ruby: '',\n                    sapphire: '',\n                    // Nuclear\n                    uranium: '',\n                    plutonium: '',\n                    helium3: '',\n                    // Exotic\n                    neodymium: '',\n                    lanthanum: '',\n                    darkmatter: '',\n                    antimatter: ''\n                };\n                // No longer used, replaced by CSS icons\n                return '';\n            }\n\n            styleGem(type) {\n                const info = this.mineralTypes[type];\n                if (!info) return '';\n                // Create a glowing orb effect matching in-game rendering\n                return `background: radial-gradient(circle at 30% 30%, #fff 10%, ${info.color} 60%);\n                        box-shadow: 0 0 4px ${info.color};\n                        border-radius: 50%;\n                        width: 12px; \n                        height: 12px;\n                        display: inline-block;`;\n            }\n\n            updateFlightHUD() {\n                if (!this.flightMode) return;\n\n\n                // Update speed number\n                const speedNumEl = document.getElementById('speedNumber');\n                const zoomEl = document.getElementById('zoomDisplay');\n                if (speedNumEl) {\n                    speedNumEl.textContent = Math.round(this.playerShip.speed);\n                }\n                if (zoomEl) {\n                    zoomEl.textContent = this.camera.zoom.toFixed(1) + 'x';\n                }\n\n                // Update radar coordinates\n                const coordsEl = document.getElementById('radarCoords');\n                if (coordsEl) {\n                    coordsEl.textContent = `X: ${Math.round(this.playerShip.x)} Y: ${Math.round(this.playerShip.y)}`;\n                }\n\n                // Update gems grid with proper emojis\n                const gemsGrid = document.getElementById('gemsGrid');\n                const gemsTotalEl = document.getElementById('gemsTotal');\n                const creditsEl = document.getElementById('creditsDisplay');\n\n                // Update credits display wherever it is\n                if (creditsEl) creditsEl.textContent = '$' + this.credits.toLocaleString();\n\n                if (gemsGrid) {\n                    let totalValue = 0;\n                    let html = '';\n\n                    // Helper for gem emoji\n                    const getGemEmoji = (type) => {\n                        const map = {\n                            iron: '', copper: '', titanium: '', gold: '',\n                            platinum: '', uranium: '', plutonium: '',\n                            lithium: '', cobalt: ''\n                        };\n                        return map[type] || '';\n                    };\n\n                    const inventory = Object.entries(this.playerInventory || {});\n\n                    if (inventory.length === 0) {\n                        html = '<div style=\"color:#5c7a8a;font-size:9px;padding:4px;\">No gems yet</div>';\n                    } else {\n                        inventory.forEach(([type, count]) => {\n                            if (count <= 0) return;\n                            const info = this.mineralTypes[type];\n                            if (!info) return;\n\n                            totalValue += count * info.value;\n\n                            const itemValue = count * info.value;\n                            const valueDisplay = this.showGemValues ? `<span style=\"color:${info.color}; font-weight:bold; margin-left:6px;\">$${Math.round(itemValue).toLocaleString()}</span>` : '';\n\n                            html += `\n                                <div class=\"gem-item\" style=\"border:1px solid ${info.color}44; background: rgba(0,0,0,0.6);\">\n                                    <div style=\"${this.styleGem(type)}\"></div>\n                                    <span style=\"color:${info.color}\">${info.name}</span>\n                                    <span class=\"gem-count\">${count}</span>\n                                    ${valueDisplay}\n                                </div>\n                            `;\n                        });\n                    }\n\n                    gemsGrid.innerHTML = html;\n\n                    // Updated Total Display (no button)\n                    if (gemsTotalEl) {\n                        gemsTotalEl.textContent = `$${totalValue.toLocaleString()}`;\n                    }\n                }\n\n                // Update radar\n                this.updateRadar();\n\n                // Update map\n                this.updateMap();\n\n                // Initialize resize handle for gems section\n                this.initGemsResize();\n            }\n\n            updateRadar() {\n                const canvas = document.getElementById('radarCanvas');\n                if (!canvas) return;\n                const ctx = canvas.getContext('2d');\n                const w = canvas.width, h = canvas.height;\n                const cx = w / 2, cy = h / 2;\n\n                // Clear\n                ctx.clearRect(0, 0, w, h);\n\n                // Draw grid lines\n                ctx.strokeStyle = 'rgba(0,255,100,0.2)';\n                ctx.lineWidth = 1;\n                ctx.beginPath();\n                ctx.moveTo(cx, 0); ctx.lineTo(cx, h);\n                ctx.moveTo(0, cy); ctx.lineTo(w, cy);\n                ctx.arc(cx, cy, 20, 0, Math.PI * 2);\n                ctx.arc(cx, cy, 35, 0, Math.PI * 2);\n                ctx.stroke();\n\n                // Draw player (center)\n                ctx.fillStyle = '#0f0';\n                ctx.beginPath();\n                ctx.arc(cx, cy, 3, 0, Math.PI * 2);\n                ctx.fill();\n\n                // Draw nearby minerals as dots\n                const radarRange = 2000;\n                this.minerals.forEach(m => {\n                    const dx = m.x - this.playerShip.x;\n                    const dy = m.y - this.playerShip.y;\n                    const dist = Math.sqrt(dx * dx + dy * dy);\n                    if (dist < radarRange) {\n                        const rx = cx + (dx / radarRange) * 35;\n                        const ry = cy + (dy / radarRange) * 35;\n                        ctx.fillStyle = m.color || '#f0f';\n                        ctx.beginPath();\n                        ctx.arc(rx, ry, 2, 0, Math.PI * 2);\n                        ctx.fill();\n                    }\n                });\n            }\n\n            generateResourceDeposits() {\n                this.resourceDeposits = [];\n\n                // TIER 1: Starting ring (30s-1min travel)\n                // Distance: 2000-4000 units (expanded outward)\n                // 12 clusters evenly distributed\n                for (let i = 0; i < 12; i++) {\n                    const angle = (i / 12) * Math.PI * 2 + Math.random() * 0.2;\n                    const dist = 2000 + Math.random() * 2000;\n                    this.resourceDeposits.push({\n                        x: Math.cos(angle) * dist,\n                        y: Math.sin(angle) * dist,\n                        z: (Math.random() - 0.5) * 400,\n                        zone: 'industrial',\n                        radius: 700,\n                        richness: 1.5,\n                        tier: 1,\n                        value: 'low',\n                        name: `Common Field ${i + 1}`\n                    });\n                }\n\n                // TIER 2: Inner belt (1-2min travel)\n                // Distance: 5000-8000 units (wider spread)\n                // 10 clusters\n                for (let i = 0; i < 10; i++) {\n                    const angle = (i / 10) * Math.PI * 2 + Math.random() * 0.3;\n                    const dist = 5000 + Math.random() * 3000;\n                    const zone = Math.random() < 0.5 ? 'precious' : 'crystal';\n                    this.resourceDeposits.push({\n                        x: Math.cos(angle) * dist,\n                        y: Math.sin(angle) * dist,\n                        z: (Math.random() - 0.5) * 600,\n                        zone: zone,\n                        radius: 800,\n                        richness: 2.0,\n                        tier: 2,\n                        value: 'medium',\n                        name: `Rich Cluster ${i + 1}`\n                    });\n                }\n\n                // TIER 3: Mid expanse (2-4min travel)\n                // Distance: 10000-15000 units\n                // 8 clusters\n                for (let i = 0; i < 8; i++) {\n                    const angle = (i / 8) * Math.PI * 2 + Math.random() * 0.4;\n                    const dist = 10000 + Math.random() * 5000;\n                    const zone = Math.random() < 0.5 ? 'nuclear' : 'crystal';\n                    this.resourceDeposits.push({\n                        x: Math.cos(angle) * dist,\n                        y: Math.sin(angle) * dist,\n                        z: (Math.random() - 0.5) * 800,\n                        zone: zone,\n                        radius: 900,\n                        richness: 3.0,\n                        tier: 3,\n                        value: 'high',\n                        name: `Epic Cache ${i + 1}`\n                    });\n                }\n\n                // TIER 4: Outer frontier (4-6min travel)\n                // Distance: 18000-25000 units  \n                // 6 clusters - Epic/Legendary\n                for (let i = 0; i < 6; i++) {\n                    const angle = (i / 6) * Math.PI * 2 + Math.random() * 0.5;\n                    const dist = 18000 + Math.random() * 7000;\n                    this.resourceDeposits.push({\n                        x: Math.cos(angle) * dist,\n                        y: Math.sin(angle) * dist,\n                        z: (Math.random() - 0.5) * 1000,\n                        zone: 'nuclear',\n                        radius: 1000,\n                        richness: 4.5,\n                        tier: 4,\n                        value: 'legendary',\n                        name: `Legendary Cache ${i + 1}`\n                    });\n                }\n\n                // TIER 5: Deep void (6-10min travel)\n                // Distance: 28000-38000 units\n                // 4 clusters - Legendary/Mythic\n                for (let i = 0; i < 4; i++) {\n                    const angle = (i / 4) * Math.PI * 2 + Math.random() * 0.6;\n                    const dist = 28000 + Math.random() * 10000;\n                    this.resourceDeposits.push({\n                        x: Math.cos(angle) * dist,\n                        y: Math.sin(angle) * dist,\n                        z: (Math.random() - 0.5) * 1500,\n                        zone: 'exotic',\n                        radius: 1200,\n                        richness: 6.0,\n                        tier: 5,\n                        value: 'mythic',\n                        name: `Mythic Treasure ${i + 1}`\n                    });\n                }\n\n                // TIER 6: Distant galaxies (10-15min travel)\n                // Distance: 42000-50000 units\n                // 3 ultra-rare clusters - Pure mythic\n                for (let i = 0; i < 3; i++) {\n                    const angle = (i / 3) * Math.PI * 2 + Math.random() * 0.8;\n                    const dist = 42000 + Math.random() * 8000;\n                    this.resourceDeposits.push({\n                        x: Math.cos(angle) * dist,\n                        y: Math.sin(angle) * dist,\n                        z: (Math.random() - 0.5) * 2000,\n                        zone: 'exotic',\n                        radius: 1500,\n                        richness: 8.0, // 8x rarity - INSANE!\n                        tier: 6,\n                        value: 'ultra-mythic',\n                        name: `Galaxy Core ${i + 1}`\n                    });\n                }\n\n                console.log(`[Universe] Generated ${this.resourceDeposits.length} gem clusters across 50,000 units`);\n            }\n\n            updateMap() {\n                const canvas = document.getElementById('mapCanvas');\n                if (!canvas) return;\n                const ctx = canvas.getContext('2d');\n                const w = canvas.width, h = canvas.height;\n                const cx = w / 2, cy = h / 2;\n\n                const mapRadius = 50000; // Increased to show entire universe\n                const scale = (Math.min(w, h) / 2) / mapRadius;\n\n                // Clear\n                ctx.fillStyle = 'rgba(0,5,20,0.95)';\n                ctx.fillRect(0, 0, w, h);\n\n                // Offset to center on player\n                const offsetX = -this.playerShip.x;\n                const offsetY = -this.playerShip.y;\n\n                // Draw Zones (centered at origin)\n                Object.values(this.galaxyZones).forEach(zone => {\n                    const r = zone.distanceRange.min * scale;\n                    ctx.beginPath();\n                    ctx.arc(cx + offsetX * scale, cy + offsetY * scale, r, 0, Math.PI * 2);\n                    ctx.strokeStyle = zone.color;\n                    ctx.globalAlpha = 0.3;\n                    ctx.lineWidth = 1;\n                    ctx.stroke();\n                });\n\n                // Draw Deposits with TIER VISUALIZATION\n                this.resourceDeposits.forEach(dep => {\n                    const dx = (dep.x + offsetX) * scale;\n                    const dy = (dep.y + offsetY) * scale;\n\n                    // Tier-based colors (6 tiers now)\n                    let color, glowColor, label;\n                    switch (dep.tier) {\n                        case 1: color = '#4488ff'; glowColor = '#6699ff'; label = 'C'; break; // Common - Blue\n                        case 2: color = '#ff66ff'; glowColor = '#ff88ff'; label = 'R'; break; // Rich - Magenta\n                        case 3: color = '#ffaa00'; glowColor = '#ffcc44'; label = 'E'; break; // Epic - Gold\n                        case 4: color = '#ff4400'; glowColor = '#ff6644'; label = 'L'; break; // Legendary - Red-Orange\n                        case 5: color = '#ff00ff'; glowColor = '#ff44ff'; label = 'M'; break; // Mythic - Bright Magenta\n                        case 6: color = '#00ffff'; glowColor = '#44ffff'; label = 'G'; break; // Galaxy - Cyan\n                        default: color = '#00f'; glowColor = '#44f'; label = '?'; break;\n                    }\n\n                    // Pulsing glow\n                    const pulse = 1 + Math.sin(Date.now() * 0.003) * 0.3;\n                    const glowSize = (3 + dep.tier) * pulse;\n\n                    // Outer glow\n                    ctx.fillStyle = glowColor;\n                    ctx.globalAlpha = 0.4;\n                    ctx.beginPath();\n                    ctx.arc(cx + dx, cy + dy, glowSize, 0, Math.PI * 2);\n                    ctx.fill();\n                    ctx.globalAlpha = 1;\n\n                    // Core icon\n                    ctx.fillStyle = color;\n                    ctx.beginPath();\n                    ctx.arc(cx + dx, cy + dy, 3 + dep.tier * 0.5, 0, Math.PI * 2);\n                    ctx.fill();\n\n                    // Tier label\n                    ctx.fillStyle = '#fff';\n                    ctx.font = 'bold 8px monospace';\n                    ctx.textAlign = 'center';\n                    ctx.fillText(label, cx + dx, cy + dy + glowSize + 8);\n                });\n\n                // Draw Minerals (gems) - larger and with glow for visibility\n                this.minerals.forEach(mineral => {\n                    const dx = (mineral.x + offsetX) * scale;\n                    const dy = (mineral.y + offsetY) * scale;\n\n                    // Glow effect\n                    ctx.fillStyle = mineral.color;\n                    ctx.globalAlpha = 0.3;\n                    ctx.beginPath();\n                    ctx.arc(cx + dx, cy + dy, 4, 0, Math.PI * 2);\n                    ctx.fill();\n\n                    // Solid dot\n                    ctx.globalAlpha = 0.9;\n                    ctx.beginPath();\n                    ctx.arc(cx + dx, cy + dy, 2.5, 0, Math.PI * 2);\n                    ctx.fill();\n                });\n                ctx.globalAlpha = 1;\n\n                // Draw Player (now always at center)\n                const px = cx;\n                const py = cy;\n\n                // Player direction arrow\n                const angle = this.playerShip.rotation + Math.PI / 2;\n                ctx.save();\n                ctx.translate(px, py);\n                ctx.rotate(this.playerShip.rotation + Math.PI / 2);\n                ctx.fillStyle = '#0f0';\n                ctx.beginPath();\n                ctx.moveTo(0, -5);\n                ctx.lineTo(4, 4);\n                ctx.lineTo(0, 2);\n                ctx.lineTo(-4, 4);\n                ctx.fill();\n                ctx.restore();\n\n                // Radar ping effect for player\n                ctx.strokeStyle = `rgba(0, 255, 0, ${0.5 + Math.sin(Date.now() * 0.005) * 0.3})`;\n                ctx.beginPath();\n                ctx.arc(px, py, 8, 0, Math.PI * 2);\n                ctx.stroke();\n            }\n\n            /* --- EXPANDED MAP --- */\n            openExpandedMap() {\n                console.log('[Expand Map] Button clicked!');\n                const modal = document.getElementById('expandedMapModal');\n                console.log('[Expand Map] Modal element:', modal);\n\n                if (modal) {\n                    modal.classList.remove('hidden');\n                    this.expandedMapOpen = true;\n                    this.expandedMapZoom = this.expandedMapZoom || 1.0;\n                    this.expandedMapOffset = this.expandedMapOffset || { x: 0, y: 0 };\n\n                    // Center on player initially\n                    this.expandedMapOffset.x = -this.playerShip.x;\n                    this.expandedMapOffset.y = -this.playerShip.y;\n\n                    console.log('[Expand Map] Starting animation, zoom:', this.expandedMapZoom);\n                    this.animateExpandedMap();\n\n                    // Add wheel listener for zoom\n                    if (!this.mapWheelListener) {\n                        this.mapWheelListener = (e) => {\n                            e.preventDefault();\n                            const zoomSpeed = 0.1;\n                            const newZoom = Math.max(0.2, Math.min(10.0, this.expandedMapZoom - Math.sign(e.deltaY) * zoomSpeed));\n                            this.expandedMapZoom = newZoom;\n                            document.getElementById('mapZoomLevel').textContent = `Zoom: ${this.expandedMapZoom.toFixed(1)}x`;\n                        };\n                        const canvas = document.getElementById('fullscreenMapCanvas');\n                        canvas.addEventListener('wheel', this.mapWheelListener);\n\n                        // Dragging Logic\n                        this.isDraggingMap = false;\n                        this.lastMapMouse = { x: 0, y: 0 };\n\n                        canvas.addEventListener('mousedown', (e) => {\n                            this.isDraggingMap = true;\n                            this.lastMapMouse = { x: e.clientX, y: e.clientY };\n                            canvas.style.cursor = 'grabbing';\n                        });\n\n                        window.addEventListener('mousemove', (e) => {\n                            if (!this.isDraggingMap) return;\n                            const dx = e.clientX - this.lastMapMouse.x;\n                            const dy = e.clientY - this.lastMapMouse.y;\n                            this.lastMapMouse = { x: e.clientX, y: e.clientY };\n\n                            // Adjust offset (pan)\n                            this.expandedMapOffset.x += dx / this.expandedMapZoom;\n                            this.expandedMapOffset.y += dy / this.expandedMapZoom;\n                        });\n\n                        window.addEventListener('mouseup', () => {\n                            this.isDraggingMap = false;\n                            canvas.style.cursor = 'grab';\n                        });\n                    }\n                }\n            }\n\n            closeExpandedMap() {\n                const modal = document.getElementById('expandedMapModal');\n                if (modal) {\n                    modal.classList.add('hidden');\n                    this.expandedMapOpen = false;\n                }\n            }\n\n            animateExpandedMap() {\n                if (!this.expandedMapOpen) return;\n\n                const canvas = document.getElementById('fullscreenMapCanvas');\n                if (!canvas) {\n                    console.error('[Map Debug] Canvas not found');\n                    return;\n                }\n\n                console.log('[Map Debug] Rendering expanded map, zoom:', this.expandedMapZoom);\n\n                // Resize if needed (handle dynamic window resizing)\n                if (canvas.width !== window.innerWidth || canvas.height !== window.innerHeight) {\n                    canvas.width = window.innerWidth;\n                    canvas.height = window.innerHeight;\n                }\n\n                const ctx = canvas.getContext('2d');\n                const w = canvas.width;\n                const h = canvas.height;\n                const cx = w / 2;\n                const cy = h / 2;\n                const zoom = this.expandedMapZoom;\n                const time = Date.now() * 0.001;\n\n                // --- 1. DEEP SPACE BACKGROUND ---\n                // Clear with a deep, rich gradient based on player position (subtle shift)\n                const bgGradient = ctx.createRadialGradient(cx, cy, 0, cx, cy, Math.max(w, h));\n                bgGradient.addColorStop(0, '#000810');\n                bgGradient.addColorStop(0.6, '#000508');\n                bgGradient.addColorStop(1, '#000000');\n                ctx.fillStyle = bgGradient;\n                ctx.fillRect(0, 0, w, h);\n\n                ctx.save();\n                ctx.translate(cx, cy);\n                ctx.scale(zoom, zoom);\n                ctx.translate(this.expandedMapOffset.x, this.expandedMapOffset.y);\n\n                // --- 2. PARALLAX STARFIELD (Background Layers) ---\n                // We generate pseudo-random stars based on world coordinates to create an infinite field\n                // Layer 1: Distant, slow moving\n                this.renderMapStars(ctx, 0.5, 0.5, 5000, 15000, '#445566');\n                // Layer 2: Mid-distance\n                this.renderMapStars(ctx, 0.3, 0.8, 3000, 10000, '#6688aa');\n\n                // --- 3. ZONE ATMOSPHERICS ---\n                // Draw large, soft radial glows for each zone to give \"territory\" feel\n                Object.values(this.galaxyZones).forEach(zone => {\n                    const dist = zone.distanceRange.min;\n                    // Skip if way off screen\n                    // Simple cull: check distance from center of screen in world space to zone center (0,0)\n                    // But zones are concentric rings, so we just draw them.\n\n                    ctx.beginPath();\n                    ctx.arc(0, 0, dist, 0, Math.PI * 2);\n                    ctx.fillStyle = zone.glowColor || zone.color;\n                    ctx.globalAlpha = 0.03; // Very subtle atmosphere\n                    ctx.lineWidth = 100; // Wide soft edge\n                    ctx.fill();\n\n                    // Zone Boundary Ring\n                    ctx.beginPath();\n                    ctx.arc(0, 0, dist, 0, Math.PI * 2);\n                    ctx.strokeStyle = zone.color;\n                    ctx.lineWidth = 2 / zoom; // Keep thin regardless of zoom\n                    ctx.globalAlpha = 0.2;\n                    ctx.setLineDash([20, 40]); // Dashed border\n                    ctx.stroke();\n                    ctx.setLineDash([]);\n\n                    // Zone Label (Floating in space)\n                    // Place label at the top of the ring\n                    ctx.fillStyle = zone.color;\n                    ctx.font = `bold ${64}px Orbitron`;\n                    ctx.textAlign = 'center';\n                    ctx.globalAlpha = 0.4;\n                    ctx.fillText(zone.name.toUpperCase(), 0, -dist + 200);\n                });\n\n                // --- 4. HOLO-GRID ---\n                // A perspective grid. Since this is 2D top-down, we draw a rectangular grid that pans.\n                ctx.strokeStyle = 'rgba(0, 243, 255, 0.08)';\n                ctx.lineWidth = 1 / zoom;\n                const gridSize = 1000;\n\n                // Calculate visible range to optimize rendering\n                // Visible world center: -this.expandedMapOffset.x, -this.expandedMapOffset.y\n                const worldCx = -this.expandedMapOffset.x;\n                const worldCy = -this.expandedMapOffset.y;\n                const visibleW = w / zoom;\n                const visibleH = h / zoom;\n\n                const startX = Math.floor((worldCx - visibleW) / gridSize) * gridSize;\n                const endX = Math.floor((worldCx + visibleW) / gridSize) * gridSize;\n                const startY = Math.floor((worldCy - visibleH) / gridSize) * gridSize;\n                const endY = Math.floor((worldCy + visibleH) / gridSize) * gridSize;\n\n                ctx.beginPath();\n                for (let x = startX; x <= endX; x += gridSize) {\n                    ctx.moveTo(x, startY);\n                    ctx.lineTo(x, endY);\n                }\n                for (let y = startY; y <= endY; y += gridSize) {\n                    ctx.moveTo(startX, y);\n                    ctx.lineTo(endX, y);\n                }\n                ctx.stroke();\n\n\n                // --- 5. ORBITAL MECHANICS & PLANETS (Cosmetic) ---\n                // Procedural planets based on zone\n                // We'll use a deterministic random based on index/position\n                // (Simplified for now: drawing a few fixed 'planets' per zone would be better but random serves 'world' feel)\n\n                // --- 6. RESOURCE DEPOSITS (Advanced Icons) ---\n                this.resourceDeposits.forEach(dep => {\n                    // Pulsing effect\n                    const pulse = 1 + Math.sin(time * 3 + dep.x * 0.01) * 0.2;\n\n                    // Deposit Glow\n                    const zoneColor = this.galaxyZones[dep.zone] ? this.galaxyZones[dep.zone].color : '#fff';\n                    const glowColor = this.galaxyZones[dep.zone] ? (this.galaxyZones[dep.zone].glowColor || zoneColor) : '#fff';\n\n                    // Draw outer glow\n                    const grad = ctx.createRadialGradient(dep.x, dep.y, 5 * pulse, dep.x, dep.y, 30 * pulse);\n                    grad.addColorStop(0, glowColor);\n                    grad.addColorStop(1, 'rgba(0,0,0,0)');\n                    ctx.fillStyle = grad;\n                    ctx.globalAlpha = 0.4;\n                    ctx.beginPath();\n                    ctx.arc(dep.x, dep.y, 40 * pulse, 0, Math.PI * 2);\n                    ctx.fill();\n\n                    // Draw core icon (Diamond shape)\n                    ctx.globalAlpha = 1;\n                    ctx.fillStyle = zoneColor;\n                    const size = 12;\n                    ctx.beginPath();\n                    ctx.moveTo(dep.x, dep.y - size);\n                    ctx.lineTo(dep.x + size, dep.y);\n                    ctx.lineTo(dep.x, dep.y + size);\n                    ctx.lineTo(dep.x - size, dep.y);\n                    ctx.closePath();\n                    ctx.fill();\n\n                    // Label\n                    if (zoom > 0.8) {\n                        ctx.fillStyle = '#fff';\n                        ctx.font = '14px \"Segoe UI\", sans-serif'; // Cleaner font\n                        ctx.textAlign = 'center';\n                        ctx.fillText(dep.name, dep.x, dep.y + 40);\n\n                        ctx.font = '10px \"Segoe UI\", sans-serif';\n                        ctx.fillStyle = '#aaa';\n                        ctx.fillText(`Richness: ${(dep.richness * 100).toFixed(0)}%`, dep.x, dep.y + 55);\n                    }\n                });\n\n                // --- 6.5. MINERALS/GEMS (Navigation Aid) ---\n                // Show minerals on the map with proper color coding\n                this.minerals.forEach(mineral => {\n                    const mineralInfo = this.mineralTypes[mineral.type];\n                    if (!mineralInfo) return;\n\n                    // Glow effect for visibility\n                    ctx.globalAlpha = 0.4;\n                    ctx.fillStyle = mineralInfo.color;\n                    ctx.beginPath();\n                    ctx.arc(mineral.x, mineral.y, 8 / zoom, 0, Math.PI * 2);\n                    ctx.fill();\n\n                    // Solid marker\n                    ctx.globalAlpha = 1.0;\n                    ctx.beginPath();\n                    ctx.arc(mineral.x, mineral.y, 4 / zoom, 0, Math.PI * 2);\n                    ctx.fill();\n\n                    // Show gem type label at higher zoom\n                    if (zoom > 1.5) {\n                        ctx.fillStyle = '#fff';\n                        ctx.font = `${10 / zoom}px Arial`;\n                        ctx.textAlign = 'center';\n                        ctx.fillText(mineralInfo.name, mineral.x, mineral.y - 10 / zoom);\n                    }\n                });\n                ctx.globalAlpha = 1.0;\n\n                // --- 7. PLAYER SHIP (Detailed HUD Marker) ---\n                const shipX = this.playerShip.x;\n                const shipY = this.playerShip.y;\n\n                ctx.translate(shipX, shipY);\n\n                // View Cone (Field of View)\n                const fovRadius = 400;\n                ctx.rotate(this.playerShip.rotation + Math.PI / 2); // Align with ship heading\n\n                ctx.beginPath();\n                ctx.moveTo(0, 0);\n                ctx.arc(0, 0, fovRadius, -Math.PI / 6, Math.PI / 6); // 60 degree cone\n                ctx.fillStyle = 'rgba(0, 255, 100, 0.1)';\n                ctx.fill();\n                ctx.strokeStyle = 'rgba(0, 255, 100, 0.3)';\n                ctx.lineWidth = 1;\n                ctx.stroke();\n\n                // Ship Icon (Triangle)\n                ctx.beginPath();\n                ctx.moveTo(0, -20);\n                ctx.lineTo(14, 14);\n                ctx.lineTo(0, 8);\n                ctx.lineTo(-14, 14);\n                ctx.closePath();\n                ctx.fillStyle = '#0f0';\n                ctx.shadowColor = '#0f0';\n                ctx.shadowBlur = 15;\n                ctx.fill();\n                ctx.shadowBlur = 0; // Reset\n\n                ctx.restore();\n\n                // --- 8. UI OVERLAYS (Screen Space) ---\n                // Coordinates Overlay (Fixed to screen corners)\n                ctx.font = '14px Consolas, monospace';\n                ctx.fillStyle = 'rgba(0, 243, 255, 0.8)';\n                ctx.textAlign = 'left';\n                ctx.fillText(`SECTOR: [${Math.floor(shipX / 5000)}, ${Math.floor(shipY / 5000)}]`, 20, h - 60);\n                ctx.fillText(`COORDS: X ${Math.round(shipX)}  Y ${Math.round(shipY)}`, 20, h - 40);\n\n                // Scale Bar\n                const scaleWidth = 200; // pixels\n                const scaleDistance = scaleWidth / zoom;\n                ctx.beginPath();\n                ctx.moveTo(w - 220, h - 40);\n                ctx.lineTo(w - 20, h - 40);\n                ctx.moveTo(w - 220, h - 45);\n                ctx.lineTo(w - 220, h - 35);\n                ctx.moveTo(w - 20, h - 45);\n                ctx.lineTo(w - 20, h - 35);\n                ctx.strokeStyle = '#fff';\n                ctx.lineWidth = 2;\n                ctx.stroke();\n\n                ctx.textAlign = 'center';\n                ctx.fillStyle = '#fff';\n                ctx.fillText(`${Math.round(scaleDistance)}km`, w - 120, h - 50);\n\n                requestAnimationFrame(() => this.animateExpandedMap());\n            }\n\n            // Helper for infinite starfield in map\n            renderMapStars(ctx, opacity, parallax, spacing, modX, color) {\n                const worldCx = -this.expandedMapOffset.x * parallax;\n                const worldCy = -this.expandedMapOffset.y * parallax;\n                const w = ctx.canvas.width / this.expandedMapZoom;\n                const h = ctx.canvas.height / this.expandedMapZoom;\n\n                // Simple deterministic \"hash\" for visuals without storing millions of stars\n                // We assume stars are on a grid with jitter\n                const startX = Math.floor((worldCx - w) / spacing);\n                const endX = Math.floor((worldCx + w) / spacing);\n                const startY = Math.floor((worldCy - h) / spacing);\n                const endY = Math.floor((worldCy + h) / spacing);\n\n                ctx.fillStyle = color;\n\n                for (let x = startX; x <= endX; x++) {\n                    for (let y = startY; y <= endY; y++) {\n                        // Deterministic random\n                        const seed = x * 34234 + y * 23123;\n                        const rx = Math.sin(seed) * spacing;\n                        const ry = Math.cos(seed * 0.5) * spacing;\n                        const size = (Math.sin(seed * 1.5) + 1.5);\n\n                        ctx.globalAlpha = opacity * (0.5 + Math.sin(seed * 0.1) * 0.5);\n                        ctx.beginPath();\n                        ctx.arc(x * spacing + rx, y * spacing + ry, size, 0, Math.PI * 2);\n                        ctx.fill();\n                    }\n                }\n                ctx.globalAlpha = 1.0;\n            }\n\n            updateFloatingLeaderboard() {\n                const listEl = document.getElementById('floatingLeadersList');\n                if (!listEl) return;\n\n                // Mock leaderboard with fluctuating wealth\n                const mockPlayers = [\n                    { name: 'StarPilot99', wealth: 125000 + Math.floor(Math.random() * 10000) },\n                    { name: 'NebulaHunter', wealth: 98000 + Math.floor(Math.random() * 8000) },\n                    { name: 'AstroMiner', wealth: 76000 + Math.floor(Math.random() * 5000) },\n                    { name: 'You', wealth: this.calculateTotalWealth() }\n                ];\n\n                mockPlayers.sort((a, b) => b.wealth - a.wealth);\n\n                let html = '';\n                mockPlayers.forEach((player, i) => {\n                    const medal = i === 0 ? '' : i === 1 ? '' : i === 2 ? '' : '';\n                    const isYou = player.name === 'You';\n                    html += `<div class=\"leader-row${isYou ? ' you' : ''}\">\n                        <span class=\"leader-rank\">${medal || (i + 1)}</span>\n                        <span class=\"leader-name\">${player.name}</span>\n                        <span class=\"leader-wealth\">$${player.wealth.toLocaleString()}</span>\n                    </div>`;\n                });\n                listEl.innerHTML = html;\n            }\n\n            updateLeaderboard() {\n                // Legacy method - now using updateFloatingLeaderboard\n                this.updateFloatingLeaderboard();\n            }\n\n            calculateTotalWealth() {\n                let total = 0;\n                for (const [type, count] of Object.entries(this.playerInventory)) {\n                    const mineralInfo = this.mineralTypes[type];\n                    if (mineralInfo) total += mineralInfo.value * count;\n                }\n                return total;\n            }\n\n            updatePlayerShip() {\n                const ship = this.playerShip;\n                const keys = this.keysPressed;\n\n                // Rotation\n                if (keys['a'] || keys['arrowleft']) ship.rotation -= ship.rotationSpeed;\n                if (keys['d'] || keys['arrowright']) ship.rotation += ship.rotationSpeed;\n\n                // 3D Pitch rotation (R/F keys)\n                if (keys['r']) ship.pitch = Math.min(Math.PI / 3, ship.pitch + 0.02); // Pitch up (max 60 degrees)\n                if (keys['f']) ship.pitch = Math.max(-Math.PI / 3, ship.pitch - 0.02); // Pitch down\n\n                // 3D Roll rotation (Z/C keys)\n                if (keys['z']) ship.roll = Math.min(Math.PI / 2, ship.roll + 0.03); // Roll left (max 90 degrees)\n                if (keys['c']) ship.roll = Math.max(-Math.PI / 2, ship.roll - 0.03); // Roll right\n\n                // Acceleration (forward/backward)\n                const cos = Math.cos(ship.rotation);\n                const sin = Math.sin(ship.rotation);\n\n                if (keys['w'] || keys['arrowup']) {\n                    ship.vx += cos * ship.acceleration;\n                    ship.vy += sin * ship.acceleration;\n                }\n                if (keys['s'] || keys['arrowdown']) {\n                    ship.vx -= cos * ship.acceleration * 0.5;\n                    ship.vy -= sin * ship.acceleration * 0.5;\n                }\n\n                // 3D movement (Q/E for up/down)\n                if (keys['q']) ship.vz += ship.acceleration;  // Move up\n                if (keys['e']) ship.vz -= ship.acceleration;  // Move down\n\n                // Boost (Shift or Space for 2x speed)\n                const boost = (keys['shift'] || keys[' ']) ? 2.0 : 1.0;\n\n                // Apply velocity with boost\n                ship.x += ship.vx * boost;\n                ship.y += ship.vy * boost;\n                ship.z += ship.vz * boost;\n\n                // Calculate speed (3D)\n                ship.speed = Math.sqrt(ship.vx * ship.vx + ship.vy * ship.vy + ship.vz * ship.vz);\n\n                // Cap speed\n                if (ship.speed > ship.maxSpeed) {\n                    const ratio = ship.maxSpeed / ship.speed;\n                    ship.vx *= ratio;\n                    ship.vy *= ratio;\n                    ship.vz *= ratio;\n                    ship.speed = ship.maxSpeed;\n                }\n\n                // Reduced friction for drifty space feel\n                const friction = 0.995;\n                ship.vx *= friction;\n                ship.vy *= friction;\n                ship.vz *= friction;\n\n                // Generate speed lines for visual feedback (Roblox-style)\n                if (ship.speed > 5) {\n                    const lineCount = Math.floor(ship.speed / 2);\n                    for (let i = 0; i < lineCount; i++) {\n                        this.speedLines.push({\n                            x: ship.x + (Math.random() - 0.5) * 300,\n                            y: ship.y + (Math.random() - 0.5) * 300,\n                            z: ship.z + (Math.random() - 0.5) * 300,\n                            vx: -ship.vx * 0.5,\n                            vy: -ship.vy * 0.5,\n                            life: 1.0\n                        });\n                    }\n                }\n\n                // Update and clean up speed lines\n                this.speedLines.forEach(line => {\n                    line.x += line.vx;\n                    line.y += line.vy;\n                    line.life -= 0.05;\n                });\n                this.speedLines = this.speedLines.filter(line => line.life > 0);\n\n                // Camera follows ship directly (keeps ship perfectly centered)\n                // Use zoom level to maintain center regardless of zoom\n                this.camera.x = -ship.x * this.camera.zoom;\n                this.camera.y = -ship.y * this.camera.zoom;\n\n                // Check and generate new sectors as player explores\n                this.checkAndGenerateSectors();\n            }\n\n            // Inventory Management\n            loadInventory() {\n                try {\n                    const saved = localStorage.getItem('playerInventory');\n                    return saved ? JSON.parse(saved) : {};\n                } catch (e) {\n                    console.error('Failed to load inventory:', e);\n                    return {};\n                }\n            }\n\n            saveInventory() {\n                try {\n                    localStorage.setItem('playerInventory', JSON.stringify(this.playerInventory));\n                } catch (e) {\n                    console.error('Failed to save inventory:', e);\n                }\n            }\n\n            loadCredits() {\n                return parseInt(localStorage.getItem('playerCredits')) || 0;\n            }\n\n            saveCredits() {\n                localStorage.setItem('playerCredits', this.credits);\n            }\n\n            loadUpgrades() {\n                try {\n                    return JSON.parse(localStorage.getItem('playerUpgrades')) || { speed: 0, armor: 0, weapons: 0, shield: 0, cargo: 0, radar: 0 };\n                } catch (e) {\n                    return { speed: 0, armor: 0, weapons: 0, shield: 0, cargo: 0, radar: 0 };\n                }\n            }\n\n            saveUpgrades() {\n                localStorage.setItem('playerUpgrades', JSON.stringify(this.playerShip.upgrades));\n            }\n\n            sellAllGems() {\n                console.log('[Sell All] Button clicked!');\n                let totalValue = 0;\n                let count = 0;\n                for (const [type, qty] of Object.entries(this.playerInventory)) {\n                    if (qty > 0) {\n                        const val = this.mineralTypes[type].value;\n                        totalValue += val * qty;\n                        count += qty;\n                        this.playerInventory[type] = 0;\n                    }\n                }\n\n                if (totalValue > 0) {\n                    this.credits += totalValue;\n                    this.saveCredits();\n                    this.saveInventory();\n                    this.showToast(`Sold ${count} gems for $${totalValue.toLocaleString()}`);\n                    console.log('[Sell All] Success:', count, 'gems for $', totalValue);\n                    // Play sound effect if available\n                } else {\n                    this.showToast('No gems to sell');\n                    console.log('[Sell All] No gems in inventory');\n                }\n            }\n\n            upgradeShip(type) {\n                const upgradeCosts = [1000, 2500, 5000, 10000, 25000]; // Function of level maybe?\n                const currentLevel = this.playerShip.upgrades[type] || 0;\n\n                if (currentLevel >= 5) {\n                    this.showToast('Max level reached!');\n                    return;\n                }\n\n                const cost = upgradeCosts[currentLevel];\n                if (this.credits >= cost) {\n                    this.credits -= cost;\n                    this.playerShip.upgrades[type]++;\n                    this.saveCredits();\n                    this.saveUpgrades();\n\n                    // Apply effects immediately\n                    const lvl = this.playerShip.upgrades[type];\n                    if (type === 'speed') {\n                        this.playerShip.maxSpeed = 50 * (1 + lvl * 0.2);\n                        this.playerShip.acceleration = 0.5 * (1 + lvl * 0.1);\n                    } else if (type === 'armor') {\n                        this.playerShip.maxHull = 100 * (1 + lvl * 0.2);\n                        this.playerShip.hullHealth = this.playerShip.maxHull; // Repair on upgrade\n                    } else if (type === 'shield') {\n                        this.playerShip.maxShield = 50 * (1 + lvl * 0.2);\n                        this.playerShip.shield = this.playerShip.maxShield;\n                    } else if (type === 'radar') {\n                        this.playerShip.radarRange = 2000 * (1 + lvl * 0.3);\n                    }\n\n                    this.showToast(`${type.toUpperCase()} Upgraded to Level ${lvl + 1}!`);\n                    this.updateUpgradeUI(); // Assuming we'll create this method\n                } else {\n                    this.showToast(`Not enough credits! Need $${cost.toLocaleString()}`);\n                }\n            }\n\n            // Spawn minerals around the player - ADDICTIVE GAMEPLAY DESIGN\n            spawnMinerals() {\n                const ship = this.playerShip;\n                const spawnRadius = 1500; // Medium range - always gems visible\n                let targetDensity = 200; // Base: Always 200 gems nearby\n\n                // Check hotspot proximity for MASSIVE density boost\n                let hotspotBonus = 1.0;\n                let activeHotspot = null;\n                let inHotspot = false;\n\n                for (const dep of this.resourceDeposits) {\n                    const dx = ship.x - dep.x;\n                    const dy = ship.y - dep.y;\n                    const dist = Math.sqrt(dx * dx + dy * dy);\n                    if (dist < dep.radius) {\n                        hotspotBonus = 3.0; // 3x rarity multiplier\n                        targetDensity = 500; // Massive gem field\n                        activeHotspot = dep;\n                        inHotspot = true;\n                        break;\n                    }\n                }\n\n                // Calculate player's zone\n                const playerDistFromOrigin = Math.sqrt(ship.x * ship.x + ship.y * ship.y);\n\n                // Remove only VERY far minerals for performance\n                this.minerals = this.minerals.filter(m => {\n                    const dx = m.x - ship.x;\n                    const dy = m.y - ship.y;\n                    const dz = m.z - ship.z;\n                    return Math.sqrt(dx * dx + dy * dy + dz * dz) < spawnRadius * 3;\n                });\n\n                // INSTANT RESPAWN: Always maintain target density\n                while (this.minerals.length < targetDensity) {\n                    const currentZone = this.getZoneAtDistance(playerDistFromOrigin);\n                    const mineralKey = this.selectElementForZone(currentZone, playerDistFromOrigin, hotspotBonus);\n                    const type = this.mineralTypes[mineralKey];\n                    if (!type) continue;\n\n                    // Dense, even distribution around player\n                    const angle = Math.random() * Math.PI * 2;\n                    const distance = spawnRadius * Math.sqrt(Math.random()); // Uniform distribution\n                    const zOffset = (Math.random() - 0.5) * 400;\n\n                    // Hotspot clustering: bias toward hotspot center\n                    let spawnX, spawnY;\n                    if (inHotspot && Math.random() < 0.6) {\n                        // 60% of gems cluster around hotspot center\n                        const hotAngle = Math.random() * Math.PI * 2;\n                        const hotDist = activeHotspot.radius * Math.sqrt(Math.random()) * 0.7;\n                        spawnX = activeHotspot.x + Math.cos(hotAngle) * hotDist;\n                        spawnY = activeHotspot.y + Math.sin(hotAngle) * hotDist;\n                    } else {\n                        // Normal spawn around player\n                        spawnX = ship.x + Math.cos(angle) * distance;\n                        spawnY = ship.y + Math.sin(angle) * distance;\n                    }\n\n                    const spawnZ = ship.z + zOffset;\n\n                    this.minerals.push({\n                        id: Date.now() + Math.random(),\n                        type: mineralKey,\n                        ...type,\n                        x: spawnX,\n                        y: spawnY,\n                        z: spawnZ,\n                        phase: Math.random() * Math.PI * 2,\n                        defended: type.rarity === 'epic' || type.rarity === 'legendary' || type.rarity === 'mythic'\n                    });\n                }\n            }\n\n            // Get the zone type at a given distance from origin\n            getZoneAtDistance(distance) {\n                for (const [zoneKey, zone] of Object.entries(this.galaxyZones)) {\n                    if (distance >= zone.distanceRange.min && distance < zone.distanceRange.max) {\n                        return zoneKey;\n                    }\n                }\n                // Beyond all zones = exotic\n                if (distance >= 5000) return 'exotic';\n                // Default to industrial for very close\n                return 'industrial';\n            }\n\n            // Select an element to spawn based on current zone and probability\n            // ADDICTIVE DESIGN: Clear risk/reward progression\n            selectElementForZone(currentZone, distance, bonusMultiplier = 1) {\n                const zones = this.galaxyZones;\n                const allElements = Object.keys(this.mineralTypes);\n\n                // Build probability weights with ZONE-BASED PROGRESSION\n                const weights = [];\n                let totalWeight = 0;\n\n                for (const elementKey of allElements) {\n                    const element = this.mineralTypes[elementKey];\n                    let weight = 1;\n\n                    // ADDICTIVE RARITY DISTRIBUTION BY ZONE\n                    // Inner Core (0-1500): Safe, abundant commons\n                    if (distance < 1500) {\n                        switch (element.rarity) {\n                            case 'common': weight = 70; break;      // 70%\n                            case 'uncommon': weight = 25; break;    // 25%\n                            case 'rare': weight = 5; break;         // 5%\n                            default: weight = 0; break;             // No epic+\n                        }\n                    }\n                    // Radiation Belt (1500-3000): Medium risk, good rewards\n                    else if (distance < 3000) {\n                        switch (element.rarity) {\n                            case 'common': weight = 40; break;      // 40%\n                            case 'uncommon': weight = 40; break;    // 40%\n                            case 'rare': weight = 15; break;        // 15%\n                            case 'epic': weight = 5; break;         // 5%\n                            default: weight = 0; break;\n                        }\n                    }\n                    // Outer Expanse (3000-5000): High risk, great rewards\n                    else if (distance < 5000) {\n                        switch (element.rarity) {\n                            case 'common': weight = 0; break;       // No commons\n                            case 'uncommon': weight = 25; break;    // 25%\n                            case 'rare': weight = 35; break;        // 35%\n                            case 'epic': weight = 30; break;        // 30%\n                            case 'legendary': weight = 10; break;   // 10%\n                            default: weight = 0; break;\n                        }\n                    }\n                    // Deep Void (5000+): Extreme risk, legendary rewards\n                    else {\n                        switch (element.rarity) {\n                            case 'common': weight = 0; break;\n                            case 'uncommon': weight = 0; break;\n                            case 'rare': weight = 20; break;        // 20%\n                            case 'epic': weight = 40; break;        // 40%\n                            case 'legendary': weight = 30; break;   // 30%\n                            case 'mythic': weight = 10; break;      // 10%\n                        }\n                    }\n\n                    // Hotspot bonus multiplier\n                    if (bonusMultiplier > 1) {\n                        // Increase rarity in hotspots\n                        if (element.rarity !== 'common') {\n                            weight *= bonusMultiplier;\n                        }\n                    }\n\n                    // Zone affinity: elements spawn more in their home zone\n                    if (zones[element.zone] && zones[element.zone].elements.includes(elementKey)) {\n                        if (element.zone === currentZone) {\n                            weight *= 1.5; // 50% bonus in home zone\n                        }\n                    }\n\n                    weights.push({ key: elementKey, weight });\n                    totalWeight += weight;\n                }\n\n                // Weighted random selection\n                let random = Math.random() * totalWeight;\n                for (const { key, weight } of weights) {\n                    random -= weight;\n                    if (random <= 0) {\n                        return key;\n                    }\n                }\n\n                // Fallback to iron\n                return 'iron';\n            }\n\n            // Check for mineral collection\n            collectMineral(mineral) {\n                const ship = this.playerShip;\n                const dx = mineral.x - ship.x;\n                const dy = mineral.y - ship.y;\n                const dz = mineral.z - ship.z;\n                const distance = Math.sqrt(dx * dx + dy * dy + dz * dz);\n                const collectionRadius = ship.size + mineral.size;\n\n                if (distance < collectionRadius) {\n                    // Add to inventory\n                    if (!this.playerInventory[mineral.type]) {\n                        this.playerInventory[mineral.type] = 0;\n                    }\n                    this.playerInventory[mineral.type]++;\n                    this.saveInventory();\n\n                    // Show notification\n                    this.collectionNotifications.push({\n                        text: `+${mineral.name} ($${mineral.value})`,\n                        color: mineral.color,\n                        time: Date.now()\n                    });\n\n                    // Remove mineral\n                    const index = this.minerals.indexOf(mineral);\n                    if (index > -1) this.minerals.splice(index, 1);\n                }\n            }\n\n            // Update minerals (check collection, spawn new ones)\n            updateMinerals() {\n                if (!this.flightMode) return;\n\n                // Check for collections\n                for (const mineral of [...this.minerals]) {\n                    this.collectMineral(mineral);\n                }\n\n                // Spawn new minerals\n                this.spawnMinerals();\n\n                // Update notifications (fade out after 2 seconds)\n                const now = Date.now();\n                this.collectionNotifications = this.collectionNotifications.filter(n => now - n.time < 2000);\n            }\n\n            toggleMatrixRainbow() {\n                this.matrixRainbowMode = !this.matrixRainbowMode;\n                const btn = document.getElementById('matrixRainbowBtn');\n                if (btn) btn.classList.toggle('active', this.matrixRainbowMode);\n            }\n\n            // Update star colors from the 3 color pickers\n            updateStarColors() {\n                try {\n                    const c1 = document.getElementById('starColor1')?.value || '#ffffff';\n                    const c2 = document.getElementById('starColor2')?.value || '#aaddff';\n                    const c3 = document.getElementById('starColor3')?.value || '#ffddaa';\n                    this.starColors = [c1, c2, c3];\n                    this.generateStaticStars();\n                    this.showToast('Star colors updated');\n                } catch (e) {\n                    console.error('[BG Error] updateStarColors failed:', e);\n                }\n            }\n\n            // Toggle slow star drift mode\n            toggleBgDrift() {\n                try {\n                    // Mutex: Turn off warp first if it's on\n                    if (this.bgWarpMode) {\n                        this.bgWarpMode = false;\n                        const warpBtn = document.getElementById('bgWarpBtn');\n                        if (warpBtn) warpBtn.classList.remove('active');\n                    }\n\n                    this.bgDriftMode = !this.bgDriftMode;\n                    const btn = document.getElementById('bgDriftBtn');\n                    if (btn) btn.classList.toggle('active', this.bgDriftMode);\n\n                    // Regenerate stars with proper velocities\n                    this.generateStaticStars();\n                    this.showToast(this.bgDriftMode ? 'Star Drift ON' : 'Star Drift OFF');\n                } catch (e) {\n                    console.error('[BG Error] toggleBgDrift failed:', e);\n                    this.bgDriftMode = false;\n                    this.showToast('Drift mode error - please try again');\n                }\n            }\n\n            toggleUpgradePanel() {\n                const panel = document.getElementById('upgradePanel');\n                if (panel) {\n                    panel.classList.toggle('hidden');\n                    if (!panel.classList.contains('hidden')) {\n                        this.updateUpgradeUI();\n                    }\n                }\n            }\n\n            updateUpgradeUI() {\n                const list = document.getElementById('upgradeList');\n                const credits = document.getElementById('dockCredits');\n                if (!list || !credits) return;\n\n                credits.textContent = '$' + this.credits.toLocaleString();\n\n                const upgrades = [\n                    { id: 'speed', name: 'Engine Overclock', desc: 'Increases max speed & acceleration' },\n                    { id: 'armor', name: 'Nanocarbon Hull', desc: 'Increases hull integrity' },\n                    { id: 'weapons', name: 'Photon Cannons', desc: 'Increases damage output (Coming Soon)' },\n                    { id: 'shield', name: 'Energy Shield', desc: 'Increases shield capacity' },\n                    { id: 'cargo', name: 'Quantum Hold', desc: 'Increases gem capacity (Coming Soon)' },\n                    { id: 'radar', name: 'Deep Scan Radar', desc: 'Increases detection range' }\n                ];\n\n                const costs = [1000, 2500, 5000, 10000, 25000];\n\n                let html = '';\n                upgrades.forEach(u => {\n                    const level = this.playerShip.upgrades[u.id] || 0;\n                    const cost = costs[level];\n                    const isMax = level >= 5;\n                    const canAfford = this.credits >= cost;\n\n                    let bars = '';\n                    for (let i = 0; i < 5; i++) {\n                        bars += `<div style=\"flex:1; height:4px; background:${i < level ? '#00f3ff' : 'rgba(255,255,255,0.1)'}; margin:0 1px;\"></div>`;\n                    }\n\n                    html += `\n                        <div style=\"background:rgba(255,255,255,0.05); border:1px solid ${canAfford ? 'rgba(0,243,255,0.3)' : 'rgba(255,50,50,0.3)'}; padding:8px; border-radius:6px;\">\n                            <div style=\"display:flex; justify-content:space-between; margin-bottom:4px;\">\n                                <span style=\"font-weight:bold; color:#e0faff; font-size:11px;\">${u.name}</span>\n                                <span style=\"font-size:10px; color:${isMax ? '#00f3ff' : '#ffd700'}\">${isMax ? 'MAX' : '$' + cost.toLocaleString()}</span>\n                            </div>\n                            <div style=\"font-size:9px; color:#8ba; margin-bottom:6px;\">${u.desc}</div>\n                            <div style=\"display:flex; margin-bottom:6px;\">${bars}</div>\n                            ${!isMax ? `<button class=\"btn-small\" onclick=\"app.upgradeShip('${u.id}')\" style=\"width:100%; font-size:10px; padding:4px; ${canAfford ? 'cursor:pointer' : 'opacity:0.5; cursor:not-allowed;'}\">UPGRADE</button>` : ''}\n                        </div>\n                    `;\n                });\n\n                list.innerHTML = html;\n            }\n\n            // Toggle warp speed mode\n            toggleBgWarp() {\n                try {\n                    // Mutex: Turn off drift first if it's on\n                    if (this.bgDriftMode) {\n                        this.bgDriftMode = false;\n                        const driftBtn = document.getElementById('bgDriftBtn');\n                        if (driftBtn) driftBtn.classList.remove('active');\n                    }\n\n                    const btn = document.getElementById('bgWarpBtn');\n\n                    // If currently disengaging, ignore button presses\n                    if (this.warpDisengaging) {\n                        this.showToast('Warp still decelerating...');\n                        return;\n                    }\n\n                    // DISENGAGE path: When warp is ON, start the disengage animation\n                    if (this.bgWarpMode) {\n                        this.warpDisengaging = true;\n                        this.disengageStartTime = performance.now(); // Track when disengage started\n                        this.disengageDuration = 4500; // 4.5 seconds total animation\n                        if (btn) btn.classList.remove('active');\n                        this.showToast('Warp Disengaged - Decelerating...');\n\n                        // Cancel any existing engage animation\n                        if (this.warpSliderAnimation) {\n                            cancelAnimationFrame(this.warpSliderAnimation);\n                            this.warpSliderAnimation = null;\n                        }\n\n                        const slider = document.getElementById('warpSpeedSlider');\n                        if (slider) {\n                            const startValue = parseFloat(slider.value) || 100;\n                            const startTime = performance.now();\n\n                            // MIRRORED timing from acceleration: \n                            // Accel was: 3s slow (150), then 1.5s fast (50100)\n                            // Decel is: 1.5s fast (10050), then 3s slow (501)\n                            const fastSlowdownDuration = 1500;  // Fast initial decel\n                            const gradualSlowdownDuration = 3000; // Slow final approach\n                            const totalDuration = fastSlowdownDuration + gradualSlowdownDuration;\n\n                            // Animate slider backward (inverse of acceleration)\n                            const animateSliderBackward = (currentTime) => {\n                                if (!this.warpDisengaging) return;\n\n                                const elapsed = currentTime - startTime;\n                                let value;\n\n                                if (elapsed < fastSlowdownDuration) {\n                                    // Fast phase: 100 to 50 in 1.5s\n                                    const progress = elapsed / fastSlowdownDuration;\n                                    const eased = 1 - Math.pow(1 - progress, 2); // ease-out\n                                    value = startValue - (startValue * 0.5 * eased);\n                                } else if (elapsed < totalDuration) {\n                                    // Slow phase: 50 to 0 in 3s (mirrors the 3s 050)\n                                    const gradualElapsed = elapsed - fastSlowdownDuration;\n                                    const progress = gradualElapsed / gradualSlowdownDuration;\n                                    const eased = 1 - Math.pow(1 - progress, 3); // ease-out cubic\n                                    value = (startValue * 0.5) - ((startValue * 0.5) * eased);\n                                } else {\n                                    // Complete - turn off warp mode\n                                    value = 0;\n                                    this.warpDisengaging = false;\n                                    this.bgWarpMode = false;\n\n                                    // Finalize objects at their current positions and clean up\n                                    const finalizePositions = (arr) => {\n                                        if (arr) arr.forEach(obj => {\n                                            // Snap objects to their final positions - REMOVED to prevent jump\n                                            // if (obj.finalX !== undefined) {\n                                            //    obj.x = obj.finalX;\n                                            //    obj.y = obj.finalY;\n                                            // }\n                                            // Clear all warp-related data\n                                            obj.flownOut = false;\n                                            obj.wasFlownOut = false;\n                                            obj.disengageInit = false;\n                                            obj.returning = false;\n                                            obj.arrivalAngle = undefined;\n                                            obj.warpScale = undefined;\n                                            obj.warpAlpha = undefined;\n                                            obj.startWarpSpeed = undefined;\n                                            obj.startScreenX = undefined;\n                                            obj.startScreenY = undefined;\n                                            obj.finalX = undefined;\n                                            obj.finalY = undefined;\n                                            obj.disengageFinalX = undefined;\n                                            obj.disengageFinalY = undefined;\n                                            obj.targetX = undefined;\n                                            obj.targetY = undefined;\n                                            obj.origX = undefined;\n                                            obj.origY = undefined;\n                                            obj.typeIndex = undefined;\n                                        });\n                                    };\n                                    finalizePositions(this.planets);\n                                    finalizePositions(this.galaxies);\n                                    finalizePositions(this.blackHoles);\n                                    finalizePositions(this.nebulae);\n                                    finalizePositions(this.spacecraft);\n                                    finalizePositions(this.stars);\n\n                                    slider.value = 0;\n                                    this.setWarpSpeedMultiplier(0);\n\n                                    this.showToast('Arrived at new destination');\n                                    return;\n                                }\n\n                                slider.value = Math.max(0, value);\n                                this.setWarpSpeedMultiplier(Math.max(0, value), false);\n\n                                this.warpSliderAnimation = requestAnimationFrame(animateSliderBackward);\n                            };\n\n                            this.warpSliderAnimation = requestAnimationFrame(animateSliderBackward);\n                        }\n                        return; // Exit after starting disengage\n                    }\n\n                    // ENGAGE path: Turn on warp mode\n                    this.bgWarpMode = true;\n                    this.warpDisengaging = false;\n                    if (btn) btn.classList.add('active');\n\n                    // Reset warp speed for smooth ramp-up\n                    this.warpSpeed = 0;\n\n                    this.showToast('WARP ENGAGED!');\n\n                    // Store original positions for all objects\n                    const storeOriginalPosition = (obj) => {\n                        if (!obj) return;\n                        obj.origX = obj.x;\n                        obj.origY = obj.y;\n                        obj.flownOut = false;\n                        obj.returning = false;\n                    };\n                    if (this.planets) this.planets.forEach(storeOriginalPosition);\n                    if (this.galaxies) this.galaxies.forEach(storeOriginalPosition);\n                    if (this.blackHoles) this.blackHoles.forEach(storeOriginalPosition);\n                    if (this.nebulae) this.nebulae.forEach(storeOriginalPosition);\n                    if (this.spacecraft) this.spacecraft.forEach(storeOriginalPosition);\n                    if (this.stars) this.stars.forEach(storeOriginalPosition);\n\n                    // Auto-animate slider from min to max\n                    const slider = document.getElementById('warpSpeedSlider');\n                    if (slider) {\n                        if (this.warpSliderAnimation) {\n                            cancelAnimationFrame(this.warpSliderAnimation);\n                        }\n\n                        this.warpManualControl = false;\n\n                        const stopAutoAnimation = () => {\n                            this.warpManualControl = true;\n                            if (this.warpSliderAnimation) {\n                                cancelAnimationFrame(this.warpSliderAnimation);\n                                this.warpSliderAnimation = null;\n                            }\n                        };\n\n                        slider.removeEventListener('mousedown', stopAutoAnimation);\n                        slider.removeEventListener('touchstart', stopAutoAnimation);\n                        slider.removeEventListener('pointerdown', stopAutoAnimation);\n                        slider.addEventListener('mousedown', stopAutoAnimation);\n                        slider.addEventListener('touchstart', stopAutoAnimation);\n                        slider.addEventListener('pointerdown', stopAutoAnimation);\n\n                        slider.value = 1;\n                        this.setWarpSpeedMultiplier(1);\n\n                        const startTime = performance.now();\n                        const firstHalfDuration = 3000;\n                        const secondHalfDuration = 1500;\n                        const totalDuration = firstHalfDuration + secondHalfDuration;\n\n                        const animateSlider = (currentTime) => {\n                            if (!this.bgWarpMode || this.warpManualControl || this.warpDisengaging) return;\n\n                            const elapsed = currentTime - startTime;\n                            let value;\n\n                            if (elapsed < firstHalfDuration) {\n                                const firstProgress = elapsed / firstHalfDuration;\n                                value = 1 + firstProgress * 49.5;\n                            } else if (elapsed < totalDuration) {\n                                const secondElapsed = elapsed - firstHalfDuration;\n                                const secondProgress = Math.min(1, secondElapsed / secondHalfDuration);\n                                value = 50.5 + secondProgress * 49.5;\n                            } else {\n                                const maintainTime = (elapsed - totalDuration) / 1000;\n                                const wave1 = Math.sin(maintainTime * 0.8) * 5;\n                                const wave2 = Math.sin(maintainTime * 2.3) * 3;\n                                const wave3 = Math.sin(maintainTime * 5.7) * 2;\n                                const surge = Math.sin(maintainTime * 0.3) * Math.sin(maintainTime * 1.1) * 4;\n                                const turbulence = wave1 + wave2 + wave3 + surge;\n                                value = 92 + turbulence;\n                                value = Math.max(85, Math.min(100, value));\n                            }\n\n                            slider.value = value;\n                            this.setWarpSpeedMultiplier(value);\n                            this.warpSliderAnimation = requestAnimationFrame(animateSlider);\n                        };\n                        this.warpSliderAnimation = requestAnimationFrame(animateSlider);\n                    }\n                } catch (e) {\n                    console.error('[BG Error] toggleBgWarp failed:', e);\n                    this.bgWarpMode = false;\n                    this.warpDisengaging = false;\n                    this.showToast('Warp mode error - please try again');\n                }\n            }\n\n            // Set warp speed multiplier from slider\n            // EXPONENTIAL acceleration: slow start, ramps up to lightspeed at midpoint\n            setWarpSpeedMultiplier(value, updateState = true) {\n                const rawValue = parseFloat(value) || 0;\n\n                if (updateState) {\n                    // Handling for \"Slow Move\" / Traverse vs Warp\n                    if (rawValue > 0.5) {\n                        // Moving: Enable warp mode (traverse)\n                        if (!this.bgWarpMode) this.bgWarpMode = true;\n                        this.warpDisengaging = false;\n\n                        const btn = document.getElementById('bgWarpBtn');\n                        if (btn) btn.classList.add('active');\n                    } else {\n                        // Stopped/Arrived (Slider ~0)\n                        if (rawValue === 0) {\n                            // FULL STOP: Ensure everything is off\n                            this.bgWarpMode = false;\n                            this.warpDisengaging = false;\n                            this.warpSpeed = 0; // Force speed to 0 immediately\n                            const btn = document.getElementById('bgWarpBtn');\n                            if (btn) btn.classList.remove('active');\n                            this.showToast('Engines Stopped');\n                        } else if (this.bgWarpMode && !this.warpDisengaging) {\n                            // Slowing down but not 0: Trigger disengage visual (stars fading)\n                            this.warpDisengaging = true;\n                        }\n                    }\n                }\n\n                // Normalize to 0-1 range (slider is 0-100)\n                const normalized = rawValue / 100;\n\n                // Curve: Speed 0 = 0. Speed 1 = Slow. Speed 100 = Fast.\n                // Using power curve to give fine control at low speeds\n                const curved = Math.pow(normalized, 3);\n\n                // Scale to final range: 0 to ~840\n                this.warpSpeedMultiplier = curved * 840;\n\n                // Store raw slider for UI consistency\n                this.warpSliderRaw = rawValue;\n            }\n\n            updateColorModeUI() {\n                const fixedIndicator = document.getElementById('fixedModeIndicator');\n                const rainbowBtn = document.getElementById('rainbowBtn');\n                const colorText = document.getElementById('currentColorModeText');\n                const colorInput = document.getElementById('colorInput');\n\n                // Guard clauses to prevent crashes if elements don't exist\n                if (colorInput) colorInput.value = this.activeColor;\n\n                if (this.colorMode === 'fixed') {\n                    if (fixedIndicator) {\n                        fixedIndicator.classList.add('active');\n                        fixedIndicator.style.background = this.activeColor;\n                    }\n                    if (rainbowBtn) rainbowBtn.classList.remove('active');\n                    if (colorText) colorText.innerText = `Color Mode: Fixed (${this.activeColor})`;\n                } else {\n                    if (fixedIndicator) fixedIndicator.classList.remove('active');\n                    if (rainbowBtn) rainbowBtn.classList.add('active');\n                    if (colorText) colorText.innerText = \"Color Mode: Rainbow (Random per star)\";\n                }\n            }\n\n            /* --- Input Handling --- */\n\n            getWorldPos(e) {\n                return {\n                    x: (e.clientX - this.canvas.width / 2 - this.camera.x) / this.camera.zoom,\n                    y: (e.clientY - this.canvas.height / 2 - this.camera.y) / this.camera.zoom\n                };\n            }\n\n            onPointerDown(e) {\n                // Track which button was pressed (0=left, 1=middle, 2=right)\n                this.pointer.button = e.button;\n\n                // Only track canvas interactions\n                this.pointer.onCanvas = (e.target === this.canvas);\n                this.pointer.isDown = true;\n                this.pointer.startX = e.clientX;\n                this.pointer.startY = e.clientY;\n                this.pointer.camStartX = this.camera.x;\n                this.pointer.camStartY = this.camera.y;\n                this.pointer.rotStartX = this.rotationX;\n                this.pointer.rotStartY = this.rotationY;\n\n                // Middle mouse button OR Alt+Left = Orbit mode (Blender style)\n                // Shift+Left = Pan mode\n                this.pointer.orbitMode = (e.button === 1) || (e.button === 0 && e.altKey);\n                this.pointer.panMode = (e.button === 0 && e.shiftKey);\n\n                // If orbiting or panning, skip star interactions\n                if (this.pointer.orbitMode || this.pointer.panMode) {\n                    return;\n                }\n\n                const world = this.getWorldPos(e);\n                const hitDist = (this.config.starBaseRad * 4) / this.camera.zoom;\n                const starHit = this.stars.find(s => Math.hypot(s.x - world.x, s.y - world.y) < hitDist);\n\n                // Refresh cluster assignments if we hit a star, in case we drag a group\n                if (starHit) {\n                    this.refreshClusterAssignments();\n\n                    // In select mode, clicking a star initiates a cluster drag\n                    if (this.mode === 'select' && starHit.clusterId) {\n                        // Determine the cluster ID to drag (it's either the cluster name string or the star's ID string)\n                        this.draggedClusterId = String(starHit.clusterId);\n                        this.pointer.lastWorldX = world.x;\n                        this.pointer.lastWorldY = world.y;\n                        this.saveState();\n                        return;\n                    }\n\n                    // If not in select mode, allow single star drag\n                    if (this.mode === 'draw') {\n                        this.draggedStar = starHit;\n                        this.saveState();\n                    }\n                }\n            }\n\n            onPointerMove(e) {\n                const world = this.getWorldPos(e);\n\n                // Hover Logic\n                const hitDist = (this.config.starBaseRad * 4) / this.camera.zoom;\n                this.hoveredStar = this.stars.find(s => Math.hypot(s.x - world.x, s.y - world.y) < hitDist);\n\n                // Cursor Feedback based on mode\n                let newCursor = 'default';\n                if (this.pointer.orbitMode && this.pointer.isDown) {\n                    newCursor = 'grab';\n                } else if (this.pointer.panMode && this.pointer.isDown) {\n                    newCursor = 'move';\n                } else if (this.draggedStar || this.draggedClusterId || this.pointer.dragging) {\n                    newCursor = 'grabbing';\n                } else if (this.hoveredStar) {\n                    newCursor = 'move';\n                } else if (this.mode === 'draw') {\n                    newCursor = 'crosshair';\n                }\n                this.canvas.style.cursor = newCursor;\n\n\n                if (!this.pointer.isDown) return;\n\n                const dx = e.clientX - this.pointer.startX;\n                const dy = e.clientY - this.pointer.startY;\n                const distMoved = Math.hypot(dx, dy);\n\n                if (distMoved > 5) {\n                    this.pointer.dragging = true;\n                }\n\n                // PRIORITY 1: Orbit mode (Middle mouse or Alt+Left) - ALWAYS rotates in 3D\n                if (this.pointer.orbitMode) {\n                    this.rotationY = this.pointer.rotStartY + dx * 0.5;\n                    this.rotationX = this.pointer.rotStartX + dy * 0.5;\n                    this.draw();\n                    // Update UI sliders\n                    const rotXSliderEl = document.getElementById('rotXSlider');\n                    const rotYSliderEl = document.getElementById('rotYSlider');\n                    if (rotXSliderEl) {\n                        rotXSliderEl.value = this.rotationX % 360;\n                        document.getElementById('rotXValue').textContent = Math.round(this.rotationX % 360) + '';\n                    }\n                    if (rotYSliderEl) {\n                        rotYSliderEl.value = this.rotationY % 360;\n                        document.getElementById('rotYValue').textContent = Math.round(this.rotationY % 360) + '';\n                    }\n                    return;\n                }\n\n                // PRIORITY 2: Pan mode (Shift + Left drag) - ALWAYS pans\n                if (this.pointer.panMode) {\n                    this.camera.x = this.pointer.camStartX + dx;\n                    this.camera.y = this.pointer.camStartY + dy;\n                    return;\n                }\n\n                // PRIORITY 3: Cluster dragging (in select mode)\n                if (this.draggedClusterId) {\n                    // Calculate world delta since last move\n                    const deltaWorldX = world.x - this.pointer.lastWorldX;\n                    const deltaWorldY = world.y - this.pointer.lastWorldY;\n\n                    const draggedIdString = this.draggedClusterId;\n                    // Move all stars in the cluster\n                    this.stars.forEach(s => {\n                        // Use strict comparison on the clusterId string\n                        if (String(s.clusterId) === draggedIdString) {\n                            s.x += deltaWorldX;\n                            s.y += deltaWorldY;\n                        }\n                    });\n\n                    // Update last position\n                    this.pointer.lastWorldX = world.x;\n                    this.pointer.lastWorldY = world.y;\n                    return;\n                }\n\n                // PRIORITY 4: Single star dragging\n                if (this.draggedStar) {\n                    this.draggedStar.x = world.x;\n                    this.draggedStar.y = world.y;\n                    return;\n                }\n\n                // PRIORITY 5: Empty space drag = rotate by default (Blender-style)\n                if (this.pointer.dragging) {\n                    this.rotationY = this.pointer.rotStartY + dx * 0.5;\n                    this.rotationX = this.pointer.rotStartX + dy * 0.5;\n                    this.draw();\n                    // Update UI sliders if they exist\n                    const rotXSliderEl = document.getElementById('rotXSlider');\n                    const rotYSliderEl = document.getElementById('rotYSlider');\n                    if (rotXSliderEl) {\n                        rotXSliderEl.value = this.rotationX % 360;\n                        document.getElementById('rotXValue').textContent = Math.round(this.rotationX % 360) + '';\n                    }\n                    if (rotYSliderEl) {\n                        rotYSliderEl.value = this.rotationY % 360;\n                        document.getElementById('rotYValue').textContent = Math.round(this.rotationY % 360) + '';\n                    }\n                }\n            }\n\n            onPointerUp(e) {\n                // Skip star creation if we were orbiting or panning\n                const wasNavigating = this.pointer.orbitMode || this.pointer.panMode;\n\n                // Only process star creation if pointer started on canvas and not navigating\n                if (this.pointer.onCanvas && !wasNavigating) {\n                    const world = this.getWorldPos(e);\n                    const hitDist = (this.config.starBaseRad * 4) / this.camera.zoom;\n                    const clickedStar = this.stars.find(s => Math.hypot(s.x - world.x, s.y - world.y) < hitDist);\n\n                    if (!this.pointer.dragging && !clickedStar) {\n                        // Empty Space Clicked - Create Star (ONLY in draw mode)\n                        if (this.mode === 'draw') {\n                            this.saveState(); // Save BEFORE action\n\n                            // Get current rotation center BEFORE adding star\n                            // This ensures consistency with how rotate3D renders existing stars\n                            const center = this.getConstellationCenter();\n\n                            // Cache the center for rendering stability after star is added\n                            // This prevents the visual \"jump\" when constellation center shifts\n                            this._cachedRotationCenter = { x: center.x, y: center.y, z: center.z };\n\n                            // Inverse rotate using the same center that rendering uses\n                            const pos3D = this.inverseRotate3D(world.x, world.y, center.x, center.y);\n\n                            this.createStar(pos3D.x, pos3D.y, pos3D.z);\n\n                            // Clear cached center after a brief delay to allow smooth transition\n                            setTimeout(() => { this._cachedRotationCenter = null; }, 100);\n                        }\n                    }\n                }\n\n                // Reset interaction state\n                this.pointer.isDown = false;\n                this.pointer.dragging = false;\n                this.pointer.onCanvas = false;\n                this.pointer.orbitMode = false;\n                this.pointer.panMode = false;\n                this.pointer.button = 0;\n                this.draggedStar = null;\n                this.draggedClusterId = null;\n            }\n\n            onRightClick(e) {\n                e.preventDefault(); // Prevent context menu\n                const world = this.getWorldPos(e);\n                const hitDist = (this.config.starBaseRad * 4) / this.camera.zoom;\n\n                // Check if clicking on a star\n                const clickedStarIndex = this.stars.findIndex(s => Math.hypot(s.x - world.x, s.y - world.y) < hitDist);\n\n                if (clickedStarIndex !== -1) {\n                    // Delete the star\n                    this.saveState(); // Save for undo\n                    this.stars.splice(clickedStarIndex, 1);\n                    this.showToast(`Deleted star`);\n                    this.draw();\n                    return;\n                }\n\n                // Check if clicking on a connection line\n                const lineHitDist = 5 / this.camera.zoom; // 5 pixel tolerance\n                for (let i = 0; i < this.stars.length; i++) {\n                    const s1 = this.stars[i];\n                    for (let j = i + 1; j < this.stars.length; j++) {\n                        const s2 = this.stars[j];\n\n                        // Only check connected stars\n                        if (Math.hypot(s1.x - s2.x, s1.y - s2.y) > this.config.maxConnectDist) continue;\n\n                        // Point-to-line distance formula\n                        const lineLen = Math.hypot(s2.x - s1.x, s2.y - s1.y);\n                        if (lineLen === 0) continue;\n\n                        const t = Math.max(0, Math.min(1, ((world.x - s1.x) * (s2.x - s1.x) + (world.y - s1.y) * (s2.y - s1.y)) / (lineLen * lineLen)));\n                        const projX = s1.x + t * (s2.x - s1.x);\n                        const projY = s1.y + t * (s2.y - s1.y);\n                        const dist = Math.hypot(world.x - projX, world.y - projY);\n\n                        if (dist < lineHitDist) {\n                            // Delete both stars that make up this connection\n                            this.saveState(); // Save for undo\n                            const indices = [i, j].sort((a, b) => b - a); // Remove in reverse order\n                            this.stars.splice(indices[0], 1);\n                            this.stars.splice(indices[1], 1);\n                            this.showToast(`Deleted connection`);\n                            this.draw();\n                            return;\n                        }\n                    }\n                }\n            }\n\n            onWheel(e) {\n                e.preventDefault();\n                const zoomSpeed = 0.0015;\n                const newZoom = Math.max(0.1, Math.min(6, this.camera.zoom - e.deltaY * zoomSpeed));\n\n                const worldPos = this.getWorldPos(e);\n                this.camera.zoom = newZoom;\n\n                this.camera.x = e.clientX - this.canvas.width / 2 - worldPos.x * this.camera.zoom;\n                this.camera.y = e.clientY - this.canvas.height / 2 - worldPos.y * this.camera.zoom;\n            }\n\n            /* --- Star Creation --- */\n\n            createStar(x, y, z = 0) {\n                let starColor = this.activeColor;\n                if (this.colorMode === 'rainbow') {\n                    starColor = this.getRainbowHex();\n                }\n\n                this.stars.push({\n                    x, y,\n                    z: z, // Store Z coordinate\n                    id: Math.floor(Date.now() + Math.random() * 1000).toString(),\n                    phase: Math.random() * Math.PI * 2,\n                    color: starColor,\n                    clusterId: null, // Will be calculated in refreshClusterAssignments()\n                });\n                this.draw();\n            }\n\n            /**\n             * Re-calculates connections and assigns cluster names/IDs to all star objects.\n             * Guarantees that s.clusterId is always a string (either the constellation name or the star's unique string ID).\n             */\n            refreshClusterAssignments() {\n                const { lines, clusters } = this.calculateGeometry();\n\n                // Map to hold assignments: { starId: clusterName/starId }\n                const assignmentMap = new Map();\n\n                // 1. Assign deterministic name (string) to all members of large clusters (>= minGroupSize)\n                clusters.forEach(c => {\n                    if (c.length >= this.config.minGroupSize) {\n                        const name = this.getConstellationName(c);\n                        c.forEach(star => {\n                            assignmentMap.set(star.id, name);\n                        });\n                    }\n                });\n\n                // 2. Apply assignments back to the main stars array\n                this.stars.forEach(s => {\n                    // If a star is part of a large cluster, use the mapped string name. \n                    // Otherwise, preserve its existing name IF it's a real string (e.g. from template), else fallback to ID.\n                    const assigned = assignmentMap.get(s.id);\n                    if (assigned) {\n                        s.clusterId = assigned;\n                    } else if (s.clusterId && isNaN(parseFloat(s.clusterId))) {\n                        // Keep existing custom name if it's not just a number\n                        // This preserves \"Wolf Major\" even if connectivity logic doesn't group it yet\n                    } else {\n                        s.clusterId = s.id;\n                    }\n                });\n\n                return { lines, clusters };\n            }\n\n            /* --- Utility Methods --- */\n\n            getStarColor(s) {\n                return s.color || '#e0faff'; // Fallback to default if somehow color is missing\n            }\n\n            hexToRgb(hex) {\n                const shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n                hex = hex.replace(shorthandRegex, (m, r, g, b) => r + r + g + g + b + b);\n                const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n                return result ? [\n                    parseInt(result[1], 16),\n                    parseInt(result[2], 16),\n                    parseInt(result[3], 16)\n                ] : [224, 240, 255]; // Default blue/white\n            }\n\n\n            /* --- Core Logic (State Management) --- */\n\n            saveState() {\n                // Save a deep copy of the stars array before an action that changes it\n                const newState = JSON.stringify(this.stars.map(s => ({\n                    x: s.x,\n                    y: s.y,\n                    id: String(s.id),\n                    phase: s.phase,\n                    color: s.color,\n                })));\n                if (this.history.length > 25) this.history.shift();\n                this.history.push(newState);\n                console.log('[UNDO] saveState called, history length:', this.history.length);\n            }\n\n            undo() {\n                console.log('[UNDO] undo() called, history length:', this.history.length);\n                if (this.history.length === 0) {\n                    this.showToast(\"Nothing to undo\");\n                    return;\n                }\n                // Pop the last saved state and restore it\n                const prevState = this.history.pop();\n                if (prevState) {\n                    this.stars = JSON.parse(prevState);\n                    console.log('[UNDO] Restored state with', this.stars.length, 'stars');\n                } else {\n                    this.stars = [];\n                }\n\n                this.draw();\n                this.showToast(`Undone (${this.history.length} remaining)`);\n            }\n\n            requestClear() {\n                document.getElementById('clearModal').classList.add('active');\n            }\n\n            closeModal() {\n                document.getElementById('clearModal').classList.remove('active');\n            }\n\n            confirmClear() {\n                this.saveState();\n                this.stars = [];\n                this.camera = { x: 0, y: 0, zoom: 1 };\n                this.closeModal();\n                this.draw();\n                this.showToast(\"Universe Imploded\");\n            }\n\n            resetView() {\n                this.camera = { x: 0, y: 0, zoom: 1 };\n            }\n\n            adjustZoom(delta) {\n                this.camera.zoom = Math.max(0.1, Math.min(6, this.camera.zoom + delta));\n                // Re-center camera on ship in flight mode to prevent drift\n                // Re-center camera on ship in flight mode to prevent drift\n                if (this.flightMode && this.playerShip) {\n                    this.camera.x = -this.playerShip.x * this.camera.zoom;\n                    this.camera.y = -this.playerShip.y * this.camera.zoom;\n                }\n            }\n\n            getConstellationName(group) {\n                // Priority: Check if any star already has a assigned name (e.g. from a Template or previous session)\n                // We assume a real name is a string that isn't just a number/ID.\n                const existing = group.find(s => s.clusterId && isNaN(parseFloat(s.clusterId)));\n                if (existing) return existing.clusterId;\n\n                const sortedIds = group.map(s => String(s.id)).sort((a, b) => a.localeCompare(b));\n                let seed = 0;\n                sortedIds.forEach((id, i) => {\n                    for (let j = 0; j < id.length; j++) {\n                        seed += id.charCodeAt(j) * (j + 1) * (i + 1);\n                    }\n                });\n                seed = Math.floor(seed);\n\n                const pre = this.prefixes[seed % this.prefixes.length];\n                const root = this.roots[(seed * 13) % this.roots.length];\n                const suf = this.suffixes[(seed * 7) % this.suffixes.length];\n\n                const type = seed % 3;\n                if (type === 0) return `${pre} ${root}`;\n                if (type === 1) return `${root} ${suf}`;\n                return `The ${pre} ${root} ${suf}`;\n            }\n\n            // Duplicate setBgStyle removed\n\n            // ... (updateColorModeUI omitted)\n\n            generateBackground() {\n                try {\n                    // Allow empty activeStyles for minimal black background with just faint stars\n                    this.config.showBackground = true;\n                    this.staticStars = [];\n                    this.galaxies = [];\n                    this.blackHoles = [];\n                    this.shootingStars = [];\n                    this.backgroundStars = [];\n                    this.nebulae = [];\n                    this.spacecraft = [];\n                    this.matrixStreams = [];\n\n                    // State handling for Cyber theme history\n                    try {\n                        const savedHistory = localStorage.getItem('matrixThemeHistory');\n                        this.themeHistory = savedHistory ? JSON.parse(savedHistory) : [];\n                        this.lastMatrixFamily = localStorage.getItem('matrixLastFamily') || '';\n                    } catch (e) {\n                        console.warn('[BG] Theme history load failed:', e);\n                        this.themeHistory = [];\n                        this.lastMatrixFamily = '';\n                    }\n\n                    // 1. Static Stars (Mixed Palette)\n                    try {\n                        this.generateStaticStars();\n                    } catch (e) {\n                        console.error('[BG Error] generateStaticStars failed:', e);\n                        this.staticStars = [];\n                    }\n\n                    // 2. Compose Layers based on active styles\n                    // Order matters for layering (Deep Space -> Nebula -> Alien -> Cyber)\n                    if (this.activeStyles.has('deep-space')) {\n                        try {\n                            this.generateDeepSpaceStyle();\n                        } catch (e) {\n                            console.error('[BG Error] generateDeepSpaceStyle failed:', e);\n                        }\n                    }\n                    if (this.activeStyles.has('nebula')) {\n                        try {\n                            this.generateNebulaStyle();\n                        } catch (e) {\n                            console.error('[BG Error] generateNebulaStyle failed:', e);\n                        }\n                    }\n                    if (this.activeStyles.has('alien')) {\n                        try {\n                            this.generateAlienStyle();\n                        } catch (e) {\n                            console.error('[BG Error] generateAlienStyle failed:', e);\n                        }\n                    }\n                    if (this.activeStyles.has('cyber')) {\n                        try {\n                            this.generateCyberStyle();\n                        } catch (e) {\n                            console.error('[BG Error] generateCyberStyle failed:', e);\n                        }\n                    }\n                } catch (e) {\n                    console.error('[BG Error] generateBackground failed critically:', e);\n                    this.showToast('Background generation failed - using minimal mode');\n                    // Ensure arrays exist to prevent cascade failures\n                    this.staticStars = this.staticStars || [];\n                    this.galaxies = this.galaxies || [];\n                    this.blackHoles = this.blackHoles || [];\n                    this.shootingStars = this.shootingStars || [];\n                    this.backgroundStars = this.backgroundStars || [];\n                    this.nebulae = this.nebulae || [];\n                    this.spacecraft = this.spacecraft || [];\n                    this.matrixStreams = this.matrixStreams || [];\n                }\n            }\n\n            generateStaticStars() {\n                // CLEAR existing stars first so color changes take effect\n                this.staticStars = [];\n\n                // Use more stars for warp mode for a denser hyperspace field\n                const count = this.bgWarpMode ? 600 : 400;\n\n                // ALWAYS read star colors directly from the DOM pickers\n                const c1 = document.getElementById('starColor1')?.value || '#ffffff';\n                const c2 = document.getElementById('starColor2')?.value || '#aaddff';\n                const c3 = document.getElementById('starColor3')?.value || '#ffddaa';\n                const activeColors = [c1, c2, c3];\n                // Also update the stored starColors array\n                this.starColors = activeColors;\n\n                // Generate stars across a much wider area using uniform distribution\n                const w = this.canvas.width;\n                const h = this.canvas.height;\n                const centerX = w / 2;\n                const centerY = h / 2;\n                const spreadX = w * 20;\n                const spreadY = h * 20;\n\n                for (let i = 0; i < count; i++) {\n                    let x, y, vx = 0, vy = 0;\n\n                    if (this.bgWarpMode) {\n                        // Warp mode: Stars originate from center and move outward radially\n                        const angle = Math.random() * Math.PI * 2;\n                        const dist = Math.random() * Math.max(w, h) * 0.8;\n                        x = centerX + Math.cos(angle) * dist;\n                        y = centerY + Math.sin(angle) * dist;\n                        // Faster radial velocity for dramatic hyperspace effect\n                        const speed = 4 + Math.random() * 16;\n                        vx = Math.cos(angle) * speed;\n                        vy = Math.sin(angle) * speed;\n                    } else {\n                        // Normal / Drift mode: Uniform distribution\n                        x = Math.random() * spreadX - spreadX / 2 + centerX;\n                        y = Math.random() * spreadY - spreadY / 2 + centerY;\n\n                        if (this.bgDriftMode) {\n                            // Slow gentle drift in random direction\n                            const angle = Math.random() * Math.PI * 2;\n                            const speed = 0.1 + Math.random() * 0.3;\n                            vx = Math.cos(angle) * speed;\n                            vy = Math.sin(angle) * speed;\n                        }\n                    }\n\n                    // Depth layer affects speed - creates parallax at high warp\n                    const depthLayer = 0.3 + Math.random() * 0.7; // 0.3 to 1.0\n                    this.staticStars.push({\n                        x: x,\n                        y: y,\n                        vx: vx,\n                        vy: vy,\n                        size: (Math.random() * 1.5 + 0.5) * depthLayer, // Farther = smaller\n                        alpha: Math.random() * 0.5 + 0.1,\n                        baseAlpha: Math.random() * 0.5 + 0.1,\n                        color: activeColors[Math.floor(Math.random() * activeColors.length)],\n                        depth: depthLayer // Used for speed variation\n                    });\n                }\n            }\n\n            // Helper: Get hue from hex color\n            getHueFromHex(hex) {\n                const rgb = this.hexToRgb(hex);\n                const r = rgb[0] / 255, g = rgb[1] / 255, b = rgb[2] / 255;\n                const max = Math.max(r, g, b), min = Math.min(r, g, b);\n                let h = 0;\n                if (max !== min) {\n                    const d = max - min;\n                    if (max === r) h = ((g - b) / d + (g < b ? 6 : 0)) / 6;\n                    else if (max === g) h = ((b - r) / d + 2) / 6;\n                    else h = ((r - g) / d + 4) / 6;\n                }\n                return Math.round(h * 360);\n            }\n\n            // Helper: HSL to Hex\n            hslToHex(h, s, l) {\n                s /= 100; l /= 100;\n                const k = n => (n + h / 30) % 12;\n                const a = s * Math.min(l, 1 - l);\n                const f = n => l - a * Math.max(-1, Math.min(k(n) - 3, Math.min(9 - k(n), 1)));\n                const toHex = x => Math.round(x * 255).toString(16).padStart(2, '0');\n                return `#${toHex(f(0))}${toHex(f(8))}${toHex(f(4))}`;\n            }\n\n            generateDeepSpaceStyle() {\n                const range = this.worldSize;\n                const half = range / 2;\n                const zRange = 3000; // Increased Z-axis depth range\n\n                // Define zoom tiers: close, medium, far\n                // Close tier: objects within 400px of center (visible at max zoom ~5x)\n                // Medium tier: objects 400-2000px from center (visible at default zoom ~1x)\n                // Far tier: objects 2000-6000px from center (visible when zoomed out ~0.1x)\n\n                // 1. Background Stars - distributed across all tiers\n                const starCount = 600; // +20%\n                for (let i = 0; i < starCount; i++) {\n                    const tier = Math.random();\n                    let dist, size;\n                    if (tier < 0.2) { // Close tier - 20%\n                        dist = Math.random() * 400;\n                        size = 0.5 + Math.random() * 1.0;\n                    } else if (tier < 0.5) { // Medium tier - 30%\n                        dist = 400 + Math.random() * 1600;\n                        size = 1.0 + Math.random() * 1.5;\n                    } else { // Far tier - 50%\n                        dist = 2000 + Math.random() * 4000;\n                        size = 1.5 + Math.random() * 2.0;\n                    }\n                    const angle = Math.random() * Math.PI * 2;\n                    this.backgroundStars.push({\n                        x: Math.cos(angle) * dist,\n                        y: Math.sin(angle) * dist,\n                        z: (Math.random() * zRange) - zRange / 2,\n                        r: size,\n                        alpha: 0.15 + Math.random() * 0.5\n                    });\n                }\n\n                // 2. Galaxies - distributed across tiers (12 total, +50%)\n                const galaxyConfigs = [\n                    { count: 2, minDist: 100, maxDist: 400, minSize: 60, maxSize: 120 },   // Close\n                    { count: 4, minDist: 400, maxDist: 2000, minSize: 100, maxSize: 250 }, // Medium\n                    { count: 6, minDist: 2000, maxDist: 6000, minSize: 200, maxSize: 450 } // Far\n                ];\n                galaxyConfigs.forEach(cfg => {\n                    for (let i = 0; i < cfg.count; i++) {\n                        const dist = cfg.minDist + Math.random() * (cfg.maxDist - cfg.minDist);\n                        const angle = Math.random() * Math.PI * 2;\n                        this.galaxies.push({\n                            x: Math.cos(angle) * dist,\n                            y: Math.sin(angle) * dist,\n                            z: (Math.random() * zRange) - zRange / 2,\n                            // Expanded color palette\n                            color: ['#ff0055', '#5500ff', '#00aaff', '#ff00aa', '#00ff88', '#ffaa00', '#aa00ff', '#ffffff'][Math.floor(Math.random() * 8)],\n                            angle: Math.random() * Math.PI * 2,\n                            size: cfg.minSize + Math.random() * (cfg.maxSize - cfg.minSize)\n                        });\n                    }\n                });\n\n                // 3. Black Holes - 3 total (+50%), one per tier\n                const blackHoleConfigs = [\n                    { minDist: 200, maxDist: 500, minSize: 20, maxSize: 40 },\n                    { minDist: 800, maxDist: 2000, minSize: 40, maxSize: 80 },\n                    { minDist: 2500, maxDist: 5000, minSize: 80, maxSize: 150 }\n                ];\n                blackHoleConfigs.forEach(cfg => {\n                    const dist = cfg.minDist + Math.random() * (cfg.maxDist - cfg.minDist);\n                    const angle = Math.random() * Math.PI * 2;\n                    this.blackHoles.push({\n                        x: Math.cos(angle) * dist,\n                        y: Math.sin(angle) * dist,\n                        z: (Math.random() * zRange) - zRange / 2,\n                        size: cfg.minSize + Math.random() * (cfg.maxSize - cfg.minSize)\n                    });\n                });\n\n                // 4. Nebulae - 18 total (+50%), distributed across tiers\n                const nebulaConfigs = [\n                    { count: 4, minDist: 50, maxDist: 500, minSize: 150, maxSize: 350 },\n                    { count: 6, minDist: 500, maxDist: 2500, minSize: 350, maxSize: 700 },\n                    { count: 8, minDist: 2500, maxDist: 6000, minSize: 600, maxSize: 1200 }\n                ];\n                nebulaConfigs.forEach(cfg => {\n                    for (let i = 0; i < cfg.count; i++) {\n                        const dist = cfg.minDist + Math.random() * (cfg.maxDist - cfg.minDist);\n                        const angle = Math.random() * Math.PI * 2;\n                        this.nebulae.push({\n                            x: Math.cos(angle) * dist,\n                            y: Math.sin(angle) * dist,\n                            z: (Math.random() * zRange) - zRange / 2,\n                            size: cfg.minSize + Math.random() * (cfg.maxSize - cfg.minSize),\n                            color: ['#4400cc', '#0033aa', '#cc0066', '#330066', '#003366', '#660033'][Math.floor(Math.random() * 6)],\n                            alpha: 0.15 + Math.random() * 0.3\n                        });\n                    }\n                });\n\n                // 5. Planets - 15 total, distributed across tiers with spacing\n                this.planets = [];\n                const planetTypes = [\n                    { name: 'gas-giant', colors: ['#E8C273', '#C17B3A', '#8B5A2B'], hasAtmosphere: true },\n                    { name: 'ice-giant', colors: ['#87CEEB', '#4682B4', '#5F9EA0'], hasAtmosphere: true },\n                    { name: 'terrestrial', colors: ['#228B22', '#8B4513', '#2E8B57'], hasAtmosphere: true },\n                    { name: 'desert', colors: ['#EDC9AF', '#D2691E', '#CD853F'], hasAtmosphere: false },\n                    { name: 'volcanic', colors: ['#8B0000', '#FF4500', '#DC143C'], hasAtmosphere: true },\n                    { name: 'ocean', colors: ['#0077BE', '#005A87', '#003F5C'], hasAtmosphere: true }\n                ];\n                const planetConfigs = [\n                    { count: 3, minDist: 100, maxDist: 500, minRadius: 20, maxRadius: 50 },\n                    { count: 5, minDist: 500, maxDist: 2500, minRadius: 40, maxRadius: 100 },\n                    { count: 7, minDist: 2500, maxDist: 6000, minRadius: 80, maxRadius: 180 }\n                ];\n\n                // Helper to perturb colors for variety\n                const perturbColor = (hex, amount = 30) => {\n                    if (!hex || !hex.startsWith('#')) return hex;\n                    let r = parseInt(hex.slice(1, 3), 16);\n                    let g = parseInt(hex.slice(3, 5), 16);\n                    let b = parseInt(hex.slice(5, 7), 16);\n\n                    r = Math.min(255, Math.max(0, r + (Math.random() - 0.5) * amount * 2));\n                    g = Math.min(255, Math.max(0, g + (Math.random() - 0.5) * amount * 2));\n                    b = Math.min(255, Math.max(0, b + (Math.random() - 0.5) * amount * 2));\n\n                    return `#${(r | 0).toString(16).padStart(2, '0')}${(g | 0).toString(16).padStart(2, '0')}${(b | 0).toString(16).padStart(2, '0')}`;\n                };\n\n                // Helper to check if a new planet overlaps with existing ones\n                const checkPlanetSpacing = (x, y, z, radius) => {\n                    const minSpacing = 800; // Increased spacing for \"X, Y\" separation (Visual Clutter reduction)\n                    const minZSpacing = 1000; // Z-axis separation\n\n                    for (const existing of this.planets) {\n                        const dx = x - existing.x;\n                        const dy = y - existing.y;\n                        const dz = z - existing.z;\n\n                        // 2D Distance Check (Screen Space Prevention)\n                        const dist2D = Math.sqrt(dx * dx + dy * dy);\n                        const required2D = radius + existing.radius + minSpacing;\n\n                        // 3D Distance Check (Physical Collision)\n                        const dist3D = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n                        // If they are too close on screen, ensure they are FAR apart in Z\n                        if (dist2D < required2D) {\n                            if (Math.abs(dz) < minZSpacing) return false;\n                        }\n                    }\n                    return true;\n                };\n\n                // Planet tier-specific z-depth ranges for visual separation\n                const zDepthTiers = [\n                    { minZ: -1000, maxZ: -400 },  // Close tier: in front\n                    { minZ: -400, maxZ: 400 },     // Medium tier: middle\n                    { minZ: 400, maxZ: 1200 }       // Far tier: behind\n                ];\n\n                planetConfigs.forEach((cfg, tierIndex) => {\n                    const zTier = zDepthTiers[tierIndex];\n\n                    for (let i = 0; i < cfg.count; i++) {\n                        const type = planetTypes[Math.floor(Math.random() * planetTypes.length)];\n                        const hasRings = Math.random() > 0.5;\n                        const radius = cfg.minRadius + Math.random() * (cfg.maxRadius - cfg.minRadius);\n\n                        // Try to find a non-overlapping position (max 50 attempts)\n                        let x, y, z, attempts = 0;\n                        do {\n                            const dist = cfg.minDist + Math.random() * (cfg.maxDist - cfg.minDist);\n                            const angle = Math.random() * Math.PI * 2;\n                            x = Math.cos(angle) * dist;\n                            y = Math.sin(angle) * dist;\n                            // Assign z-depth based on tier for visual depth separation\n                            z = zTier.minZ + Math.random() * (zTier.maxZ - zTier.minZ);\n                            attempts++;\n                        } while (!checkPlanetSpacing(x, y, z, radius) && attempts < 50);\n\n                        this.planets.push({\n                            x: x,\n                            y: y,\n                            z: z, // Use the Z we calculated\n                            radius: radius,\n                            type: type.name,\n                            // Randomize colors slightly for variety\n                            baseColor: perturbColor(type.colors[0], 40),\n                            secondaryColor: perturbColor(type.colors[1], 40),\n                            tertiaryColor: perturbColor(type.colors[2], 40),\n                            hasAtmosphere: type.hasAtmosphere,\n                            atmosphereColor: type.name === 'ice-giant' ? '#ADD8E6' : (type.name === 'volcanic' ? '#FF6347' : '#87CEEB'),\n                            hasRings: hasRings,\n                            ringColor: hasRings ? `hsl(${Math.random() * 360}, ${40 + Math.random() * 40}%, ${50 + Math.random() * 30}%)` : null, // Full HSL/RGB variety\n                            ringInnerRadius: radius * 1.3,\n                            ringOuterRadius: radius * 2.2,\n                            textureSeed: Math.random() * 1000,\n                            rotation: Math.random() * Math.PI * 2,\n                            axialTilt: (Math.random() - 0.5) * 0.6\n                        });\n                    }\n                });\n\n                // 6. Moving Cosmic Stars (shooting stars / drifting stars)\n                this.shootingStars = [];\n                const shootingStarCount = 15;\n                for (let i = 0; i < shootingStarCount; i++) {\n                    const angle = Math.random() * Math.PI * 2;\n                    const dist = 500 + Math.random() * 5000;\n                    this.shootingStars.push({\n                        x: Math.cos(angle) * dist,\n                        y: Math.sin(angle) * dist,\n                        z: (Math.random() * zRange) - zRange / 2,\n                        vx: (Math.random() - 0.5) * 2,\n                        vy: (Math.random() - 0.5) * 2,\n                        size: 1 + Math.random() * 2,\n                        tailLength: 20 + Math.random() * 40,\n                        color: ['#ffffff', '#ffffaa', '#aaffff', '#ffaaff'][Math.floor(Math.random() * 4)],\n                        alpha: 0.4 + Math.random() * 0.4\n                    });\n                }\n            }\n\n            generateNebulaStyle() {\n                const zRange = 3000;\n\n                // Nebulae distributed across zoom tiers (30 total, +50%)\n                const nebulaConfigs = [\n                    { count: 6, minDist: 50, maxDist: 500, minSize: 100, maxSize: 300 },    // Close\n                    { count: 10, minDist: 500, maxDist: 2500, minSize: 300, maxSize: 800 }, // Medium\n                    { count: 14, minDist: 2500, maxDist: 6000, minSize: 700, maxSize: 1500 } // Far\n                ];\n                const colors = ['#ff0055', '#ffaa00', '#00ffaa', '#0055ff', '#ff00ff', '#00ffff', '#ff5500', '#55ff00'];\n\n                nebulaConfigs.forEach(cfg => {\n                    for (let i = 0; i < cfg.count; i++) {\n                        const dist = cfg.minDist + Math.random() * (cfg.maxDist - cfg.minDist);\n                        const angle = Math.random() * Math.PI * 2;\n                        this.nebulae.push({\n                            x: Math.cos(angle) * dist,\n                            y: Math.sin(angle) * dist,\n                            z: (Math.random() * zRange) - zRange / 2,\n                            size: cfg.minSize + Math.random() * (cfg.maxSize - cfg.minSize),\n                            color: colors[Math.floor(Math.random() * colors.length)],\n                            alpha: 0.25 + Math.random() * 0.35\n                        });\n                    }\n                });\n\n                // Background stars distributed across tiers (1000 total, +25%)\n                const starCount = 1000;\n                for (let i = 0; i < starCount; i++) {\n                    const tier = Math.random();\n                    let dist, size;\n                    if (tier < 0.2) {\n                        dist = Math.random() * 500;\n                        size = 0.5 + Math.random() * 1.0;\n                    } else if (tier < 0.5) {\n                        dist = 500 + Math.random() * 2000;\n                        size = 1.0 + Math.random() * 1.5;\n                    } else {\n                        dist = 2500 + Math.random() * 3500;\n                        size = 1.5 + Math.random() * 2.5;\n                    }\n                    const angle = Math.random() * Math.PI * 2;\n                    this.backgroundStars.push({\n                        x: Math.cos(angle) * dist,\n                        y: Math.sin(angle) * dist,\n                        z: (Math.random() * zRange) - zRange / 2,\n                        r: size,\n                        alpha: 0.2 + Math.random() * 0.5\n                    });\n                }\n            }\n\n            generateAlienStyle() {\n                const zRange = 3000;\n\n                // Green/Purple Theme (Randomized Mix)\n                const theme = Math.random();\n                let color1, color2;\n                if (theme < 0.33) { color1 = '#00ff00'; color2 = '#ccff00'; }\n                else if (theme < 0.66) { color1 = '#aa00ff'; color2 = '#ff00aa'; }\n                else { color1 = '#00ffff'; color2 = '#0000ff'; }\n\n                // Background stars distributed across zoom tiers (1800 total, +20%)\n                const starCount = 1800;\n                for (let i = 0; i < starCount; i++) {\n                    const tier = Math.random();\n                    let dist, size;\n                    if (tier < 0.2) {\n                        dist = Math.random() * 500;\n                        size = 0.3 + Math.random() * 0.6;\n                    } else if (tier < 0.5) {\n                        dist = 500 + Math.random() * 2000;\n                        size = 0.5 + Math.random() * 0.8;\n                    } else {\n                        dist = 2500 + Math.random() * 3500;\n                        size = 0.7 + Math.random() * 1.2;\n                    }\n                    const angle = Math.random() * Math.PI * 2;\n                    this.backgroundStars.push({\n                        x: Math.cos(angle) * dist,\n                        y: Math.sin(angle) * dist,\n                        z: (Math.random() * zRange) - zRange / 2,\n                        r: size,\n                        alpha: 0.1 + Math.random() * 0.4,\n                        color: Math.random() > 0.5 ? color1 : color2\n                    });\n                }\n\n                // Alien Spacecraft Fleet - distributed across zoom tiers (30 total, +50%)\n                const shipClasses = [\n                    { name: 'saucer', baseSize: 50, complexity: 'high', weight: 4 },\n                    { name: 'star-dreadnought', baseSize: 120, complexity: 'high', weight: 1 },\n                    { name: 'quantum-scout', baseSize: 40, complexity: 'high', weight: 3 },\n                    { name: 'void-fighter', baseSize: 30, complexity: 'medium', weight: 4 },\n                    { name: 'nebula-cruiser', baseSize: 90, complexity: 'high', weight: 2 },\n                    { name: 'bio-corvette', baseSize: 60, complexity: 'high', weight: 2 },\n                    { name: 'warp-strider', baseSize: 100, complexity: 'medium', weight: 1 },\n                    { name: 'prism-destroyer', baseSize: 80, complexity: 'low', weight: 2 },\n                    { name: 'stellar-barge', baseSize: 110, complexity: 'medium', weight: 2 },\n                    { name: 'cyber-sentry', baseSize: 35, complexity: 'high', weight: 3 },\n                    { name: 'aether-wing', baseSize: 50, complexity: 'high', weight: 2 },\n                    { name: 'death-sphere', baseSize: 150, complexity: 'high', weight: 1 },\n                    { name: 'tie-fighter', baseSize: 45, complexity: 'high', weight: 3 }\n                ];\n\n                // Build weighted selection pool\n                const pool = [];\n                shipClasses.forEach(sc => {\n                    for (let w = 0; w < sc.weight; w++) pool.push(sc);\n                });\n\n                // Spacecraft configs per tier\n                const craftConfigs = [\n                    { count: 6, minDist: 50, maxDist: 500, sizeScale: 0.4 },    // Close - small ships\n                    { count: 10, minDist: 500, maxDist: 2500, sizeScale: 0.7 }, // Medium\n                    { count: 14, minDist: 2500, maxDist: 6000, sizeScale: 1.2 } // Far - larger ships\n                ];\n\n                craftConfigs.forEach(cfg => {\n                    for (let i = 0; i < cfg.count; i++) {\n                        const shipClass = pool[Math.floor(Math.random() * pool.length)];\n                        const hue = Math.random() * 360;\n                        const size = shipClass.baseSize * cfg.sizeScale * (0.7 + Math.random() * 0.6);\n                        const isSaucer = shipClass.name === 'saucer';\n                        const dist = cfg.minDist + Math.random() * (cfg.maxDist - cfg.minDist);\n                        const angle = Math.random() * Math.PI * 2;\n\n                        this.spacecraft.push({\n                            x: Math.cos(angle) * dist,\n                            y: Math.sin(angle) * dist,\n                            z: (Math.random() * zRange) - zRange / 2,\n                            vx: (Math.random() - 0.5) * (isSaucer ? 2 : 3),\n                            vy: (Math.random() - 0.5) * (isSaucer ? 2 : 3),\n                            size: size,\n                            shipClass: shipClass.name,\n                            complexity: shipClass.complexity,\n                            hullColor: isSaucer ? `hsl(${hue}, 10%, 50%)` : `hsl(${hue}, 30%, 40%)`,\n                            hullHighlight: isSaucer ? `hsl(${hue}, 5%, 85%)` : `hsl(${hue}, 20%, 70%)`,\n                            hullShadow: isSaucer ? `hsl(${hue}, 15%, 25%)` : `hsl(${hue}, 40%, 20%)`,\n                            engineColor: `hsl(${(hue + 180) % 360}, 100%, 60%)`,\n                            engineGlow: `hsl(${(hue + 180) % 360}, 100%, 85%)`,\n                            lightColor: `hsl(${Math.random() * 60 + 300}, 100%, 55%)`,\n                            lightColor2: `hsl(${Math.random() * 60}, 100%, 50%)`,\n                            lightPhase: Math.random() * Math.PI * 2,\n                            detailSeed: Math.random() * 1000,\n                            wingAngle: 0.3 + Math.random() * 0.4,\n                            engineCount: shipClass.name === 'mothership' ? 6 : (shipClass.name === 'destroyer' ? 4 : (shipClass.name === 'cruiser' ? 3 : 2)),\n                            domeColor: `hsl(${Math.random() * 180 + 160}, 80%, 70%)`,\n                            beamActive: Math.random() > 0.7,\n                            beamColor: `hsl(${Math.random() * 60 + 80}, 100%, 70%)`,\n                            ringCount: isSaucer ? Math.floor(Math.random() * 3) + 2 : 0,\n                            rotationSpeed: (Math.random() - 0.5) * 0.02,\n                            rotation: Math.random() * Math.PI * 2,\n                            hasShield: Math.random() > 0.8,\n                            shieldColor: `hsl(${Math.random() * 60 + 180}, 70%, 60%)`,\n                            shieldPhase: Math.random() * Math.PI * 2\n                        });\n                    }\n                });\n            }\n\n            generateCyberStyle() {\n                // Reset custom color flag so new generation allows random themes again\n                this.matrixColorCustomized = false;\n\n                // Matrix Rain Setup (Screen Space)\n                this.matrixStreams = [];\n                const fontSize = 14;\n                const columns = Math.ceil(this.canvas.width / fontSize);\n\n                // Base Themes\n                // Top 20 Curated Cyber Colors + Rainbow Surge\n                const themes = [\n                    { name: 'System Yellow', color: '#FFFF00', family: 'yellow' },\n                    { name: 'Neon Pink', color: '#FF1493', family: 'pink' },\n                    { name: 'Chrome Static', color: '#C0C0C0', family: 'mono' }, // Silver\n                    { name: 'Royal Data', color: '#4169E1', family: 'blue' }, // Royal Blue\n                    { name: 'Navy Blue', color: '#000080', family: 'blue' },\n                    { name: 'White Noise', color: '#FFFFFF', family: 'mono' },\n                    { name: 'Golden Key', color: '#FFD700', family: 'yellow' }, // Gold\n                    { name: 'Firewall Orange', color: '#FF4500', family: 'pink' },\n                    { name: 'Cyan Future', color: '#00FFFF', family: 'blue' },\n                    { name: 'Lime Access', color: '#32CD32', family: 'green' },\n                    { name: 'Purple Haze', color: '#800080', family: 'purple' },\n                    { name: 'Crimson Error', color: '#DC143C', family: 'pink' },\n                    { name: 'Teal Glitch', color: '#008080', family: 'green' },\n                    { name: 'Magenta Core', color: '#FF00FF', family: 'pink' },\n                    { name: 'Violet Mainframe', color: '#EE82EE', family: 'purple' },\n                    { name: 'Emerald Link', color: '#50C878', family: 'green' },\n                    { name: 'Sapphire Stream', color: '#0F52BA', family: 'blue' },\n                    { name: 'Ruby Firewall', color: '#E0115F', family: 'pink' },\n                    { name: 'Amber Alert', color: '#FFBF00', family: 'yellow' },\n                    { name: 'Ice Blue', color: '#A5F2F3', family: 'blue' },\n                    { name: 'sentAIent Blue', color: '#60A9FF', family: 'blue' },\n                    { name: 'Rainbow Surge', color: 'rainbow', family: 'rainbow' }\n                ];\n\n                // History Buffer Logic (Last 5 themes) + Family Check\n                // Filter out ANY theme that is in the history buffer OR matches the last family\n                const lastFamily = this.lastMatrixFamily || '';\n\n                let availableThemes = themes.filter(t => !this.themeHistory.includes(t.name));\n\n                // Try to filter by family too, but ensure we don't empty the pool\n                const familyFiltered = availableThemes.filter(t => t.family !== lastFamily);\n                if (familyFiltered.length > 0) {\n                    availableThemes = familyFiltered;\n                }\n\n                // Fallback: If we ran out of themes (unlikely), just avoid the very last one\n                let pool = availableThemes;\n                if (pool.length === 0) {\n                    const lastTheme = this.themeHistory[this.themeHistory.length - 1];\n                    pool = themes.filter(t => t.name !== lastTheme);\n                }\n\n                const themeIndex = Math.floor(Math.random() * pool.length);\n                const theme = pool[themeIndex];\n\n                // Update History\n                this.themeHistory.push(theme.name);\n                if (this.themeHistory.length > 5) {\n                    this.themeHistory.shift(); // Keep only last 5\n                }\n                this.lastMatrixFamily = theme.family; // Track family\n\n                // Persist to LocalStorage\n                try {\n                    localStorage.setItem('matrixThemeHistory', JSON.stringify(this.themeHistory));\n                    localStorage.setItem('matrixLastFamily', this.lastMatrixFamily);\n                } catch (e) {\n                    console.warn('LocalStorage failed', e);\n                }\n\n                console.log(`[Matrix] Selected: ${theme.name} (${theme.family}), History: ${JSON.stringify(this.themeHistory)}, Pool Size: ${pool.length}`);\n\n                this.matrixTheme = theme;\n\n                // Discrete Speed Levels: Crawl, Slow, Normal, Fast, Hyper, Ludicrous\n                const speedLevels = [\n                    { name: 'Crawl', value: 0.2 },\n                    { name: 'Slow', value: 0.5 },\n                    { name: 'Normal', value: 1.0 },\n                    { name: 'Fast', value: 2.0 },\n                    { name: 'Hyper', value: 4.0 },\n                    { name: 'Ludicrous', value: 8.0 }\n                ];\n                const selectedSpeed = speedLevels[Math.floor(Math.random() * speedLevels.length)];\n                this.matrixSpeedMultiplier = selectedSpeed.value;\n\n                this.showToast(`Cyber Theme: ${theme.name} (Speed: ${selectedSpeed.name}) [v14]`);\n\n                // Update UI Display\n                const displayEl = document.getElementById('matrixThemeDisplay');\n                if (displayEl) {\n                    displayEl.innerText = `Theme: ${theme.name} | Family: ${theme.family.charAt(0).toUpperCase() + theme.family.slice(1)}`;\n                }\n\n                // Sync speed slider with current value\n                const slider = document.getElementById('matrixSpeedSlider');\n                const sliderValue = document.getElementById('matrixSpeedValue');\n                if (slider) slider.value = this.matrixSpeedMultiplier;\n                if (sliderValue) sliderValue.textContent = this.matrixSpeedMultiplier.toFixed(1) + 'x';\n\n                for (let i = 0; i < columns; i++) {\n                    const depth = Math.random(); // 0 to 1\n                    const size = Math.floor(10 + depth * 14); // 10px to 24px\n                    // Apply speed multiplier with per-stream variance\n                    const speed = (2 + depth * 8 + Math.random() * 2) * this.matrixSpeedMultiplier;\n\n                    // Massive Trails: 600 to 1500 characters (3x longer)\n                    const len = 600 + Math.floor(Math.random() * 9000);\n                    const chars = [];\n                    for (let j = 0; j < len; j++) {\n                        chars.push(String.fromCharCode(0x30A0 + Math.random() * 96));\n                    }\n\n                    // Handle Rainbow Theme\n                    let streamColor = theme.color;\n                    if (this.matrixColorCustomized) {\n                        streamColor = this.matrixColor;\n                    } else if (theme.name === 'Rainbow Surge') {\n                        // Calculate hue based on column index (i) to cycle through the spectrum\n                        const hue = (i * 360 / columns) % 360;\n                        streamColor = `hsl(${hue}, 100%, 50%)`; // Full saturation, mid lightness\n                    }\n\n                    this.matrixStreams.push({\n                        x: i * fontSize, // Fixed columns\n                        y: -Math.random() * this.canvas.height - size * len, // Start above visible area\n                        baseSpeed: (2 + depth * 8 + Math.random() * 2), // Store base speed\n                        chars: chars,\n                        color: streamColor,\n                        size: size,\n                        opacity: 0.3 + depth * 0.7 // Closer = brighter\n                    });\n                }\n\n                console.log(`[Matrix] Generated ${this.matrixStreams.length} streams, columns: ${columns}, theme: ${theme.name}`);\n            }\n\n            /* --- Rendering --- */\n\n            animate(time) {\n                // Update flight game physics\n                if (this.flightMode) {\n                    this.updatePlayerShip();\n                    this.updateMinerals();\n                    this.updateFlightHUD();\n                }\n\n                // Update spacecraft positions\n                if (this.spacecraft && this.spacecraft.length > 0) {\n                    const range = this.worldSize;\n                    const half = range / 2;\n                    this.spacecraft.forEach(s => {\n                        s.x += s.vx;\n                        s.y += s.vy;\n                        // Wrap around world bounds\n                        if (s.x > half) s.x = -half;\n                        if (s.x < -half) s.x = half;\n                        if (s.y > half) s.y = -half;\n                        if (s.y < -half) s.y = half;\n                    });\n                }\n\n                // Update shooting/moving stars positions\n                if (this.shootingStars && this.shootingStars.length > 0) {\n                    const range = this.worldSize;\n                    const half = range / 2;\n                    this.shootingStars.forEach(s => {\n                        s.x += s.vx;\n                        s.y += s.vy;\n                        // Wrap around world bounds\n                        if (s.x > half) s.x = -half;\n                        if (s.x < -half) s.x = half;\n                        if (s.y > half) s.y = -half;\n                        if (s.y < -half) s.y = half;\n                    });\n                }\n\n                // Update static stars for Drift/Warp modes (with error handling)\n                try {\n                    if ((this.bgDriftMode || this.bgWarpMode) && this.staticStars && this.staticStars.length > 0) {\n                        const w = this.canvas.width;\n                        const h = this.canvas.height;\n                        const centerX = w / 2;\n                        const centerY = h / 2;\n\n                        // Ramp warp speed - works during both engage (bgWarpMode) and disengage (warpDisengaging)\n                        if (this.bgWarpMode || this.warpDisengaging) {\n                            // warpSpeedMultiplier is now linear (0.1 to 840)\n                            const linearSlider = this.warpSpeedMultiplier || 1;\n                            // Normalize to warp range (0 to 25.2) - TRIPLED max speed\n                            const targetWarp = Math.min(25.2, linearSlider / 33);\n\n                            const rampSpeed = 0.02; // Slightly faster ramp for responsiveness\n                            this.warpSpeed = this.warpSpeed || 0;\n                            this.warpSpeed += (targetWarp - this.warpSpeed) * rampSpeed;\n                            // Cap to prevent runaway - TRIPLED max\n                            this.warpSpeed = Math.min(this.warpSpeed, 25.2);\n                            // Also cap minimum during disengage\n                            if (this.warpSpeed < 0.01) this.warpSpeed = 0;\n                        }\n\n                        this.staticStars.forEach(s => {\n                            // Safety: Ensure velocity properties exist\n                            if (typeof s.vx !== 'number') s.vx = 0;\n                            if (typeof s.vy !== 'number') s.vy = 0;\n                            if (typeof s.baseAlpha !== 'number') s.baseAlpha = s.alpha || 0.5;\n\n                            // Store original position if not yet stored (for warp start)\n                            if (typeof s.origX !== 'number') s.origX = s.x;\n                            if (typeof s.origY !== 'number') s.origY = s.y;\n\n                            // Stars move during BOTH engage and disengage\n                            if ((this.bgWarpMode || this.warpDisengaging) && !this.bgDriftMode) {\n                                // LIGHTSPEED: Stars fly OUTWARD from center, accelerating\n                                const dx = s.x - centerX;\n                                const dy = s.y - centerY;\n                                const dist = Math.sqrt(dx * dx + dy * dy);\n\n                                // Direction outward from center with slight jitter at high speeds\n                                const warpIntensity = (this.warpSpeed || 0);\n                                // Add subtle angular wobble at high speeds for organic look\n                                const jitterAmount = Math.min(0.08, warpIntensity * 0.003);\n                                const jitterAngle = (Math.random() - 0.5) * jitterAmount;\n                                const baseDirX = dist > 1 ? dx / dist : 0;\n                                const baseDirY = dist > 1 ? dy / dist : 0;\n                                // Apply rotation for jitter\n                                const cosJ = Math.cos(jitterAngle);\n                                const sinJ = Math.sin(jitterAngle);\n                                const dirX = baseDirX * cosJ - baseDirY * sinJ;\n                                const dirY = baseDirX * sinJ + baseDirY * cosJ;\n\n                                // Speed varies by depth layer - creates parallax/3D feel\n                                const depthFactor = s.depth || 0.5;\n                                const perspectiveAccel = 1 + (dist / Math.max(w, h)) * 1.2;\n                                // Deeper stars move faster, creates sense of passing through field\n                                const speed = warpIntensity * perspectiveAccel * 10.5 * depthFactor;\n\n                                // Move star outward\n                                s.x += dirX * speed;\n                                s.y += dirY * speed;\n\n                                // Respawn from center when star goes off screen\n                                const maxDist = Math.max(w, h) * 0.9;\n                                if (dist > maxDist || s.x < -50 || s.x > w + 50 || s.y < -50 || s.y > h + 50) {\n                                    // Respawn with wider random distance spread\n                                    const angle = Math.random() * Math.PI * 2;\n                                    // More variation in spawn distance for staggered arrivals\n                                    const startDist = 3 + Math.random() * Math.random() * 80;\n                                    s.x = centerX + Math.cos(angle) * startDist;\n                                    s.y = centerY + Math.sin(angle) * startDist;\n                                    s.alpha = 0.05; // Start very faint\n                                    // Randomize depth on respawn for variety\n                                    s.depth = 0.3 + Math.random() * 0.7;\n                                    s.size = (Math.random() * 1.5 + 0.5) * s.depth;\n                                } else {\n                                    // Fade in as star moves outward, faster fade for deeper stars\n                                    const fadeRate = 0.6 + depthFactor * 0.4;\n                                    s.alpha = Math.min(1, 0.15 + (dist / maxDist) * 0.85 * fadeRate);\n                                }\n                            } else if (this.bgDriftMode && !this.bgWarpMode) {\n                                // Drift: Subtle but noticeable movement\n                                s.x += s.vx * 0.03;\n                                s.y += s.vy * 0.03;\n\n                                // Wrap around screen\n                                if (s.x < -w * 5) s.x += w * 10;\n                                if (s.x > w * 5) s.x -= w * 10;\n                                if (s.y < -h * 5) s.y += h * 10;\n                                if (s.y > h * 5) s.y -= h * 10;\n                            }\n                        });\n                    }\n                } catch (e) {\n                    console.error('[BG Error] Static star animation failed:', e);\n                    // Fail silently to prevent crash loop\n                }\n\n                // === WARP FLYOUT/FLYIN: Move background objects ===\n                // IMPORTANT: Objects use WORLD coordinates with (0,0) at world center\n                // Camera transform places world (0,0) at screen center\n                if (this.bgWarpMode || this.warpDisengaging) {\n                    try {\n                        const w = this.canvas.width;\n                        const h = this.canvas.height;\n                        // SCREEN CENTER in WORLD coordinates - this is where light rays emanate from\n                        // Safety: ensure camera exists\n                        const camera = this.camera || { x: 0, y: 0, zoom: 1 };\n                        const zoom = camera.zoom || 1;\n                        const screenCenterWorldX = -(camera.x || 0) / zoom;\n                        const screenCenterWorldY = -(camera.y || 0) / zoom;\n                        // Max distance before object is \"off screen\" in world coords\n                        const maxWorldDist = this.worldSize * 2;\n                        // Use the SAME warpIntensity as static stars for synchronized motion\n                        const warpIntensity = this.warpSpeed || 0;\n                        const isDisengaging = this.warpDisengaging;\n\n                        // Helper to fly an object using WORLD coordinates\n                        const flyObject = (obj, speedMultiplier = 1, maxSpread = 2000) => {\n                            if (!obj) return;\n\n                            if (isDisengaging) {\n                                // === DISENGAGE: Objects appear at random positions and gradually decelerate ===\n                                // Matches light ray deceleration - gradual slowdown as we exit lightspeed\n\n                                // CRITICAL: Reset flownOut so object renders during disengage\n                                obj.flownOut = false;\n\n                                // Initialize on first frame of disengage\n                                if (!obj.disengageInit) {\n                                    // Assign random final position around screen\n                                    // Some close (fly by), some in distance\n                                    const angle = Math.random() * Math.PI * 2;\n                                    const distance = 200 + Math.random() * maxSpread;\n                                    const depth = 0.3 + Math.random() * 1.4; // 0.3 to 1.7 depth factor\n\n                                    obj.finalX = screenCenterWorldX + Math.cos(angle) * distance;\n                                    obj.finalY = screenCenterWorldY + Math.sin(angle) * distance;\n                                    obj.depth = depth; // Closer objects move faster\n\n                                    // Start position: exact center (simulating vanishing point)\n                                    // This creates the effect of objects spawning from a single point\n                                    obj.startX = screenCenterWorldX;\n                                    obj.startY = screenCenterWorldY;\n\n                                    // Reset scale/alpha for emergence\n                                    obj.warpScale = 0.01;\n                                    obj.warpAlpha = 0;\n\n                                    obj.disengageInit = true;\n                                }\n\n                                // Use SAME progress calculation as light ray deceleration (warpSpeed-based)\n                                // This synchronizes object movement with light ray shortening\n                                const maxWarp = 25;\n                                const currentWarp = warpIntensity || 0;\n                                // Progress: 0 = full warp, 1 = stopped\n                                const progress = 1 - Math.min(1, currentWarp / maxWarp);\n\n                                // Position: LINEAR interpolation synced with warp\n                                // Objects move at same rate as stars slow down\n                                obj.x = obj.startX + (obj.finalX - obj.startX) * progress;\n                                obj.y = obj.startY + (obj.finalY - obj.startY) * progress;\n\n                                // Scale: EXPONENTIAL (Perspective-like)\n                                // Objects stay small in distance, then loom large on arrival\n                                // Cubic easing (t*t*t) simulates Z-axis approach better than linear\n                                const ease = progress * progress * progress;\n                                obj.warpScale = 0.01 + ease * 0.99; // Target 1.0 strictly (Depth handled by size)\n                                obj.warpScale = Math.min(1, Math.max(0.01, obj.warpScale));\n\n                                // Alpha: Stay INVISIBLE behind light for first 35% of animation\n                                // Then fade in gradually, reaching full opacity when warp stops\n                                const alphaDelay = 0.35; // 35% - stay behind light longer\n                                const alphaProgress = Math.max(0, (progress - alphaDelay) / (1 - alphaDelay));\n                                obj.warpAlpha = alphaProgress; // Linear fade to 1.0 (draw loop handles base alpha)\n\n                                return; // Don't continue to engage logic\n\n                            } else {\n                                // === ENGAGE: Fly RADIALLY OUTWARD from SCREEN center ===\n                                // Account for zoom level - objects at higher zoom should fly faster\n                                if (obj.flownOut) return;\n\n                                // Direction is from SCREEN CENTER outward (not world center)\n                                const dx = obj.x - screenCenterWorldX;\n                                const dy = obj.y - screenCenterWorldY;\n                                const dist = Math.sqrt(dx * dx + dy * dy);\n\n                                // If exactly at center, give random direction\n                                if (dist < 5) {\n                                    const angle = Math.random() * Math.PI * 2;\n                                    obj.x += Math.cos(angle) * 20;\n                                    obj.y += Math.sin(angle) * 20;\n                                    return;\n                                }\n\n                                // Normalize for radial outward direction\n                                const dirX = dx / dist;\n                                const dirY = dy / dist;\n\n                                // ZOOM COMPENSATION: Objects at higher zoom need to move faster\n                                // to appear to leave the screen at the same visual rate\n                                const zoomFactor = 1 / (this.camera.zoom || 1);\n\n                                const perspectiveAccel = 1 + (dist / this.worldSize) * 1.2;\n                                const depth = obj.depth || 0.5;\n                                const engageSpeedFactor = 4.0;\n                                const speed = warpIntensity * perspectiveAccel * 10.5 * depth * speedMultiplier * engageSpeedFactor * zoomFactor;\n\n                                // Move radially outward from world center\n                                obj.x += dirX * speed;\n                                obj.y += dirY * speed;\n\n                                // Mark as flown out when far from world center\n                                if (dist > maxWorldDist) {\n                                    obj.flownOut = true;\n                                    obj.wasFlownOut = true; // Track for disengage reset\n                                }\n                            }\n                        };\n\n                        // Apply to all object types - different depths create parallax\n                        // Assign typeIndex for golden ratio distribution (avoids ring patterns)\n                        let globalIndex = 0;\n                        if (this.planets) this.planets.forEach((p, i) => {\n                            p.depth = p.depth || 0.6;\n                            p.typeIndex = globalIndex++;\n                            flyObject(p, 0.8, 3000);\n                        });\n                        if (this.galaxies) this.galaxies.forEach((g, i) => {\n                            g.depth = g.depth || 0.4;\n                            g.typeIndex = globalIndex++;\n                            flyObject(g, 0.5, 5000);\n                        });\n                        if (this.blackHoles) this.blackHoles.forEach((bh, i) => {\n                            bh.depth = bh.depth || 0.3;\n                            bh.typeIndex = globalIndex++;\n                            flyObject(bh, 0.4, 4000);\n                        });\n                        if (this.nebulae) this.nebulae.forEach((n, i) => {\n                            n.depth = n.depth || 0.5;\n                            n.typeIndex = globalIndex++;\n                            flyObject(n, 0.6, 4000);\n                        });\n                        if (this.spacecraft) this.spacecraft.forEach((s, i) => {\n                            s.depth = s.depth || 0.8;\n                            s.typeIndex = globalIndex++;\n                            flyObject(s, 1.2, 2000);\n                        });\n                        // User-placed stars\n                        if (this.stars && this.stars.length > 0) {\n                            this.stars.forEach((star, i) => {\n                                star.depth = star.depth || 0.7;\n                                star.typeIndex = globalIndex++;\n                                flyObject(star, 0.9, 2500);\n                            });\n                        }\n                    } catch (e) {\n                        console.error('[WARP] Animation error:', e);\n                    }\n                }\n\n                this.draw(time);\n                requestAnimationFrame(this.animate);\n            }\n\n            draw(time) {\n                const { ctx, canvas } = this;\n\n                ctx.setTransform(1, 0, 0, 1, 0, 0);\n                ctx.fillStyle = this.config.bgColor;\n                ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n                // Static Background Stars (Screen Space)\n                if (this.config.showBackground) {\n                    const paraX = this.camera.x * 0.05;\n                    const paraY = this.camera.y * 0.05;\n\n                    try {\n                        const centerX = canvas.width / 2;\n                        const centerY = canvas.height / 2;\n                        const maxDist = Math.sqrt(centerX * centerX + centerY * centerY);\n                        const time = performance.now() / 1000;\n\n                        this.staticStars.forEach(s => {\n                            // Safety check for required properties\n                            if (typeof s.x !== 'number' || typeof s.y !== 'number') return;\n\n                            let sx = (s.x + paraX) % canvas.width;\n                            let sy = (s.y + paraY) % canvas.height;\n                            if (sx < 0) sx += canvas.width;\n                            if (sy < 0) sy += canvas.height;\n\n                            // Ensure we have valid values\n                            const vx = typeof s.vx === 'number' ? s.vx : 0;\n                            const vy = typeof s.vy === 'number' ? s.vy : 0;\n                            const size = s.r || s.size || 1; // Use 'r' if available (matches generation)\n                            const starColor = s.color || '#ffffff';\n\n                            // Parse star color for gradient manipulation\n                            let r = 255, g = 255, b = 255;\n                            try {\n                                if (starColor.startsWith('#')) {\n                                    const hex = starColor.slice(1);\n                                    // Use ?? instead of || to preserve 0 values (0 is valid for RGB!)\n                                    const parsedR = parseInt(hex.substr(0, 2), 16);\n                                    const parsedG = parseInt(hex.substr(2, 2), 16);\n                                    const parsedB = parseInt(hex.substr(4, 2), 16);\n                                    r = isNaN(parsedR) ? 255 : parsedR;\n                                    g = isNaN(parsedG) ? 255 : parsedG;\n                                    b = isNaN(parsedB) ? 255 : parsedB;\n                                }\n                            } catch (e) { /* use defaults */ }\n\n                            if (this.bgWarpMode && !this.bgDriftMode) {\n                                // ====== LIGHTSPEED: Moving stars with trailing streaks ======\n                                const dx = sx - centerX;\n                                const dy = sy - centerY;\n                                const distFromCenter = Math.sqrt(dx * dx + dy * dy);\n\n                                if (distFromCenter < 3) return; // Skip center stars\n\n                                // Warp intensity - already curved via setWarpSpeedMultiplier\n                                const warpIntensity = this.warpSpeed || 0;\n                                const sliderValue = this.warpSpeedMultiplier || 1;\n\n                                // Streak length varies by depth - deeper stars = longer streaks\n                                // Low slider = short rays, high slider = dramatic but not overwhelming\n                                const perspFactor = distFromCenter / maxDist;\n                                const depthFactor = s.depth || 0.5;\n                                // Use sqrt for diminishing returns, depth multiplier for parallax\n                                const lengthFactor = Math.sqrt(sliderValue) * 14 * depthFactor;\n                                const streakLength = 5 + lengthFactor * (2 + perspFactor * 12);\n                                // Cap max streak length - varies by depth\n                                const cappedStreak = Math.min(streakLength, 1680 * depthFactor);\n\n                                // Direction OUTWARD from center (streak trails BEHIND moving star)\n                                const dirOutX = dx / distFromCenter;\n                                const dirOutY = dy / distFromCenter;\n\n                                // HEAD is at current position (leading edge, flying outward)\n                                // TAIL is behind (toward center, where star came from)\n                                const headX = sx;\n                                const headY = sy;\n                                const tailX = sx - dirOutX * cappedStreak;\n                                const tailY = sy - dirOutY * cappedStreak;\n\n                                // Alpha: cap to prevent white-out, scale with intensity\n                                // Lower alpha at high speeds = more visible individual rays\n                                const baseAlpha = s.alpha || 0.2;\n                                const intensityBoost = Math.min(0.4, warpIntensity * 0.15);\n                                const alpha = Math.min(0.65, baseAlpha + intensityBoost);\n                                ctx.globalAlpha = alpha;\n\n                                if (cappedStreak > 2) {\n                                    try {\n                                        // === GRADIENT: Use star's actual color throughout ===\n                                        const grad = ctx.createLinearGradient(tailX, tailY, headX, headY);\n                                        grad.addColorStop(0, 'transparent'); // Tail fades\n                                        grad.addColorStop(0.3, `rgba(${r}, ${g}, ${b}, 0.2)`);\n                                        grad.addColorStop(0.6, `rgba(${r}, ${g}, ${b}, 0.6)`);\n                                        // Bright head - boost luminosity but keep the hue\n                                        const brightR = Math.min(255, r + 40);\n                                        const brightG = Math.min(255, g + 40);\n                                        const brightB = Math.min(255, b + 40);\n                                        grad.addColorStop(1, `rgba(${brightR}, ${brightG}, ${brightB}, 1)`);\n\n                                        // Main streak - line width matches star diameter (size * 2)\n                                        ctx.strokeStyle = grad;\n                                        // Base width should be diameter (size * 2). add intensity.\n                                        const lineW = Math.max(0.6, Math.min(6, size * 2.0 + warpIntensity * 0.06));\n                                        ctx.lineWidth = lineW;\n                                        ctx.lineCap = 'round';\n                                        ctx.beginPath();\n                                        ctx.moveTo(tailX, tailY);\n                                        ctx.lineTo(headX, headY);\n                                        ctx.stroke();\n\n                                        // Bright core at head - USE STAR COLOR, not white!\n                                        if (cappedStreak > 15) {\n                                            // Brighter version of star's color for the core\n                                            const coreR = Math.min(255, r + 80);\n                                            const coreG = Math.min(255, g + 80);\n                                            const coreB = Math.min(255, b + 80);\n                                            ctx.strokeStyle = `rgba(${coreR}, ${coreG}, ${coreB}, 0.85)`;\n                                            ctx.lineWidth = Math.max(0.4, size * 0.3);\n                                            ctx.globalAlpha = alpha * 0.9;\n                                            ctx.beginPath();\n                                            const coreLen = Math.min(cappedStreak * 0.12, 30);\n                                            const coreX = headX - dirOutX * coreLen;\n                                            const coreY = headY - dirOutY * coreLen;\n                                            ctx.moveTo(coreX, coreY);\n                                            ctx.lineTo(headX, headY);\n                                            ctx.stroke();\n                                        }\n                                    } catch (e) {\n                                        ctx.strokeStyle = starColor;\n                                        ctx.lineWidth = size;\n                                        ctx.beginPath();\n                                        ctx.moveTo(tailX, tailY);\n                                        ctx.lineTo(headX, headY);\n                                        ctx.stroke();\n                                    }\n                                }\n\n                                // Bright head point - smaller at high speeds - USE STAR COLOR\n                                ctx.globalAlpha = Math.min(0.9, alpha + 0.2);\n                                // Use bright version of star's color instead of white\n                                const headR = Math.min(255, r + 100);\n                                const headG = Math.min(255, g + 100);\n                                const headB = Math.min(255, b + 100);\n                                ctx.fillStyle = `rgb(${headR}, ${headG}, ${headB})`;\n                                ctx.beginPath();\n                                const headSize = Math.max(0.5, Math.min(1.2, size * 0.4));\n                                ctx.arc(headX, headY, headSize, 0, Math.PI * 2);\n                                ctx.fill();\n\n\n                            } else if (this.bgDriftMode && !this.bgWarpMode) {\n                                // ====== SIMPLE DRIFT - Stars just float gently ======\n                                ctx.globalAlpha = s.alpha || 0.5;\n                                ctx.fillStyle = starColor;\n                                ctx.beginPath();\n                                ctx.arc(sx, sy, size, 0, Math.PI * 2);\n                                ctx.fill();\n\n                            } else {\n                                // === NORMAL MODE: Simple colored dot ===\n                                ctx.globalAlpha = s.alpha || 0.5;\n                                ctx.fillStyle = starColor;\n                                ctx.beginPath();\n                                ctx.arc(sx, sy, size, 0, Math.PI * 2);\n                                ctx.fill();\n                            }\n                        });\n                    } catch (renderError) {\n                        console.error('[BG Error] Star rendering failed:', renderError);\n                    }\n\n                    // ====== SHOOTING STARS (Normal mode only) ======\n                    if (!this.bgWarpMode && !this.bgDriftMode) {\n                        const now = performance.now();\n\n                        // Spawn new shooting star every 2-6 seconds\n                        if (now - this.lastShootingStarTime > 2000 + Math.random() * 4000) {\n                            this.lastShootingStarTime = now;\n                            const colors = this.starColors || ['#ffffff', '#aaddff', '#ffddaa'];\n\n                            // Start from random edge\n                            const edge = Math.floor(Math.random() * 4);\n                            let startX, startY, angle;\n\n                            if (edge === 0) { // Top\n                                startX = Math.random() * canvas.width;\n                                startY = -10;\n                                angle = Math.PI * 0.25 + Math.random() * Math.PI * 0.5;\n                            } else if (edge === 1) { // Right\n                                startX = canvas.width + 10;\n                                startY = Math.random() * canvas.height;\n                                angle = Math.PI * 0.75 + Math.random() * Math.PI * 0.5;\n                            } else if (edge === 2) { // Bottom\n                                startX = Math.random() * canvas.width;\n                                startY = canvas.height + 10;\n                                angle = -Math.PI * 0.25 - Math.random() * Math.PI * 0.5;\n                            } else { // Left\n                                startX = -10;\n                                startY = Math.random() * canvas.height;\n                                angle = -Math.PI * 0.25 + Math.random() * Math.PI * 0.5;\n                            }\n\n                            this.shootingStarsActive.push({\n                                x: startX,\n                                y: startY,\n                                vx: Math.cos(angle) * (8 + Math.random() * 12),\n                                vy: Math.sin(angle) * (8 + Math.random() * 12),\n                                size: 1.5 + Math.random() * 1.5,\n                                tailLength: 30 + Math.random() * 50,\n                                color: colors[Math.floor(Math.random() * colors.length)],\n                                life: 1.0\n                            });\n                        }\n\n                        // Update and draw shooting stars\n                        this.shootingStarsActive = this.shootingStarsActive.filter(star => {\n                            star.x += star.vx;\n                            star.y += star.vy;\n                            star.life -= 0.01;\n\n                            if (star.life <= 0 || star.x < -100 || star.x > canvas.width + 100 ||\n                                star.y < -100 || star.y > canvas.height + 100) {\n                                return false; // Remove\n                            }\n\n                            // Draw shooting star with tail\n                            const speed = Math.sqrt(star.vx * star.vx + star.vy * star.vy);\n                            const dirX = -star.vx / speed;\n                            const dirY = -star.vy / speed;\n                            const tailX = star.x + dirX * star.tailLength;\n                            const tailY = star.y + dirY * star.tailLength;\n\n                            ctx.globalAlpha = star.life * 0.8;\n                            ctx.strokeStyle = star.color;\n                            ctx.lineWidth = star.size;\n                            ctx.lineCap = 'round';\n                            ctx.beginPath();\n                            ctx.moveTo(tailX, tailY);\n                            ctx.lineTo(star.x, star.y);\n                            ctx.stroke();\n\n                            // Bright head\n                            ctx.fillStyle = '#ffffff';\n                            ctx.beginPath();\n                            ctx.arc(star.x, star.y, star.size * 1.2, 0, Math.PI * 2);\n                            ctx.fill();\n\n                            return true; // Keep\n                        });\n                    }\n\n                    ctx.globalAlpha = 1.0;\n\n                    // Cyber Matrix Rain (Screen Space)\n                    // Only draw if cyber style is active\n                    if (this.activeStyles.has('cyber') && this.matrixStreams) {\n                        console.log('[Matrix Render] Drawing', this.matrixStreams.length, 'streams');\n                        ctx.textAlign = 'center';\n                        const speedMult = this.matrixSpeedMultiplier || 1.0;\n                        const lengthMult = this.matrixLengthMultiplier || 1.0;\n\n                        // Apply angle transform\n                        if (this.matrixAngle !== 0) {\n                            ctx.save();\n                            ctx.translate(canvas.width / 2, canvas.height / 2);\n                            ctx.rotate((this.matrixAngle * Math.PI) / 180);\n                            ctx.translate(-canvas.width / 2, -canvas.height / 2);\n                        }\n\n                        // Base visible length: 20 chars at 1x, slider scales from ~4 to ~60 chars\n                        const baseVisibleLength = 20;\n                        const rainbowHueOffset = Date.now() * 0.1; // Animate rainbow hue\n\n                        this.matrixStreams.forEach((stream, streamIndex) => {\n                            // Update with real-time speed multiplier\n                            stream.y += stream.baseSpeed * speedMult;\n\n                            // Calculate visible length based on slider (independent of array size)\n                            const visibleLength = Math.max(3, Math.floor(baseVisibleLength * lengthMult));\n\n                            if (stream.y - (visibleLength * stream.size) > canvas.height * 1.5) {\n                                stream.y = -stream.size * visibleLength; // Reset\n                            }\n\n                            // Draw\n                            ctx.font = `${stream.size}px monospace, 'Courier New', monospace`;\n                            ctx.textBaseline = 'middle';\n\n                            // Only draw visible characters based on length multiplier\n                            for (let i = 0; i < visibleLength && i < stream.chars.length; i++) {\n                                const char = stream.chars[i];\n                                const charY = stream.y - (i * stream.size);\n                                if (charY < -stream.size * 2 || charY > canvas.height * 1.5) continue;\n\n                                // Improved visibility: Fade out only near the end of the tail\n                                const relativePos = 1 - (i / visibleLength);\n                                const alpha = Math.pow(relativePos, 0.5) * stream.opacity;\n\n                                ctx.globalAlpha = alpha;\n\n                                // Rainbow mode: cycle through HSL colors\n                                if (this.matrixRainbowMode) {\n                                    const hue = (rainbowHueOffset + streamIndex * 15 + i * 5) % 360;\n                                    ctx.fillStyle = `hsl(${hue}, 100%, 60%)`;\n                                } else {\n                                    ctx.fillStyle = stream.color;\n                                }\n                                ctx.shadowBlur = 4;\n                                ctx.shadowColor = stream.color;\n\n                                ctx.fillText(char, stream.x, charY);\n                            }\n                        });\n\n                        // Restore from angle transform\n                        if (this.matrixAngle !== 0) {\n                            ctx.restore();\n                        }\n\n                        ctx.shadowBlur = 0;\n                        ctx.globalAlpha = 1.0;\n                    }\n                }\n\n                // World Transform\n                ctx.translate(canvas.width / 2 + this.camera.x, canvas.height / 2 + this.camera.y);\n                ctx.scale(this.camera.zoom, this.camera.zoom);\n\n                // Calculations & Cluster ID Assignment\n                const { lines, clusters } = this.refreshClusterAssignments();\n\n                // 0. Draw Background Layers\n                // Always draw background stars and nebulae if they exist\n                this.drawBackgroundElements();\n\n                // Draw deep space specific elements (galaxies, black holes, planets)\n                if (this.activeStyles.has('deep-space')) this.drawDeepSpaceSpecific();\n\n                // 1. Draw Grid Lines (Glow Pass + Core Pass) with 3D rotation\n                if (lines.length > 0) {\n                    ctx.lineCap = 'round';\n                    ctx.shadowBlur = 10;\n\n                    // Rotation center - use cached if available (during star placement)\n                    const center = this._cachedRotationCenter || this.getConstellationCenter();\n                    const rotCenterX = center.x;\n                    const rotCenterY = center.y;\n                    const rotCenterZ = center.z || 0;\n\n                    lines.forEach(l => {\n                        const alpha = Math.max(0, 1 - (l.dist / this.config.maxConnectDist));\n                        const starColor = this.getStarColor(l.s1);\n                        const [r, g, b] = this.hexToRgb(starColor);\n\n                        // Apply 3D rotation\n                        const s1z = l.s1.z || 0;\n                        const s2z = l.s2.z || 0;\n                        const p1 = this.rotate3D(l.s1.x, l.s1.y, s1z, rotCenterX, rotCenterY);\n                        const p2 = this.rotate3D(l.s2.x, l.s2.y, s2z, rotCenterX, rotCenterY);\n\n                        ctx.shadowColor = `rgba(${r}, ${g}, ${b}, 0.8)`;\n                        ctx.strokeStyle = `rgba(${r}, ${g}, ${b}, ${alpha * 0.3})`;\n                        ctx.lineWidth = 3 / this.camera.zoom;\n                        ctx.beginPath();\n                        ctx.moveTo(p1.x, p1.y);\n                        ctx.lineTo(p2.x, p2.y);\n                        ctx.stroke();\n                    });\n                    ctx.shadowBlur = 0;\n\n                    lines.forEach(l => {\n                        const alpha = Math.max(0, 1 - (l.dist / this.config.maxConnectDist));\n                        const starColor = this.getStarColor(l.s1);\n\n                        // Apply 3D rotation\n                        const s1z = l.s1.z || 0;\n                        const s2z = l.s2.z || 0;\n                        const p1 = this.rotate3D(l.s1.x, l.s1.y, s1z, rotCenterX, rotCenterY);\n                        const p2 = this.rotate3D(l.s2.x, l.s2.y, s2z, rotCenterX, rotCenterY);\n\n                        ctx.strokeStyle = starColor;\n                        ctx.globalAlpha = alpha * 0.8;\n                        ctx.lineWidth = 1 / this.camera.zoom;\n                        ctx.beginPath();\n                        ctx.moveTo(p1.x, p1.y);\n                        ctx.lineTo(p2.x, p2.y);\n                        ctx.stroke();\n                    });\n                    ctx.globalAlpha = 1.0;\n                }\n\n                // 6. Draw Text Labels\n                ctx.textAlign = \"center\";\n                ctx.textBaseline = \"middle\";\n                ctx.font = `600 ${14 / this.camera.zoom}px 'Exo 2'`;\n\n                clusters.forEach(c => {\n                    // Only draw names for clusters that meet the minimum size threshold AND have a generated name\n                    const name = String(c[0].clusterId);\n                    if (c.length < this.config.minGroupSize || name === String(c[0].id)) return;\n\n                    // Centroid Calculation\n                    let cx = 0, cy = 0;\n                    c.forEach(s => { cx += s.x; cy += s.y; });\n                    cx /= c.length; cy /= c.length;\n\n                    const avgColor = this.getStarColor(c[0]);\n\n                    // Draw Text Label\n                    ctx.fillStyle = avgColor;\n                    ctx.shadowColor = \"black\";\n                    ctx.shadowBlur = 4;\n                    ctx.fillText(name, cx, cy + (30 / this.camera.zoom));\n                    ctx.shadowBlur = 0;\n                });\n\n                // 7. Draw Stars with 3D rotation\n                const timeNow = performance.now();\n                // Use cached rotation center if available (during star placement), otherwise calculate\n                const center = this._cachedRotationCenter || this.getConstellationCenter();\n                const rotCenterX = center.x;\n                const rotCenterY = center.y;\n                // Note: we just pass centerX/Y as pivot, Z pivot is implicitly handled by rotate3D logic relative to 0? \n                // Wait, rotate3D logic (let pz = z) rotates AROUND (centerX, centerY, 0).\n                // If the constellation center has Z != 0, we should translate Z too?\n                // rotate3D implementation: let px = x - centerX; let py = y - centerY; let pz = z; \n                // So it assumes pivot Z is 0. If center.z is not 0, we should subtract it.\n                // But let's stick to previous logical structure where we just updated rotate3D signature.\n                // Ideally: let pz = z - (center.z || 0);\n                // Let's rely on the definition where we pass Z.\n\n                this.stars.forEach(s => {\n                    if (s.flownOut) return; // Skip if flown out during warp\n\n                    ctx.save();\n\n                    // Apply disengage warp values\n                    let wScale = 1.0;\n                    let wAlpha = 1.0;\n                    if (this.warpDisengaging && s.warpScale !== undefined) {\n                        wScale = s.warpScale;\n                        wAlpha = s.warpAlpha !== undefined ? s.warpAlpha : 1.0;\n                    }\n\n                    const isHover = (s === this.hoveredStar);\n\n                    // Apply 3D rotation\n                    const sz = s.z || 0;\n                    const rotated = this.rotate3D(s.x, s.y, sz, rotCenterX, rotCenterY);\n                    const rx = rotated.x;\n                    const ry = rotated.y;\n                    const rScale = rotated.scale;\n\n                    const twinkle = Math.sin(timeNow * 0.003 + s.phase) * 0.2 + 0.8;\n                    const scale = isHover ? 1.5 : 1.0;\n                    const radius = this.config.starBaseRad * twinkle * scale * rScale * wScale / this.camera.zoom;\n                    const starColor = this.getStarColor(s);\n                    const [r, g, b] = this.hexToRgb(starColor);\n\n                    // Apply transparency\n                    ctx.globalAlpha = wAlpha;\n\n                    // Draw Glow\n                    const glowRad = Math.max(0.1, radius * 6); // Ensure positive radius\n                    const grad = ctx.createRadialGradient(rx, ry, 0, rx, ry, glowRad);\n                    grad.addColorStop(0, `rgba(255, 255, 255, ${isHover ? 0.9 : 0.6})`);\n                    grad.addColorStop(0.2, `rgba(${r}, ${g}, ${b}, 0.3)`);\n                    grad.addColorStop(1, \"rgba(0,0,0,0)\");\n\n                    ctx.fillStyle = grad;\n                    ctx.beginPath();\n                    ctx.arc(rx, ry, glowRad, 0, Math.PI * 2);\n                    ctx.fill();\n\n                    // Draw Core (Star Shape)\n                    ctx.fillStyle = starColor;\n                    this.drawStarShape(ctx, rx, ry, radius);\n\n                    ctx.restore();\n                });\n\n                // Update HUD\n                const statEl = document.getElementById('stats');\n                const constellationCount = clusters.filter(c => c.length >= this.config.minGroupSize).length;\n                if (statEl) statEl.innerText = `Mode: ${this.mode.charAt(0).toUpperCase() + this.mode.slice(1)} | Stars: ${this.stars.length} | Constellations: ${constellationCount} | Zoom: ${this.camera.zoom.toFixed(2)}x`;\n\n                // Draw player ship if in flight mode\n                if (this.flightMode && this.playerShip) {\n                    console.log('[Spacecraft Debug] Rendering player ship at', this.playerShip.x, this.playerShip.y);\n                    this.renderSpeedLines(ctx);\n                    this.renderMinerals(ctx, time);\n                    this.renderPlayerShip(ctx, time);\n                    this.renderCollectionNotifications(ctx);\n                } else {\n                    console.log('[Spacecraft Debug] NOT rendering - flightMode:', this.flightMode, 'playerShip:', !!this.playerShip);\n                }\n            }\n\n            renderSpeedLines(ctx) {\n                this.speedLines.forEach(line => {\n                    ctx.save();\n                    ctx.translate(line.x, line.y);\n\n                    ctx.globalAlpha = line.life * 0.5;\n                    ctx.strokeStyle = '#88ccff';\n                    ctx.lineWidth = 2 / this.camera.zoom;\n\n                    ctx.beginPath();\n                    ctx.moveTo(0, 0);\n                    ctx.lineTo(-line.vx * 3, -line.vy * 3);\n                    ctx.stroke();\n\n                    ctx.globalAlpha = 1;\n                    ctx.restore();\n                });\n            }\n\n            renderPlayerShip(ctx, time) {\n                const ship = this.playerShip;\n                if (!ship) return;\n\n                ctx.save();\n                ctx.translate(ship.x, ship.y);\n\n                // Base rotation (yaw - turning left/right)\n                ctx.rotate(ship.rotation);\n\n                // 3D roll rotation (barrel roll) - rotate around the forward axis\n                const roll = ship.roll || 0;\n                ctx.rotate(roll);\n\n                // 3D pitch rotation (up/down tilt) - simulated visually\n                const pitch = ship.pitch || 0;\n                const pitchScale = Math.cos(pitch); // Squash vertically when pitched\n\n                const size = 40 / this.camera.zoom;\n                const shipType = ship.type || 'interceptor';\n\n                // Draw ship based on type\n                switch (shipType) {\n                    case 'saucer':\n                        // Flying saucer - ellipse with dome\n                        ctx.fillStyle = '#ffcc00';\n                        ctx.strokeStyle = '#ff9900';\n                        ctx.lineWidth = 2 / this.camera.zoom;\n                        ctx.beginPath();\n                        ctx.ellipse(0, 0, size, size * 0.4, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.stroke();\n                        // Dome\n                        ctx.fillStyle = '#66ffff';\n                        ctx.beginPath();\n                        ctx.ellipse(0, -size * 0.15, size * 0.5, size * 0.35, 0, Math.PI, 0);\n                        ctx.fill();\n                        // Lights around edge\n                        for (let i = 0; i < 6; i++) {\n                            const angle = (i / 6) * Math.PI * 2 + time * 0.005;\n                            ctx.fillStyle = i % 2 === 0 ? '#ff0000' : '#00ff00';\n                            ctx.beginPath();\n                            ctx.arc(Math.cos(angle) * size * 0.8, Math.sin(angle) * size * 0.3, size * 0.08, 0, Math.PI * 2);\n                            ctx.fill();\n                        }\n                        break;\n\n                    case 'hauler':\n                        // Heavy cargo ship - rectangular with containers\n                        ctx.fillStyle = '#666666';\n                        ctx.strokeStyle = '#888888';\n                        ctx.lineWidth = 2 / this.camera.zoom;\n                        ctx.fillRect(-size * 0.8, -size * 0.5, size * 1.6, size);\n                        ctx.strokeRect(-size * 0.8, -size * 0.5, size * 1.6, size);\n                        // Cargo containers\n                        ctx.fillStyle = '#884400';\n                        ctx.fillRect(-size * 0.5, -size * 0.35, size * 0.4, size * 0.7);\n                        ctx.fillRect(0, -size * 0.35, size * 0.4, size * 0.7);\n                        // Cockpit\n                        ctx.fillStyle = '#00aaff';\n                        ctx.beginPath();\n                        ctx.moveTo(size * 0.8, 0);\n                        ctx.lineTo(size * 0.5, -size * 0.3);\n                        ctx.lineTo(size * 0.5, size * 0.3);\n                        ctx.closePath();\n                        ctx.fill();\n                        // Engines\n                        ctx.fillStyle = '#ff4400';\n                        ctx.fillRect(-size * 0.9, -size * 0.4, size * 0.15, size * 0.25);\n                        ctx.fillRect(-size * 0.9, size * 0.15, size * 0.15, size * 0.25);\n                        break;\n\n                    case 'orion':\n                        // Orion constellation ship - star points\n                        ctx.fillStyle = '#ffffff';\n                        ctx.strokeStyle = '#aaddff';\n                        ctx.lineWidth = 2 / this.camera.zoom;\n                        // Main star shape\n                        ctx.beginPath();\n                        for (let i = 0; i < 5; i++) {\n                            const outerAngle = (i * Math.PI * 2 / 5) - Math.PI / 2;\n                            const innerAngle = outerAngle + Math.PI / 5;\n                            const outerX = Math.cos(outerAngle) * size;\n                            const outerY = Math.sin(outerAngle) * size;\n                            const innerX = Math.cos(innerAngle) * size * 0.4;\n                            const innerY = Math.sin(innerAngle) * size * 0.4;\n                            if (i === 0) ctx.moveTo(outerX, outerY);\n                            else ctx.lineTo(outerX, outerY);\n                            ctx.lineTo(innerX, innerY);\n                        }\n                        ctx.closePath();\n                        ctx.fill();\n                        ctx.stroke();\n                        // Glowing core\n                        ctx.fillStyle = '#00ccff';\n                        ctx.beginPath();\n                        ctx.arc(0, 0, size * 0.25, 0, Math.PI * 2);\n                        ctx.fill();\n                        break;\n\n                    case 'draco':\n                        // Dragon constellation - serpentine shape\n                        ctx.fillStyle = '#22aa44';\n                        ctx.strokeStyle = '#00ff66';\n                        ctx.lineWidth = 3 / this.camera.zoom;\n                        // Dragon head\n                        ctx.beginPath();\n                        ctx.moveTo(size, 0);\n                        ctx.lineTo(size * 0.7, -size * 0.4);\n                        ctx.lineTo(size * 0.5, -size * 0.2);\n                        ctx.lineTo(0, -size * 0.5);\n                        ctx.lineTo(-size * 0.5, -size * 0.3);\n                        ctx.lineTo(-size, 0);\n                        ctx.lineTo(-size * 0.5, size * 0.3);\n                        ctx.lineTo(0, size * 0.5);\n                        ctx.lineTo(size * 0.5, size * 0.2);\n                        ctx.lineTo(size * 0.7, size * 0.4);\n                        ctx.closePath();\n                        ctx.fill();\n                        ctx.stroke();\n                        // Dragon eye\n                        ctx.fillStyle = '#ff0000';\n                        ctx.beginPath();\n                        ctx.arc(size * 0.6, -size * 0.1, size * 0.1, 0, Math.PI * 2);\n                        ctx.fill();\n                        // Fire breath\n                        ctx.fillStyle = `rgba(255, ${100 + Math.sin(time * 0.01) * 50}, 0, 0.7)`;\n                        ctx.beginPath();\n                        ctx.moveTo(size, 0);\n                        ctx.lineTo(size * 1.5, -size * 0.2);\n                        ctx.lineTo(size * 1.3, 0);\n                        ctx.lineTo(size * 1.5, size * 0.2);\n                        ctx.closePath();\n                        ctx.fill();\n                        break;\n\n                    case 'phoenix':\n                        // Phoenix - fiery bird shape\n                        ctx.fillStyle = '#ff4400';\n                        ctx.strokeStyle = '#ffaa00';\n                        ctx.lineWidth = 2 / this.camera.zoom;\n                        // Body\n                        ctx.beginPath();\n                        ctx.moveTo(size, 0);\n                        ctx.bezierCurveTo(size * 0.5, -size * 0.3, -size * 0.3, -size * 0.4, -size * 0.5, 0);\n                        ctx.bezierCurveTo(-size * 0.3, size * 0.4, size * 0.5, size * 0.3, size, 0);\n                        ctx.fill();\n                        ctx.stroke();\n                        // Wings\n                        ctx.fillStyle = '#ff6600';\n                        ctx.beginPath();\n                        ctx.moveTo(0, -size * 0.2);\n                        ctx.lineTo(-size * 0.3, -size * 0.9);\n                        ctx.lineTo(-size * 0.5, -size * 0.6);\n                        ctx.lineTo(-size * 0.7, -size * 0.8);\n                        ctx.lineTo(-size * 0.6, -size * 0.3);\n                        ctx.closePath();\n                        ctx.fill();\n                        ctx.beginPath();\n                        ctx.moveTo(0, size * 0.2);\n                        ctx.lineTo(-size * 0.3, size * 0.9);\n                        ctx.lineTo(-size * 0.5, size * 0.6);\n                        ctx.lineTo(-size * 0.7, size * 0.8);\n                        ctx.lineTo(-size * 0.6, size * 0.3);\n                        ctx.closePath();\n                        ctx.fill();\n                        // Tail flames\n                        const flicker = Math.sin(time * 0.02) * 0.2;\n                        ctx.fillStyle = `rgba(255, ${150 + flicker * 100}, 0, 0.8)`;\n                        ctx.beginPath();\n                        ctx.moveTo(-size * 0.5, 0);\n                        ctx.lineTo(-size * (1.2 + flicker), -size * 0.15);\n                        ctx.lineTo(-size * (1 + flicker), 0);\n                        ctx.lineTo(-size * (1.2 + flicker), size * 0.15);\n                        ctx.closePath();\n                        ctx.fill();\n                        break;\n\n                    case 'harvester':\n                        // STELLAR HARVESTER - Tie-fighter inspired design\n                        // Rotate 90 degrees to face forward\n                        ctx.rotate(Math.PI / 2);\n                        ctx.scale(1, pitchScale || 1); // Apply pitch scaling\n                        // Left hexagonal panel\n                        ctx.fillStyle = '#00ddff';\n                        ctx.strokeStyle = '#0088ff';\n                        ctx.lineWidth = 2 / this.camera.zoom;\n                        ctx.beginPath();\n                        for (let i = 0; i < 6; i++) {\n                            const angle = (Math.PI / 3) * i;\n                            const x = -size * 1.2 + Math.cos(angle) * size * 0.4;\n                            const y = Math.sin(angle) * size * 0.6;\n                            if (i === 0) ctx.moveTo(x, y);\n                            else ctx.lineTo(x, y);\n                        }\n                        ctx.closePath();\n                        ctx.fill();\n                        ctx.stroke();\n\n                        // Right hexagonal panel\n                        ctx.beginPath();\n                        for (let i = 0; i < 6; i++) {\n                            const angle = (Math.PI / 3) * i;\n                            const x = size * 1.2 + Math.cos(angle) * size * 0.4;\n                            const y = Math.sin(angle) * size * 0.6;\n                            if (i === 0) ctx.moveTo(x, y);\n                            else ctx.lineTo(x, y);\n                        }\n                        ctx.closePath();\n                        ctx.fill();\n                        ctx.stroke();\n\n                        // Central cockpit pod\n                        ctx.fillStyle = '#888888';\n                        ctx.strokeStyle = '#00ffff';\n                        ctx.lineWidth = 2 / this.camera.zoom;\n                        ctx.beginPath();\n                        ctx.ellipse(0, 0, size * 0.3, size * 0.25, 0, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.stroke();\n\n                        // Cockpit window\n                        ctx.fillStyle = '#00ffff';\n                        ctx.beginPath();\n                        ctx.arc(0, 0, size * 0.12, 0, Math.PI * 2);\n                        ctx.fill();\n\n                        // Connecting struts\n                        ctx.strokeStyle = '#666666';\n                        ctx.lineWidth = 3 / this.camera.zoom;\n                        ctx.beginPath();\n                        ctx.moveTo(-size * 0.3, 0);\n                        ctx.lineTo(-size * 0.8, 0);\n                        ctx.moveTo(size * 0.3, 0);\n                        ctx.lineTo(size * 0.8, 0);\n                        ctx.stroke();\n\n                        // Engine glow on panels\n                        const pulseGlow = 0.3 + Math.sin(time * 0.005) * 0.2;\n                        ctx.fillStyle = `rgba(0, 255, 100, ${pulseGlow})`;\n                        ctx.beginPath();\n                        ctx.arc(-size * 1.2, 0, size * 0.15, 0, Math.PI * 2);\n                        ctx.fill();\n                        ctx.beginPath();\n                        ctx.arc(size * 1.2, 0, size * 0.15, 0, Math.PI * 2);\n                        ctx.fill();\n                        break;\n\n                    case 'interceptor':\n                    default:\n                        // STELLAR HARVESTER - Advanced gem collection vessel\n                        ctx.fillStyle = '#00ffff';\n                        ctx.strokeStyle = '#0088ff';\n                        ctx.lineWidth = 3 / this.camera.zoom;\n                        ctx.beginPath();\n                        ctx.moveTo(size, 0);\n                        ctx.lineTo(-size * 0.6, -size * 0.6);\n                        ctx.lineTo(-size * 0.4, 0);\n                        ctx.lineTo(-size * 0.6, size * 0.6);\n                        ctx.closePath();\n                        ctx.fill();\n                        ctx.stroke();\n                        // Engine glow\n                        ctx.fillStyle = '#ff6600';\n                        ctx.beginPath();\n                        ctx.arc(-size * 0.5, 0, size * 0.2, 0, Math.PI * 2);\n                        ctx.fill();\n                        break;\n                }\n\n                ctx.restore();\n            }\n\n            renderMinerals(ctx, time) {\n                this.minerals.forEach(mineral => {\n                    ctx.save();\n                    // Use world coordinates (ctx already transformed)\n                    ctx.translate(mineral.x, mineral.y);\n\n                    // Safeguard against invalid zoom\n                    const safeZoom = Math.max(0.01, this.camera.zoom || 1);\n\n                    // Pulsing glow animation\n                    const pulse = Math.sin(time * 0.003 + mineral.phase) * 0.3 + 0.7;\n                    const size = mineral.size * pulse / safeZoom;\n\n                    // Ensure size is valid\n                    if (!isFinite(size) || size <= 0) {\n                        ctx.restore();\n                        return;\n                    }\n\n                    // Glow effect\n                    const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, size * 2);\n                    gradient.addColorStop(0, mineral.color);\n                    gradient.addColorStop(0.5, mineral.color + '88');\n                    gradient.addColorStop(1, mineral.color + '00');\n\n                    ctx.fillStyle = gradient;\n                    ctx.beginPath();\n                    ctx.arc(0, 0, size * 2, 0, Math.PI * 2);\n                    ctx.fill();\n\n                    // Core\n                    ctx.fillStyle = mineral.color;\n                    ctx.beginPath();\n                    ctx.arc(0, 0, size, 0, Math.PI * 2);\n                    ctx.fill();\n\n                    // Bright center\n                    ctx.fillStyle = '#ffffff';\n                    ctx.globalAlpha = 0.5;\n                    ctx.beginPath();\n                    ctx.arc(0, 0, size * 0.4, 0, Math.PI * 2);\n                    ctx.fill();\n                    ctx.globalAlpha = 1;\n\n                    ctx.restore();\n                });\n            }\n\n            renderCollectionNotifications(ctx) {\n                const canvas = this.canvas;\n                const now = Date.now();\n\n                this.collectionNotifications.forEach(notification => {\n                    const age = now - notification.time;\n                    const opacity = Math.max(0, 1 - age / 2000);\n                    const yOffset = age * 0.05;\n\n                    ctx.save();\n                    ctx.setTransform(1, 0, 0, 1, 0, 0);\n\n                    ctx.globalAlpha = opacity;\n                    ctx.font = 'bold 20px Arial';\n                    ctx.fillStyle = notification.color;\n                    ctx.strokeStyle = '#000';\n                    ctx.lineWidth = 3;\n                    ctx.textAlign = 'center';\n\n                    const x = canvas.width / 2;\n                    const y = canvas.height / 2 - 100 - yOffset;\n\n                    ctx.strokeText(notification.text, x, y);\n                    ctx.fillText(notification.text, x, y);\n                    ctx.globalAlpha = 1;\n\n                    ctx.restore();\n                });\n            }\n\n            drawBackgroundElements() {\n                if (!this.config.showBackground) return;\n\n                const ctx = this.ctx;\n\n                // 1. Background Stars (from all active styles)\n                if (this.backgroundStars && this.backgroundStars.length > 0) {\n                    this.backgroundStars.forEach(s => {\n                        ctx.fillStyle = s.color || \"white\";\n                        ctx.globalAlpha = s.alpha;\n                        ctx.beginPath();\n                        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);\n                        ctx.fill();\n                    });\n                    ctx.globalAlpha = 1;\n                }\n\n                // 2. Nebulae (from nebula + deep-space styles)\n                if (this.nebulae && this.nebulae.length > 0) {\n                    ctx.globalCompositeOperation = 'screen';\n                    this.nebulae.forEach(n => {\n                        if (n.flownOut) return; // Skip if flown out during warp\n\n                        // During disengage: use scale and alpha from flyObject\n                        let scale = 1.0;\n                        let alpha = 1.0;\n                        if (this.warpDisengaging && n.warpScale !== undefined) {\n                            scale = n.warpScale || 0.01;\n                            alpha = n.warpAlpha || 0;\n                        }\n\n                        const scaledSize = Math.max(0.1, n.size * scale);\n                        const scaledAlpha = n.alpha * alpha;\n\n                        const grad = ctx.createRadialGradient(n.x, n.y, 0, n.x, n.y, scaledSize);\n                        grad.addColorStop(0, n.color);\n                        grad.addColorStop(1, 'transparent');\n\n                        ctx.globalAlpha = scaledAlpha;\n                        ctx.fillStyle = grad;\n                        ctx.beginPath();\n                        ctx.arc(n.x, n.y, scaledSize, 0, Math.PI * 2);\n                        ctx.fill();\n                    });\n                    ctx.globalCompositeOperation = 'source-over';\n                    ctx.globalAlpha = 1;\n                }\n\n                // 2.5 Moving Cosmic Stars (shooting stars with tails)\n                if (this.activeStyles.has('deep-space') && this.shootingStars && this.shootingStars.length > 0) {\n                    this.shootingStars.forEach(s => {\n                        ctx.save();\n\n                        // Draw tail (gradient line in opposite direction of movement)\n                        const tailX = s.x - s.vx * s.tailLength;\n                        const tailY = s.y - s.vy * s.tailLength;\n\n                        const tailGrad = ctx.createLinearGradient(tailX, tailY, s.x, s.y);\n                        tailGrad.addColorStop(0, 'transparent');\n                        tailGrad.addColorStop(0.7, s.color + '40');\n                        tailGrad.addColorStop(1, s.color);\n\n                        ctx.strokeStyle = tailGrad;\n                        ctx.lineWidth = s.size * 0.8;\n                        ctx.lineCap = 'round';\n                        ctx.globalAlpha = s.alpha;\n\n                        ctx.beginPath();\n                        ctx.moveTo(tailX, tailY);\n                        ctx.lineTo(s.x, s.y);\n                        ctx.stroke();\n\n                        // Draw star head (bright point)\n                        ctx.fillStyle = s.color;\n                        ctx.globalAlpha = s.alpha + 0.3;\n                        ctx.beginPath();\n                        ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);\n                        ctx.fill();\n\n                        ctx.restore();\n                    });\n                    ctx.globalAlpha = 1;\n                }\n\n                // 3. Spacecraft (from alien style) - ENHANCED RENDERING\n                if (this.activeStyles.has('alien') && this.spacecraft && this.spacecraft.length > 0) {\n                    const time = performance.now() * 0.001;\n                    this.spacecraft.forEach(s => {\n                        if (s.flownOut) return; // Skip if flown out during warp\n                        ctx.save();\n\n                        // Position comes from flyObject during disengage\n                        ctx.translate(s.x, s.y);\n\n                        // During disengage: use scale and alpha from flyObject\n                        if (this.warpDisengaging && s.warpScale !== undefined) {\n                            ctx.scale(s.warpScale, s.warpScale);\n                            ctx.globalAlpha = s.warpAlpha || 0;\n                        }\n\n                        // Update rotation for saucers\n                        if (s.rotationSpeed) s.rotation += s.rotationSpeed;\n\n                        const size = s.size;\n                        const zoom = this.camera.zoom;\n                        const angle = Math.atan2(s.vy, s.vx);\n\n                        // Shield effect (drawn first, behind ship)\n                        if (s.hasShield) {\n                            const shieldPulse = Math.sin(time * 2 + s.shieldPhase) * 0.3 + 0.4;\n                            ctx.globalAlpha = shieldPulse * 0.4;\n                            const shieldGrad = ctx.createRadialGradient(0, 0, size * 0.5, 0, 0, size * 1.5);\n                            shieldGrad.addColorStop(0, 'transparent');\n                            shieldGrad.addColorStop(0.7, s.shieldColor || 'rgba(100,200,255,0.3)');\n                            shieldGrad.addColorStop(1, 'transparent');\n                            ctx.fillStyle = shieldGrad;\n                            ctx.beginPath();\n                            ctx.arc(0, 0, size * 1.5, 0, Math.PI * 2);\n                            ctx.fill();\n                            ctx.globalAlpha = 1;\n                        }\n\n                        // Tractor beam (for saucers)\n                        if (s.beamActive && s.shipClass === 'saucer') {\n                            const beamPulse = Math.sin(time * 5) * 0.2 + 0.6;\n                            ctx.globalAlpha = beamPulse * 0.5;\n                            const beamGrad = ctx.createLinearGradient(0, size * 0.2, 0, size * 3);\n                            beamGrad.addColorStop(0, s.beamColor || '#88ff88');\n                            beamGrad.addColorStop(1, 'transparent');\n                            ctx.fillStyle = beamGrad;\n                            ctx.beginPath();\n                            ctx.moveTo(-size * 0.3, size * 0.2);\n                            ctx.lineTo(-size * 0.8, size * 3);\n                            ctx.lineTo(size * 0.8, size * 3);\n                            ctx.lineTo(size * 0.3, size * 0.2);\n                            ctx.closePath();\n                            ctx.fill();\n                            ctx.globalAlpha = 1;\n                        }\n\n                        // Rotate for directional ships (not saucers)\n                        if (s.shipClass !== 'saucer') {\n                            ctx.rotate(angle);\n                        }\n\n                        // Engine trails (for non-saucers)\n                        if (s.shipClass !== 'saucer' && s.shipClass !== 'probe') {\n                            ctx.globalAlpha = 0.7;\n                            const trailLength = size * 2;\n                            const engineSpacing = size * 0.25;\n                            const engineCount = s.engineCount || 2;\n\n                            for (let i = 0; i < engineCount; i++) {\n                                const offsetY = (i - (engineCount - 1) / 2) * engineSpacing;\n                                const flicker = 0.7 + Math.sin(time * 15 + s.detailSeed + i) * 0.3;\n                                const trailGrad = ctx.createLinearGradient(-size * 0.7, offsetY, -size * 0.7 - trailLength * flicker, offsetY);\n                                trailGrad.addColorStop(0, s.engineGlow || '#ffffff');\n                                trailGrad.addColorStop(0.15, s.engineColor || '#00aaff');\n                                trailGrad.addColorStop(1, 'transparent');\n\n                                ctx.fillStyle = trailGrad;\n                                ctx.beginPath();\n                                ctx.moveTo(-size * 0.65, offsetY - 4);\n                                ctx.quadraticCurveTo(-size * 0.7 - trailLength * 0.5 * flicker, offsetY, -size * 0.7 - trailLength * flicker, offsetY);\n                                ctx.quadraticCurveTo(-size * 0.7 - trailLength * 0.5 * flicker, offsetY, -size * 0.65, offsetY + 4);\n                                ctx.closePath();\n                                ctx.fill();\n                            }\n                            ctx.globalAlpha = 1;\n                        }\n\n                        // Hull gradient\n                        const hullGrad = ctx.createLinearGradient(0, -size * 0.5, 0, size * 0.5);\n                        hullGrad.addColorStop(0, s.hullHighlight || '#ccc');\n                        hullGrad.addColorStop(0.3, s.hullColor || '#888');\n                        hullGrad.addColorStop(1, s.hullShadow || '#333');\n                        ctx.fillStyle = hullGrad;\n                        ctx.strokeStyle = s.hullHighlight || '#ddd';\n                        ctx.lineWidth = 1.5 / zoom;\n\n                        // === SHIP RENDERING: 13 Star Wars-Quality Spacecraft ===\n                        if (s.shipClass === 'saucer') {\n                            ctx.beginPath();\n                            ctx.ellipse(0, 0, size, size * 0.25, 0, 0, Math.PI * 2);\n                            ctx.fill();\n                            ctx.stroke();\n                            const domeGrad = ctx.createRadialGradient(-size * 0.1, -size * 0.15, 0, 0, -size * 0.05, size * 0.4);\n                            domeGrad.addColorStop(0, '#ffffff');\n                            domeGrad.addColorStop(0.3, s.domeColor || '#88ffff');\n                            domeGrad.addColorStop(1, 'rgba(0,50,50,0.8)');\n                            ctx.fillStyle = domeGrad;\n                            ctx.beginPath();\n                            ctx.ellipse(0, -size * 0.08, size * 0.35, size * 0.25, 0, Math.PI, 0);\n                            ctx.fill();\n                        } else if (s.shipClass === 'star-dreadnought') {\n                            ctx.beginPath();\n                            ctx.moveTo(size * 1.2, 0);\n                            for (let i = 0; i < 6; i++) {\n                                const angle = (i / 6) * Math.PI * 2;\n                                ctx.lineTo(Math.cos(angle) * size * 0.8, Math.sin(angle) * size * 0.8);\n                            }\n                            ctx.closePath();\n                            ctx.fill();\n                            ctx.stroke();\n                        } else if (s.shipClass === 'quantum-scout') {\n                            for (let i = 0; i < 3; i++) {\n                                ctx.save();\n                                ctx.rotate(time * (2 + i) + i);\n                                ctx.strokeStyle = '#00aaff';\n                                ctx.lineWidth = 2;\n                                ctx.beginPath();\n                                ctx.ellipse(0, 0, size * (0.6 + i * 0.3), size * 0.2, 0, 0, Math.PI * 2);\n                                ctx.stroke();\n                                ctx.restore();\n                            }\n                        } else if (s.shipClass === 'void-fighter') {\n                            ctx.beginPath();\n                            ctx.moveTo(size * 0.9, 0);\n                            ctx.lineTo(size * 0.2, -size * 0.5);\n                            ctx.lineTo(-size * 0.6, -size * 0.3);\n                            ctx.lineTo(-size * 0.6, size * 0.3);\n                            ctx.lineTo(size * 0.2, size * 0.5);\n                            ctx.closePath();\n                            ctx.fill();\n                            ctx.stroke();\n                        } else if (s.shipClass === 'nebula-cruiser') {\n                            // Concorde-style supersonic jet\n                            const hullGrad = ctx.createLinearGradient(-size, 0, size, 0);\n                            hullGrad.addColorStop(0, '#606080');\n                            hullGrad.addColorStop(0.5, '#8080a0');\n                            hullGrad.addColorStop(1, '#505070');\n                            ctx.fillStyle = hullGrad;\n                            // Sleek fuselage with pointed nose\n                            ctx.beginPath();\n                            ctx.moveTo(size * 1.2, 0);\n                            ctx.lineTo(size * 0.7, -size * 0.08);\n                            ctx.lineTo(-size * 0.5, -size * 0.12);\n                            ctx.lineTo(-size * 0.8, 0);\n                            ctx.lineTo(-size * 0.5, size * 0.12);\n                            ctx.lineTo(size * 0.7, size * 0.08);\n                            ctx.closePath();\n                            ctx.fill();\n                            ctx.stroke();\n                            // Delta wings\n                            ctx.fillStyle = '#7070a0';\n                            ctx.beginPath();\n                            ctx.moveTo(size * 0.2, 0);\n                            ctx.lineTo(-size * 0.3, -size * 0.6);\n                            ctx.lineTo(-size * 0.6, -size * 0.4);\n                            ctx.closePath();\n                            ctx.fill();\n                            ctx.beginPath();\n                            ctx.moveTo(size * 0.2, 0);\n                            ctx.lineTo(-size * 0.3, size * 0.6);\n                            ctx.lineTo(-size * 0.6, size * 0.4);\n                            ctx.closePath();\n                            ctx.fill();\n                        } else if (s.shipClass === 'bio-corvette') {\n                            const bioGrad = ctx.createLinearGradient(-size, 0, size, 0);\n                            bioGrad.addColorStop(0, '#4a0066');\n                            bioGrad.addColorStop(0.5, '#9900cc');\n                            bioGrad.addColorStop(1, '#660099');\n                            ctx.fillStyle = bioGrad;\n                            ctx.beginPath();\n                            ctx.moveTo(size * 0.8, 0);\n                            ctx.bezierCurveTo(size * 0.6, -size * 0.4, size * 0.2, -size * 0.5, -size * 0.3, -size * 0.3);\n                            ctx.bezierCurveTo(-size * 0.7, 0, -size * 0.3, size * 0.3, size * 0.2, size * 0.5);\n                            ctx.bezierCurveTo(size * 0.6, size * 0.4, size * 0.8, 0, size * 0.8, 0);\n                            ctx.fill();\n                        } else if (s.shipClass === 'warp-strider') {\n                            const hullGrad = ctx.createLinearGradient(-size, 0, size, 0);\n                            hullGrad.addColorStop(0, '#606060');\n                            hullGrad.addColorStop(0.5, '#a0a0a0');\n                            hullGrad.addColorStop(1, '#505050');\n                            ctx.fillStyle = hullGrad;\n                            ctx.beginPath();\n                            ctx.moveTo(size * 0.8, 0);\n                            ctx.lineTo(size * 0.3, -size * 0.15);\n                            ctx.lineTo(-size * 0.6, -size * 0.15);\n                            ctx.lineTo(-size * 0.8, 0);\n                            ctx.lineTo(-size * 0.6, size * 0.15);\n                            ctx.lineTo(size * 0.3, size * 0.15);\n                            ctx.closePath();\n                            ctx.fill();\n                            ctx.fillStyle = '#707070';\n                            ctx.fillRect(-size * 0.7, -size * 0.5, size * 0.4, size * 0.08);\n                            ctx.fillRect(-size * 0.7, size * 0.42, size * 0.4, size * 0.08);\n                        } else if (s.shipClass === 'prism-destroyer') {\n                            const hullGrad = ctx.createLinearGradient(-size, -size, size, size);\n                            hullGrad.addColorStop(0, '#c0c0c0');\n                            hullGrad.addColorStop(0.5, '#e8e8e8');\n                            hullGrad.addColorStop(1, '#707070');\n                            ctx.fillStyle = hullGrad;\n                            ctx.beginPath();\n                            ctx.moveTo(size, 0);\n                            ctx.lineTo(size * 0.3, -size * 0.6);\n                            ctx.lineTo(-size * 0.5, -size * 0.5);\n                            ctx.lineTo(-size * 0.8, 0);\n                            ctx.lineTo(-size * 0.5, size * 0.5);\n                            ctx.lineTo(size * 0.3, size * 0.6);\n                            ctx.closePath();\n                            ctx.fill();\n                            ctx.stroke();\n                        } else if (s.shipClass === 'stellar-barge') {\n                            const hullGrad = ctx.createLinearGradient(-size, 0, size, 0);\n                            hullGrad.addColorStop(0, '#4a3820');\n                            hullGrad.addColorStop(0.5, '#8B6F47');\n                            hullGrad.addColorStop(1, '#3a2810');\n                            ctx.fillStyle = hullGrad;\n                            ctx.fillRect(-size * 0.7, -size * 0.35, size * 1.3, size * 0.7);\n                            ctx.fillStyle = '#5a4830';\n                            ctx.beginPath();\n                            ctx.moveTo(size * 0.7, -size * 0.25);\n                            ctx.lineTo(size, 0);\n                            ctx.lineTo(size * 0.7, size * 0.25);\n                            ctx.closePath();\n                            ctx.fill();\n                        } else if (s.shipClass === 'cyber-sentry') {\n                            const eyeGrad = ctx.createRadialGradient(0, 0, 0, 0, 0, size * 0.4);\n                            eyeGrad.addColorStop(0, '#ff0000');\n                            eyeGrad.addColorStop(0.5, '#880000');\n                            eyeGrad.addColorStop(1, '#220000');\n                            ctx.fillStyle = eyeGrad;\n                            ctx.beginPath();\n                            ctx.arc(0, 0, size * 0.35, 0, Math.PI * 2);\n                            ctx.fill();\n                            for (let i = 0; i < 8; i++) {\n                                const angle = (i / 8) * Math.PI * 2 + time;\n                                ctx.strokeStyle = '#ff0000';\n                                ctx.lineWidth = 2;\n                                ctx.beginPath();\n                                ctx.moveTo(Math.cos(angle) * size * 0.4, Math.sin(angle) * size * 0.4);\n                                ctx.lineTo(Math.cos(angle) * size * 0.8, Math.sin(angle) * size * 0.8);\n                                ctx.stroke();\n                            }\n                        } else if (s.shipClass === 'aether-wing') {\n                            const grad = ctx.createLinearGradient(-size, 0, size, 0);\n                            grad.addColorStop(0, 'rgba(0,100,255,0)');\n                            grad.addColorStop(0.5, 'rgba(100,200,255,0.6)');\n                            grad.addColorStop(1, 'rgba(0,100,255,0)');\n                            ctx.fillStyle = grad;\n                            ctx.beginPath();\n                            ctx.moveTo(-size * 0.8, -size * 0.6);\n                            ctx.lineTo(size * 0.8, 0);\n                            ctx.lineTo(-size * 0.8, size * 0.6);\n                            ctx.closePath();\n                            ctx.fill();\n                        } else if (s.shipClass === 'death-sphere') {\n                            const sphereGrad = ctx.createRadialGradient(-size * 0.2, -size * 0.2, 0, 0, 0, size);\n                            sphereGrad.addColorStop(0, '#505050');\n                            sphereGrad.addColorStop(0.5, '#303030');\n                            sphereGrad.addColorStop(1, '#101010');\n                            ctx.fillStyle = sphereGrad;\n                            ctx.beginPath();\n                            ctx.arc(0, 0, size, 0, Math.PI * 2);\n                            ctx.fill();\n                            ctx.stroke();\n                            const laserGrad = ctx.createRadialGradient(size * 0.4, -size * 0.4, 0, size * 0.4, -size * 0.4, size * 0.12);\n                            laserGrad.addColorStop(0, '#00ff00');\n                            laserGrad.addColorStop(0.5, '#00aa00');\n                            laserGrad.addColorStop(1, 'rgba(0,170,0,0)');\n                            ctx.fillStyle = laserGrad;\n                            ctx.beginPath();\n                            ctx.arc(size * 0.4, -size * 0.4, size * 0.1, 0, Math.PI * 2);\n                            ctx.fill();\n                        } else if (s.shipClass === 'tie-fighter') {\n                            const cockpitGrad = ctx.createRadialGradient(0, 0, 0, 0, 0, size * 0.3);\n                            cockpitGrad.addColorStop(0, '#606060');\n                            cockpitGrad.addColorStop(0.7, '#303030');\n                            cockpitGrad.addColorStop(1, '#101010');\n                            ctx.fillStyle = cockpitGrad;\n                            ctx.beginPath();\n                            for (let i = 0; i < 6; i++) {\n                                const angle = (i / 6) * Math.PI * 2 - Math.PI / 2;\n                                const x = Math.cos(angle) * size * 0.25;\n                                const y = Math.sin(angle) * size * 0.25;\n                                if (i === 0) ctx.moveTo(x, y);\n                                else ctx.lineTo(x, y);\n                            }\n                            ctx.closePath();\n                            ctx.fill();\n                            ctx.stroke();\n                            const panelGrad = ctx.createLinearGradient(-size, -size, size, size);\n                            panelGrad.addColorStop(0, '#404040');\n                            panelGrad.addColorStop(0.5, '#505050');\n                            panelGrad.addColorStop(1, '#303030');\n                            ctx.fillStyle = panelGrad;\n                            ctx.fillRect(-size * 1.2, -size * 0.8, size * 0.8, size * 1.6);\n                            ctx.strokeRect(-size * 1.2, -size * 0.8, size * 0.8, size * 1.6);\n                            ctx.fillRect(size * 0.4, -size * 0.8, size * 0.8, size * 1.6);\n                            ctx.strokeRect(size * 0.4, -size * 0.8, size * 0.8, size * 1.6);\n                        } else {\n                            // Default fallback for any unrecognized ships\n                            ctx.beginPath();\n                            ctx.arc(0, 0, size * 0.5, 0, Math.PI * 2);\n                            ctx.fill();\n                            ctx.stroke();\n                        }\n\n                        // Navigation lights (for non-probes, non-saucers)\n                        if (s.shipClass !== 'probe' && s.shipClass !== 'saucer') {\n                            const lightPulse = Math.sin(time * 3 + (s.lightPhase || 0)) * 0.5 + 0.5;\n                            ctx.fillStyle = s.lightColor || '#ff00ff';\n                            ctx.globalAlpha = lightPulse;\n                            ctx.beginPath();\n                            ctx.arc(size * 0.85, 0, 3 / zoom, 0, Math.PI * 2);\n                            ctx.fill();\n\n                            // Wing tip lights\n                            ctx.fillStyle = '#00ff00';\n                            ctx.beginPath();\n                            ctx.arc(-size * 0.5, -size * 0.6, 2 / zoom, 0, Math.PI * 2);\n                            ctx.fill();\n                            ctx.fillStyle = '#ff0000';\n                            ctx.beginPath();\n                            ctx.arc(-size * 0.5, size * 0.6, 2 / zoom, 0, Math.PI * 2);\n                            ctx.fill();\n                            ctx.globalAlpha = 1;\n                        }\n\n                        ctx.restore();\n                    });\n                }\n            }\n\n            drawDeepSpaceSpecific() {\n                if (!this.config.showBackground) return;\n\n                const ctx = this.ctx;\n                const time = performance.now() * 0.0005;\n\n                // 1. Galaxies\n                if (this.galaxies && this.galaxies.length > 0) {\n                    this.galaxies.forEach(g => {\n                        if (g.flownOut) return; // Skip if flown out during warp\n                        ctx.save();\n                        // Position comes from flyObject during disengage\n                        ctx.translate(g.x, g.y);\n\n                        // During disengage: use scale and alpha from flyObject\n                        if (this.warpDisengaging && g.warpScale !== undefined) {\n                            ctx.scale(g.warpScale, g.warpScale);\n                            ctx.globalAlpha = g.warpAlpha || 0;\n                        }\n\n                        ctx.rotate(g.angle + time * 0.1);\n\n                        const spiralGradient = ctx.createRadialGradient(0, 0, 0, 0, 0, g.size);\n                        spiralGradient.addColorStop(0, 'rgba(255,255,255,0.8)');\n                        spiralGradient.addColorStop(0.2, g.color);\n                        spiralGradient.addColorStop(1, 'transparent');\n\n                        ctx.fillStyle = spiralGradient;\n                        ctx.beginPath();\n                        for (let i = 0; i < 3; i++) {\n                            ctx.rotate(Math.PI * 2 / 3);\n                            ctx.ellipse(0, 0, g.size, g.size / 4, 0, 0, Math.PI * 2); // Corrected ellipse center\n                        }\n                        ctx.fill();\n                        ctx.restore();\n                    });\n                }\n\n                // 2. Black Holes\n                if (this.blackHoles && this.blackHoles.length > 0) {\n                    this.blackHoles.forEach(bh => {\n                        if (bh.flownOut) return; // Skip if flown out during warp\n                        ctx.save();\n\n                        // Position comes from flyObject during disengage\n                        ctx.translate(bh.x, bh.y);\n\n                        // During disengage: use scale and alpha from flyObject\n                        if (this.warpDisengaging && bh.warpScale !== undefined) {\n                            ctx.scale(bh.warpScale, bh.warpScale);\n                            ctx.globalAlpha = bh.warpAlpha || 0;\n                        }\n\n                        // Accretion disk\n                        ctx.beginPath();\n                        ctx.strokeStyle = 'orange';\n                        ctx.lineWidth = 2;\n                        ctx.arc(0, 0, bh.size * 1.5, 0, Math.PI * 2);\n                        ctx.stroke();\n\n                        // Event Horizon\n                        ctx.beginPath();\n                        ctx.fillStyle = 'black';\n                        ctx.arc(0, 0, bh.size, 0, Math.PI * 2);\n                        ctx.fill();\n\n                        // Glow\n                        ctx.shadowColor = 'purple';\n                        ctx.shadowBlur = 20;\n                        ctx.stroke();\n                        ctx.shadowBlur = 0;\n\n                        ctx.restore();\n                    });\n                }\n\n                // 3. Planets (with zoom-based detail and proper Saturn-style rings)\n                if (this.planets && this.planets.length > 0) {\n                    const zoom = this.camera.zoom;\n                    this.planets.forEach(p => {\n                        if (p.flownOut) return; // Skip if flown out during warp\n                        ctx.save();\n\n                        // Position comes from flyObject during disengage\n                        ctx.translate(p.x, p.y);\n\n                        // During disengage: use scale and alpha from flyObject\n                        if (this.warpDisengaging && p.warpScale !== undefined) {\n                            ctx.scale(p.warpScale, p.warpScale);\n                            ctx.globalAlpha = p.warpAlpha || 0;\n                        }\n\n                        ctx.rotate(p.axialTilt);\n\n                        const screenRadius = p.radius * zoom;\n                        const detailLevel = Math.min(3, Math.floor(screenRadius / 30)); // 0-3 detail levels\n\n                        // === SATURN-STYLE RINGS: Draw back half first ===\n                        if (p.hasRings) {\n                            this.drawPlanetRingsHalf(ctx, p, 'back');\n                        }\n\n                        // Atmospheric glow (outer)\n                        if (p.hasAtmosphere) {\n                            const atmosGrad = ctx.createRadialGradient(0, 0, p.radius * 0.95, 0, 0, p.radius * 1.15);\n                            atmosGrad.addColorStop(0, 'transparent');\n                            atmosGrad.addColorStop(0.5, p.atmosphereColor + '40');\n                            atmosGrad.addColorStop(1, 'transparent');\n                            ctx.fillStyle = atmosGrad;\n                            ctx.beginPath();\n                            ctx.arc(0, 0, p.radius * 1.15, 0, Math.PI * 2);\n                            ctx.fill();\n                        }\n\n                        // Planet body with 3D gradient\n                        const bodyGrad = ctx.createRadialGradient(\n                            -p.radius * 0.3, -p.radius * 0.3, 0,\n                            0, 0, p.radius\n                        );\n                        bodyGrad.addColorStop(0, p.secondaryColor);\n                        bodyGrad.addColorStop(0.4, p.baseColor);\n                        bodyGrad.addColorStop(0.8, p.tertiaryColor);\n                        bodyGrad.addColorStop(1, '#000000');\n\n                        ctx.fillStyle = bodyGrad;\n                        ctx.beginPath();\n                        ctx.arc(0, 0, p.radius, 0, Math.PI * 2);\n                        ctx.fill();\n\n                        // Surface texture (procedural bands/patterns based on zoom)\n                        if (detailLevel >= 1) {\n                            ctx.globalAlpha = 0.3;\n                            ctx.strokeStyle = p.tertiaryColor;\n                            ctx.lineWidth = 2 / zoom;\n\n                            // Draw bands for gas giants\n                            if (p.type === 'gas-giant' || p.type === 'ice-giant') {\n                                for (let i = -4; i <= 4; i++) {\n                                    const bandY = p.radius * (i * 0.15);\n                                    const bandWidth = Math.sqrt(p.radius * p.radius - bandY * bandY);\n                                    if (bandWidth > 0) {\n                                        ctx.beginPath();\n                                        ctx.ellipse(0, bandY, bandWidth, 3, 0, 0, Math.PI * 2);\n                                        ctx.stroke();\n                                    }\n                                }\n                            }\n\n                            // Draw continents for terrestrial/ocean\n                            if ((p.type === 'terrestrial' || p.type === 'ocean') && detailLevel >= 2) {\n                                ctx.fillStyle = p.type === 'ocean' ? p.baseColor : p.secondaryColor;\n                                const seed = p.textureSeed;\n                                for (let j = 0; j < 5; j++) {\n                                    const cx = Math.cos(seed + j * 1.2) * p.radius * 0.5;\n                                    const cy = Math.sin(seed * 0.7 + j) * p.radius * 0.4;\n                                    const cr = p.radius * (0.15 + Math.sin(seed + j) * 0.1);\n                                    ctx.beginPath();\n                                    ctx.arc(cx, cy, cr, 0, Math.PI * 2);\n                                    ctx.fill();\n                                }\n                            }\n                            ctx.globalAlpha = 1;\n                        }\n\n                        // Shadow side\n                        const shadowGrad = ctx.createLinearGradient(-p.radius, 0, p.radius, 0);\n                        shadowGrad.addColorStop(0, 'transparent');\n                        shadowGrad.addColorStop(0.6, 'transparent');\n                        shadowGrad.addColorStop(1, 'rgba(0,0,0,0.6)');\n                        ctx.fillStyle = shadowGrad;\n                        ctx.beginPath();\n                        ctx.arc(0, 0, p.radius, 0, Math.PI * 2);\n                        ctx.fill();\n\n                        // === SATURN-STYLE RINGS: Draw front half on top ===\n                        if (p.hasRings) {\n                            this.drawPlanetRingsHalf(ctx, p, 'front');\n                        }\n\n                        ctx.restore();\n                    });\n                }\n            }\n\n            // Helper method for drawing Saturn-style planet rings (half at a time)\n            drawPlanetRingsHalf(ctx, planet, half) {\n                const p = planet;\n                ctx.save();\n\n                // Create clipping region for front or back half\n                ctx.beginPath();\n                if (half === 'back') {\n                    // Back half: top portion of ellipse (behind planet)\n                    ctx.rect(-p.ringOuterRadius * 1.5, -p.ringOuterRadius, p.ringOuterRadius * 3, p.ringOuterRadius);\n                } else {\n                    // Front half: bottom portion of ellipse (in front of planet)\n                    ctx.rect(-p.ringOuterRadius * 1.5, 0, p.ringOuterRadius * 3, p.ringOuterRadius);\n                }\n                ctx.clip();\n\n                // Draw the ring bands\n                ctx.globalAlpha = half === 'back' ? 0.4 : 0.7; // Back rings dimmer\n\n                // Multiple ring bands with gradient colors\n                for (let i = 0; i < 5; i++) {\n                    const ringR = p.ringInnerRadius + (p.ringOuterRadius - p.ringInnerRadius) * (i / 5 + 0.1);\n                    const ringThickness = (p.ringOuterRadius - p.ringInnerRadius) * 0.12;\n\n                    // Slight color variation per band\n                    const hueShift = i * 5;\n                    ctx.strokeStyle = p.ringColor;\n                    ctx.lineWidth = ringThickness;\n\n                    ctx.beginPath();\n                    ctx.ellipse(0, 0, ringR, ringR * 0.25, 0, 0, Math.PI * 2);\n                    ctx.stroke();\n                }\n\n                ctx.restore();\n            }\n\n            drawStarShape(ctx, x, y, r) {\n                ctx.beginPath();\n                const pr = r * 0.5;\n                ctx.moveTo(x, y - r);\n                ctx.lineTo(x + pr, y - pr);\n                ctx.lineTo(x + r, y);\n                ctx.lineTo(x + pr, y + pr);\n                ctx.lineTo(x, y + r);\n                ctx.lineTo(x - pr, y + pr);\n                ctx.lineTo(x - r, y);\n                ctx.lineTo(x - pr, y - pr);\n                ctx.closePath();\n                ctx.fill();\n            }\n\n            // Get the center point of all stars (constellation center)\n            getConstellationCenter() {\n                if (this.stars.length === 0) {\n                    return { x: this.canvas.width / 2, y: this.canvas.height / 2, z: 0 };\n                }\n                let sumX = 0, sumY = 0, sumZ = 0;\n                this.stars.forEach(s => {\n                    sumX += s.x;\n                    sumY += s.y;\n                    sumZ += (s.z || 0);\n                });\n                return {\n                    x: sumX / this.stars.length,\n                    y: sumY / this.stars.length,\n                    z: sumZ / this.stars.length\n                };\n            }\n\n            // 3D Rotation: Rotate a point around a given center\n            rotate3D(x, y, z, centerX, centerY) {\n                // Convert degrees to radians\n                const radX = this.rotationX * Math.PI / 180;\n                const radY = this.rotationY * Math.PI / 180;\n                const radZ = this.rotationZ * Math.PI / 180;\n\n                // Translate to origin (center of view)\n                let px = x - centerX;\n                let py = y - centerY;\n                let pz = z;\n\n                // Rotation around X axis\n                let y1 = py * Math.cos(radX) - pz * Math.sin(radX);\n                let z1 = py * Math.sin(radX) + pz * Math.cos(radX);\n                py = y1;\n                pz = z1;\n\n                // Rotation around Y axis\n                let x1 = px * Math.cos(radY) + pz * Math.sin(radY);\n                z1 = -px * Math.sin(radY) + pz * Math.cos(radY);\n                px = x1;\n                pz = z1;\n\n                // Rotation around Z axis\n                x1 = px * Math.cos(radZ) - py * Math.sin(radZ);\n                y1 = px * Math.sin(radZ) + py * Math.cos(radZ);\n                px = x1;\n                py = y1;\n\n                // Simple perspective projection (optional depth effect)\n                const fov = 800;\n                const scale = fov / (fov + pz);\n\n                // Translate back\n                return {\n                    x: px * scale + centerX,\n                    y: py * scale + centerY,\n                    scale: scale\n                };\n            }\n\n            // Inverse 3D Rotation: Project screen point back to 3D world (at Z=0 plane relative to rotation)\n            inverseRotate3D(x, y, centerX, centerY) {\n                // Negate angles for inverse rotation\n                const radX = -this.rotationX * Math.PI / 180;\n                const radY = -this.rotationY * Math.PI / 180;\n                const radZ = -this.rotationZ * Math.PI / 180;\n\n                // Translate to origin\n                let px = x - centerX;\n                let py = y - centerY;\n                let pz = 0; // Assume we are clicking on the plane passing through center\n\n                // Inverse Order: X^-1( Y^-1( Z^-1( P ) ) )\n                // Note: Forward was RotZ(RotY(RotX(P))). Inverse is RotXinv(RotYinv(RotZinv(P))).\n\n                // 1. Inverse Z Rotation\n                let x1 = px * Math.cos(radZ) - py * Math.sin(radZ);\n                let y1 = px * Math.sin(radZ) + py * Math.cos(radZ);\n                px = x1;\n                py = y1;\n\n                // 2. Inverse Y Rotation\n                x1 = px * Math.cos(radY) + pz * Math.sin(radY);\n                let z1 = -px * Math.sin(radY) + pz * Math.cos(radY);\n                px = x1;\n                pz = z1;\n\n                // 3. Inverse X Rotation\n                y1 = py * Math.cos(radX) - pz * Math.sin(radX);\n                z1 = py * Math.sin(radX) + pz * Math.cos(radX);\n                py = y1;\n                pz = z1;\n\n                // Translate back\n                return {\n                    x: px + centerX,\n                    y: py + centerY,\n                    z: pz\n                };\n            }\n\n            // Reset rotation sliders and values\n            resetRotation() {\n                this.rotationX = 0;\n                this.rotationY = 0;\n                this.rotationZ = 0;\n\n                const xSlider = document.getElementById('rotXSlider');\n                const ySlider = document.getElementById('rotYSlider');\n                const zSlider = document.getElementById('rotZSlider');\n\n                if (xSlider) { xSlider.value = 0; document.getElementById('rotXValue').textContent = '0'; }\n                if (ySlider) { ySlider.value = 0; document.getElementById('rotYValue').textContent = '0'; }\n                if (zSlider) { zSlider.value = 0; document.getElementById('rotZValue').textContent = '0'; }\n            }\n\n            calculateGeometry() {\n                const lines = [];\n                const adj = {};\n                // Performance fix: use Map for O(1) star lookups\n                const starMap = new Map();\n                this.stars.forEach(s => {\n                    adj[s.id] = [];\n                    starMap.set(s.id, s);\n                });\n\n                for (let i = 0; i < this.stars.length; i++) {\n                    for (let j = i + 1; j < this.stars.length; j++) {\n                        const s1 = this.stars[i];\n                        const s2 = this.stars[j];\n                        const dist = Math.hypot(s1.x - s2.x, s1.y - s2.y);\n\n                        if (dist < this.config.maxConnectDist) {\n                            lines.push({ s1, s2, dist });\n                            adj[s1.id].push(s2.id);\n                            adj[s2.id].push(s1.id);\n                        }\n                    }\n                }\n\n                // BFS for clusters\n                const clusters = [];\n                const visited = new Set();\n                this.stars.forEach(star => {\n                    if (!visited.has(star.id)) {\n                        const cluster = [];\n                        const queue = [star.id];\n                        visited.add(star.id);\n                        while (queue.length) {\n                            const id = queue.shift();\n                            const s = starMap.get(id); // O(1) lookup\n                            if (s) cluster.push(s);\n                            adj[id].forEach(nid => {\n                                if (!visited.has(nid)) {\n                                    visited.add(nid);\n                                    queue.push(nid);\n                                }\n                            });\n                        }\n                        if (cluster.length > 0) clusters.push(cluster);\n                    }\n                });\n\n                return { lines, clusters };\n            }\n\n            showToast(msg) {\n                console.log('[Toast]', msg);\n                // Create a toast element if needed\n                let toast = document.getElementById('toast');\n                if (!toast) {\n                    toast = document.createElement('div');\n                    toast.id = 'toast';\n                    toast.style.cssText = 'position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.8);color:white;padding:10px 20px;border-radius:8px;z-index:9999;transition:opacity 0.3s';\n                    document.body.appendChild(toast);\n                }\n                toast.textContent = msg;\n                toast.style.opacity = '1';\n                clearTimeout(this._toastTimeout);\n                this._toastTimeout = setTimeout(() => { toast.style.opacity = '0'; }, 2000);\n            }\n\n            // Ship Selection Methods\n            showShipModal() {\n                const modal = document.getElementById('shipModal');\n                if (modal) modal.classList.add('active');\n            }\n\n            hideShipModal() {\n                const modal = document.getElementById('shipModal');\n                if (modal) modal.classList.remove('active');\n            }\n\n            selectShip(shipType) {\n                const ships = {\n                    interceptor: { name: 'Interceptor', maxSpeed: 50, acceleration: 0.5 },\n                    saucer: { name: 'Saucer', maxSpeed: 70, acceleration: 0.7 },\n                    hauler: { name: 'Hauler', maxSpeed: 30, acceleration: 0.3 },\n                    orion: { name: 'Orion', maxSpeed: 60, acceleration: 0.6 },\n                    draco: { name: 'Draco', maxSpeed: 80, acceleration: 0.4 },\n                    phoenix: { name: 'Phoenix', maxSpeed: 55, acceleration: 0.8 },\n                    harvester: { name: 'Starfighter', maxSpeed: 80, acceleration: 0.8 }\n                };\n                const ship = ships[shipType];\n                if (ship && this.playerShip) {\n                    this.playerShip.type = shipType;\n                    this.playerShip.maxSpeed = ship.maxSpeed;\n                    this.playerShip.acceleration = ship.acceleration;\n                    this.showToast(`Selected ${ship.name}`);\n                }\n                this.hideShipModal();\n            }\n\n            downloadSVG() {\n                if (this.stars.length === 0) {\n                    this.showToast(\"Universe is empty!\");\n                    return;\n                }\n\n                // Ensure cluster IDs are assigned for naming in SVG\n                this.refreshClusterAssignments();\n\n                let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n                this.stars.forEach(s => {\n                    minX = Math.min(minX, s.x); minY = Math.min(minY, s.y);\n                    maxX = Math.max(maxX, s.x); maxY = Math.max(maxY, s.y);\n                });\n\n                const pad = 100;\n                const w = (maxX - minX) + pad * 2;\n                const h = (maxY - minY) + pad * 2;\n                const vbX = minX - pad;\n                const vbY = minY - pad;\n\n                const { lines, clusters } = this.calculateGeometry();\n\n                let svg = `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"${vbX} ${vbY} ${w} ${h}\" style=\"background:#020205\">\n            <rect x=\"${vbX}\" y=\"${vbY}\" width=\"${w}\" height=\"${h}\" fill=\"#020205\"/>`;\n\n                // Lines\n                lines.forEach(l => {\n                    const op = (1 - (l.dist / this.config.maxConnectDist)).toFixed(2);\n                    const [r, g, b] = this.hexToRgb(this.getStarColor(l.s1));\n                    svg += `<line x1=\"${l.s1.x}\" y1=\"${l.s1.y}\" x2=\"${l.s2.x}\" y2=\"${l.s2.y}\" stroke=\"rgb(${r}, ${g}, ${b})\" stroke-width=\"1.5\" stroke-linecap=\"round\" opacity=\"${op * 0.8}\"/>`;\n                });\n\n                // Labels\n                clusters.forEach(c => {\n                    const name = String(c[0].clusterId);\n                    if (c.length < this.config.minGroupSize || name === String(c[0].id)) return;\n\n                    let cx = 0, cy = 0; c.forEach(s => { cx += s.x; cy += s.y }); cx /= c.length; cy /= c.length;\n                    const color = this.getStarColor(c[0]);\n                    svg += `<text x=\"${cx}\" y=\"${cy + 30}\" font-family=\"sans-serif\" font-size=\"14\" fill=\"${color}\" text-anchor=\"middle\" font-weight=\"600\">${name}</text>`;\n                });\n\n                // Stars\n                this.stars.forEach(s => {\n                    const color = this.getStarColor(s);\n                    const r = this.config.starBaseRad * 1.5;\n\n                    // Star Shape\n                    const pr = r * 0.5;\n                    const pathData = `M${s.x} ${s.y - r} L${s.x + pr} ${s.y - pr} L${s.x + r} ${s.y} L${s.x + pr} ${s.y + pr} L${s.x} ${s.y + r} L${s.x - pr} ${s.y + pr} L${s.x - r} ${s.y} L${s.x - pr} ${s.y - pr} Z`;\n                    svg += `<path d=\"${pathData}\" fill=\"${color}\" opacity=\"0.8\"/>`;\n\n                    // Core dot\n                    svg += `<circle cx=\"${s.x}\" cy=\"${s.y}\" r=\"1.5\" fill=\"white\" />`;\n                });\n\n                svg += `</svg>`;\n\n                // FileSaver-style download for Chrome compatibility\n                const blob = new Blob([svg], { type: 'image/svg+xml;charset=utf-8' });\n                const filename = `AetherMap-${Date.now()}.svg`;\n\n                // Try using msSaveBlob for IE/Edge compatibility\n                if (typeof window.navigator.msSaveBlob !== 'undefined') {\n                    window.navigator.msSaveBlob(blob, filename);\n                    this.showToast(\"Map Exported\");\n                    return;\n                }\n\n                const url = window.URL.createObjectURL(blob);\n                const link = document.createElement('a');\n                link.href = url;\n                link.download = filename;\n\n                // Dispatch a real click event instead of calling click()\n                const event = new MouseEvent('click', {\n                    view: window,\n                    bubbles: true,\n                    cancelable: true\n                });\n                link.dispatchEvent(event);\n\n                // Clean up after a delay\n                setTimeout(() => {\n                    window.URL.revokeObjectURL(url);\n                }, 1000);\n\n                this.showToast(\"Map Exported\");\n            }\n\n            // Download canvas as PNG image\n            downloadPNG() {\n                const filename = `Interstellar-${Date.now()}.png`;\n                const link = document.createElement('a');\n                link.download = filename;\n                link.href = this.canvas.toDataURL('image/png');\n\n                // Dispatch a real click event for Chrome compatibility\n                const event = new MouseEvent('click', {\n                    view: window,\n                    bubbles: true,\n                    cancelable: true\n                });\n                link.dispatchEvent(event);\n\n                this.showToast(\"Image saved as \" + filename);\n            }\n\n            // Trigger the hidden file input for loading SVG\n            triggerLoadSVG() {\n                document.getElementById('svgFileInput').click();\n            }\n\n            // Load and parse an SVG file to restore stars\n            loadSVG(event) {\n                const file = event.target.files[0];\n                if (!file) return;\n\n                const reader = new FileReader();\n                reader.onload = (e) => {\n                    try {\n                        const svgContent = e.target.result;\n                        const parser = new DOMParser();\n                        const doc = parser.parseFromString(svgContent, 'image/svg+xml');\n\n                        // Find all path elements (stars)\n                        const pathElements = doc.querySelectorAll('path[fill][opacity]');\n\n                        if (pathElements.length === 0) {\n                            this.showToast(\"No stars found in SVG\");\n                            return;\n                        }\n\n                        // Clear current stars and history\n                        this.stars = [];\n                        this.history = [];\n\n                        // Parse each path to extract star data\n                        pathElements.forEach((path, index) => {\n                            const d = path.getAttribute('d');\n                            const fill = path.getAttribute('fill');\n\n                            // Parse path: M{x} {y-r} L...\n                            const match = d.match(/M([-\\d.]+)\\s+([-\\d.]+)/);\n                            if (match) {\n                                const topX = parseFloat(match[1]);\n                                const topY = parseFloat(match[2]);\n                                const r = this.config.starBaseRad * 1.5;\n                                const y = topY + r;\n\n                                this.stars.push({\n                                    id: Date.now() + index,\n                                    x: topX,\n                                    y: y,\n                                    color: fill,\n                                    phase: Math.random() * Math.PI * 2,\n                                    clusterId: null\n                                });\n                            }\n                        });\n\n                        event.target.value = '';\n                        this.showToast(`Loaded ${this.stars.length} stars`);\n                        this.draw();\n                    } catch (err) {\n                        console.error('Error parsing SVG:', err);\n                        this.showToast(\"Error loading SVG file\");\n                    }\n                };\n                reader.readAsText(file);\n            }\n\n            // Export canvas animation as video\n            exportVideo() {\n                if (this._isRecording) {\n                    this.showToast(\"Already recording...\");\n                    return;\n                }\n\n                // Get selected duration\n                const durationSelect = document.getElementById('videoDuration');\n                const duration = durationSelect ? parseInt(durationSelect.value) : 5000;\n                const durationSec = duration / 1000;\n\n                this._isRecording = true;\n                const btn = document.getElementById('exportVideoBtn');\n                if (btn) btn.classList.add('active');\n\n                this.showToast(`Recording ${durationSec} seconds...`);\n\n                const stream = this.canvas.captureStream(30);\n                const chunks = [];\n\n                const mimeType = MediaRecorder.isTypeSupported('video/webm;codecs=vp9')\n                    ? 'video/webm;codecs=vp9'\n                    : 'video/webm';\n\n                const recorder = new MediaRecorder(stream, { mimeType });\n\n                recorder.ondataavailable = (e) => {\n                    if (e.data.size > 0) chunks.push(e.data);\n                };\n\n                recorder.onstop = () => {\n                    this._isRecording = false;\n                    if (btn) btn.classList.remove('active');\n\n                    const blob = new Blob(chunks, { type: mimeType });\n                    const filename = `Interstellar-${Date.now()}.webm`;\n                    const url = window.URL.createObjectURL(blob);\n                    const link = document.createElement('a');\n                    link.href = url;\n                    link.download = filename;\n\n                    // Dispatch a real click event for Chrome compatibility\n                    const event = new MouseEvent('click', {\n                        view: window,\n                        bubbles: true,\n                        cancelable: true\n                    });\n                    link.dispatchEvent(event);\n\n                    // Clean up after a delay\n                    setTimeout(() => {\n                        window.URL.revokeObjectURL(url);\n                    }, 1000);\n\n                    this.showToast(\"Video exported!\");\n                };\n\n                recorder.onerror = (e) => {\n                    this._isRecording = false;\n                    if (btn) btn.classList.remove('active');\n                    console.error('Recording error:', e);\n                    this.showToast(\"Recording failed\");\n                };\n\n                recorder.start();\n\n                setTimeout(() => {\n                    if (recorder.state === 'recording') {\n                        recorder.stop();\n                    }\n                }, duration);\n            }\n        }\n\n        window.app = new AetherEngine();\n    "],"file":"assets/interstellar-C1eK5Khi.js"}