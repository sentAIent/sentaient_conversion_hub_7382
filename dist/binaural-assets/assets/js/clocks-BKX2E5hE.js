import{R as e,i as t,e as s,M as i,V as a,u as n,J as o}from"./dynamic-import-helper-CTnsj-vI.js";import{E as r,p as d}from"./errors-DV9ybRQO.js";import{a as c,t as h,g as f}from"./array-YYQw31d9.js";import{B as l}from"./BaseMetric-ClLQP9bU.js";import{computed as u}from"./reactiveCustomization-CEUTOUc3.js";import{c as p}from"./compareObjects-R6Hcs7xe.js";import{P as g}from"./pinia-B4IAWUO-.js";class w{constructor({id:e=c(),timeZoneId:t="",timeZoneName:s="",currentOffset:i=0,name:a="",pinned:n=!1,isTeam:o=!1,archived:r=!1,readOnly:m=!1,icon:d}){this.id=e,this.timeZoneId=t,this.timeZoneName=s,this.currentOffset=i,this.name=a,this.pinned=n,this.isTeam=o,this.archived=r,this.readOnly=m,this.icon=d??"globe"}compare(e){return p((null==e?void 0:e.serialize())??new w({id:this.id}).serialize(),this.serialize())}validate(){if(""===this.timeZoneId||""===this.timeZoneName)throw new e({message:r.TimezoneEmpty,input:"timezone"});if(""===this.name)throw new e({message:r.NameEmpty,input:"name"})}serialize(){return{...this}}get type(){return l.Clock}get displayTooltip(){return this.difference}get displayValue(){return this.time}get date(){return m.models.date}get offset(){return this.currentOffset}set offset(e){this.currentOffset=e}get offsetDate(){const e=new Date(this.date.get("date"));return this.offset&&e.setUTCSeconds(e.getUTCSeconds()+this.offset),e}get time(){const e=this.offsetDate.getUTCHours(),t=h(this.offsetDate.getUTCMinutes());return u.hour12clock?`${e>12?e-12:0===e?12:e}:${t}${e>=12?"p":"a"}`:`${e<10?0:""}${e}:${t}`}get difference(){const e=this.date.get("date"),s=this.offsetDate,i=e.getDate()==s.getUTCDate()?"Today":e.getDate()+1==s.getUTCDate()?"Tomorrow":"Yesterday",a=e.getTime(),n=s.getTime()+60*s.getTimezoneOffset()*1e3,o=n>a?(n-a)/t.msPerHour:(a-n)/t.msPerHour;return i+", "+(a>n?"-":"+")+(o%1!=0?Math.round(10*o)/10:Math.round(o))+" hrs"}get timezone(){return{name:this.name,timeZoneName:this.timeZoneName,timeZoneId:this.timeZoneId,offset:this.offset}}set timezone(e){this.name||(this.name=e.name),this.timeZoneName=e.timeZoneName,this.timeZoneId=e.timeZoneId,this.offset=e.offset}}const v=((t=d().clocksService)=>{const r=s("clocks",{plugins:[g.MockData],state:()=>({data:{},loading:!1,loaded:!1,activeItem:null,randomItems:[]}),getters:{items:e=>Object.values(e.data).filter((e=>!e.archived)).map((e=>new w(e))).sort(((e,t)=>e.offset-t.offset)).sort(((e,t)=>+t.pinned-+e.pinned)),unpinnedItems:e=>Object.values(e.data).filter((e=>!e.archived&&!e.pinned)).map((e=>new w(e))),pinnedItems:e=>Object.values(e.data).filter((e=>!e.archived&&e.pinned)).map((e=>new w(e))).sort(((e,t)=>t.offset-e.offset)),archivedItems:e=>Object.values(e.data).filter((e=>e.archived)).map((e=>new w(e))),getItemById(e){const t=e.data;return e=>{const s=t[e];if(s)return new w(s)}},showRandom(){return 0===this.pinnedItems.length||!!u["showRandomMetric-clock"]}},actions:{clearActiveItem(){this.activeItem=null},setRandomItems(){!this.showRandom||this.unpinnedItems.length<=0?this.randomItems=[]:this.randomItems=[f(this.unpinnedItems)]},newItem(){this.activeItem||(this.activeItem=new w({}))},editItem(t){const s=this.data[t];if(!s)throw new e({message:`No clock found with id: ${t}`});this.activeItem=new w(s)},refresh(e){!(null==e?void 0:e.force)&&(this.loading||this.loaded&&!(null==e?void 0:e.archived))||(this.loading=!0,t.get({success:e=>{this.data=Object.fromEntries(e.map((e=>[e.id,e]))),this.loaded=!0,this.loading=!1},failure:()=>{this.loading=!1},...(null==e?void 0:e.archived)&&{queryParams:{includeArchived:"true"},mode:i.Server}}))},async create(e){a.set(this.data,e.id,e),await t.create(e)},async update(s,i){const n=this.data[s];if(!n)throw new e({message:`No clock found with id: ${s}`});a.set(this.data,s,{...n,...i}),await t.update(s,i)},async delete(e){a.delete(this.data,e),await t.delete(e)},async openItemOnTeamSite(e){let s=await t.getMetricServerId(e);s.toUpperCase().startsWith("T")&&(s=s.substring(1)),m.commandManager.execute("window.account.open.login",`/team/${l.Clock}?id=${s}`)}}});return(async()=>{const e=r();await n((()=>e.loaded)).toBe(!0),o((()=>e.showRandom),(()=>{e.setRandomItems()}))})(),r})(),I=Object.freeze(Object.defineProperty({__proto__:null,default:v,useClocksStore:v},Symbol.toStringTag,{value:"Module"}));export{w as C,I as c,v as u};