import{computed as t}from"./reactiveCustomization-CEUTOUc3.js";import{O as e,c as o,o as s,A as i}from"./dynamic-import-helper-CTnsj-vI.js";import{u as r}from"./useAllComponentsMounted-VdWDSwjD.js";import{s as a}from"./showAnyway-8ON2gVJd.js";import{B as n}from"./BaseDropdownOption-tB3ldrjh.js";import{B as d}from"./BaseDropdownDivider-Bay0Demn.js";import{B as c}from"./BaseDropdown-CB3yfeIu.js";import{a as u}from"./modal-qMFaWR5h.js";import{U as l}from"./enums-1c3kgXdw.js";import p from"./AppContainer-BFIQ2qhm.js";import h from"./BaseIcon-BW2ar6VN.js";import{a as v,D as g}from"./constants-CALDQiUE.js";import{n as f}from"./_plugin-vue2_normalizer-DeUNqxFl.js";import w from"./icon-heart-Ba128MNM.js";import"./VueBase-C55TLWt3.js";import"./_commonjsHelpers-B3K3fdV-.js";import"./ClickOutside-DCLvi2fj.js";import"./pinia-B4IAWUO-.js";import"./portal-vue.esm-DdddSpdW.js";import"./array-YYQw31d9.js";import"./style-D-IRYiWS.js";import"./Logger-cMW5At62.js";import"./string-BBKP9xfj.js";import"./BaseDropdownContent-C68ik0op.js";import"./index-998LMmMn.js";import"./icon-ellipsis-D7nTOXaQ.js";const b=Backbone.Model.extend({defaults:{_id:"",body:"",source:"",is_custom:!1,detail_url:"",twitter:""},idAttribute:"forDate"}),y=m.models.FeedManager.extend({initialize:function(){m.models.FeedManager.prototype.initialize.call(this,m.models.Quote,"quote")}}),k=Backbone.Collection.extend({localStorage:new Backbone.LocalStorage("momentum-quote"),model:m.models.Quote,getActiveItem:function(){if(this.length>0){let t=m.utils.getDateString();return this.get(t)}}});var D=(t=>(t.BlueSky="bluesky",t.LinkedIn="linkedin",t.Reddit="reddit",t.Threads="threads",t.X="x",t))(D||{});const _=new i({feature:"quotes"});const q=f(e({name:"ShareDropdown",components:{BaseDropdown:c,BaseDropdownOption:n,BaseIcon:h},props:{quote:{type:Object,required:!0},isCustom:{type:Boolean,default:!1}},setup:()=>({DropdownPosition:v,DropdownAlignment:g,shareDropdown:o(),SharePlatform:D}),methods:{closeDropdown(){var t;null==(t=this.shareDropdown)||t.closeDropdown()},getShareText(t={}){const e=this.quote.get("body"),{includeAttribution:o=!0,platform:s=null}=t;let i=`“${e}”`;if(this.quote.get("twitter")?i+=` – @${this.quote.get("twitter")}`:this.quote.get("source")&&(i+=` – ${this.quote.get("source")}`),o)switch(s){case D.BlueSky:i+=" via @momentumdash.bsky.social";break;case D.Reddit:i+=" via r/MomentumDash";break;default:i+=" via @momentumdash"}return i},getShareLink(t){switch(t){case D.BlueSky:return`https://bsky.app/intent/compose?text=${encodeURIComponent(this.getShareText({platform:D.BlueSky}))}`;case D.LinkedIn:return`https://www.linkedin.com/feed/?shareActive=true&text=${encodeURIComponent(this.getShareText())}`;case D.Reddit:return`https://www.reddit.com/submit?title=${encodeURIComponent(this.getShareText({platform:D.Reddit}))}`;case D.Threads:return`https://www.threads.net/intent/post?text=${encodeURIComponent(this.getShareText({platform:D.Threads}))}`;case D.X:return`https://x.com/intent/tweet?text=${encodeURIComponent(this.getShareText({includeAttribution:!1}))}&via=momentumdash&related=momentumdash,levibucsis`}},share(t){this.closeDropdown();const e=this.getShareLink(t);s(e),this.captureShareAnalytics(t)},captureShareAnalytics(t){_.capture("quote share",{custom:this.isCustom,platform:t})}}}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("base-dropdown",{ref:"shareDropdown",attrs:{"container-class":"dash",position:t.DropdownPosition.Right,alignment:t.DropdownAlignment.Center,nipple:!1,"position-offset":-5},scopedSlots:t._u([{key:"toggle",fn:function(){return[e("base-dropdown-option",{attrs:{"data-test":"share"}},[e("base-icon",{attrs:{src:"share"}}),t._v(" Share ")],1)]},proxy:!0}])},[e("base-dropdown-option",{attrs:{"data-test":"share-bluesky"},on:{click:function(e){return t.share(t.SharePlatform.BlueSky)}}},[e("base-icon",{attrs:{src:"icon/social/bluesky"}}),t._v(" Bluesky ")],1),e("base-dropdown-option",{attrs:{"data-test":"share-linkedin"},on:{click:function(e){return t.share(t.SharePlatform.LinkedIn)}}},[e("base-icon",{attrs:{src:"icon/social/linkedin"}}),t._v(" LinkedIn ")],1),e("base-dropdown-option",{attrs:{"data-test":"share-reddit"},on:{click:function(e){return t.share(t.SharePlatform.Reddit)}}},[e("base-icon",{attrs:{src:"icon/social/reddit"}}),t._v(" Reddit ")],1),e("base-dropdown-option",{attrs:{"data-test":"share-threads"},on:{click:function(e){return t.share(t.SharePlatform.Threads)}}},[e("base-icon",{attrs:{src:"icon/social/threads"}}),t._v(" Threads ")],1),e("base-dropdown-option",{attrs:{"data-test":"share-x"},on:{click:function(e){return t.share(t.SharePlatform.X)}}},[e("base-icon",{attrs:{src:"icon/social/x"}}),t._v(" X ")],1)],1)}),[],!1,null,null).exports,Q=new i({feature:"quotes"});m.models.Quote=b,m.collect.Quotes=k,m.collect.quotes=new k,m.models.QuoteManager=y,m.models.quoteManager=new y;const S=f({name:"Quote",components:{AppContainer:p,BaseDropdown:c,BaseDropdownDivider:d,BaseDropdownOption:n,BaseIcon:h,ShareDropdown:q},bb:()=>({collection:m.collect.quotes}),setup:()=>({...r(),debouncedHover:null}),data:()=>({activeQuoteId:"",skipping:!1,dropdownActive:!1,quoteOverride:""}),computed:{showAnyway:()=>a.includes("quote"),quoteVisible:()=>t.quoteVisible,activeQuote(){return this.quoteOverride||this.collection.get(this.activeQuoteId)},quoteUuid(){return this.activeQuote?this.activeQuote.get("_id"):""},isCustom(){return!!this.activeQuote&&this.activeQuote.get("is_custom")},body(){return this.activeQuote?`“${this.activeQuote.get("body")}”`:""},bodyArray(){return this.body.split(" ")},source(){return this.activeQuote?this.activeQuote.get("source"):""},detailUrl(){return this.activeQuote?this.activeQuote.get("detail_url"):""},isFavorite(){return!!this.activeQuote&&this.activeQuote.get("is_favorite")}},created(){m.models.quoteManager.firstFetch(),this.setQuote(),m.on("newDay",this.setQuote),m.collect.quotes.on("reset add change sync refresh",this.setQuote),m.on("quote:override",this.overrideQuote),m.trigger("quote:created")},destroyed(){m.off("newDay",this.setQuote),m.collect.quotes.off("reset add change sync refresh",this.setQuote),m.off("quote:override",this.overrideQuote)},methods:{overrideQuote(t){this.quoteOverride=t?{body:t,forDate:m.utils.getDateString(),_id:m.utils.uuidv4(),get(t){return this[t]}}:null},handleClick(){var t;this.$touch&&(null==(t=this.$refs.settingsDropdown)||t.openDropdown()),this.detailUrl&&this.detailUrl.length>0&&s(this.detailUrl)},captureDebouncedHover(t){const e=t.target;this.cancelDebouncedHoverCapture(),this.debouncedHover=setTimeout((()=>{e.matches(":hover")&&Q.capture("quote hover",{custom:this.isCustom})}),1e3)},cancelDebouncedHoverCapture(){clearTimeout(this.debouncedHover)},toggleFavorite(){let t=this.activeQuote.is_favorite=!this.isFavorite;m.models.quoteManager.toggleFavorite(t).catch((()=>this.activeQuote.is_favorite=!t)),Q.capture("quote "+(t?"fav":"unfav"),{custom:this.isCustom,location:"dash"})},skipQuote(){var t;if(!this.$plus)return null==(t=this.$refs.settingsDropdown)||t.closeDropdown(),void u(l.QUOTES,"dash");this.skipping||(this.skipping=!0,setTimeout((()=>{m.models.quoteManager.skipItem().finally((()=>{this.skipping=!1})),Q.capture("quote skip",{is_paid_event:!0,custom:this.isCustom})}),450))},setQuote(){this.activeQuoteId=this.getActiveQuote()},getActiveQuote(){let t;return this.collection.length>0&&(t=this.collection.getActiveItem()),t?(m.trigger("quote:downloaded"),t.id):(m.trigger("sync:download","quote"),"")},openSettings(){var t;null==(t=this.$refs.settingsDropdown)||t.closeDropdown(),m.commandManager.executeAsync("settings.display",null,{section:"quote-settings"})},openDropdown(){var t;null==(t=this.$refs.settingsDropdown)||t.openDropdown()},onDropdownToggle(t){this.dropdownActive=t},access:m.utils.access}},(function(){var t=this,e=t._self._c;return e("app-container",{attrs:{"app-name":"quote","data-test":"quote"},nativeOn:{mouseenter:function(e){return t.captureDebouncedHover.apply(null,arguments)},mouseleave:function(e){return t.cancelDebouncedHoverCapture.apply(null,arguments)},click:function(e){return e.preventDefault(),t.handleClick(e)},dblclick:function(e){return t.openDropdown.apply(null,arguments)}}},[e("transition",{attrs:{name:"fade",mode:"out-in"}},[t.activeQuote?e("div",{key:t.quoteUuid,staticClass:"app-dash dark",class:{active:t.dropdownActive},attrs:{"data-test":"app-dash"}},[e("p",{staticClass:"body"},[e("span",{staticClass:"body-text",attrs:{"data-test":"body-text"}},[t._v(t._s(t.body))])]),e("div",{staticClass:"below",attrs:{"data-test":"below"}},[t.source?e("span",{staticClass:"source u--mobile-hide",attrs:{"data-test":"source"}},[t._v(t._s(t.source))]):t._e(),e("base-dropdown",{ref:"settingsDropdown",attrs:{"container-class":"dash","data-test":"settings-dropdown","mobile-toggle-hidden":!0},on:{toggle:t.onDropdownToggle},scopedSlots:t._u([{key:"toastHeader",fn:function(){return[e("div",{staticClass:"toast-title",attrs:{"data-test":"body-text"}},[t._v(t._s(t.body))]),t.source?e("div",{staticClass:"toast-source",attrs:{"data-test":"source"}},[t._v("– "+t._s(t.source))]):t._e()]},proxy:!0}],null,!1,3597242828)},[e("base-dropdown-option",{attrs:{"data-test":"favorite"},on:{click:t.toggleFavorite}},[e("span",{class:["favorite",{active:t.isFavorite}],attrs:{"data-test":"favorite-icon"}},[e("inline-svg",{staticClass:"icon icon-heart",attrs:{src:w}})],1),t._v(" "+t._s(t.isFavorite?"Unfavorite":"Favorite")+" ")]),e("base-dropdown-option",{attrs:{"data-test":"skip"},on:{click:t.skipQuote}},[e("base-icon",{attrs:{src:"redo"}}),t._v(" Skip to new quote "),t.$plus?t._e():e("span",{staticClass:"badge badge-plus"},[t._v("PLUS")])],1),e("share-dropdown",{attrs:{quote:t.activeQuote,"is-custom":t.isCustom}}),e("base-dropdown-divider"),e("base-dropdown-option",{attrs:{"data-test":"manage"},on:{click:t.openSettings}},[e("base-icon",{attrs:{src:"icon/apps/quotes"}}),t._v(" Manage quotes ")],1),e("base-dropdown-divider"),e("base-dropdown-option",{attrs:{"data-test":"settings"},on:{click:t.openSettings}},[e("base-icon",{attrs:{src:"icon/apps/settings"}}),t._v(" Settings ")],1)],1)],1)]):t._e()])],1)}),[],!1,null,"9a100a93").exports;export{S as default};